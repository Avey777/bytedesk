"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[871],{60871:function(e,t,a){a.d(t,{Z:function(){return _}});var s=a(84176),o=a.n(s),r=a(73193),n=a.n(r),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),p=a(45332),f=a.n(p),m=a(31756),h=a(30234),x=a(31881),M=a(25191),w=a(32597),k=a(91768),j=a(28031),b=a(80503),y=a(24418),v=a(75699),T=a(1670),S=a(4363),F=a(17606),I=a(68943),Z=a(37799),C=a(81213),A=a(42119),E=a(44194);function P(e){return D.apply(this,arguments)}function D(){return(D=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/robot/message/query/org",{method:"GET",params:n()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=a(47454),N=a(52544),U=a(31549),q=["current","pageSize"],z={RATE_PENDING:{text:"待评价",color:"default"},RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},_=function(e){var t=e.isSuperUser,a=(0,v.useIntl)(),s=(0,N.Z)().isDarkMode,r=(0,E.useRef)(),i=(0,h.Z)().translateString,l=(0,x.u)((function(e){return e.currentOrg})),u=(0,E.useState)(1),p=f()(u,2),D=p[0],_=p[1],L=(0,E.useState)(10),B=f()(L,2),O=B[0],G=B[1],H=(0,E.useState)([]),K=f()(H,2),W=K[0],V=K[1],Q=(0,E.useState)([]),J=f()(Q,2),Y=J[0],X=J[1],$=(0,E.useState)(0),ee=f()($,2),te=ee[0],ae=ee[1],se=(0,E.useState)({}),oe=f()(se,2),re=oe[0],ne=oe[1],ie=(0,E.useState)(!1),de=f()(ie,2),le=de[0],ce=de[1],ue=(0,E.useState)(""),ge=f()(ue,2),pe=ge[0],fe=ge[1],me=(0,E.useState)(!1),he=f()(me,2),xe=he[0],Me=he[1],we=(0,E.useState)(""),ke=f()(we,2),je=ke[0],be=ke[1],ye=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,U.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,U.jsx)(v.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:200,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.userNickname.tooltip"}),render:function(e,t){var a;return(0,U.jsx)(U.Fragment,{children:i(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,U.jsx)(v.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.robotNickname.tooltip"}),render:function(e,t){var a;return(0,U.jsx)(U.Fragment,{children:i(null==t||null===(a=t.robot)||void 0===a?void 0:a.nickname)})}},{title:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.prompt",defaultMessage:"Prompt"}),dataIndex:"prompt",hideInSearch:!0,width:250,ellipsis:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.prompt.tooltip"}),render:function(e,t){var s=t.prompt;return s?s.length>50?(0,U.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return Te(s)},children:[(0,U.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[s.substring(0,50),"..."]}),(0,U.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),Te(s)},children:a.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,U.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:s}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0,copyable:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.question.tooltip"})},{title:(0,U.jsx)(v.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.answer.tooltip"}),render:function(e,t){var s=t.answer;return s?s.length>100?(0,U.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return Se(s)},children:[(0,U.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[s.substring(0,100),"..."]}),(0,U.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),Se(s)},children:a.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,U.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:s}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"message.status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.status.tooltip"}),render:function(e,t){return(0,R.ng)(null==t?void 0:t.status)}},{title:(0,U.jsx)(v.FormattedMessage,{id:"message.channel",defaultMessage:"Channel"}),dataIndex:"channel",width:100,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.channel.tooltip"}),render:function(e,t){return(0,R.YG)(t.channel)}},{title:(0,U.jsx)(v.FormattedMessage,{id:"ai.unanswered",defaultMessage:"未回答"}),dataIndex:"isUnAnswered",width:120,hideInSearch:!0,valueType:"select",valueEnum:{true:{text:"未回答",status:"Error"},false:{text:"已回答",status:"Success"}},tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.isUnAnswered.tooltip"}),render:function(e,t){var a=t.isUnAnswered;return null==a?"-":(0,U.jsx)(F.Z,{status:a?"error":"success",text:a?"未回答":"已回答"})}},{title:(0,U.jsx)(v.FormattedMessage,{id:"ai.tokens.prompt",defaultMessage:"Prompt Tokens"}),dataIndex:"promptTokens",width:160,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.promptTokens.tooltip"}),render:function(e,t){var a=t.promptTokens;return a?(0,U.jsx)(I.Z,{color:"blue",children:a}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"ai.tokens.completion",defaultMessage:"Completion Tokens"}),dataIndex:"completionTokens",width:160,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.completionTokens.tooltip"}),render:function(e,t){var a=t.completionTokens;return a?(0,U.jsx)(I.Z,{color:"green",children:a}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"ai.tokens.total",defaultMessage:"Total Tokens"}),dataIndex:"totalTokens",width:140,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.totalTokens.tooltip"}),render:function(e,t){var a=t.totalTokens;return a?(0,U.jsx)(I.Z,{color:"orange",children:a}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"ai.provider",defaultMessage:"AI Provider"}),dataIndex:"aiProvider",width:120,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.aiProvider.tooltip"}),render:function(e,t){var a=t.aiProvider;return a?(0,U.jsx)(I.Z,{color:"purple",children:a}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"ai.model",defaultMessage:"AI Model"}),dataIndex:"aiModel",width:120,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.aiModel.tooltip"}),render:function(e,t){var a=t.aiModel;return a?(0,U.jsx)(I.Z,{color:"cyan",children:a}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,valueType:"select",valueEnum:{RATE_PENDING:{text:"待评价",status:"Default"},RATE_UP:{text:"点赞",status:"Success"},RATE_DOWN:{text:"点踩",status:"Error"},RATE_FEEDBACK:{text:"反馈意见",status:"Warning"},RATE_TRANSFER:{text:"转人工",status:"Processing"}},tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=z[a]||{text:a,color:"default"};return(0,U.jsx)(I.Z,{color:s.color,children:s.text||a})}},{title:(0,U.jsx)(v.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.rateDownTags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,U.jsx)(U.Fragment,{children:t.rateDownTagList.map((function(e){return(0,U.jsx)(I.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,U.jsx)(v.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.rateDownReason.tooltip"})},{title:(0,U.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,U.jsx)(v.FormattedMessage,{id:"robot.message.createdAt.tooltip"})},{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,o){return[(0,U.jsx)("a",{onClick:function(){ve(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,U.jsx)(Z.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return Fe(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,U.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],ve=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==l?void 0:l.uid,t:M.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},Te=function(e){fe(e),ce(!0)},Se=function(e){be(e),Me(!0)},Fe=function(){var e=g()(c()().mark((function e(t){var s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(s=r.current)||void 0===s||s.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=g()(c()().mark((function e(){var t,s,o,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Y.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,s=0,o=d()(Y);try{for(o.s();!(n=o.n()).done;)n.value}catch(e){o.e(e)}finally{o.f()}m.yw.destroy(),0===s?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:s})),V([]),X([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=g()(c()().mark((function e(t,a,s){var o,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),o=localStorage.getItem(M.LA8),r=n()({orgUid:(null==l?void 0:l.uid)||"",accessToken:o||"",exportType:t},re),"current"===t?(r.pageNumber=String(D-1),r.pageSize=String(O)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,w.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams(r).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),Ce=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),o=function(){var s=r,o=r*a+1,n=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(o,"-").concat(n," (").concat(n-o+1,"条)"),onClick:function(){return Ze("range",s,a)}})},r=0;r<s;r++)o();return t},Ae={selectedRowKeys:W,onChange:function(e,t){V(e),X(t)}};return(0,U.jsxs)(U.Fragment,{children:[(0,U.jsx)(y.Z,{columns:ye,actionRef:r,cardBordered:!0,rowSelection:Ae,scroll:{x:3e3},request:function(){var e=g()(c()().mark((function e(a,s,r){var n,i,d,u,g,p,f,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",a,s,r),n=a.current,i=a.pageSize,d=o()(a,q),_(n),G(i),ne(d),u=void 0,g=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],u=p,g="ascend"===s[p]?"ascend":"descend"),f={pageNumber:n-1,pageSize:i,orgUid:null==l?void 0:l.uid,isSuperUser:t,topic:d.topic,threadUid:d.threadUid,userNickname:d.userNickname,robotNickname:d.robotNickname,status:d.status,answer:d.answer,user:d.user,robot:d.robot,isUnAnswered:d.isUnAnswered,promptTokens:d.promptTokens,completionTokens:d.completionTokens,totalTokens:d.totalTokens,aiProvider:d.aiProvider,aiModel:d.aiModel,threads:d.threads,componentType:d.componentType,sortBy:u,sortDirection:g},e.next=11,P(f);case 11:return h=e.sent,console.log("getAllRobotMessages response:",f,h),200===h.code?ae(h.data.totalElements):m.yw.error(h.message),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"机器人消息",toolBarRender:function(){return function(){var e=[],t=[];W.length>0&&t.push({key:"batchDelete",icon:(0,U.jsx)(k.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){C.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:Ie,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,U.jsx)(j.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ze("current")}}];return te>0&&(te<=1e3?s.push({key:"export-all",icon:(0,U.jsx)(j.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(te,"条)"),onClick:function(){return Ze("all")}}):s.push({key:"export-range",icon:(0,U.jsx)(j.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(te,"条)"),children:Ce(te)})),e.push((0,U.jsx)(A.Z,{menu:{items:s},placement:"bottom",children:(0,U.jsxs)(S.ZP,{icon:(0,U.jsx)(j.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,U.jsx)(b.Z,{})]},"button")},"export")),t.length>0&&e.push((0,U.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,U.jsxs)(S.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,U.jsx)(b.Z,{})]})},"batchOperations")),e}()}}),(0,U.jsx)(C.Z,{title:a.formatMessage({id:"prompt.detail",defaultMessage:"Prompt Details"}),open:le,onCancel:function(){return ce(!1)},footer:[(0,U.jsx)(S.ZP,{onClick:function(){navigator.clipboard.writeText(pe),m.yw.success(a.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"}))},children:a.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,U.jsx)(S.ZP,{onClick:function(){return ce(!1)},children:a.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,U.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,U.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:s?"#1f1f1f":"#f5f5f5",color:s?"#ffffff":"#000000",padding:"12px",borderRadius:"4px",border:"1px solid ".concat(s?"#434343":"#d9d9d9")},children:pe})})}),(0,U.jsx)(C.Z,{title:a.formatMessage({id:"answer.detail",defaultMessage:"Answer Details"}),open:xe,onCancel:function(){return Me(!1)},footer:[(0,U.jsx)(S.ZP,{onClick:function(){navigator.clipboard.writeText(je),m.yw.success(a.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"}))},children:a.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,U.jsx)(S.ZP,{onClick:function(){return Me(!1)},children:a.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,U.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,U.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:s?"#1f1f1f":"#f5f5f5",color:s?"#ffffff":"#000000",padding:"12px",borderRadius:"4px",border:"1px solid ".concat(s?"#434343":"#d9d9d9")},children:je})})})]})}}}]);