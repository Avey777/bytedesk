"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9290],{86985:function(e,s,r){r.d(s,{Z:function(){return j}});var t=r(90819),a=r.n(t),n=r(89933),i=r.n(n),o=r(45332),l=r.n(o),c=r(5025),d=r(5488),u=r(14870);function f(){return g.apply(this,arguments)}function g(){return(g=i()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,s){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(s,r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:s,captchaCode:r,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=r(58087),x=r(27259),y=r(44194),M=r(31549),j=function(e){var s=e.onKaptchaChange,r=e.onKaptchaCheck,t=(0,u.useIntl)(),n=(0,y.useState)(),o=l()(n,2),d=o[0],g=o[1],m=(0,y.useState)(),j=l()(m,2),w=j[0],v=j[1],Z=(0,y.useState)(!1),b=l()(Z,2),k=b[0],C=b[1],S=function(){var e=i()(a()().mark((function e(){var s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=2;break}return e.abrupt("return");case 2:return C(!0),e.prev=3,e.next=6,f();case 6:200===(s=e.sent).code?(g(s.data.captchaUid),v(s.data.captchaImage)):c.yw.error(t.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),c.yw.error(t.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 13:return e.prev=13,C(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(){return e.apply(this,arguments)}}(),z=function(){var e=i()(a()().mark((function e(s,t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(s,t);case 2:n=e.sent,console.log("checkCaptcha response",n),200===n.code?r&&r(!0):r&&r(!1);case 5:case"end":return e.stop()}}),e)})));return function(s,r){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){S()}),[]);return(0,M.jsx)(M.Fragment,{children:w&&(0,M.jsxs)(M.Fragment,{children:[(0,M.jsx)(x.Z,{onChange:function(e){s&&(s(d,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?z(d,e.target.value):r&&r(!1))},prefix:(0,M.jsx)(h.Z,{}),placeholder:t.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,M.jsx)("img",{src:w,alt:"captcha",onClick:S})]})})}},92023:function(e,s,r){r.d(s,{G:function(){return g}});var t=r(73193),a=r.n(t),n=(r(44194),r(15435)),i=r(5488),o=r(28977),l=r.n(o),c=r(95660),d=r(5025),u=r(18580),f=r(31549),g=function(e){var s=e.children,r=e.onSuccess,t=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},g={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){c.Z.log("beforeUpload",e);var s=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=s,o.fileType=e.type,c.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&c.Z.log("not uploading:",e.file),"done"===e.file.status)if(c.Z.log("response: ",e.file.response),200===e.file.response.code){var s=e.file.response.data.fileUrl;r(s),d.yw.success("".concat(e.file.name," 上传成功"))}else t(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),t(e.file))}};return(0,f.jsx)(n.Z,a()(a()({},g),{},{children:s}))}},9362:function(e,s,r){r.r(s),r.d(s,{default:function(){return fe}});var t=r(73193),a=r.n(t),n=r(90819),i=r.n(n),o=r(89933),l=r.n(o),c=r(45332),d=r.n(c),u=r(44194),f=r(14870),g=r(85817),p=r(79401),m=r(5780),h=r(78875),x=r(20228),y=r(49616),M=r(45681),j=r(88344),w=r(27473),v=r(93892),Z=r(82373),b=r(32394),k=r(48821),C=r(16331),S=r(10022),z=r(80556),P=r(59908),U=r(55439),I=r(88008),T=r(93689),R=r(36099),A=r(58791),F=r(13891),D=r(82690),O=r(26978),E=r(31806),L=r(40439),q=r(79479),B=r(90033),V=r(20467),N=r(5025),Y=r(92023),K=r(18751),G=r(33363),W=r(16843),$=r(86985),H=r(34599),J=r(5488),Q=r(40795),X=r(71017),_=r(68349),ee=r(31549),se=function(e){var s=e.open,r=e.onSubmit,t=e.onClose,a=(0,f.useIntl)(),n=b.A.useForm(),o=d()(n,1)[0],c=(0,K.Z)().translateString,g=(0,B.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),p=g.userInfo,m=g.deviceUid,h=(0,H.u)((function(e){return e.currentOrg})),x=(0,u.useRef)(),y=(0,u.useState)(""),M=d()(y,2),j=M[0],w=M[1],v=(0,u.useState)(""),Z=d()(v,2),C=Z[0],S=Z[1],z=(0,u.useState)(!1),P=d()(z,2),U=P[0],I=P[1],T=function(){var e=l()(i()().mark((function e(s,r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",s," captchaValue",r),w(s),S(r);case 3:case"end":return e.stop()}}),e)})));return function(s,r){return e.apply(this,arguments)}}(),R=function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",s),I(s);case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),A=function(){var e=l()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=l()(i()().mark((function e(s){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changeEmail:",s),(null==p?void 0:p.email)!==s.email){e.next=4;break}return N.yw.error("Email is not changed!"),e.abrupt("return");case 4:return a={email:s.email,code:s.code,platform:J.iw8},e.next=7,(0,V.Uk)(a);case 7:n=e.sent,console.log("changeEmail response:",n),200===n.code?(N.yw.success("Email changed successfully!"),r(s.email),t()):N.yw.error(c(n.message));case 10:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=x.current)||void 0===e||e.endTiming()}),2)};return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(_.Z,{title:a.formatMessage({id:"pages.settings.reset.email",defaultMessage:"重置邮箱"}),forceRender:!0,open:s,footer:null,onCancel:function(){t()},children:(0,ee.jsxs)(b.A,{form:o,onFinish:function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeEmail:",s),A();case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),children:[(0,ee.jsx)(k.Z,{fieldProps:{size:"large",prefix:(0,ee.jsx)(Q.Z,{})},name:"email",placeholder:a.formatMessage({id:"pages.login.email.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,ee.jsx)(f.FormattedMessage,{id:"pages.login.email.required",defaultMessage:"请输入邮箱！"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,ee.jsx)(b.A.Item,{name:"captchaCode",rules:[],children:(0,ee.jsx)($.Z,{onKaptchaChange:T,onKaptchaCheck:R})}),(0,ee.jsx)(X.Z,{fieldProps:{size:"large",prefix:(0,ee.jsx)(O.Z,{})},captchaProps:{size:"large",disabled:!U},placeholder:a.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,s){return e?"".concat(s," ").concat(a.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):a.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"email",name:"code",rules:[{required:!0,message:(0,ee.jsx)(f.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:x,onGetCaptcha:function(){var e=l()(i()().mark((function e(s){var r,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("email:",s),!s){e.next=18;break}if((null==p?void 0:p.email)!==s){e.next=6;break}return N.yw.error("Email is not changed!"),F(),e.abrupt("return");case 6:return r={email:s,type:J.Iju,captchaUid:j,captchaCode:C,deviceUid:m,userUid:null==p?void 0:p.uid,orgUid:null==h?void 0:h.uid,platform:J.iw8},e.next=9,(0,W.O8)(r);case 9:if(t=e.sent,console.log("sendEmailCode",t),200===t.code){e.next=15;break}return N.yw.error(t.message),F(),e.abrupt("return");case 15:N.yw.success(t.message),e.next=19;break;case 18:N.yw.error("手机号格式错误");case 19:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()})]})})})},re=function(e){var s=e.open,r=e.onSubmit,t=e.onClose,a=(0,f.useIntl)(),n=b.A.useForm(),o=d()(n,1)[0],c=(0,K.Z)().translateString,g=(0,B.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),p=g.userInfo,m=g.deviceUid,h=(0,H.u)((function(e){return e.currentOrg})),x=(0,u.useRef)(),y=(0,u.useState)(""),M=d()(y,2),j=M[0],w=M[1],v=(0,u.useState)(""),Z=d()(v,2),C=Z[0],S=Z[1],z=(0,u.useState)(!1),P=d()(z,2),U=P[0],I=P[1],T=function(){var e=l()(i()().mark((function e(s,r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",s," captchaValue",r),w(s),S(r);case 3:case"end":return e.stop()}}),e)})));return function(s,r){return e.apply(this,arguments)}}(),R=function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",s),I(s);case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),A=function(){var e=l()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=l()(i()().mark((function e(s){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changeMobile:",s),(null==p?void 0:p.mobile)!==s.mobile){e.next=4;break}return N.yw.error("mobile is not changed"),e.abrupt("return");case 4:return a={mobile:s.mobile,code:s.code,platform:J.iw8},e.next=7,(0,V.KF)(a);case 7:n=e.sent,console.log("changeMobile response:",n),200===n.code?(N.yw.success("Mobile changed successfully!"),r(s.mobile),t()):N.yw.error(c(n.message));case 10:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),F=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=x.current)||void 0===e||e.endTiming()}),2)};return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(_.Z,{title:a.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"重置手机号"}),forceRender:!0,open:s,footer:null,onCancel:function(){t()},children:(0,ee.jsxs)(b.A,{form:o,onFinish:function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeMobile:",s),A();case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),children:[(0,ee.jsx)(k.Z,{fieldProps:{size:"large",prefix:(0,ee.jsx)(Q.Z,{})},name:"mobile",placeholder:a.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,ee.jsx)(f.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,ee.jsx)(f.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,ee.jsx)(b.A.Item,{name:"captchaCode",rules:[],children:(0,ee.jsx)($.Z,{onKaptchaChange:T,onKaptchaCheck:R})}),(0,ee.jsx)(X.Z,{fieldProps:{size:"large",prefix:(0,ee.jsx)(O.Z,{})},captchaProps:{size:"large",disabled:!U},placeholder:a.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,s){return e?"".concat(s," ").concat(a.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):a.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,ee.jsx)(f.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:x,onGetCaptcha:function(){var e=l()(i()().mark((function e(s){var r,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",s),!s||11!==s.length){e.next=18;break}if((null==p?void 0:p.mobile)!==s){e.next=6;break}return N.yw.error("mobile is not changed"),F(),e.abrupt("return");case 6:return r={mobile:s,type:J.BG8,captchaUid:j,captchaCode:C,deviceUid:m,userUid:null==p?void 0:p.uid,orgUid:null==h?void 0:h.uid,platform:J.iw8},e.next=9,(0,W.Y7)(r);case 9:if(t=e.sent,console.log("sendMobileCode",t),200===t.code){e.next=15;break}return N.yw.error(t.message),F(),e.abrupt("return");case 15:N.yw.success(t.message),e.next=19;break;case 18:N.yw.error("手机号格式错误");case 19:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()})]})})})},te=r(24522),ae=r(63327),ne=r(63628),ie=g.Z.Text,oe=function(e){var s=e.open,r=e.onClose,t=(0,f.useIntl)(),a=(0,K.Z)().translateString,n=(0,u.useState)(0),o=d()(n,2),c=o[0],g=o[1],p=(0,u.useState)(""),m=d()(p,2),h=m[0],x=m[1],M=function(e){return e>=80?"#52c41a":e>=60?"#faad14":e>=40?"#fa8c16":"#ff4d4f"};return(0,ee.jsx)(_.Z,{title:t.formatMessage({id:"pages.settings.reset.password",defaultMessage:"重置密码"}),forceRender:!0,open:s,footer:null,onCancel:function(){r()},children:(0,ee.jsxs)(b.A,{initialValues:{oldPassword:"",newPassword:"",confirmPassword:""},onFinish:function(){var e=l()(i()().mark((function e(s){var n,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((0,ae.Qc)(s.newPassword)<40)){e.next=4;break}return N.yw.error(t.formatMessage({id:"pages.settings.password.weak",defaultMessage:"密码强度太弱，请设置更强的密码"})),e.abrupt("return");case 4:if(!(s.newPassword.trim().length<6)){e.next=7;break}return N.yw.error(t.formatMessage({id:"pages.settings.password.min.length",defaultMessage:"密码最小长度不能小于6"})),e.abrupt("return");case 7:if(s.newPassword===s.confirmPassword){e.next=10;break}return N.yw.error(t.formatMessage({id:"pages.settings.password.mismatch",defaultMessage:"两次输入密码不一致"})),e.abrupt("return");case 10:return n={oldPassword:s.oldPassword,newPassword:s.newPassword},e.next=13,(0,V.Cp)(n);case 13:200===(o=e.sent).code?(N.yw.success(t.formatMessage({id:"pages.settings.password.change.success",defaultMessage:"Password changed successfully!"})),r()):N.yw.error(a(o.message));case 15:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),children:[(0,ee.jsx)(k.Z.Password,{name:"oldPassword",label:t.formatMessage({id:"pages.settings.password.old",defaultMessage:"原密码(手机号直接登录用户，可以留空)"})}),(0,ee.jsx)(k.Z.Password,{name:"newPassword",label:t.formatMessage({id:"pages.settings.password.new",defaultMessage:"新密码"}),fieldProps:{onChange:function(e){var s=e.target.value,r=(0,ae.Qc)(s),t=(0,ae.$g)(r);g(r),x(t)}},rules:[{required:!0,message:t.formatMessage({id:"pages.settings.password.new.required",defaultMessage:"请输入新密码"})},{min:6,message:t.formatMessage({id:"pages.settings.password.min.length",defaultMessage:"密码长度不能少于6位"})}]}),(0,ee.jsx)("div",{style:{marginBottom:16},children:(0,ee.jsx)(ie,{type:"secondary",style:{fontSize:"12px"},children:t.formatMessage({id:"pages.settings.password.suggestion",defaultMessage:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})})}),c>0&&(0,ee.jsx)("div",{style:{marginBottom:16},children:(0,ee.jsxs)(y.Z,{direction:"vertical",style:{width:"100%"},children:[(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,ee.jsx)(ie,{type:"secondary",children:t.formatMessage({id:"pages.settings.password.strength",defaultMessage:"密码强度："})}),(0,ee.jsx)(ie,{strong:!0,style:{color:M(c)},children:h})]}),(0,ee.jsx)(ne.Z,{percent:c,strokeColor:M(c),showInfo:!1,size:"small"}),(0,ee.jsx)(ie,{type:"secondary",style:{fontSize:"12px"},children:t.formatMessage({id:"pages.settings.password.suggestion",defaultMessage:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})})]})}),(0,ee.jsx)(k.Z.Password,{name:"confirmPassword",label:t.formatMessage({id:"pages.settings.password.confirm",defaultMessage:"确认密码"}),rules:[{required:!0,message:t.formatMessage({id:"pages.settings.password.confirm.required",defaultMessage:"请确认密码"})},function(e){var s=e.getFieldValue;return{validator:function(e,r){return r&&s("newPassword")!==r?Promise.reject(new Error(t.formatMessage({id:"pages.settings.password.confirm.error",defaultMessage:"两次输入密码不一致"}))):Promise.resolve()}}}]})]})})},le=r(95660),ce={labelCol:{span:6},wrapperCol:{span:18}},de=g.Z.Title,ue=g.Z.Text,fe=function(){var e,s,r=(0,f.useIntl)(),t=(0,te.Z)().isDarkMode,n=(0,f.useLocation)(),o=b.A.useForm(),c=d()(o,1)[0],g=(0,K.Z)().translateString,W=(0,B.L)((function(e){return{userInfo:e.userInfo,setUserInfo:e.setUserInfo}})),$=W.userInfo,H=W.setUserInfo,J=(0,u.useState)(""),Q=d()(J,2),X=Q[0],_=Q[1],ae=(0,u.useState)(!1),ne=d()(ae,2),ie=ne[0],fe=ne[1],ge=(0,u.useState)(!1),pe=d()(ge,2),me=pe[0],he=pe[1],xe=(0,u.useState)(!1),ye=d()(xe,2),Me=ye[0],je=ye[1],we=(0,u.useState)(!1),ve=d()(we,2),Ze=ve[0],be=ve[1],ke=function(e){if(0===e)return r.formatMessage({id:"password.modified.today",defaultMessage:"今天"});if(1===e)return r.formatMessage({id:"password.modified.yesterday",defaultMessage:"昨天"});if(-1===e)return r.formatMessage({id:"password.modified.tomorrow",defaultMessage:"明天"});if(e>0){if(e<7)return r.formatMessage({id:"password.modified.days.ago",defaultMessage:"".concat(e,"天前")},{days:e});if(e<30){var s=Math.floor(e/7);return r.formatMessage({id:"password.modified.weeks.ago",defaultMessage:"".concat(s,"周前")},{weeks:s})}if(e<365){var t=Math.floor(e/30);return r.formatMessage({id:"password.modified.months.ago",defaultMessage:"".concat(t,"个月前")},{months:t})}var a=Math.floor(e/365);return r.formatMessage({id:"password.modified.years.ago",defaultMessage:"".concat(a,"年前")},{years:a})}return r.formatMessage({id:"password.modified.today",defaultMessage:"今天"})},Ce=function(){var e=(null==$?void 0:$.passwordModifiedAt)||(null==$?void 0:$.createdAt);if(!e)return null;var s=new Date(e),t=new Date,a=new Date(s.getFullYear(),s.getMonth(),s.getDate()),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=n.getTime()-a.getTime(),o=Math.floor(i/864e5);return le.Z.debug("Password modification time calculation:",{originalPasswordDate:s.toISOString(),originalCurrentDate:t.toISOString(),passwordDateOnly:a.toISOString(),currentDateOnly:n.toISOString(),diffTime:i,diffDays:o,timeFieldUsed:null!=$&&$.passwordModifiedAt?"passwordModifiedAt":"createdAt (fallback)",note:null!=$&&$.passwordModifiedAt?"Using actual password modification time":"Using account creation time as fallback for password modification time"}),{passwordDate:s,diffDays:o,isLongTime:o>90,isVeryLongTime:o>180,isUsingCreatedAt:!(null!=$&&$.passwordModifiedAt),formattedDate:s.toLocaleDateString("zh-CN"===r.locale?"zh-CN":"en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),formattedTimeDiff:ke(o)}}(),Se=function(){fe(!0)},ze=function(){var e=l()(i()().mark((function e(s,t){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,V.ck)(s);case 3:if(a=e.sent,le.Z.debug("updateProfile response:",a),200!==a.code){e.next=12;break}return n=t||r.formatMessage({id:"update.success"}),N.yw.success(n),a.data.username!==$.username?(0,G.NZ)():(H(a.data),c.setFieldsValue({uid:a.data.uid,username:a.data.username,nickname:g(a.data.nickname),email:a.data.email,mobile:a.data.mobile,country:a.data.country,description:g(a.data.description)})),e.abrupt("return",!0);case 12:return N.yw.error(a.message),e.abrupt("return",!1);case 14:e.next=21;break;case 16:return e.prev=16,e.t0=e.catch(0),console.error("Update profile error:",e.t0),N.yw.error(r.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),e.abrupt("return",!1);case 21:case"end":return e.stop()}}),e,null,[[0,16]])})));return function(s,r){return e.apply(this,arguments)}}(),Pe=function(){var e=l()(i()().mark((function e(s){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return le.Z.debug("handleUploadSuccess:",s),_(s),t=a()(a()({},$),{},{avatar:s}),e.next=5,ze(t,r.formatMessage({id:"avatar.upload.success",defaultMessage:"头像上传成功"}));case 5:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),Ue=function(){var e=l()(i()().mark((function e(s){var r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a()(a()(a()({},$),s),{},{avatar:X}),le.Z.debug("Form submit userObject:",r),e.next=4,ze(r);case 4:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){$&&_($.avatar)}),[$]);var Ie=function(){var e=l()(i()().mark((function e(){var s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return be(!0),e.prev=1,e.next=4,(0,V.Ai)();case 4:s=e.sent,le.Z.debug("handleRefreshProfile getProfile response:",s),200===s.code?(H(s.data),c.setFieldsValue({uid:s.data.uid,username:s.data.username,nickname:g(s.data.nickname),email:s.data.email,mobile:s.data.mobile,country:s.data.country,description:g(s.data.description)}),N.yw.success(r.formatMessage({id:"profile.refresh.success",defaultMessage:"刷新成功"}))):N.yw.error(s.message||r.formatMessage({id:"profile.refresh.failed",defaultMessage:"刷新失败"})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),console.error("Refresh profile error:",e.t0),N.yw.error(r.formatMessage({id:"profile.refresh.failed",defaultMessage:"刷新失败"}));case 13:return e.prev=13,be(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){Ie()}),[]),(0,u.useEffect)((function(){if("true"===new URLSearchParams(n.search).get("showChangePassword")){var e=setTimeout((function(){fe(!0);var e=n.pathname;window.history.replaceState({},"",e)}),500);return function(){return clearTimeout(e)}}}),[n.search]),(0,ee.jsxs)("div",{style:{padding:"24px",backgroundColor:t?"#1f1f1f":"#f0f2f5",minHeight:"100vh"},children:[(0,ee.jsxs)(p.Z,{variant:"borderless",style:{maxWidth:800,margin:"0 auto",borderRadius:"12px",boxShadow:t?"0 2px 8px rgba(255, 255, 255, 0.05)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[(0,ee.jsxs)(de,{level:2,style:{marginBottom:"24px",textAlign:"center",position:"relative"},children:[(0,ee.jsx)(S.Z,{style:{marginRight:"8px",color:"#1890ff"}}),r.formatMessage({id:"profile.title",defaultMessage:"个人资料"}),(0,ee.jsx)(m.ZP,{type:"text",icon:(0,ee.jsx)(z.Z,{spin:Ze}),onClick:Ie,loading:Ze,disabled:Ze,style:{position:"absolute",right:0,top:"50%",transform:"translateY(-50%)",color:Ze?"#ccc":"#1890ff"},title:Ze?r.formatMessage({id:"profile.refreshing",defaultMessage:"正在刷新..."}):r.formatMessage({id:"profile.refresh",defaultMessage:"刷新用户信息"})})]}),(0,ee.jsx)(p.Z,{size:"small",style:{marginBottom:"24px",backgroundColor:t?"#2d2d2d":"#fafafa",borderRadius:"8px"},children:(0,ee.jsx)(h.Z,{justify:"center",align:"middle",style:{padding:"20px 0"},children:(0,ee.jsx)(x.Z,{children:(0,ee.jsxs)(y.Z,{direction:"vertical",align:"center",size:"large",children:[(0,ee.jsx)(M.Z,{src:X,size:100,style:{border:"4px solid #fff",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}}),(0,ee.jsx)(Y.G,{onSuccess:Pe,onError:function(e){le.Z.debug("handleUploadError:",e)},children:(0,ee.jsx)(m.ZP,{type:"primary",icon:(0,ee.jsx)(P.Z,{}),style:{borderRadius:"20px"},children:r.formatMessage({id:"pages.robot.upload",defaultMessage:"上传头像"})})},"avatar")]})})})}),(0,ee.jsxs)(b.A,a()(a()({},ce),{},{form:c,onFinish:Ue,submitter:{render:function(e,s){return(0,ee.jsx)(h.Z,{justify:"center",style:{marginTop:"32px"},children:(0,ee.jsx)(x.Z,{children:(0,ee.jsx)(y.Z,{size:"middle",children:s})})})},submitButtonProps:{size:"large",style:{borderRadius:"8px",minWidth:"120px"}},resetButtonProps:{size:"large",style:{borderRadius:"8px",minWidth:"120px"}}},children:[(0,ee.jsxs)(p.Z,{title:(0,ee.jsxs)(ue,{strong:!0,style:{fontSize:"16px"},children:[(0,ee.jsx)(S.Z,{style:{marginRight:"8px",color:"#1890ff"}}),r.formatMessage({id:"profile.basic.info",defaultMessage:"基本信息"})]}),size:"small",style:{marginBottom:"24px",backgroundColor:t?"#262626":void 0},children:[(0,ee.jsx)(k.Z,{name:"uid",label:r.formatMessage({id:"profile.user.id",defaultMessage:"用户ID"}),rules:[{required:!0}],readonly:!0,fieldProps:{style:{backgroundColor:t?"#2a2a2a":"#f5f5f5"}}}),(0,ee.jsx)(k.Z,{name:"username",label:r.formatMessage({id:"username.change.tip",defaultMessage:"用户名"}),rules:[{required:!0}],fieldProps:{prefix:(0,ee.jsx)(S.Z,{style:{color:"#1890ff"}})}}),(0,ee.jsx)(k.Z,{name:"nickname",label:r.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0}],fieldProps:{prefix:(0,ee.jsx)(S.Z,{style:{color:"#52c41a"}})}}),(0,ee.jsx)(k.Z,{name:"country",label:r.formatMessage({id:"profile.country",defaultMessage:"国家/地区"}),readonly:!0,fieldProps:{prefix:(0,ee.jsx)(U.Z,{style:{color:"#722ed1"}}),style:{backgroundColor:t?"#2a2a2a":"#f5f5f5"}}}),(0,ee.jsx)(C.Z,{name:"description",label:r.formatMessage({id:"description",defaultMessage:"个人简介"}),fieldProps:{rows:4,placeholder:r.formatMessage({id:"profile.description.placeholder",defaultMessage:"请输入个人简介..."})}}),(0,ee.jsx)("div",{style:{marginTop:"16px"},children:(0,ee.jsxs)(h.Z,{gutter:[16,8],children:[(0,ee.jsx)(x.Z,{span:6,children:(0,ee.jsxs)(ue,{strong:!0,children:[r.formatMessage({id:"profile.account.type",defaultMessage:"账户类型"}),":"]})}),(0,ee.jsx)(x.Z,{span:18,children:(0,ee.jsxs)(y.Z,{children:[(null==$?void 0:$.superUser)&&(0,ee.jsx)(j.Z,{color:"red",icon:(0,ee.jsx)(I.Z,{}),children:r.formatMessage({id:"profile.super.user",defaultMessage:"超级管理员"})}),null!=$&&$.enabled?(0,ee.jsx)(j.Z,{color:"green",icon:(0,ee.jsx)(T.Z,{}),children:r.formatMessage({id:"profile.account.enabled",defaultMessage:"已启用"})}):(0,ee.jsx)(j.Z,{color:"red",icon:(0,ee.jsx)(R.Z,{}),children:r.formatMessage({id:"profile.account.disabled",defaultMessage:"已禁用"})})]})})]})})]}),(null==$?void 0:$.currentOrganization)&&(0,ee.jsxs)(p.Z,{title:(0,ee.jsxs)(ue,{strong:!0,style:{fontSize:"16px"},children:[(0,ee.jsx)(A.Z,{style:{marginRight:"8px",color:"#13c2c2"}}),r.formatMessage({id:"profile.organization.info",defaultMessage:"组织信息"})]}),size:"small",style:{marginBottom:"24px",backgroundColor:t?"#262626":void 0},children:[(0,ee.jsxs)(h.Z,{gutter:[16,8],children:[(0,ee.jsx)(x.Z,{span:6,children:(0,ee.jsxs)(ue,{strong:!0,children:[r.formatMessage({id:"profile.organization.name",defaultMessage:"组织名称"}),":"]})}),(0,ee.jsx)(x.Z,{span:18,children:(0,ee.jsxs)(y.Z,{children:[$.currentOrganization.logo&&(0,ee.jsx)(M.Z,{src:$.currentOrganization.logo,size:"small"}),(0,ee.jsx)(ue,{children:$.currentOrganization.name}),$.currentOrganization.vip&&(0,ee.jsx)(j.Z,{color:"gold",icon:(0,ee.jsx)(I.Z,{}),children:"VIP"})]})})]}),$.currentOrganization.description&&(0,ee.jsxs)(h.Z,{gutter:[16,8],style:{marginTop:"8px"},children:[(0,ee.jsx)(x.Z,{span:6,children:(0,ee.jsxs)(ue,{strong:!0,children:[r.formatMessage({id:"profile.organization.description",defaultMessage:"组织描述"}),":"]})}),(0,ee.jsx)(x.Z,{span:18,children:(0,ee.jsx)(ue,{type:"secondary",children:g($.currentOrganization.description)})})]}),$.currentOrganization.code&&(0,ee.jsxs)(h.Z,{gutter:[16,8],style:{marginTop:"8px"},children:[(0,ee.jsx)(x.Z,{span:6,children:(0,ee.jsxs)(ue,{strong:!0,children:[r.formatMessage({id:"profile.organization.code",defaultMessage:"组织编码"}),":"]})}),(0,ee.jsx)(x.Z,{span:18,children:(0,ee.jsx)(ue,{code:!0,children:$.currentOrganization.code})})]})]}),((null==$||null===(e=$.currentRoles)||void 0===e?void 0:e.length)>0||(null==$||null===(s=$.authorities)||void 0===s?void 0:s.length)>0)&&(0,ee.jsxs)(p.Z,{title:(0,ee.jsxs)(ue,{strong:!0,style:{fontSize:"16px"},children:[(0,ee.jsx)(F.Z,{style:{marginRight:"8px",color:"#f5222d"}}),r.formatMessage({id:"profile.roles.permissions",defaultMessage:"角色与权限"})]}),size:"small",style:{marginBottom:"24px",backgroundColor:t?"#262626":void 0},children:[(null==$?void 0:$.currentRoles)&&$.currentRoles.length>0&&(0,ee.jsx)("div",{style:{marginBottom:"16px"},children:(0,ee.jsxs)(h.Z,{gutter:[16,8],children:[(0,ee.jsx)(x.Z,{span:6,children:(0,ee.jsxs)(ue,{strong:!0,children:[r.formatMessage({id:"profile.current.roles",defaultMessage:"当前角色"}),":"]})}),(0,ee.jsx)(x.Z,{span:18,children:(0,ee.jsx)(y.Z,{wrap:!0,children:$.currentRoles.map((function(e,s){return(0,ee.jsxs)(j.Z,{color:"blue",style:{margin:"2px"},children:[g(e.name),e.description&&(0,ee.jsx)(w.Z,{title:e.description,children:(0,ee.jsx)(D.Z,{style:{marginLeft:"4px"}})})]},e.uid||s)}))})})]})}),(null==$?void 0:$.userOrganizationRoles)&&$.userOrganizationRoles.length>0&&(0,ee.jsx)("div",{style:{marginBottom:"16px"},children:(0,ee.jsxs)(h.Z,{gutter:[16,8],children:[(0,ee.jsx)(x.Z,{span:6,children:(0,ee.jsxs)(ue,{strong:!0,children:[r.formatMessage({id:"profile.organization.roles",defaultMessage:"组织角色"}),":"]})}),(0,ee.jsx)(x.Z,{span:18,children:(0,ee.jsx)(y.Z,{direction:"vertical",style:{width:"100%"},children:$.userOrganizationRoles.map((function(e,s){var r,t;return(0,ee.jsxs)("div",{style:{marginBottom:"8px"},children:[(0,ee.jsxs)(ue,{strong:!0,style:{marginRight:"8px"},children:[null===(r=e.organization)||void 0===r?void 0:r.name,":"]}),(0,ee.jsx)(y.Z,{wrap:!0,children:null===(t=e.roles)||void 0===t?void 0:t.map((function(e,s){return(0,ee.jsx)(j.Z,{color:"purple",style:{margin:"2px"},children:g(e.name)},e.uid||s)}))})]},s)}))})})]})})]}),(0,ee.jsxs)(p.Z,{title:(0,ee.jsxs)(ue,{strong:!0,style:{fontSize:"16px"},children:[(0,ee.jsx)(O.Z,{style:{marginRight:"8px",color:"#fa541c"}}),r.formatMessage({id:"profile.security.settings",defaultMessage:"安全设置"})]}),size:"small",style:{marginBottom:"24px",backgroundColor:t?"#262626":void 0},children:[Ce&&(0,ee.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0"},children:[(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(O.Z,{style:{color:"#fa541c"}}),(0,ee.jsx)(ue,{children:r.formatMessage({id:"password.modified.time",defaultMessage:"密码修改时间"})})]}),(0,ee.jsxs)(y.Z,{direction:"vertical",align:"end",size:"small",children:[(0,ee.jsx)(ue,{type:"secondary",children:Ce.formattedDate}),(0,ee.jsxs)(ue,{type:"secondary",style:{fontSize:"12px"},children:["(",Ce.formattedTimeDiff,")"]})]})]}),Ce.isLongTime&&(0,ee.jsx)(v.Z,{message:r.formatMessage({id:"password.security.reminder",defaultMessage:"密码安全提醒"}),description:Ce.isVeryLongTime?r.formatMessage({id:"password.very.long.time.warning",defaultMessage:"您的密码已经 ".concat(Ce.diffDays," 天没有修改，存在安全风险，强烈建议立即更换密码。")},{days:Ce.diffDays}):r.formatMessage({id:"password.long.time.warning",defaultMessage:"您的密码已经 ".concat(Ce.diffDays," 天没有修改，建议定期更换密码以确保账户安全。")},{days:Ce.diffDays}),type:Ce.isVeryLongTime?"error":"warning",showIcon:!0,style:{marginTop:"8px"},action:(0,ee.jsx)(m.ZP,{size:"small",type:"primary",onClick:Se,danger:Ce.isVeryLongTime,children:r.formatMessage({id:"password.change.now",defaultMessage:"立即修改"})})}),(0,ee.jsx)(Z.Z,{style:{margin:"16px 0"}})]}),(0,ee.jsx)(h.Z,{gutter:[16,16],children:(0,ee.jsx)(x.Z,{span:24,children:(0,ee.jsxs)(y.Z,{direction:"vertical",style:{width:"100%"},children:[(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(O.Z,{style:{color:"#fa541c"}}),(0,ee.jsx)(ue,{children:r.formatMessage({id:"profile.login.password",defaultMessage:"登录密码"})})]}),(0,ee.jsx)(m.ZP,{type:"link",onClick:Se,style:{fontWeight:"bold"},children:r.formatMessage({id:"pages.settings.reset.password",defaultMessage:"修改密码"})})]}),(0,ee.jsx)(Z.Z,{style:{margin:"8px 0"}})]})})})]}),(0,ee.jsx)(p.Z,{title:(0,ee.jsxs)(ue,{strong:!0,style:{fontSize:"16px"},children:[(0,ee.jsx)(E.Z,{style:{marginRight:"8px",color:"#722ed1"}}),r.formatMessage({id:"profile.contact.info",defaultMessage:"联系方式"})]}),size:"small",children:(0,ee.jsx)(h.Z,{gutter:[16,16],children:(0,ee.jsxs)(x.Z,{span:24,children:[(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(E.Z,{style:{color:"#722ed1"}}),(0,ee.jsx)(ue,{children:r.formatMessage({id:"profile.email.address",defaultMessage:"邮箱地址"})}),null!=$&&$.emailVerified?(0,ee.jsx)(j.Z,{icon:(0,ee.jsx)(T.Z,{}),color:"success",children:r.formatMessage({id:"profile.verified",defaultMessage:"已验证"})}):(0,ee.jsx)(j.Z,{icon:(0,ee.jsx)(L.Z,{}),color:"error",children:r.formatMessage({id:"profile.not.verified",defaultMessage:"未验证"})})]}),(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(ue,{type:"secondary",children:(null==$?void 0:$.email)||r.formatMessage({id:"profile.not.set",defaultMessage:"未设置"})}),(0,ee.jsx)(m.ZP,{type:"link",onClick:function(){he(!0)},style:{fontWeight:"bold"},children:r.formatMessage({id:"pages.settings.reset.email",defaultMessage:"修改邮箱"})})]})]}),(0,ee.jsx)(Z.Z,{style:{margin:"8px 0"}}),(0,ee.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(q.Z,{style:{color:"#13c2c2"}}),(0,ee.jsx)(ue,{children:r.formatMessage({id:"profile.mobile.number",defaultMessage:"手机号码"})}),null!=$&&$.mobileVerified?(0,ee.jsx)(j.Z,{icon:(0,ee.jsx)(T.Z,{}),color:"success",children:r.formatMessage({id:"profile.verified",defaultMessage:"已验证"})}):(0,ee.jsx)(j.Z,{icon:(0,ee.jsx)(L.Z,{}),color:"error",children:r.formatMessage({id:"profile.not.verified",defaultMessage:"未验证"})})]}),(0,ee.jsxs)(y.Z,{children:[(0,ee.jsx)(ue,{type:"secondary",children:(null==$?void 0:$.mobile)||r.formatMessage({id:"profile.not.set",defaultMessage:"未设置"})}),(0,ee.jsx)(m.ZP,{type:"link",onClick:function(){je(!0)},style:{fontWeight:"bold"},children:r.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"修改手机号"})})]})]})]})})})]}))]}),ie&&(0,ee.jsx)(oe,{open:ie,onClose:function(){fe(!1)}}),me&&(0,ee.jsx)(se,{open:me,onSubmit:function(e){he(!1),$.email=e,H($),c.setFieldValue("email",e)},onClose:function(){he(!1)}}),Me&&(0,ee.jsx)(re,{open:Me,onSubmit:function(e){je(!1),$.mobile=e,H($),c.setFieldValue("mobile",e)},onClose:function(){je(!1)}})]})}},63327:function(e,s,r){r.d(s,{$g:function(){return d},N9:function(){return l},Qc:function(){return c},vC:function(){return o}});var t=r(46803),a=r.n(t),n=r(95660);function i(e){return"bytedesk_salt"!==e&&e?a().SHA256(e).toString().substring(0,16):"bytedesk_license"}function o(e,s){if(!e)throw new Error("密码不能为空");if(!s)throw new Error("盐值不能为空");try{var r=i(s),t=a().enc.Utf8.parse(r);return a().AES.encrypt(e,t,{mode:a().mode.ECB,padding:a().pad.Pkcs7}).toString()}catch(e){throw n.Z.error("密码加密失败:",e),new Error("密码加密失败: "+e.message)}}function l(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",t=0;t<e;t++)r+=s.charAt(Math.floor(Math.random()*s.length));return r}function c(e){var s=0;return e?(e.length>=8&&(s+=20),e.length>=12&&(s+=10),/\d/.test(e)&&(s+=20),/[a-z]/.test(e)&&(s+=20),/[A-Z]/.test(e)&&(s+=20),/[!@#$%^&*(),.?":{}|<>]/.test(e)&&(s+=10),Math.min(s,100)):0}function d(e){return e>=80?"强":e>=60?"中":e>=40?"弱":"很弱"}}}]);