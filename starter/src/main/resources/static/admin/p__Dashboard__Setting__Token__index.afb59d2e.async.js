"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5128],{16829:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},o=n(5901),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(i)},51344:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},o=n(5901),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(i)},83381:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},o=n(5901),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(i)},80503:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=n(5901),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(i)},83004:function(e,t,n){n.d(t,{Z:function(){return c}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372 0-89 31.3-170.8 83.5-234.8l523.3 523.3C682.8 852.7 601 884 512 884zm288.5-137.2L277.2 223.5C341.2 171.3 423 140 512 140c205.4 0 372 166.6 372 372 0 89-31.3 170.8-83.5 234.8z"}}]},name:"stop",theme:"outlined"},o=n(5901),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(i)},31051:function(e,t,n){var r=n(39328),a=n(17323),s=n(90098),o=n(44194),i=n(17881),c=n(77929),l=n(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,t){var n=e.fieldProps,d=e.children,p=e.params,f=e.proFieldProps,h=e.mode,g=e.valueEnum,v=e.request,m=e.showSearch,k=e.options,x=(0,a.Z)(e,u),y=(0,o.useContext)(i.Z);return(0,l.jsx)(c.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,s.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({options:k,mode:h,showSearch:m,getPopupContainer:y.getPopupContainer},n),ref:t,proFieldProps:f},x),{},{children:d}))},f=o.forwardRef((function(e,t){var n=e.fieldProps,u=e.children,p=e.params,f=e.proFieldProps,h=e.mode,g=e.valueEnum,v=e.request,m=e.options,k=(0,a.Z)(e,d),x=(0,r.Z)({options:m,mode:h||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),y=(0,o.useContext)(i.Z);return(0,l.jsx)(c.Z,(0,r.Z)((0,r.Z)({valueEnum:(0,s.h)(g),request:v,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,r.Z)({getPopupContainer:y.getPopupContainer},x),ref:t,proFieldProps:f},k),{},{children:u}))})),h=o.forwardRef(p);h.SearchSelect=f,h.displayName="ProFormComponent",t.Z=h},3e3:function(e,t,n){var r=n(39328),a=n(17323),s=n(44194),o=n(77929),i=n(31549),c=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],l=s.forwardRef((function(e,t){var n=e.fieldProps,s=e.unCheckedChildren,l=e.checkedChildren,u=e.proFieldProps,d=(0,a.Z)(e,c);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:s,checkedChildren:l},n),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},d))}));t.Z=l},22766:function(e,t,n){var r=n(76285),a=n(39328),s=n(17323),o=n(92032),i=n(55681),c=n(30024),l=n(21762),u=n(44194),d=n(77929),p=n(31549),f=["fieldProps","proFieldProps"],h=["fieldProps","proFieldProps"],g="text",v=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),n=(0,r.Z)(t,2),s=n[0],l=n[1];return(0,p.jsx)(i.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var n,r=t.getFieldValue(e.name||[]);return(0,p.jsx)(c.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return l(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(n=e.statusRender)||void 0===n?void 0:n.call(e,r),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},m=function(e){var t=e.fieldProps,n=e.proFieldProps,r=(0,s.Z)(e,f);return(0,p.jsx)(d.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:n},r))};m.Password=function(e){var t=e.fieldProps,n=e.proFieldProps,o=(0,s.Z)(e,h),i=(0,u.useState)(!1),c=(0,r.Z)(i,2),f=c[0],m=c[1];return null!=t&&t.statusRender&&o.name?(0,p.jsx)(v,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:f,onOpenChange:m,children:(0,p.jsx)("div",{children:(0,p.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,l.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var n;null==t||null===(n=t.onBlur)||void 0===n||n.call(t,e),m(!1)},onClick:function(e){var n;null==t||null===(n=t.onClick)||void 0===n||n.call(t,e),m(!0)}}),proFieldProps:n,filedConfig:{valueType:g}},o))})}):(0,p.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:n,filedConfig:{valueType:g}},o))},m.displayName="ProFormComponent",t.Z=m},12581:function(e,t,n){var r=n(39328),a=n(17323),s=n(44194),o=n(77929),i=n(31549),c=["fieldProps","proFieldProps"],l=function(e,t){var n=e.fieldProps,s=e.proFieldProps,l=(0,a.Z)(e,c);return(0,i.jsx)(o.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:n,proFieldProps:s},l))};t.Z=s.forwardRef(l)},30234:function(e,t,n){var r=n(25191),a=n(32057),s=n(75699);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},85645:function(e,t,n){n.r(t),n.d(t,{default:function(){return ae}});var r=n(45332),a=n.n(r),s=n(44194),o=n(90962),i=n(73193),c=n.n(i),l=n(84176),u=n.n(l),d=n(86222),p=n.n(d),f=n(90819),h=n.n(f),g=n(89933),v=n.n(g),m=n(31756),k=n(25191),x=n(75699);function y(e){return M.apply(this,arguments)}function M(){return(M=v()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/token/query/org",{method:"GET",params:c()(c()({},t),{},{channel:k.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=v()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/token/create",{method:"POST",data:c()(c()({},t),{},{channel:k.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function T(e){return Z.apply(this,arguments)}function Z(){return(Z=v()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/token/update",{method:"POST",data:c()(c()({},t),{},{channel:k.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return C.apply(this,arguments)}function C(){return(C=v()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/token/delete",{method:"POST",data:c()(c()({},t),{},{channel:k.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return A.apply(this,arguments)}function A(){return(A=v()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/token/delete/all",{method:"POST",data:c()(c()({},t),{},{channel:k.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return R.apply(this,arguments)}function R(){return(R=v()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/token/generate",{method:"POST",data:c()(c()({},t),{},{channel:k.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=n(31881),F=n(83381),E=n(6992),O=n(91768),D=n(83004),z=n(16829),B=n(51344),V=n(80503),q=n(24418),U=n(81213),N=n(37799),_=n(4363),H=n(42119),L=n(6373),W=n(22766),J=n(31051),X=n(3e3),K=n(12581),G=n(65318),Y=n(81020),Q=n(35911),$=n(31549),ee=function(e){var t=e.isEdit,n=e.token,r=e.open,o=e.onClose,i=e.onSubmit,l=L.A.useForm(),u=a()(l,1)[0],d=(0,I.u)((function(e){return e.currentOrg})),p=(0,s.useState)(k.Bye),f=a()(p,2),g=f[0],x=f[1],y=(0,s.useState)(!1),M=a()(y,2),w=M[0],b=M[1],T=function(){var e=v()(h()().mark((function e(){var t,n;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=d&&d.uid){e.next=3;break}return m.yw.error("请先选择组织"),e.abrupt("return");case 3:return b(!0),e.prev=4,t={orgUid:d.uid,type:g},e.next=8,j(t);case 8:n=e.sent,console.log("generateToken response",null==n?void 0:n.data,t),200===(null==n?void 0:n.code)&&null!=n&&n.data?(u.setFieldValue("accessToken",n.data),m.yw.success("Token生成成功")):m.yw.error("Token生成失败"),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),console.error("Generate token error:",e.t0),m.yw.error("Token生成失败");case 17:return e.prev=17,b(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[4,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,s.useEffect)((function(){var e,r;t?(x((null==n?void 0:n.type)||k.ntl),r=(null==n?void 0:n.type)===k.Bye||(null==n?void 0:n.type)===k.ntl||(null==n?void 0:n.type)===k.UnP||(null==n?void 0:n.type)===k.SZe||(null==n?void 0:n.type)===k.BWI||(null==n?void 0:n.type)===k.Ofb||(null==n?void 0:n.type)===k.p_p?Array.isArray(null==n?void 0:n.scope)?null==n?void 0:n.scope:null!=n&&n.scope?[null==n?void 0:n.scope]:[]:Array.isArray(null==n?void 0:n.scope)?null==n?void 0:n.scope.join(" "):(null==n?void 0:n.scope)||"",u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,accessToken:null==n?void 0:n.accessToken,refreshToken:null==n?void 0:n.refreshToken,scope:r,expiresAt:null==n?void 0:n.expiresAt,revoked:null!==(e=null==n?void 0:n.revoked)&&void 0!==e&&e,revokeReason:null==n?void 0:n.revokeReason,channel:null==n?void 0:n.channel,device:null==n?void 0:n.device,description:null==n?void 0:n.description})):(x(k.ntl),u.setFieldsValue({name:"",type:k.ntl,accessToken:"",refreshToken:"",scope:[],expiresAt:void 0,revoked:!1,revokeReason:"",channel:"",device:"",description:""}))}),[t,n,u]),(0,$.jsx)($.Fragment,{children:(0,$.jsx)(G.Z,{title:"Token",width:600,onClose:o,open:r,extra:(0,$.jsxs)(Y.Z,{children:[(0,$.jsx)(_.ZP,{onClick:o,children:"取消"}),(0,$.jsx)(_.ZP,{type:"primary",onClick:function(){return u.submit()},children:"提交"})]}),children:(0,$.jsxs)(L.A,{form:u,name:"tokenForm",onFinish:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=c()({},e);g===k.Bye||g===k.ntl||g===k.UnP||g===k.SZe||g===k.BWI||g===k.Ofb||g===k.p_p?Array.isArray(t.scope)||(t.scope=t.scope?[t.scope]:[]):Array.isArray(t.scope)&&(t.scope=t.scope.join(" "));var n=c()(c()({},t),{},{orgUid:null==d?void 0:d.uid});console.log("submit",n),i(n)}))},submitter:!1,children:[(0,$.jsx)(W.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,$.jsx)(J.Z,{name:"type",label:"类型",width:"md",options:[{label:"API Token",value:k.ntl}],rules:[{required:!0}],fieldProps:{onChange:function(e){x(e),e===k.Bye||e===k.ntl||e===k.UnP||e===k.SZe||e===k.BWI||e===k.Ofb||e===k.p_p?u.setFieldValue("scope",[]):u.setFieldValue("scope","")}}}),(0,$.jsx)(W.Z,{label:"Access Token",name:"accessToken",rules:[{required:!0,message:"请输入Access Token"},{min:10,message:"Access Token长度至少10个字符"}],fieldProps:{placeholder:"请输入访问令牌",showCount:!0,maxLength:500,suffix:(0,$.jsx)(_.ZP,{size:"small",icon:(0,$.jsx)(Q.Z,{}),onClick:T,type:"text",title:"生成随机Token",loading:w,disabled:w,children:w?"生成中...":"随机生成"})}}),(0,$.jsx)(X.Z,{label:"是否撤销",name:"revoked",fieldProps:{checkedChildren:"已撤销",unCheckedChildren:"有效"}}),(0,$.jsx)(W.Z,{label:"撤销原因",name:"revokeReason",fieldProps:{placeholder:"可选，撤销原因"}}),(0,$.jsx)(K.Z,{label:"描述",name:"description",placeholder:"可选，token用途描述"})]})})})},te=n(30234),ne=["current","pageSize"],re=function(){var e=(0,x.useIntl)(),t=(0,s.useRef)(),n=(0,te.Z)().translateString,r=(0,s.useState)(1),o=a()(r,2),i=(o[0],o[1]),l=(0,s.useState)(10),d=a()(l,2),f=(d[0],d[1]),g=(0,I.u)((function(e){return e.currentOrg})),k=(0,s.useState)(!1),M=a()(k,2),b=M[0],Z=M[1],C=(0,s.useState)({}),A=a()(C,2),j=A[0],R=A[1],L=(0,s.useState)(!1),W=a()(L,2),J=W[0],X=W[1],K=U.Z.useModal(),G=a()(K,2),Y=G[0],Q=G[1],re=(0,s.useState)([]),ae=a()(re,2),se=ae[0],oe=ae[1],ie=(0,s.useState)([]),ce=a()(ie,2),le=ce[0],ue=ce[1],de=(0,s.useState)(0),pe=a()(de,2),fe=pe[0],he=pe[1],ge=(0,s.useState)({}),ve=a()(ge,2),me=(ve[0],ve[1]),ke=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,$.jsx)(x.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150,ellipsis:!0},{title:(0,$.jsx)(x.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,valueType:"select",valueEnum:{BEARER:{text:"Bearer Token",status:"Default"},API:{text:"API Token",status:"Default"},REFRESH:{text:e.formatMessage({id:"token.type.refresh.text"}),status:"Default"},ACCESS:{text:e.formatMessage({id:"token.type.access.text"}),status:"Default"},THIRD_PARTY:{text:e.formatMessage({id:"token.type.third_party.text"}),status:"Default"},TEMPORARY:{text:e.formatMessage({id:"token.type.temporary.text"}),status:"Default"},DEVICE:{text:e.formatMessage({id:"token.type.device.text"}),status:"Default"},SESSION:{text:e.formatMessage({id:"token.type.session.text"}),status:"Default"},VERIFICATION:{text:e.formatMessage({id:"token.type.verification.text"}),status:"Default"},PASSWORD_RESET:{text:e.formatMessage({id:"token.type.password_reset.text"}),status:"Default"},INVITATION:{text:e.formatMessage({id:"token.type.invitation.text"}),status:"Default"},SSO:{text:e.formatMessage({id:"token.type.sso.text"}),status:"Default"},AUTHORIZATION_CODE:{text:e.formatMessage({id:"token.type.authorization_code.text"}),status:"Default"},CLIENT_CREDENTIALS:{text:e.formatMessage({id:"token.type.client_credentials.text"}),status:"Default"},IMPLICIT:{text:e.formatMessage({id:"token.type.implicit.text"}),status:"Default"},RESOURCE_OWNER_PASSWORD:{text:e.formatMessage({id:"token.type.resource_owner_password.text"}),status:"Default"},CUSTOM:{text:e.formatMessage({id:"token.type.custom.text"}),status:"Default"}}},{title:(0,$.jsx)(x.FormattedMessage,{id:"accessToken",defaultMessage:"Access Token"}),dataIndex:"accessToken",width:200,copyable:!0,ellipsis:!0,hideInSearch:!0,render:function(e){return e?e.length>20?"".concat(e.substring(0,20),"..."):e:"-"}},{title:(0,$.jsx)(x.FormattedMessage,{id:"channel",defaultMessage:"Channel"}),dataIndex:"channel",width:120,hideInSearch:!0,ellipsis:!0},{title:(0,$.jsx)(x.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",width:200,hideInSearch:!0,ellipsis:!0,render:function(e){return e?e.length>30?"".concat(e.substring(0,30),"..."):e:"-"}},{title:(0,$.jsx)(x.FormattedMessage,{id:"expiresAt",defaultMessage:"Expires At"}),dataIndex:"expiresAt",width:180,hideInSearch:!0,valueType:"dateTime",render:function(t){return t||e.formatMessage({id:"token.no.expiry",defaultMessage:"永不过期"})}},{title:(0,$.jsx)(x.FormattedMessage,{id:"revoked",defaultMessage:"Revoked"}),dataIndex:"revoked",width:100,valueType:"select",hideInSearch:!0,valueEnum:{true:{text:e.formatMessage({id:"token.status.revoked"}),status:"Error"},false:{text:e.formatMessage({id:"token.status.valid"}),status:"Success"}}},{title:(0,$.jsx)(x.FormattedMessage,{id:"revokeReason",defaultMessage:"Revoke Reason"}),dataIndex:"revokeReason",width:150,hideInSearch:!0,ellipsis:!0,render:function(e){return e?e.length>20?"".concat(e.substring(0,20),"..."):e:"-"}},{title:(0,$.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,valueType:"dateTime"},{title:(0,$.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,valueType:"dateTime"}],xe=[].concat(ke,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:200,render:function(t,r,a,s){return[(0,$.jsx)("a",{onClick:function(){R(r),X(!0),Z(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,$.jsx)("a",{onClick:function(){return Me(r)},style:{color:r.revoked?"#52c41a":"#ff4d4f"},children:r.revoked?e.formatMessage({id:"token.toggle.revoke.restore"}):e.formatMessage({id:"token.toggle.revoke.revoke"})},"toggle-revoke"),(0,$.jsx)(N.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n(r.name),"】？"),onConfirm:function(){return ye(r)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,$.jsx)(F.Z,{style:{color:"red"}}),children:(0,$.jsx)(_.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),ye=function(){var n=v()(h()().mark((function n(r){var a;return h()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteToken:",r),n.next=3,P(r);case 3:a=n.sent,console.log("deleteToken:",a),200===a.code?(m.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):m.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),Me=function(){var n=v()(h()().mark((function n(r){var a,s,o;return h()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return a={uid:r.uid,name:r.name,type:r.type,accessToken:r.accessToken,refreshToken:r.refreshToken,scope:r.scope,expiresAt:r.expiresAt,revoked:!r.revoked,revokeReason:r.revoked?"":e.formatMessage({id:"token.manual.revoke",defaultMessage:"手动撤销"}),channel:r.channel,device:r.device,description:r.description,orgUid:r.orgUid},n.next=3,T(a);case 3:s=n.sent,console.log("handleToggleRevoke response:",s),200===s.code?(m.yw.success(e.formatMessage({id:r.revoked?"token.toggle.revoke.success.restore":"token.toggle.revoke.success.revoke"})),null===(o=t.current)||void 0===o||o.reload()):m.yw.error(s.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),we=function(){var e=v()(h()().mark((function e(n){var r,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(n);case 2:r=e.sent,console.log("handleCreateToken response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),Z(!1)):m.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),be=function(){var e=v()(h()().mark((function e(n){var r,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==j?void 0:j.uid,e.next=3,T(n);case 3:r=e.sent,console.log("handleUpdateToken response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),Z(!1)):m.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Te=function(){Z(!0),X(!1),R({})},Ze=function(){var n=v()(h()().mark((function n(){var r,a,s,o,i,c;return h()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==le.length){n.next=3;break}return m.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),n.abrupt("return");case 3:m.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,s=0,o=p()(le),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return c=i.value,n.prev=11,n.next=14,P(c);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:m.yw.destroy(),0===s?m.yw.success(e.formatMessage({id:"token.batch.delete.success.count"},{count:a})):m.yw.warning(e.formatMessage({id:"token.batch.delete.partial.success.fail"},{success:a,fail:s})),oe([]),ue([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Pe=function(){var n=v()(h()().mark((function n(){var r,a,s,o,i,c,l;return h()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==le.length){n.next=3;break}return m.yw.warning(e.formatMessage({id:"batch.revoke.noselection",defaultMessage:"请选择要撤销的项目"})),n.abrupt("return");case 3:m.yw.loading(e.formatMessage({id:"revoking",defaultMessage:"正在撤销..."})),a=0,s=0,o=p()(le),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=24;break}return c=i.value,n.prev=11,l={uid:c.uid,revoked:!0,revokeReason:e.formatMessage({id:"token.batch.revoke.reason",defaultMessage:"批量撤销"}),orgUid:c.orgUid},n.next=15,T(l);case 15:200===n.sent.code?a++:s++,n.next=22;break;case 19:n.prev=19,n.t0=n.catch(11),s++;case 22:n.next=9;break;case 24:n.next=29;break;case 26:n.prev=26,n.t1=n.catch(7),o.e(n.t1);case 29:return n.prev=29,o.f(),n.finish(29);case 32:m.yw.destroy(),0===s?m.yw.success(e.formatMessage({id:"token.batch.revoke.success.count"},{count:a})):m.yw.warning(e.formatMessage({id:"token.batch.revoke.partial.success.fail"},{success:a,fail:s})),oe([]),ue([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 37:case"end":return n.stop()}}),n,null,[[7,26,29,32],[11,19]])})));return function(){return n.apply(this,arguments)}}(),Ce=function(){var n=v()(h()().mark((function n(){var r,a,s,o,i,c,l;return h()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==le.length){n.next=3;break}return m.yw.warning(e.formatMessage({id:"batch.restore.noselection",defaultMessage:"请选择要恢复的项目"})),n.abrupt("return");case 3:m.yw.loading(e.formatMessage({id:"restoring",defaultMessage:"正在恢复..."})),a=0,s=0,o=p()(le),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=24;break}return c=i.value,n.prev=11,l={uid:c.uid,revoked:!1,revokeReason:"",orgUid:c.orgUid},n.next=15,T(l);case 15:200===n.sent.code?a++:s++,n.next=22;break;case 19:n.prev=19,n.t0=n.catch(11),s++;case 22:n.next=9;break;case 24:n.next=29;break;case 26:n.prev=26,n.t1=n.catch(7),o.e(n.t1);case 29:return n.prev=29,o.f(),n.finish(29);case 32:m.yw.destroy(),0===s?m.yw.success(e.formatMessage({id:"token.batch.restore.success.count"},{count:a})):m.yw.warning(e.formatMessage({id:"token.batch.restore.partial.success.fail"},{success:a,fail:s})),oe([]),ue([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 37:case"end":return n.stop()}}),n,null,[[7,26,29,32],[11,19]])})));return function(){return n.apply(this,arguments)}}(),Se=function(){var n=v()(h()().mark((function n(){var r,a,s;return h()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==fe){n.next=3;break}return m.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return m.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={orgUid:null==g?void 0:g.uid},n.next=8,S(r);case 8:200===(a=n.sent).code?(m.yw.destroy(),m.yw.success(e.formatMessage({id:"token.deleteAll.success.all"})),null===(s=t.current)||void 0===s||s.reloadAndRest()):(m.yw.destroy(),m.yw.error(a.message||e.formatMessage({id:"token.deleteAll.failed"}))),n.next=17;break;case 12:n.prev=12,n.t0=n.catch(4),m.yw.destroy(),m.yw.error(e.formatMessage({id:"token.deleteAll.error.process"})),console.error(e.formatMessage({id:"token.deleteAll.error.console"}),n.t0);case 17:case"end":return n.stop()}}),n,null,[[4,12]])})));return function(){return n.apply(this,arguments)}}(),Ae={selectedRowKeys:se,onChange:function(e,t){oe(e),ue(t)}},je=function(){var e=v()(h()().mark((function e(t,n,r){var a,s,o,l,d;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,s=t.pageSize,o=u()(t,ne),i(a),f(s),me(o),l=c()({pageNumber:a-1,pageSize:s,orgUid:null==g?void 0:g.uid},o),e.next=7,y(l);case 7:return d=e.sent,console.log("queryTokensByOrg response:",d,l),200===d.code?he(d.data.totalElements):m.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}();return(0,$.jsxs)($.Fragment,{children:[b&&(0,$.jsx)(ee,{isEdit:J,open:b,token:j,onClose:function(){Z(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),J?be(e):we(e)}}),(0,$.jsx)(q.Z,{columns:xe,actionRef:t,cardBordered:!0,rowSelection:Ae,request:je,scroll:{x:1600},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){i(e),f(t)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"token.list.title"}),toolBarRender:function(){return t=[(0,$.jsx)(_.ZP,{type:"primary",icon:(0,$.jsx)(E.Z,{}),onClick:Te,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],n=[],se.length>0&&n.push({key:"batchDelete",icon:(0,$.jsx)(O.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(se.length,")"),onClick:function(){Y.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(se.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Ze,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchRevoke",icon:(0,$.jsx)(D.Z,{}),danger:!0,label:e.formatMessage({id:"batch.revoke"})+" (".concat(se.length,")"),onClick:function(){Y.confirm({title:e.formatMessage({id:"batch.revoke.tip"}),content:e.formatMessage({id:"batch.revoke.confirm"}),onOk:Pe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchRestore",icon:(0,$.jsx)(z.Z,{}),label:e.formatMessage({id:"batch.restore"})+" (".concat(se.length,")"),onClick:function(){Y.confirm({title:e.formatMessage({id:"batch.restore.tip"}),content:e.formatMessage({id:"batch.restore.confirm"}),onOk:Ce,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,$.jsx)(B.Z,{}),danger:!0,label:e.formatMessage({id:"token.deleteAll"}),onClick:function(){Y.confirm({title:e.formatMessage({id:"token.deleteAll.tip"}),content:e.formatMessage({id:"token.deleteAll.confirm"}),onOk:Se,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.length>0&&t.push((0,$.jsx)(H.Z,{menu:{items:n},placement:"bottom",children:(0,$.jsxs)(_.ZP,{type:se.length>0?"primary":"default",danger:se.length>0,children:[se.length>0?e.formatMessage({id:"batch.operations"})+" (".concat(se.length,")"):e.formatMessage({id:"more.operations"}),(0,$.jsx)(V.Z,{})]})},"batchOperations")),t;var t,n}}),Q]})},ae=function(){var e=(0,x.useIntl)(),t=(0,s.useState)("tokens"),n=a()(t,2),r=n[0],i=n[1],c=[{key:"tokens",label:e.formatMessage({id:"token.config",defaultMessage:"AccessToken"}),children:(0,$.jsx)(re,{})}];return(0,$.jsx)("div",{className:"token-container",children:(0,$.jsx)(o.Z,{activeKey:r,onChange:function(e){return i(e)},items:c})})}}}]);