"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2810],{99927:function(e,t,a){a.r(t),a.d(t,{default:function(){return J}});var o=a(44194),r=a(37963),s=a(14870),n=a(84176),i=a.n(n),l=a(73193),d=a.n(l),c=a(90819),u=a.n(c),f=a(89933),g=a.n(f),p=a(45332),w=a.n(p),m=a(68349),M=a(26411),v=a(5780),x=a(78359),y=a(5025),h=a(43940),k=a(5488),j=a(8065),b=a(15722),S=a(7358),Z=a(10162),C=a(11090),I=a(2484),A=a(18751),U=a(34599),T=a(81084),P=a(28977),z=a.n(P),B=a(18580),E=a(32394),D=a(47783),F=a(48821),H=a(16331),Y=a(68724),q=a(49616),O=a(31549),R=function(e){var t,a,r=e.isEdit,n=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,c=E.A.useForm(),u=w()(c,1)[0],f=(0,s.useIntl)(),g=(0,U.u)((function(e){return e.currentOrg})),p=(0,o.useState)(),m=w()(p,2),M=m[0],x=m[1],y=(0,j.v)((function(e){return e.categoryResult})),h=(0,A.Z)().translateString;(0,o.useEffect)((function(){if(r&&n&&u){var e;u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid});var t=null==y||null===(e=y.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==n?void 0:n.categoryUid)}));x(t)}else console.log("form resetFields"),u.resetFields()}),[n,u,r,null==y||null===(t=y.data)||void 0===t?void 0:t.content]);return(0,O.jsx)("div",{children:(0,O.jsx)(Y.Z,{title:r?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,O.jsxs)(q.Z,{children:[(0,O.jsx)(v.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,O.jsx)(v.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:r?null==n?void 0:n.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,O.jsxs)(E.A,{form:u,name:"workflow",submitter:!1,children:[(0,O.jsx)(D.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==y||null===(a=y.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),x(null==y||null===(t=y.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,O.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,O.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,O.jsx)(H.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,O.jsx)(H.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},W=a(33363),N=["current","pageSize","content"],L=function(e){var t=e.level,a=(e.type,(0,o.useRef)()),r=(0,s.useIntl)(),n=(0,o.useState)(!0),l=w()(n,2),c=l[0],f=l[1],p=(0,A.Z)().translateString,P=(0,o.useState)(1),E=w()(P,2),D=E[0],F=E[1],H=(0,o.useState)(10),Y=w()(H,2),q=Y[0],L=Y[1],_=(0,o.useState)(!1),K=w()(_,2),G=K[0],J=K[1],Q=(0,o.useState)([]),V=w()(Q,2),$=(V[0],V[1]),X=(0,o.useState)({}),ee=w()(X,2),te=ee[0],ae=ee[1],oe=(0,j.v)((function(e){return e.currentCategory})),re=(0,U.u)((function(e){return e.currentOrg})),se=m.Z.useModal(),ne=w()(se,2),ie=ne[0],le=ne[1],de=(0,o.useState)(0),ce=w()(de,2),ue=ce[0],fe=ce[1],ge=(0,o.useState)({}),pe=w()(ge,2),we=pe[0],me=pe[1],Me=function(){var e=g()(u()().mark((function e(t){var o,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h._I)(t);case 3:200===(o=e.sent).code?(y.yw.destroy(),y.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=a.current)||void 0===s||s.reload()):(y.yw.destroy(),y.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=g()(u()().mark((function e(t){var o,s,n,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=8;break}return y.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.rI)(t);case 4:200===(o=e.sent).code?(y.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(s=a.current)||void 0===s||s.reload(),J(!1)):y.yw.error(o.message),e.next=13;break;case 8:return y.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.$B)(t);case 11:200===(n=e.sent).code?(y.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),J(!1)):y.yw.error(n.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[oe]);var xe=function(){var e=g()(u()().mark((function e(a,o,r){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,o,r),s=localStorage.getItem(k.LA8),n=d()({categoryUid:(null==oe?void 0:oe.uid)===k.zBg?"":null==oe?void 0:oe.uid,orgUid:t===k.Hxq?"":null==re?void 0:re.uid,level:t,accessToken:s||"",exportType:a},we),"current"===a?(n.pageNumber=String(D-1),n.pageSize=String(q)):"all"===a?(n.pageNumber="0",n.pageSize="1000"):"range"===a&&void 0!==o&&void 0!==r&&(n.pageNumber=String(o),n.pageSize=String(r)),window.open((0,B.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,o=Math.ceil(e/a),r=function(){var o=s,r=s*a+1,n=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(n," (").concat(n-r+1,"条)"),onClick:function(){return xe("range",o,a)}})},s=0;s<o;s++)r();return t},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:r.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:r.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:r.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:r.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",o=function(){var e=g()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,W.TE)(t);case 2:e.sent.success?y.yw.success(r.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):y.yw.error(r.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,O.jsx)(M.Z,{content:(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,O.jsx)("span",{children:r.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,O.jsx)(v.ZP,{type:"text",icon:(0,O.jsx)(S.Z,{}),onClick:function(e){e.stopPropagation(),o(a)},title:r.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,O.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,O.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:r.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?z()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?z()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,O.jsx)("a",{onClick:function(){return function(e){f(!0),ae(e),J(!0)}(t)},children:r.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,O.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,O.jsx)(b.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(e.name),"】？"),onOk:function(){Me(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=g()(u()().mark((function e(a,o,s){var n,l,c,f,g,p,w,m,M;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),n=a.current,l=a.pageSize,c=a.content,f=i()(a,N),F(n),L(l),me(d()(d()({},f),{},{content:c})),g=void 0,p=void 0,o&&Object.keys(o).length>0&&(w=Object.keys(o)[0],g=w,p="ascend"===o[w]?"ascend":"descend"),m=d()(d()({pageNumber:n-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==re?void 0:re.uid,categoryUid:(null==oe?void 0:oe.uid)===k.zBg?"":null==oe?void 0:oe.uid,level:t},f),{},{content:c,sortBy:g,sortDirection:p}),e.next=11,(0,h.Au)(m);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,m),200!==M.code){e.next=20;break}return y.yw.destroy(),$(M.data.content),fe(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return y.yw.destroy(),y.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(T.Z,{columns:he,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){F(e),L(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,O.jsx)(v.ZP,{type:"primary",onClick:function(){window.open((0,B.HU)(),"_blank")},icon:(0,O.jsx)(Z.Z,{}),children:r.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,O.jsx)(C.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return xe("current")}}];return ue>0&&(ue<=1e3?t.push({key:"export-all",icon:(0,O.jsx)(C.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ue,"条)"),onClick:function(){return xe("all")}}):t.push({key:"export-range",icon:(0,O.jsx)(C.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ue,"条)"),children:ye(ue)})),e.push((0,O.jsx)(x.Z,{menu:{items:t},placement:"bottom",children:(0,O.jsxs)(v.ZP,{type:"primary",icon:(0,O.jsx)(C.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,O.jsx)(I.Z,{})]})},"export")),e},request:ke}),G&&(0,O.jsx)(R,{isEdit:c,workflow:te,level:t,open:G,onClose:function(){return J(!1)},onSubmit:ve}),le]})},_=function(e){var t,a,r=e.isEdit,n=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,c=E.A.useForm(),u=w()(c,1)[0],f=(0,s.useIntl)(),g=(0,U.u)((function(e){return e.currentOrg})),p=(0,o.useState)(),m=w()(p,2),M=m[0],x=m[1],y=(0,j.v)((function(e){return e.categoryResult})),h=(0,A.Z)().translateString;(0,o.useEffect)((function(){if(r&&n&&u){var e;u.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid});var t=null==y||null===(e=y.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==n?void 0:n.categoryUid)}));x(t)}else console.log("form resetFields"),u.resetFields()}),[n,u,r,null==y||null===(t=y.data)||void 0===t?void 0:t.content]);return(0,O.jsx)("div",{children:(0,O.jsx)(Y.Z,{title:r?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,O.jsxs)(q.Z,{children:[(0,O.jsx)(v.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,O.jsx)(v.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:r?null==n?void 0:n.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,O.jsxs)(E.A,{form:u,name:"workflow",submitter:!1,children:[(0,O.jsx)(D.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==y||null===(a=y.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),x(null==y||null===(t=y.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,O.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,O.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,O.jsx)(H.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,O.jsx)(H.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},K=["current","pageSize","content"],G=function(e){var t=e.level,a=(e.type,(0,o.useRef)()),r=(0,s.useIntl)(),n=(0,o.useState)(!0),l=w()(n,2),c=l[0],f=l[1],p=(0,A.Z)().translateString,P=(0,o.useState)(1),E=w()(P,2),D=E[0],F=E[1],H=(0,o.useState)(10),Y=w()(H,2),q=Y[0],R=Y[1],N=(0,o.useState)(!1),L=w()(N,2),G=L[0],J=L[1],Q=(0,o.useState)([]),V=w()(Q,2),$=(V[0],V[1]),X=(0,o.useState)({}),ee=w()(X,2),te=ee[0],ae=ee[1],oe=(0,j.v)((function(e){return e.currentCategory})),re=(0,U.u)((function(e){return e.currentOrg})),se=m.Z.useModal(),ne=w()(se,2),ie=ne[0],le=ne[1],de=(0,o.useState)(0),ce=w()(de,2),ue=ce[0],fe=ce[1],ge=(0,o.useState)({}),pe=w()(ge,2),we=pe[0],me=pe[1],Me=function(){var e=g()(u()().mark((function e(t){var o,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h._I)(t);case 3:200===(o=e.sent).code?(y.yw.destroy(),y.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=a.current)||void 0===s||s.reload()):(y.yw.destroy(),y.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=g()(u()().mark((function e(t){var o,s,n,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=8;break}return y.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.rI)(t);case 4:200===(o=e.sent).code?(y.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(s=a.current)||void 0===s||s.reload(),J(!1)):y.yw.error(o.message),e.next=13;break;case 8:return y.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.$B)(t);case 11:200===(n=e.sent).code?(y.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),J(!1)):y.yw.error(n.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[oe]);var xe=function(){var e=g()(u()().mark((function e(a,o,r){var s,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,o,r),s=localStorage.getItem(k.LA8),n=d()({categoryUid:(null==oe?void 0:oe.uid)===k.zBg?"":null==oe?void 0:oe.uid,orgUid:t===k.Hxq?"":null==re?void 0:re.uid,level:t,accessToken:s||"",exportType:a},we),"current"===a?(n.pageNumber=String(D-1),n.pageSize=String(q)):"all"===a?(n.pageNumber="0",n.pageSize="1000"):"range"===a&&void 0!==o&&void 0!==r&&(n.pageNumber=String(o),n.pageSize=String(r)),window.open((0,B.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],a=1e3,o=Math.ceil(e/a),r=function(){var o=s,r=s*a+1,n=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(r,"-").concat(n," (").concat(n-r+1,"条)"),onClick:function(){return xe("range",o,a)}})},s=0;s<o;s++)r();return t},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:r.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:r.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:r.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:r.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",o=function(){var e=g()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,W.TE)(t);case 2:e.sent.success?y.yw.success(r.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):y.yw.error(r.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,O.jsx)(M.Z,{content:(0,O.jsxs)("div",{children:[(0,O.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,O.jsx)("span",{children:r.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,O.jsx)(v.ZP,{type:"text",icon:(0,O.jsx)(S.Z,{}),onClick:function(e){e.stopPropagation(),o(a)},title:r.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,O.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,O.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:r.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?z()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?z()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,O.jsx)("a",{onClick:function(){return function(e){f(!0),ae(e),J(!0)}(t)},children:r.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,O.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,O.jsx)(b.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(e.name),"】？"),onOk:function(){Me(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=g()(u()().mark((function e(a,o,s){var n,l,c,f,g,p,w,m,M;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return y.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),n=a.current,l=a.pageSize,c=a.content,f=i()(a,K),F(n),R(l),me(d()(d()({},f),{},{content:c})),g=void 0,p=void 0,o&&Object.keys(o).length>0&&(w=Object.keys(o)[0],g=w,p="ascend"===o[w]?"ascend":"descend"),m=d()(d()({pageNumber:n-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==re?void 0:re.uid,categoryUid:(null==oe?void 0:oe.uid)===k.zBg?"":null==oe?void 0:oe.uid,level:t},f),{},{content:c,sortBy:g,sortDirection:p}),e.next=11,(0,h.Au)(m);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,m),200!==M.code){e.next=20;break}return y.yw.destroy(),$(M.data.content),fe(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return y.yw.destroy(),y.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}();return(0,O.jsxs)(O.Fragment,{children:[(0,O.jsx)(T.Z,{columns:he,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){F(e),R(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,O.jsx)(v.ZP,{type:"primary",onClick:function(){window.open((0,B.HU)(),"_blank")},icon:(0,O.jsx)(Z.Z,{}),children:r.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,O.jsx)(C.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return xe("current")}}];return ue>0&&(ue<=1e3?t.push({key:"export-all",icon:(0,O.jsx)(C.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ue,"条)"),onClick:function(){return xe("all")}}):t.push({key:"export-range",icon:(0,O.jsx)(C.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ue,"条)"),children:ye(ue)})),e.push((0,O.jsx)(x.Z,{menu:{items:t},placement:"bottom",children:(0,O.jsxs)(v.ZP,{type:"primary",icon:(0,O.jsx)(C.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,O.jsx)(I.Z,{})]})},"export")),e},request:ke}),G&&(0,O.jsx)(_,{isEdit:c,workflow:te,level:t,open:G,onClose:function(){return J(!1)},onSubmit:ve}),le]})},J=(r.Z.TabPane,function(e){var t=e.level,a=void 0===t?"org":t,o=(0,s.useIntl)(),n=[{key:"template",label:o.formatMessage({id:"pages.whatsapp.template.tab",defaultMessage:"WhatsApp 模板"}),children:(0,O.jsx)(L,{level:a,type:"whatsapp"})},{key:"send",label:o.formatMessage({id:"pages.whatsapp.send.tab",defaultMessage:"发送记录"}),children:(0,O.jsx)(G,{level:a,type:"whatsapp"})}];return(0,O.jsx)("div",{children:(0,O.jsx)(r.Z,{defaultActiveKey:"template",items:n,style:{padding:"10px"}})})})}}]);