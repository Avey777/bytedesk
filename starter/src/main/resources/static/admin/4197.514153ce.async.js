"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4197],{83381:function(e,t,r){r.d(t,{Z:function(){return d}});var a=r(77260),s=r(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=r(5901),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var d=s.forwardRef(o)},28031:function(e,t,r){r.d(t,{Z:function(){return d}});var a=r(77260),s=r(44194),n={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=r(5901),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var d=s.forwardRef(o)},80503:function(e,t,r){r.d(t,{Z:function(){return d}});var a=r(77260),s=r(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},i=r(5901),o=function(e,t){return s.createElement(i.Z,(0,a.Z)({},e,{ref:t,icon:n}))};var d=s.forwardRef(o)},18316:function(e,t,r){r.d(t,{Lp:function(){return m},Pn:function(){return h},c5:function(){return v},ln:function(){return g},p:function(){return l}});var a=r(90819),s=r.n(a),n=r(73193),i=r.n(n),o=r(89933),d=r.n(o),c=r(25191),u=r(75699);function l(e){return p.apply(this,arguments)}function p(){return(p=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/query/org",{method:"GET",params:i()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return f.apply(this,arguments)}function f(){return(f=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/create",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return x.apply(this,arguments)}function x(){return(x=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/update",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return M.apply(this,arguments)}function M(){return(M=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=d()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/tag/delete/all",{method:"POST",data:i()(i()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},22837:function(e,t,r){r.d(t,{Z:function(){return $}});var a=r(84176),s=r.n(a),n=r(73193),i=r.n(n),o=r(90819),d=r.n(o),c=r(89933),u=r.n(c),l=r(45332),p=r.n(l),g=r(31756),f=r(35129),m=r(25191),x=r(75699);function h(e){return M.apply(this,arguments)}function M(){return(M=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/browse/query/org",{method:"GET",params:i()(i()({},t),{},{channel:m.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return b.apply(this,arguments)}function b(){return(b=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/browse/create",{method:"POST",data:i()(i()({},t),{},{channel:m.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return k.apply(this,arguments)}function k(){return(k=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/browse/update",{method:"POST",data:i()(i()({},t),{},{channel:m.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return w.apply(this,arguments)}function w(){return(w=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/browse/delete",{method:"POST",data:i()(i()({},t),{},{channel:m.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var S=r(31881),F=r(32597),Z=r(83381),I=r(58896),T=r(41881),L=r(91768),A=r(28031),U=r(6992),C=r(80503),B=r(79148),O=r(43443),z=r(43413),E=r(59946),R=r(77407),P=r(50972),N=r(28977),D=r.n(N),q=r(44194),Y=r(6373),J=r(22766),H=r(12581),X=r(34651),G=r(55738),K=r(24418),V=r(31549),Q=function(e){var t,r=e.isEdit,a=e.browse,s=e.open,n=e.onClose,o=e.onSubmit,d=(0,x.useIntl)(),c=X.Z.useForm(),u=p()(c,1)[0],l=G.Z.Text;(0,q.useEffect)((function(){var e;s&&(r&&a?u.setFieldsValue({url:a.url||"",title:a.title||"",referrer:a.referrer||"",ipAddress:a.ipAddress||"",deviceType:a.deviceType||"",operatingSystem:a.operatingSystem||"",browser:a.browser||"",screenResolution:a.screenResolution||"",duration:a.duration||"",pageLoadTime:a.pageLoadTime||"",geoLocation:a.geoLocation||"",sessionId:a.sessionId||"",userAgent:a.userAgent||"",utmSource:a.utmSource||"",utmMedium:a.utmMedium||"",utmCampaign:a.utmCampaign||"",status:(null===(e=a.visitor)||void 0===e?void 0:e.status)||"",eventData:a.eventData||""}):u.resetFields())}),[s,r,a,u]);var g=r?d.formatMessage({id:"browse.edit",defaultMessage:"编辑客户"}):d.formatMessage({id:"browse.create",defaultMessage:"新增客户"}),f=a&&!r,m=f?null:(0,V.jsxs)(z.Z,{children:[(0,V.jsx)(R.ZP,{onClick:n,children:(0,V.jsx)(x.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,V.jsx)(R.ZP,{type:"primary",onClick:function(){u.validateFields().then((function(e){var t=i()(i()({},e),r&&a?{uid:a.uid}:{});o(t)}))},children:(0,V.jsx)(x.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,V.jsx)(V.Fragment,{children:(0,V.jsx)(K.Z,{title:g,onClose:n,open:s,width:500,extra:m,children:f&&a?(0,V.jsxs)("div",{children:[(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"url",defaultMessage:"URL"}),":"]})," ",a.url||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"title",defaultMessage:"标题"}),":"]})," ",a.title||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),":"]})," ",a.referrer||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"}),":"]})," ",a.ipAddress||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),":"]})," ",a.deviceType||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"operatingSystem",defaultMessage:"操作系统"}),":"]})," ",a.operatingSystem||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"browser",defaultMessage:"浏览器"}),":"]})," ",a.browser||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"screenResolution",defaultMessage:"屏幕分辨率"}),":"]})," ",a.screenResolution||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"duration",defaultMessage:"停留时长"}),":"]})," ",a.duration?"".concat(a.duration,"秒"):"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"pageLoadTime",defaultMessage:"页面加载时间"}),":"]})," ",a.pageLoadTime?"".concat(a.pageLoadTime,"毫秒"):"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"}),":"]})," ",a.geoLocation||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"sessionId",defaultMessage:"会话ID"}),":"]})," ",a.sessionId||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"userAgent",defaultMessage:"User-Agent"}),":"]})," ",a.userAgent||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"utmSource",defaultMessage:"UTM来源"}),":"]})," ",a.utmSource||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"utmMedium",defaultMessage:"UTM媒介"}),":"]})," ",a.utmMedium||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"utmCampaign",defaultMessage:"UTM活动"}),":"]})," ",a.utmCampaign||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"browse.status",defaultMessage:"状态"}),":"]})," ",(null===(t=a.visitor)||void 0===t?void 0:t.status)||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"eventData",defaultMessage:"事件数据"}),":"]})," ",a.eventData||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",a.createdAt||"-"]}),(0,V.jsxs)("div",{style:{marginBottom:16},children:[(0,V.jsxs)(l,{strong:!0,children:[(0,V.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",a.updatedAt||"-"]})]}):(0,V.jsxs)(Y.A,{form:u,name:"browseForm",submitter:!1,children:[(0,V.jsx)(J.Z,{name:"url",label:(0,V.jsx)(x.FormattedMessage,{id:"url",defaultMessage:"URL"}),rules:[{required:!0,message:"请输入访问的URL"}]}),(0,V.jsx)(J.Z,{name:"title",label:(0,V.jsx)(x.FormattedMessage,{id:"title",defaultMessage:"标题"}),rules:[{required:!0,message:"请输入页面标题"}]}),(0,V.jsx)(J.Z,{name:"referrer",label:(0,V.jsx)(x.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),placeholder:"来源页面URL"}),(0,V.jsx)(J.Z,{name:"ipAddress",label:(0,V.jsx)(x.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"})}),(0,V.jsx)(J.Z,{name:"deviceType",label:(0,V.jsx)(x.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),placeholder:"desktop/mobile/tablet"}),(0,V.jsx)(J.Z,{name:"operatingSystem",label:(0,V.jsx)(x.FormattedMessage,{id:"operatingSystem",defaultMessage:"操作系统"})}),(0,V.jsx)(J.Z,{name:"browser",label:(0,V.jsx)(x.FormattedMessage,{id:"browser",defaultMessage:"浏览器"})}),(0,V.jsx)(J.Z,{name:"screenResolution",label:(0,V.jsx)(x.FormattedMessage,{id:"screenResolution",defaultMessage:"屏幕分辨率"}),placeholder:"如 1920x1080"}),(0,V.jsx)(J.Z,{name:"duration",label:(0,V.jsx)(x.FormattedMessage,{id:"duration",defaultMessage:"停留时长(秒)"}),fieldProps:{type:"number"}}),(0,V.jsx)(J.Z,{name:"pageLoadTime",label:(0,V.jsx)(x.FormattedMessage,{id:"pageLoadTime",defaultMessage:"页面加载时间(毫秒)"}),fieldProps:{type:"number"}}),(0,V.jsx)(J.Z,{name:"geoLocation",label:(0,V.jsx)(x.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"})}),(0,V.jsx)(J.Z,{name:"sessionId",label:(0,V.jsx)(x.FormattedMessage,{id:"sessionId",defaultMessage:"会话ID"})}),(0,V.jsx)(H.Z,{name:"userAgent",label:(0,V.jsx)(x.FormattedMessage,{id:"userAgent",defaultMessage:"User-Agent"})}),(0,V.jsx)(J.Z,{name:"utmSource",label:(0,V.jsx)(x.FormattedMessage,{id:"utmSource",defaultMessage:"UTM来源"})}),(0,V.jsx)(J.Z,{name:"utmMedium",label:(0,V.jsx)(x.FormattedMessage,{id:"utmMedium",defaultMessage:"UTM媒介"})}),(0,V.jsx)(J.Z,{name:"utmCampaign",label:(0,V.jsx)(x.FormattedMessage,{id:"utmCampaign",defaultMessage:"UTM活动"})}),(0,V.jsx)(J.Z,{name:"status",label:(0,V.jsx)(x.FormattedMessage,{id:"browse.status",defaultMessage:"状态"}),placeholder:"默认为 ONLINE"}),(0,V.jsx)(H.Z,{name:"eventData",label:(0,V.jsx)(x.FormattedMessage,{id:"eventData",defaultMessage:"事件数据"}),placeholder:"JSON格式的事件信息"})]})})})},W=["current","pageSize"],_=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,V.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,V.jsx)(x.FormattedMessage,{id:"url",defaultMessage:"URL"}),dataIndex:"url",copyable:!0,ellipsis:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.url.tooltip",defaultMessage:"访问的URL地址"}),render:function(e,t){return t.url?(0,V.jsx)("a",{href:t.url,target:"_blank",rel:"noopener noreferrer",children:t.url}):"-"}},{title:(0,V.jsx)(x.FormattedMessage,{id:"title",defaultMessage:"标题"}),dataIndex:"title",ellipsis:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.title.tooltip",defaultMessage:"页面标题"})},{title:(0,V.jsx)(x.FormattedMessage,{id:"referrer",defaultMessage:"来源"}),dataIndex:"referrer",ellipsis:!0,hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.referrer.tooltip",defaultMessage:"来源页面URL"}),render:function(e,t){return t.referrer?(0,V.jsx)("a",{href:t.referrer,target:"_blank",rel:"noopener noreferrer",children:t.referrer}):"-"}},{title:(0,V.jsx)(x.FormattedMessage,{id:"deviceType",defaultMessage:"设备类型"}),dataIndex:"deviceType",hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.deviceType.tooltip",defaultMessage:"设备类型(desktop/mobile/tablet)"})},{title:(0,V.jsx)(x.FormattedMessage,{id:"browser",defaultMessage:"浏览器"}),dataIndex:"browser",hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.browser.tooltip",defaultMessage:"浏览器类型"})},{title:(0,V.jsx)(x.FormattedMessage,{id:"duration",defaultMessage:"停留时长"}),dataIndex:"duration",hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.duration.tooltip",defaultMessage:"停留时长(秒)"}),render:function(e,t){return t.duration?"".concat(t.duration,"秒"):"-"}},{title:(0,V.jsx)(x.FormattedMessage,{id:"ipAddress",defaultMessage:"IP地址"}),dataIndex:"ipAddress",copyable:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.ipAddress.tooltip",defaultMessage:"访客IP地址"})},{title:(0,V.jsx)(x.FormattedMessage,{id:"geoLocation",defaultMessage:"地理位置"}),dataIndex:"geoLocation",hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.geoLocation.tooltip",defaultMessage:"访客地理位置"})},{title:(0,V.jsx)(x.FormattedMessage,{id:"status",defaultMessage:"状态"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.status.tooltip",defaultMessage:"访客状态"}),render:function(e,t){var r,a,s;return"ONLINE"===(null===(r=t.visitor)||void 0===r?void 0:r.status)?(0,V.jsx)(O.Z,{color:"green",children:(0,V.jsx)(x.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===(null===(a=t.visitor)||void 0===a?void 0:a.status)?(0,V.jsx)(O.Z,{color:"red",children:(0,V.jsx)(x.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===(null===(s=t.visitor)||void 0===s?void 0:s.status)?(0,V.jsx)(O.Z,{color:"black",children:(0,V.jsx)(x.FormattedMessage,{id:"visitor.status.blocked"})}):(0,V.jsx)(O.Z,{color:"default",children:(0,V.jsx)(x.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,V.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"访问时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,V.jsx)(x.FormattedMessage,{id:"browse.createdAt.tooltip",defaultMessage:"访问时间"}),render:function(e,t,r,a){return D()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],$=function(e){var t=e.isSuperUser,r=(0,x.useIntl)(),a=(0,q.useRef)(),n=(0,q.useState)(1),o=p()(n,2),c=o[0],l=o[1],M=(0,q.useState)(10),b=p()(M,2),k=b[0],w=b[1],O=(0,S.u)((function(e){return e.currentOrg})),N=(0,q.useState)({}),D=p()(N,2),Y=D[0],J=D[1],H=(0,q.useState)(0),X=p()(H,2),G=X[0],K=X[1],$=(0,q.useState)([]),ee=p()($,2),te=ee[0],re=ee[1],ae=(0,q.useState)([]),se=p()(ae,2),ne=(se[0],se[1]),ie=(0,q.useState)(!1),oe=p()(ie,2),de=oe[0],ce=oe[1],ue=(0,q.useState)(!1),le=p()(ue,2),pe=le[0],ge=le[1],fe=(0,q.useState)(),me=p()(fe,2),xe=me[0],he=me[1],Me=function(){var e=u()(d()().mark((function e(t){var s,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!pe||!xe){e.next=7;break}return e.next=4,j(i()(i()({},t),{},{uid:xe.uid,orgUid:null==O?void 0:O.uid}));case 4:s=e.sent,e.next=10;break;case 7:return e.next=9,v(i()(i()({},t),{},{orgUid:null==O?void 0:O.uid}));case 9:s=e.sent;case 10:200===s.code?(g.yw.success(pe?r.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):r.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),ce(!1),null===(n=a.current)||void 0===n||n.reload()):g.yw.error(s.message||r.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),g.yw.error(r.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),ve=function(){he(void 0),ge(!1),ce(!0)},be=[].concat(_,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,t){return(0,V.jsxs)(z.Z,{children:[(0,V.jsx)(E.Z,{title:r.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,V.jsx)(R.ZP,{type:"text",icon:(0,V.jsx)(I.Z,{}),onClick:function(){return function(e){he(e),ge(!1),ce(!0)}(t)}})}),(0,V.jsx)(E.Z,{title:r.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,V.jsx)(R.ZP,{type:"text",icon:(0,V.jsx)(T.Z,{}),onClick:function(){return function(e){he(e),ge(!0),ce(!0)}(t)}})}),(0,V.jsx)(E.Z,{title:r.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,V.jsx)(R.ZP,{type:"text",danger:!0,icon:(0,V.jsx)(L.Z,{}),onClick:function(){return function(e){var t;f.Z.confirm({title:r.formatMessage({id:"browse.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,V.jsx)(Z.Z,{}),content:r.formatMessage({id:"browse.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(t=u()(d()().mark((function t(){var s,n;return d()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,y({uid:e.uid,orgUid:null==O?void 0:O.uid});case 3:200===(s=t.sent).code?(g.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=a.current)||void 0===n||n.reload()):g.yw.error(s.message||r.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),t.next=11;break;case 7:t.prev=7,t.t0=t.catch(0),console.error("删除客户出错:",t.t0),g.yw.error(r.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return t.stop()}}),t,null,[[0,7]])}))),function(){return t.apply(this,arguments)})})}(t)}})})]})}}]),je=function(){var e=u()(d()().mark((function e(t,r,a){var s,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,r,a),s=localStorage.getItem(m.LA8),n=i()({orgUid:(null==O?void 0:O.uid)||"",accessToken:s||"",exportType:t},Y),"current"===t?(n.pageNumber=String(c-1),n.pageSize=String(k)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==r&&void 0!==a&&(n.pageNumber=String(r),n.pageSize=String(a)),window.open((0,F.kG)()+"/api/v1/browse/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ke=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return je("range",a,r)}})},n=0;n<a;n++)s();return t},ye={selectedRowKeys:te,onChange:function(e,t){re(e),ne(t)}};return(0,V.jsxs)(V.Fragment,{children:[(0,V.jsx)(B.Z,{columns:be,actionRef:a,cardBordered:!0,rowSelection:ye,scroll:{x:2500},request:function(){var e=u()(d()().mark((function e(r,a,n){var o,c,u,p,f,m,x,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,c=r.pageSize,u=s()(r,W),l(o),w(c),J(u),p=void 0,f=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],p=m,f="ascend"===a[m]?"ascend":"descend"),x=i()(i()({pageNumber:o-1,pageSize:c,orgUid:null==O?void 0:O.uid,isSuperUser:t},u),{},{sortBy:p,sortDirection:f}),e.next=10,h(x);case 10:return M=e.sent,console.log("queryBrowsesByOrg response:",M,x),200===M.code?K(M.data.totalElements):g.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),w(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"浏览列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,V.jsx)(A.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return je("current")}}],G>0&&(G<=1e3?e.push({key:"export-all",icon:(0,V.jsx)(A.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return je("all")}}):e.push({key:"export-range",icon:(0,V.jsx)(A.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:ke(G)})),[(0,V.jsx)(R.ZP,{type:"primary",icon:(0,V.jsx)(U.Z,{}),onClick:ve,children:r.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,V.jsx)(P.Z,{menu:{items:e},placement:"bottom",children:(0,V.jsxs)(R.ZP,{type:"primary",icon:(0,V.jsx)(A.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,V.jsx)(C.Z,{})]})},"exportOperations")];var e}}),(0,V.jsx)(Q,{isEdit:pe,browse:xe,open:de,onClose:function(){return ce(!1)},onSubmit:Me})]})}},83857:function(e,t,r){r.d(t,{Z:function(){return P}});var a=r(84176),s=r.n(a),n=r(86222),i=r.n(n),o=r(90819),d=r.n(o),c=r(10154),u=r.n(c),l=r(73193),p=r.n(l),g=r(89933),f=r.n(g),m=r(45332),x=r.n(m),h=r(31756),M=r(25191),v=r(75699);function b(e){return j.apply(this,arguments)}function j(){return(j=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/black/query/org",{method:"GET",params:p()(p()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return y.apply(this,arguments)}function y(){return(y=f()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/black/delete",{method:"POST",data:{uid:t,channel:M.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(31881),S=r(32597),F=r(91768),Z=r(80503),I=r(28031),T=r(79148),L=r(44532),A=r(77407),U=r(35129),C=r(50972),B=r(28977),O=r.n(B),z=r(44194),E=r(31549),R=["current","pageSize"],P=function(e){var t=e.isSuperUser,r=(0,v.useIntl)(),a=(0,z.useRef)(),n=(0,w.u)((function(e){return e.currentOrg})),o=(0,z.useState)(1),c=x()(o,2),l=c[0],g=c[1],m=(0,z.useState)(10),j=x()(m,2),y=j[0],B=j[1],P=(0,z.useState)({}),N=x()(P,2),D=N[0],q=N[1],Y=(0,z.useState)(0),J=x()(Y,2),H=J[0],X=J[1],G=(0,z.useState)([]),K=x()(G,2),V=K[0],Q=K[1],W=(0,z.useState)([]),_=x()(W,2),$=_[0],ee=_[1],te=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,E.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.blockIp"}),dataIndex:"blockIp",tooltip:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.blockIp.tooltip"}),valueEnum:{true:{text:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.yes"}),status:"Error"},false:{text:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.no"}),status:"Default"}}},{title:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.reason"}),dataIndex:"reason",copyable:!0,tooltip:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.reason.tooltip"})},{title:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.startTime.tooltip"}),render:function(e,t){return t.startTime?O()(t.startTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.endTime.tooltip"}),render:function(e,t){return t.endTime?O()(t.endTime).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.userNickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,E.jsx)(v.FormattedMessage,{id:"visitor.black.userNickname.tooltip"})},{title:(0,E.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,E.jsx)(v.FormattedMessage,{id:"message.createdAt.tooltip"}),render:function(e,t){return t.createdAt?O()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],re=[].concat(te,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,s){return[(0,E.jsx)(L.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.blackNickname,"】？"),onConfirm:function(){return se(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,E.jsx)(A.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackip.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),ae=function(){var e=f()(d()().mark((function e(r,a,s){var i,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),i=localStorage.getItem(M.LA8),o=p()({orgUid:t?"":(null==n?void 0:n.uid)||"",accessToken:i||"",exportType:r},Object.entries(D).reduce((function(e,t){var r=x()(t,2),a=r[0],s=r[1];return p()(p()({},e),{},u()({},a,"string"==typeof s?s:String(s)))}),{})),"current"===r?(o.pageNumber=String(l-1),o.pageSize=String(y)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,S.kG)()+"/api/v1/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),se=function(){var e=f()(d()().mark((function e(t){var s,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,k(t.uid);case 4:s=e.sent,console.log("unblock response:",s),200===s.code?(null==a||null===(n=a.current)||void 0===n||n.reload(),h.yw.success(r.formatMessage({id:"unblock.success"}))):h.yw.error(r.formatMessage({id:"unblock.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),h.yw.error(r.formatMessage({id:"unblock.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),ne=function(){var e=f()(d()().mark((function e(){var t,s,n,o,c,u;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==$.length){e.next=3;break}return h.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:h.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,o=i()($),e.prev=7,o.s();case 9:if((c=o.n()).done){e.next=23;break}return u=c.value,e.prev=11,e.next=14,k(u.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:h.yw.destroy(),0===n?h.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:s})):h.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:s,fail:n})),Q([]),ee([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ie=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return ae("range",a,r)}})},n=0;n<a;n++)s();return t},oe={selectedRowKeys:V,onChange:function(e,t){Q(e),ee(t)}};return(0,E.jsx)(T.Z,{columns:re,actionRef:a,cardBordered:!0,rowSelection:oe,scroll:{x:2e3},request:function(){var e=f()(d()().mark((function e(r,a,i){var o,c,u,l,f,m,x,M;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,c=r.pageSize,u=s()(r,R),g(o),B(c),q(u),l=void 0,f=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],l=m,f="ascend"===a[m]?"ascend":"descend"),x=p()(p()({pageNumber:r.current-1,pageSize:c,orgUid:null==n?void 0:n.uid,isSuperUser:t},u),{},{sortBy:l,sortDirection:f}),e.next=10,b(x);case 10:return M=e.sent,console.log("queryBlacks response:",M,x),200===M.code?X(M.data.totalElements):h.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){g(e),B(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.black.list"}),toolBarRender:function(){return function(){var e=[],t=[];V.length>0&&(t.push({key:"batchUnblock",icon:(0,E.jsx)(F.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(V.length,")"),onClick:function(){U.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(V.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:ne,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,E.jsx)(C.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(A.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",V.length,")",(0,E.jsx)(Z.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,E.jsx)(I.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ae("current")}}];return H>0&&(H<=1e3?a.push({key:"export-all",icon:(0,E.jsx)(I.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(H,"条)"),onClick:function(){return ae("all")}}):a.push({key:"export-range",icon:(0,E.jsx)(I.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(H,"条)"),children:ie(H)})),e.push((0,E.jsx)(C.Z,{menu:{items:a},placement:"bottom",children:(0,E.jsxs)(A.ZP,{type:"primary",icon:(0,E.jsx)(I.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,E.jsx)(Z.Z,{})]})},"exportOperations")),e}()}})}},93686:function(e,t,r){r.d(t,{Z:function(){return E}});var a=r(84176),s=r.n(a),n=r(86222),i=r.n(n),o=r(90819),d=r.n(o),c=r(73193),u=r.n(c),l=r(89933),p=r.n(l),g=r(45332),f=r.n(g),m=r(31756),x=r(25191),h=r(75699);function M(e){return v.apply(this,arguments)}function v(){return(v=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/ip/black/query/org",{method:"GET",params:u()(u()({},t),{},{channel:x.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return j.apply(this,arguments)}function j(){return(j=p()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/ip/black/delete",{method:"POST",data:{uid:t,channel:x.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var k=r(31881),y=r(32597),w=r(91768),S=r(80503),F=r(28031),Z=r(79148),I=r(44532),T=r(77407),L=r(35129),A=r(50972),U=r(28977),C=r.n(U),B=r(44194),O=r(31549),z=["current","pageSize"],E=function(e){var t=e.isSuperUser,r=(0,h.useIntl)(),a=(0,B.useRef)(),n=(0,k.u)((function(e){return e.currentOrg})),o=(0,B.useState)(1),c=f()(o,2),l=c[0],g=c[1],v=(0,B.useState)(10),j=f()(v,2),U=j[0],E=j[1],R=(0,B.useState)({}),P=f()(R,2),N=P[0],D=P[1],q=(0,B.useState)(0),Y=f()(q,2),J=Y[0],H=Y[1],X=(0,B.useState)([]),G=f()(X,2),K=G[0],V=G[1],Q=(0,B.useState)([]),W=f()(Q,2),_=W[0],$=W[1],ee=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,O.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.ip"}),dataIndex:"ip",tooltip:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.ip.tooltip"})},{title:(0,O.jsx)(h.FormattedMessage,{id:"visitor.black.nickname"}),dataIndex:"blackNickname",copyable:!0,tooltip:(0,O.jsx)(h.FormattedMessage,{id:"visitor.black.nickname.tooltip"})},{title:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.reason"}),dataIndex:"reason",tooltip:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.reason.tooltip"})},{title:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.startTime"}),dataIndex:"startTime",search:!1,tooltip:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.startTime.tooltip"}),render:function(e,t){return(0,O.jsx)("span",{children:C()(t.startTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.endTime"}),dataIndex:"endTime",search:!1,tooltip:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.endTime.tooltip"}),render:function(e,t){return(0,O.jsx)("span",{children:C()(t.endTime).format("YYYY-MM-DD HH:mm:ss")})}},{title:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.userNickname"}),dataIndex:"userNickname",tooltip:(0,O.jsx)(h.FormattedMessage,{id:"visitor.blackip.userNickname.tooltip"})},{title:(0,O.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,O.jsx)(h.FormattedMessage,{id:"message.createdAt.tooltip"})}],te=[].concat(ee,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(e,t,a,s){return[(0,O.jsx)(I.Z,{title:r.formatMessage({id:"unblockTip",defaultMessage:"Delete Tip"}),description:"".concat(r.formatMessage({id:"unblockAffirm",defaultMessage:"Unblock"}),"【").concat(null==t?void 0:t.ip,"】？"),onConfirm:function(){return ae(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,O.jsx)(T.ZP,{size:"small",type:"link",danger:!0,children:r.formatMessage({id:"visitor.blackip.unblock",defaultMessage:"Unblock"})})},"unblock")]}}]),re=function(){var e=p()(d()().mark((function e(r,a,s){var i,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),i=localStorage.getItem(x.LA8),o=u()({orgUid:t?"":null==n?void 0:n.uid,accessToken:i||"",exportType:r},N),"current"===r?(o.pageNumber=String(l-1),o.pageSize=String(U)):"all"===r?(o.pageNumber="0",o.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,y.kG)()+"/api/v1/ip/black/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),ae=function(){var e=p()(d()().mark((function e(t){var s,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(t),e.prev=1,e.next=4,b(t.uid);case 4:s=e.sent,console.log("unblock response:",s),200===s.code?(null==a||null===(n=a.current)||void 0===n||n.reload(),m.yw.success(r.formatMessage({id:"unblock.success"}))):m.yw.error(r.formatMessage({id:"unblock.error"})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),m.yw.error(r.formatMessage({id:"unblock.error"}));case 12:case"end":return e.stop()}}),e,null,[[1,9]])})));return function(t){return e.apply(this,arguments)}}(),se=function(){var e=p()(d()().mark((function e(){var t,s,n,o,c,u;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==_.length){e.next=3;break}return m.yw.warning(r.formatMessage({id:"batch.noselection",defaultMessage:"请选择需要处理的项目"})),e.abrupt("return");case 3:m.yw.loading(r.formatMessage({id:"processing",defaultMessage:"处理中..."})),s=0,n=0,o=i()(_),e.prev=7,o.s();case 9:if((c=o.n()).done){e.next=23;break}return u=c.value,e.prev=11,e.next=14,b(u.uid);case 14:200===e.sent.code?s++:n++,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),n++;case 21:e.next=9;break;case 23:e.next=28;break;case 25:e.prev=25,e.t1=e.catch(7),o.e(e.t1);case 28:return e.prev=28,o.f(),e.finish(28);case 31:m.yw.destroy(),0===n?m.yw.success(r.formatMessage({id:"batch.unblock.success",defaultMessage:"成功解除 {count} 条黑名单"},{count:s})):m.yw.warning(r.formatMessage({id:"batch.unblock.partial",defaultMessage:"成功解除 {success} 条黑名单，失败 {fail} 条"},{success:s,fail:n})),V([]),$([]),null===(t=a.current)||void 0===t||t.reloadAndRest();case 36:case"end":return e.stop()}}),e,null,[[7,25,28,31],[11,18]])})));return function(){return e.apply(this,arguments)}}(),ne=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return re("range",a,r)}})},n=0;n<a;n++)s();return t},ie={selectedRowKeys:K,onChange:function(e,t){V(e),$(t)}};return(0,O.jsx)(Z.Z,{columns:te,actionRef:a,cardBordered:!0,rowSelection:ie,scroll:{x:1800},request:function(){var e=p()(d()().mark((function e(r,a,i){var o,c,l,p,f,x,h,v;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=r.current,c=r.pageSize,l=s()(r,z),g(o),E(c),D(l),p=void 0,f=void 0,a&&Object.keys(a).length>0&&(x=Object.keys(a)[0],p=x,f="ascend"===a[x]?"ascend":"descend"),h=u()(u()({pageNumber:r.current-1,pageSize:c,orgUid:null==n?void 0:n.uid,isSuperUser:t},l),{},{sortBy:p,sortDirection:f}),e.next=10,M(h);case 10:return v=e.sent,console.log("queryIpBlacklists response:",v,h),200===v.code?H(v.data.totalElements):m.yw.error(v.message),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){g(e),E(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.blackip.list"}),toolBarRender:function(){return function(){var e=[],t=[];K.length>0&&(t.push({key:"batchUnblock",icon:(0,O.jsx)(w.Z,{}),danger:!0,label:r.formatMessage({id:"batch.unblock",defaultMessage:"批量解除黑名单"})+" (".concat(K.length,")"),onClick:function(){L.Z.confirm({title:r.formatMessage({id:"batch.unblockTip",defaultMessage:"解除黑名单确认"}),content:"".concat(r.formatMessage({id:"batch.unblockAffirm",defaultMessage:"确定要解除"})," ").concat(K.length," ").concat(r.formatMessage({id:"items",defaultMessage:"项"}),"?"),onOk:se,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}}),e.push((0,O.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,O.jsxs)(T.ZP,{type:"primary",danger:!0,children:[r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})," (",K.length,")",(0,O.jsx)(S.Z,{})]})},"batchOperations")));var a=[{key:"export-current",icon:(0,O.jsx)(F.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return re("current")}}];return J>0&&(J<=1e3?a.push({key:"export-all",icon:(0,O.jsx)(F.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(J,"条)"),onClick:function(){return re("all")}}):a.push({key:"export-range",icon:(0,O.jsx)(F.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(J,"条)"),children:ne(J)})),e.push((0,O.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,O.jsxs)(T.ZP,{type:"primary",icon:(0,O.jsx)(F.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,O.jsx)(S.Z,{})]})},"exportOperations")),e}()}})}},99626:function(e,t,r){r.d(t,{Z:function(){return D}});var a=r(84176),s=r.n(a),n=r(90819),i=r.n(n),o=r(73193),d=r.n(o),c=r(89933),u=r.n(c),l=r(45332),p=r.n(l),g=r(31756),f=r(25191),m=r(75699);function x(e){return h.apply(this,arguments)}function h(){return(h=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.request)("/api/v1/visitor/query/org",{method:"GET",params:d()(d()({},t),{},{channel:f.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return v.apply(this,arguments)}function v(){return(v=u()(i()().mark((function e(t){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,m.request)("/api/v1/visitor/update/tagList",{method:"POST",data:d()(d()({},t),{},{channel:f.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=r(31881),j=r(32597),k=r(47454),y=r(28031),w=r(80503),S=r(79148),F=r(43443),Z=r(50972),I=r(77407),T=r(28977),L=r.n(T),A=r(44194),U=r(34651),C=r(24418),B=r(43413),O=r(34251),z=r(18316),E=r(30234),R=r(31549),P=function(e){var t=e.open,r=e.onClose,a=e.onSubmit,s=e.visitor,n=e.orgUid,o=(0,m.useIntl)(),d=(0,E.Z)().translateString,c=U.Z.useForm(),l=p()(c,1)[0],x=(0,A.useState)([]),h=p()(x,2),v=h[0],b=h[1],j=(0,A.useState)(!1),k=p()(j,2),y=k[0],w=k[1],S=(0,A.useMemo)((function(){var e;return 1===(null==s||null===(e=s.tagList)||void 0===e?void 0:e.length)&&""===s.tagList[0]?[]:(null==s?void 0:s.tagList)||[]}),[null==s?void 0:s.tagList]);(0,A.useEffect)((function(){t&&n&&F()}),[t,n]),(0,A.useEffect)((function(){t&&s&&l.setFieldsValue({tagList:S})}),[t,s,S,l]);var F=function(){var e=u()(i()().mark((function e(){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,z.p)({orgUid:n,type:f.IuT});case 3:200===(t=e.sent).code?b(t.data.content||[]):g.yw.error(t.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Error fetching tags:",e.t0),g.yw.error(o.formatMessage({id:"fetch.tags.error"}));case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),Z=function(){var e=u()(i()().mark((function e(){var t,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(s){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,w(!0),e.next=6,l.validateFields();case 6:return t=e.sent,e.next=9,M({uid:s.uid,tagList:t.tagList||[],orgUid:s.orgUid});case 9:200===(n=e.sent).code?(g.yw.success(o.formatMessage({id:"save.success",defaultMessage:"保存成功"})),a(),r()):g.yw.error(n.message||o.formatMessage({id:"save.error",defaultMessage:"保存失败"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(2),console.error("Validation failed:",e.t0),g.yw.error(o.formatMessage({id:"save.error",defaultMessage:"保存失败"}));case 17:return e.prev=17,w(!1),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[2,13,17,20]])})));return function(){return e.apply(this,arguments)}}();return(0,R.jsx)(C.Z,{title:o.formatMessage({id:"edit.visitor",defaultMessage:"编辑访客"}),placement:"right",onClose:r,open:t,width:400,extra:(0,R.jsxs)(B.Z,{children:[(0,R.jsx)(I.ZP,{onClick:r,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,R.jsx)(I.ZP,{type:"primary",onClick:Z,loading:y,children:o.formatMessage({id:"ok",defaultMessage:"确定"})})]}),children:(0,R.jsx)(U.Z,{form:l,layout:"vertical",initialValues:{tagList:S},children:(0,R.jsx)(U.Z.Item,{name:"tagList",label:o.formatMessage({id:"tags",defaultMessage:"标签"}),rules:[{type:"array"}],children:(0,R.jsx)(O.Z,{mode:"multiple",allowClear:!0,showSearch:!0,placeholder:o.formatMessage({id:"select.tags",defaultMessage:"请选择标签"}),style:{width:"100%"},options:v.map((function(e){return{label:d(e.name),value:e.name}})),filterOption:function(e,t){var r;return(null!==(r=null==t?void 0:t.label)&&void 0!==r?r:"").toLowerCase().includes(e.toLowerCase())}})})})})},N=["current","pageSize"],D=function(e){var t=e.isSuperUser,r=(0,m.useIntl)(),a=(0,A.useRef)(),n=(0,b.u)((function(e){return e.currentOrg})),o=(0,A.useState)(1),c=p()(o,2),l=c[0],h=c[1],M=(0,A.useState)(10),v=p()(M,2),T=v[0],U=v[1],C=(0,A.useState)({}),B=p()(C,2),O=B[0],z=B[1],E=(0,A.useState)(0),D=p()(E,2),q=D[0],Y=D[1],J=(0,A.useState)([]),H=p()(J,2),X=H[0],G=H[1],K=(0,A.useState)([]),V=p()(K,2),Q=(V[0],V[1]),W=(0,A.useState)(!1),_=p()(W,2),$=_[0],ee=_[1],te=(0,A.useState)(null),re=p()(te,2),ae=re[0],se=re[1],ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(m.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.nickname"}),dataIndex:"nickname",copyable:!0,width:250,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.nickname.tooltip"})},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.ip"}),dataIndex:"ip",copyable:!0,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.ip.tooltip"})},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.ipLocation"}),dataIndex:"ipLocation",copyable:!0,width:250,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.ipLocation.tooltip"})},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.status"}),dataIndex:"status",hideInSearch:!0,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.status.tooltip"}),render:function(e,t){return"ONLINE"===t.status?(0,R.jsx)(F.Z,{color:"green",children:(0,R.jsx)(m.FormattedMessage,{id:"visitor.status.online"})}):"OFFLINE"===t.status?(0,R.jsx)(F.Z,{color:"red",children:(0,R.jsx)(m.FormattedMessage,{id:"visitor.status.offline"})}):"BLOCKED"===t.status?(0,R.jsx)(F.Z,{color:"black",children:(0,R.jsx)(m.FormattedMessage,{id:"visitor.status.blocked"})}):(0,R.jsx)(F.Z,{color:"default",children:(0,R.jsx)(m.FormattedMessage,{id:"visitor.status.unknown"})})}},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.vipLevel"}),dataIndex:"vipLevel",copyable:!0,hideInSearch:!0,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.vipLevel.tooltip"})},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.channel"}),dataIndex:"client",hideInSearch:!0,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.channel.tooltip"}),render:function(e,t){return(0,k.YG)(t.channel)}},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.tagList"}),dataIndex:"tagList",hideInSearch:!0,tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.tagList.tooltip"}),render:function(e,t){var r;return null==t||null===(r=t.tagList)||void 0===r?void 0:r.map((function(e,t){return(0,R.jsx)(F.Z,{color:"green",style:{marginRight:4},children:e},t)}))}},{title:(0,R.jsx)(m.FormattedMessage,{id:"visitor.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,fixed:"right",tooltip:(0,R.jsx)(m.FormattedMessage,{id:"visitor.updatedAt.tooltip"}),render:function(e,t){return(0,R.jsx)("span",{children:L()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss")})}}],ie=[].concat(ne,[{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),valueType:"option",key:"option",fixed:"right",width:100,render:function(e,t){return[(0,R.jsx)("a",{onClick:function(){se(t),ee(!0)},children:r.formatMessage({id:"edit",defaultMessage:"编辑"})},"edit")]}}]),oe=function(){var e=u()(i()().mark((function e(r,a,s){var o,c;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",r,a,s),o=localStorage.getItem(f.LA8),c=d()({orgUid:t?"":null==n?void 0:n.uid,accessToken:o||"",exportType:r},O),"current"===r?(c.pageNumber=String(l-1),c.pageSize=String(T)):"all"===r?(c.pageNumber="0",c.pageSize="1000"):"range"===r&&void 0!==a&&void 0!==s&&(c.pageNumber=String(a),c.pageSize=String(s)),window.open((0,j.kG)()+"/api/v1/visitor/export?"+new URLSearchParams(c).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),de=function(e){for(var t=[],r=1e3,a=Math.ceil(e/r),s=function(){var a=n,s=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(s,"-").concat(i," (").concat(i-s+1,"条)"),onClick:function(){return oe("range",a,r)}})},n=0;n<a;n++)s();return t},ce={selectedRowKeys:X,onChange:function(e,t){G(e),Q(t)}};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(S.Z,{columns:ie,actionRef:a,cardBordered:!0,rowSelection:ce,scroll:{x:1800},request:function(){var e=u()(i()().mark((function e(r,a,o){var c,u,l,p,f,m,M,v;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return c=r.current,u=r.pageSize,l=s()(r,N),h(c),U(u),z(l),p=void 0,f=void 0,a&&Object.keys(a).length>0&&(m=Object.keys(a)[0],p=m,f="ascend"===a[m]?"ascend":"descend"),M=d()(d()({pageNumber:r.current-1,pageSize:u,orgUid:null==n?void 0:n.uid,isSuperUser:t},l),{},{sortBy:p,sortDirection:f}),e.next=10,x(M);case 10:return v=e.sent,console.log("queryVisitorsByOrg response:",v,M),200===v.code?Y(v.data.totalElements):g.yw.error(v.message),e.abrupt("return",{data:v.data.content,success:!0,total:v.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,a){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){h(e),U(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"visitor.list"}),toolBarRender:function(){return e=[{key:"export-current",icon:(0,R.jsx)(y.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return oe("current")}}],q>0&&(q<=1e3?e.push({key:"export-all",icon:(0,R.jsx)(y.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(q,"条)"),onClick:function(){return oe("all")}}):e.push({key:"export-range",icon:(0,R.jsx)(y.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(q,"条)"),children:de(q)})),[(0,R.jsx)(Z.Z,{menu:{items:e},placement:"bottom",children:(0,R.jsxs)(I.ZP,{type:"primary",icon:(0,R.jsx)(y.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,R.jsx)(w.Z,{})]})},"exportOperations")];var e}}),(0,R.jsx)(P,{open:$,onClose:function(){ee(!1),se(null)},onSubmit:function(){var e;null===(e=a.current)||void 0===e||e.reload()},visitor:ae,orgUid:(null==ae?void 0:ae.orgUid)||(null==n?void 0:n.uid)})]})}}}]);