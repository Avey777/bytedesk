"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9290],{86985:function(e,s,r){r.d(s,{Z:function(){return M}});var t=r(90819),a=r.n(t),n=r(89933),i=r.n(n),o=r(45332),l=r.n(o),c=r(5025),d=r(5488),u=r(14870);function f(){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,s){return m.apply(this,arguments)}function m(){return(m=i()(a()().mark((function e(s,r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:s,captchaCode:r,channel:d.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=r(58087),x=r(27259),w=r(44194),y=r(31549),M=function(e){var s=e.onKaptchaChange,r=e.onKaptchaCheck,t=(0,u.useIntl)(),n=(0,w.useState)(),o=l()(n,2),d=o[0],p=o[1],m=(0,w.useState)(),M=l()(m,2),v=M[0],j=M[1],b=(0,w.useState)(!1),Z=l()(b,2),k=Z[0],C=Z[1],S=function(){var e=i()(a()().mark((function e(){var s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!k){e.next=2;break}return e.abrupt("return");case 2:return C(!0),e.prev=3,e.next=6,f();case 6:200===(s=e.sent).code?(p(s.data.captchaUid),j(s.data.captchaImage)):c.yw.error(t.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),c.yw.error(t.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 13:return e.prev=13,C(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(){return e.apply(this,arguments)}}(),P=function(){var e=i()(a()().mark((function e(s,t){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(s,t);case 2:n=e.sent,console.log("checkCaptcha response",n),200===n.code?r&&r(!0):r&&r(!1);case 5:case"end":return e.stop()}}),e)})));return function(s,r){return e.apply(this,arguments)}}();(0,w.useEffect)((function(){S()}),[]);return(0,y.jsx)(y.Fragment,{children:v&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(x.Z,{onChange:function(e){s&&(s(d,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?P(d,e.target.value):r&&r(!1))},prefix:(0,y.jsx)(h.Z,{}),placeholder:t.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,y.jsx)("img",{src:v,alt:"captcha",onClick:S})]})})}},92023:function(e,s,r){r.d(s,{G:function(){return p}});var t=r(73193),a=r.n(t),n=(r(44194),r(15435)),i=r(5488),o=r(28977),l=r.n(o),c=r(95660),d=r(5025),u=r(18580),f=r(31549),p=function(e){var s=e.children,r=e.onSuccess,t=e.onError,o={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},p={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:o,showUploadList:!1,beforeUpload:function(e){c.Z.log("beforeUpload",e);var s=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return o.file=e,o.fileName=s,o.fileType=e.type,c.Z.log("beforeUpload",o),!0},onChange:function(e){if("uploading"!==e.file.status&&c.Z.log("not uploading:",e.file),"done"===e.file.status)if(c.Z.log("response: ",e.file.response),200===e.file.response.code){var s=e.file.response.data.fileUrl;r(s),d.yw.success("".concat(e.file.name," 上传成功"))}else t(e.file),d.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(d.yw.error("".concat(e.file.name," 上传失败")),t(e.file))}};return(0,f.jsx)(n.Z,a()(a()({},p),{},{children:s}))}},9362:function(e,s,r){r.r(s),r.d(s,{default:function(){return te}});var t=r(73193),a=r.n(t),n=r(90819),i=r.n(n),o=r(89933),l=r.n(o),c=r(45332),d=r.n(c),u=r(44194),f=r(14870),p=r(85817),g=r(79401),m=r(78875),h=r(20228),x=r(49616),w=r(45681),y=r(5780),M=r(93892),v=r(82373),j=r(88344),b=r(32394),Z=r(48821),k=r(16331),C=r(10022),S=r(59908),P=r(26978),U=r(31806),I=r(93689),T=r(40439),z=r(79479),A=r(90033),F=r(20467),D=r(5025),E=r(92023),R=r(18751),q=r(33363),L=r(16843),V=r(86985),B=r(34599),N=r(5488),O=r(40795),K=r(71017),Y=r(68349),G=r(31549),W=function(e){var s=e.open,r=e.onSubmit,t=e.onClose,a=(0,f.useIntl)(),n=b.A.useForm(),o=d()(n,1)[0],c=(0,R.Z)().translateString,p=(0,A.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),g=p.userInfo,m=p.deviceUid,h=(0,B.u)((function(e){return e.currentOrg})),x=(0,u.useRef)(),w=(0,u.useState)(""),y=d()(w,2),M=y[0],v=y[1],j=(0,u.useState)(""),k=d()(j,2),C=k[0],S=k[1],U=(0,u.useState)(!1),I=d()(U,2),T=I[0],z=I[1],E=function(){var e=l()(i()().mark((function e(s,r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",s," captchaValue",r),v(s),S(r);case 3:case"end":return e.stop()}}),e)})));return function(s,r){return e.apply(this,arguments)}}(),q=function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",s),z(s);case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),W=function(){var e=l()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=l()(i()().mark((function e(s){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changeEmail:",s),(null==g?void 0:g.email)!==s.email){e.next=4;break}return D.yw.error("Email is not changed!"),e.abrupt("return");case 4:return a={email:s.email,code:s.code,platform:N.iw8},e.next=7,(0,F.Uk)(a);case 7:n=e.sent,console.log("changeEmail response:",n),200===n.code?(D.yw.success("Email changed successfully!"),r(s.email),t()):D.yw.error(c(n.message));case 10:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=x.current)||void 0===e||e.endTiming()}),2)};return(0,G.jsx)(G.Fragment,{children:(0,G.jsx)(Y.Z,{title:a.formatMessage({id:"pages.settings.reset.email",defaultMessage:"重置邮箱"}),forceRender:!0,open:s,footer:null,onCancel:function(){t()},children:(0,G.jsxs)(b.A,{form:o,onFinish:function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeEmail:",s),W();case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),children:[(0,G.jsx)(Z.Z,{fieldProps:{size:"large",prefix:(0,G.jsx)(O.Z,{})},name:"email",placeholder:a.formatMessage({id:"pages.login.email.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,G.jsx)(f.FormattedMessage,{id:"pages.login.email.required",defaultMessage:"请输入邮箱！"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,G.jsx)(b.A.Item,{name:"captchaCode",rules:[],children:(0,G.jsx)(V.Z,{onKaptchaChange:E,onKaptchaCheck:q})}),(0,G.jsx)(K.Z,{fieldProps:{size:"large",prefix:(0,G.jsx)(P.Z,{})},captchaProps:{size:"large",disabled:!T},placeholder:a.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,s){return e?"".concat(s," ").concat(a.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):a.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"email",name:"code",rules:[{required:!0,message:(0,G.jsx)(f.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:x,onGetCaptcha:function(){var e=l()(i()().mark((function e(s){var r,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("email:",s),!s){e.next=18;break}if((null==g?void 0:g.email)!==s){e.next=6;break}return D.yw.error("Email is not changed!"),$(),e.abrupt("return");case 6:return r={email:s,type:N.Iju,captchaUid:M,captchaCode:C,deviceUid:m,userUid:null==g?void 0:g.uid,orgUid:null==h?void 0:h.uid,platform:N.iw8},e.next=9,(0,L.O8)(r);case 9:if(t=e.sent,console.log("sendEmailCode",t),200===t.code){e.next=15;break}return D.yw.error(t.message),$(),e.abrupt("return");case 15:D.yw.success(t.message),e.next=19;break;case 18:D.yw.error("手机号格式错误");case 19:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()})]})})})},$=function(e){var s=e.open,r=e.onSubmit,t=e.onClose,a=(0,f.useIntl)(),n=b.A.useForm(),o=d()(n,1)[0],c=(0,R.Z)().translateString,p=(0,A.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),g=p.userInfo,m=p.deviceUid,h=(0,B.u)((function(e){return e.currentOrg})),x=(0,u.useRef)(),w=(0,u.useState)(""),y=d()(w,2),M=y[0],v=y[1],j=(0,u.useState)(""),k=d()(j,2),C=k[0],S=k[1],U=(0,u.useState)(!1),I=d()(U,2),T=I[0],z=I[1],E=function(){var e=l()(i()().mark((function e(s,r){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",s," captchaValue",r),v(s),S(r);case 3:case"end":return e.stop()}}),e)})));return function(s,r){return e.apply(this,arguments)}}(),q=function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",s),z(s);case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),W=function(){var e=l()(i()().mark((function e(){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=l()(i()().mark((function e(s){var a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("changeMobile:",s),(null==g?void 0:g.mobile)!==s.mobile){e.next=4;break}return D.yw.error("mobile is not changed"),e.abrupt("return");case 4:return a={mobile:s.mobile,code:s.code,platform:N.iw8},e.next=7,(0,F.KF)(a);case 7:n=e.sent,console.log("changeMobile response:",n),200===n.code?(D.yw.success("Mobile changed successfully!"),r(s.mobile),t()):D.yw.error(c(n.message));case 10:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=x.current)||void 0===e||e.endTiming()}),2)};return(0,G.jsx)(G.Fragment,{children:(0,G.jsx)(Y.Z,{title:a.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"重置手机号"}),forceRender:!0,open:s,footer:null,onCancel:function(){t()},children:(0,G.jsxs)(b.A,{form:o,onFinish:function(){var e=l()(i()().mark((function e(s){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeMobile:",s),W();case 2:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),children:[(0,G.jsx)(Z.Z,{fieldProps:{size:"large",prefix:(0,G.jsx)(O.Z,{})},name:"mobile",placeholder:a.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,G.jsx)(f.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,G.jsx)(f.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,G.jsx)(b.A.Item,{name:"captchaCode",rules:[],children:(0,G.jsx)(V.Z,{onKaptchaChange:E,onKaptchaCheck:q})}),(0,G.jsx)(K.Z,{fieldProps:{size:"large",prefix:(0,G.jsx)(P.Z,{})},captchaProps:{size:"large",disabled:!T},placeholder:a.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,s){return e?"".concat(s," ").concat(a.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):a.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,G.jsx)(f.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:x,onGetCaptcha:function(){var e=l()(i()().mark((function e(s){var r,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",s),!s||11!==s.length){e.next=18;break}if((null==g?void 0:g.mobile)!==s){e.next=6;break}return D.yw.error("mobile is not changed"),$(),e.abrupt("return");case 6:return r={mobile:s,type:N.BG8,captchaUid:M,captchaCode:C,deviceUid:m,userUid:null==g?void 0:g.uid,orgUid:null==h?void 0:h.uid,platform:N.iw8},e.next=9,(0,L.Y7)(r);case 9:if(t=e.sent,console.log("sendMobileCode",t),200===t.code){e.next=15;break}return D.yw.error(t.message),$(),e.abrupt("return");case 15:D.yw.success(t.message),e.next=19;break;case 18:D.yw.error("手机号格式错误");case 19:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}()})]})})})},H=r(24522),J=r(63327),Q=r(63628),X=p.Z.Text,_=function(e){var s=e.open,r=e.onClose,t=(0,f.useIntl)(),a=(0,R.Z)().translateString,n=(0,u.useState)(0),o=d()(n,2),c=o[0],p=o[1],g=(0,u.useState)(""),m=d()(g,2),h=m[0],w=m[1],y=function(e){return e>=80?"#52c41a":e>=60?"#faad14":e>=40?"#fa8c16":"#ff4d4f"};return(0,G.jsx)(Y.Z,{title:t.formatMessage({id:"pages.settings.reset.password",defaultMessage:"重置密码"}),forceRender:!0,open:s,footer:null,onCancel:function(){r()},children:(0,G.jsxs)(b.A,{initialValues:{oldPassword:"",newPassword:"",confirmPassword:""},onFinish:function(){var e=l()(i()().mark((function e(s){var n,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!((0,J.Qc)(s.newPassword)<40)){e.next=4;break}return D.yw.error(t.formatMessage({id:"pages.settings.password.weak",defaultMessage:"密码强度太弱，请设置更强的密码"})),e.abrupt("return");case 4:if(!(s.newPassword.trim().length<6)){e.next=7;break}return D.yw.error(t.formatMessage({id:"pages.settings.password.min.length",defaultMessage:"密码最小长度不能小于6"})),e.abrupt("return");case 7:if(s.newPassword===s.confirmPassword){e.next=10;break}return D.yw.error(t.formatMessage({id:"pages.settings.password.mismatch",defaultMessage:"两次输入密码不一致"})),e.abrupt("return");case 10:return n={oldPassword:s.oldPassword,newPassword:s.newPassword},e.next=13,(0,F.Cp)(n);case 13:200===(o=e.sent).code?(D.yw.success(t.formatMessage({id:"pages.settings.password.change.success",defaultMessage:"Password changed successfully!"})),r()):D.yw.error(a(o.message));case 15:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}(),children:[(0,G.jsx)(Z.Z.Password,{name:"oldPassword",label:t.formatMessage({id:"pages.settings.password.old",defaultMessage:"原密码(手机号直接登录用户，可以留空)"})}),(0,G.jsx)(Z.Z.Password,{name:"newPassword",label:t.formatMessage({id:"pages.settings.password.new",defaultMessage:"新密码"}),fieldProps:{onChange:function(e){var s=e.target.value,r=(0,J.Qc)(s),t=(0,J.$g)(r);p(r),w(t)}},rules:[{required:!0,message:t.formatMessage({id:"pages.settings.password.new.required",defaultMessage:"请输入新密码"})},{min:6,message:t.formatMessage({id:"pages.settings.password.min.length",defaultMessage:"密码长度不能少于6位"})}]}),(0,G.jsx)("div",{style:{marginBottom:16},children:(0,G.jsx)(X,{type:"secondary",style:{fontSize:"12px"},children:t.formatMessage({id:"pages.settings.password.suggestion",defaultMessage:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})})}),c>0&&(0,G.jsx)("div",{style:{marginBottom:16},children:(0,G.jsxs)(x.Z,{direction:"vertical",style:{width:"100%"},children:[(0,G.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,G.jsx)(X,{type:"secondary",children:t.formatMessage({id:"pages.settings.password.strength",defaultMessage:"密码强度："})}),(0,G.jsx)(X,{strong:!0,style:{color:y(c)},children:h})]}),(0,G.jsx)(Q.Z,{percent:c,strokeColor:y(c),showInfo:!1,size:"small"}),(0,G.jsx)(X,{type:"secondary",style:{fontSize:"12px"},children:t.formatMessage({id:"pages.settings.password.suggestion",defaultMessage:"建议：包含大小写字母、数字和特殊字符，长度至少8位"})})]})}),(0,G.jsx)(Z.Z.Password,{name:"confirmPassword",label:t.formatMessage({id:"pages.settings.password.confirm",defaultMessage:"确认密码"}),rules:[{required:!0,message:t.formatMessage({id:"pages.settings.password.confirm.required",defaultMessage:"请确认密码"})},function(e){var s=e.getFieldValue;return{validator:function(e,r){return r&&s("newPassword")!==r?Promise.reject(new Error(t.formatMessage({id:"pages.settings.password.confirm.error",defaultMessage:"两次输入密码不一致"}))):Promise.resolve()}}}]})]})})},ee={labelCol:{span:6},wrapperCol:{span:18}},se=p.Z.Title,re=p.Z.Text,te=function(){var e=(0,f.useIntl)(),s=(0,H.Z)().isDarkMode,r=(0,f.useLocation)(),t=b.A.useForm(),n=d()(t,1)[0],o=(0,R.Z)().translateString,c=(0,A.L)((function(e){return{userInfo:e.userInfo,setUserInfo:e.setUserInfo}})),p=c.userInfo,L=c.setUserInfo,V=(0,u.useState)(""),B=d()(V,2),N=B[0],O=B[1],K=(0,u.useState)(!1),Y=d()(K,2),J=Y[0],Q=Y[1],X=(0,u.useState)(!1),te=d()(X,2),ae=te[0],ne=te[1],ie=(0,u.useState)(!1),oe=d()(ie,2),le=oe[0],ce=oe[1],de=function(s){if(0===s)return e.formatMessage({id:"password.modified.today",defaultMessage:"今天"});if(1===s)return e.formatMessage({id:"password.modified.yesterday",defaultMessage:"昨天"});if(-1===s)return e.formatMessage({id:"password.modified.tomorrow",defaultMessage:"明天"});if(s>0){if(s<7)return e.formatMessage({id:"password.modified.days.ago",defaultMessage:"".concat(s,"天前")},{days:s});if(s<30){var r=Math.floor(s/7);return e.formatMessage({id:"password.modified.weeks.ago",defaultMessage:"".concat(r,"周前")},{weeks:r})}if(s<365){var t=Math.floor(s/30);return e.formatMessage({id:"password.modified.months.ago",defaultMessage:"".concat(t,"个月前")},{months:t})}var a=Math.floor(s/365);return e.formatMessage({id:"password.modified.years.ago",defaultMessage:"".concat(a,"年前")},{years:a})}return e.formatMessage({id:"password.modified.today",defaultMessage:"今天"})},ue=function(){var s=(null==p?void 0:p.passwordModifiedAt)||(null==p?void 0:p.createdAt);if(!s)return null;var r=new Date(s),t=new Date,a=new Date(r.getFullYear(),r.getMonth(),r.getDate()),n=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i=n.getTime()-a.getTime(),o=Math.floor(i/864e5);return console.log("Password modification time calculation:",{originalPasswordDate:r.toISOString(),originalCurrentDate:t.toISOString(),passwordDateOnly:a.toISOString(),currentDateOnly:n.toISOString(),diffTime:i,diffDays:o,timeFieldUsed:null!=p&&p.passwordModifiedAt?"passwordModifiedAt":"createdAt (fallback)",note:null!=p&&p.passwordModifiedAt?"Using actual password modification time":"Using account creation time as fallback for password modification time"}),{passwordDate:r,diffDays:o,isLongTime:o>90,isVeryLongTime:o>180,isUsingCreatedAt:!(null!=p&&p.passwordModifiedAt),formattedDate:r.toLocaleDateString("zh-CN"===e.locale?"zh-CN":"en-US",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),formattedTimeDiff:de(o)}}(),fe=function(){Q(!0)},pe=function(){var s=l()(i()().mark((function s(r,t){var a,l;return i()().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,(0,F.ck)(r);case 3:if(a=s.sent,console.log("updateProfile response:",a),200!==a.code){s.next=12;break}return l=t||e.formatMessage({id:"update.success"}),D.yw.success(l),a.data.username!==p.username?(0,q.NZ)():(L(a.data),n.setFieldsValue({uid:a.data.uid,username:a.data.username,nickname:o(a.data.nickname),email:a.data.email,mobile:a.data.mobile,description:o(a.data.description)})),s.abrupt("return",!0);case 12:return D.yw.error(a.message),s.abrupt("return",!1);case 14:s.next=21;break;case 16:return s.prev=16,s.t0=s.catch(0),console.error("Update profile error:",s.t0),D.yw.error(e.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),s.abrupt("return",!1);case 21:case"end":return s.stop()}}),s,null,[[0,16]])})));return function(e,r){return s.apply(this,arguments)}}(),ge=function(){var s=l()(i()().mark((function s(r){var t;return i()().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return console.log("handleUploadSuccess:",r),O(r),t=a()(a()({},p),{},{avatar:r}),s.next=5,pe(t,e.formatMessage({id:"avatar.upload.success",defaultMessage:"头像上传成功"}));case 5:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}(),me=function(){var e=l()(i()().mark((function e(s){var r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=a()(a()(a()({},p),s),{},{avatar:N}),console.log("Form submit userObject:",r),e.next=4,pe(r);case 4:case"end":return e.stop()}}),e)})));return function(s){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){p&&O(p.avatar)}),[p]);var he=function(){var e=l()(i()().mark((function e(){var s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,F.Ai)();case 2:s=e.sent,console.log("handleRefreshProfile getProfile response:",s),200===s.code?(L(s.data),n.setFieldsValue({uid:s.data.uid,username:s.data.username,nickname:o(s.data.nickname),email:s.data.email,mobile:s.data.mobile,description:o(s.data.description)})):D.yw.error(s.message);case 5:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,u.useEffect)((function(){he()}),[]),(0,u.useEffect)((function(){if("true"===new URLSearchParams(r.search).get("showChangePassword")){var e=setTimeout((function(){Q(!0);var e=r.pathname;window.history.replaceState({},"",e)}),500);return function(){return clearTimeout(e)}}}),[r.search]),(0,G.jsxs)("div",{style:{padding:"24px",backgroundColor:s?"#1f1f1f":"#f0f2f5",minHeight:"100vh"},children:[(0,G.jsxs)(g.Z,{variant:"borderless",style:{maxWidth:800,margin:"0 auto",borderRadius:"12px",boxShadow:s?"0 2px 8px rgba(255, 255, 255, 0.05)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[(0,G.jsxs)(se,{level:2,style:{marginBottom:"24px",textAlign:"center"},children:[(0,G.jsx)(C.Z,{style:{marginRight:"8px",color:"#1890ff"}}),e.formatMessage({id:"profile.title",defaultMessage:"个人资料"})]}),(0,G.jsx)(g.Z,{size:"small",style:{marginBottom:"24px",backgroundColor:s?"#2d2d2d":"#fafafa",borderRadius:"8px"},children:(0,G.jsx)(m.Z,{justify:"center",align:"middle",style:{padding:"20px 0"},children:(0,G.jsx)(h.Z,{children:(0,G.jsxs)(x.Z,{direction:"vertical",align:"center",size:"large",children:[(0,G.jsx)(w.Z,{src:N,size:100,style:{border:"4px solid #fff",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.15)"}}),(0,G.jsx)(E.G,{onSuccess:ge,onError:function(e){console.log("handleUploadError:",e)},children:(0,G.jsx)(y.ZP,{type:"primary",icon:(0,G.jsx)(S.Z,{}),style:{borderRadius:"20px"},children:e.formatMessage({id:"pages.robot.upload",defaultMessage:"上传头像"})})},"avatar")]})})})}),(0,G.jsxs)(b.A,a()(a()({},ee),{},{form:n,onFinish:me,submitter:{render:function(e,s){return(0,G.jsx)(m.Z,{justify:"center",style:{marginTop:"32px"},children:(0,G.jsx)(h.Z,{children:(0,G.jsx)(x.Z,{size:"middle",children:s})})})},submitButtonProps:{size:"large",style:{borderRadius:"8px",minWidth:"120px"}},resetButtonProps:{size:"large",style:{borderRadius:"8px",minWidth:"120px"}}},children:[(0,G.jsxs)(g.Z,{title:(0,G.jsxs)(re,{strong:!0,style:{fontSize:"16px"},children:[(0,G.jsx)(C.Z,{style:{marginRight:"8px",color:"#1890ff"}}),e.formatMessage({id:"profile.basic.info",defaultMessage:"基本信息"})]}),size:"small",style:{marginBottom:"24px",backgroundColor:s?"#262626":void 0},children:[(0,G.jsx)(Z.Z,{name:"uid",label:e.formatMessage({id:"profile.user.id",defaultMessage:"用户ID"}),rules:[{required:!0}],readonly:!0,fieldProps:{style:{backgroundColor:s?"#2a2a2a":"#f5f5f5"}}}),(0,G.jsx)(Z.Z,{name:"username",label:e.formatMessage({id:"username.change.tip",defaultMessage:"用户名"}),rules:[{required:!0}],fieldProps:{prefix:(0,G.jsx)(C.Z,{style:{color:"#1890ff"}})}}),(0,G.jsx)(Z.Z,{name:"nickname",label:e.formatMessage({id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0}],fieldProps:{prefix:(0,G.jsx)(C.Z,{style:{color:"#52c41a"}})}}),(0,G.jsx)(k.Z,{name:"description",label:e.formatMessage({id:"description",defaultMessage:"个人简介"}),fieldProps:{rows:4,placeholder:e.formatMessage({id:"profile.description.placeholder",defaultMessage:"请输入个人简介..."})}})]}),(0,G.jsxs)(g.Z,{title:(0,G.jsxs)(re,{strong:!0,style:{fontSize:"16px"},children:[(0,G.jsx)(P.Z,{style:{marginRight:"8px",color:"#fa541c"}}),e.formatMessage({id:"profile.security.settings",defaultMessage:"安全设置"})]}),size:"small",style:{marginBottom:"24px",backgroundColor:s?"#262626":void 0},children:[ue&&(0,G.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,G.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0"},children:[(0,G.jsxs)(x.Z,{children:[(0,G.jsx)(P.Z,{style:{color:"#fa541c"}}),(0,G.jsx)(re,{children:e.formatMessage({id:"password.modified.time",defaultMessage:"密码修改时间"})})]}),(0,G.jsxs)(x.Z,{direction:"vertical",align:"end",size:"small",children:[(0,G.jsx)(re,{type:"secondary",children:ue.formattedDate}),(0,G.jsxs)(re,{type:"secondary",style:{fontSize:"12px"},children:["(",ue.formattedTimeDiff,")"]})]})]}),ue.isLongTime&&(0,G.jsx)(M.Z,{message:e.formatMessage({id:"password.security.reminder",defaultMessage:"密码安全提醒"}),description:ue.isVeryLongTime?e.formatMessage({id:"password.very.long.time.warning",defaultMessage:"您的密码已经 ".concat(ue.diffDays," 天没有修改，存在安全风险，强烈建议立即更换密码。")},{days:ue.diffDays}):e.formatMessage({id:"password.long.time.warning",defaultMessage:"您的密码已经 ".concat(ue.diffDays," 天没有修改，建议定期更换密码以确保账户安全。")},{days:ue.diffDays}),type:ue.isVeryLongTime?"error":"warning",showIcon:!0,style:{marginTop:"8px"},action:(0,G.jsx)(y.ZP,{size:"small",type:"primary",onClick:fe,danger:ue.isVeryLongTime,children:e.formatMessage({id:"password.change.now",defaultMessage:"立即修改"})})}),(0,G.jsx)(v.Z,{style:{margin:"16px 0"}})]}),(0,G.jsx)(m.Z,{gutter:[16,16],children:(0,G.jsx)(h.Z,{span:24,children:(0,G.jsxs)(x.Z,{direction:"vertical",style:{width:"100%"},children:[(0,G.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[(0,G.jsxs)(x.Z,{children:[(0,G.jsx)(P.Z,{style:{color:"#fa541c"}}),(0,G.jsx)(re,{children:e.formatMessage({id:"profile.login.password",defaultMessage:"登录密码"})})]}),(0,G.jsx)(y.ZP,{type:"link",onClick:fe,style:{fontWeight:"bold"},children:e.formatMessage({id:"pages.settings.reset.password",defaultMessage:"修改密码"})})]}),(0,G.jsx)(v.Z,{style:{margin:"8px 0"}})]})})})]}),(0,G.jsx)(g.Z,{title:(0,G.jsxs)(re,{strong:!0,style:{fontSize:"16px"},children:[(0,G.jsx)(U.Z,{style:{marginRight:"8px",color:"#722ed1"}}),e.formatMessage({id:"profile.contact.info",defaultMessage:"联系方式"})]}),size:"small",children:(0,G.jsx)(m.Z,{gutter:[16,16],children:(0,G.jsxs)(h.Z,{span:24,children:[(0,G.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[(0,G.jsxs)(x.Z,{children:[(0,G.jsx)(U.Z,{style:{color:"#722ed1"}}),(0,G.jsx)(re,{children:e.formatMessage({id:"profile.email.address",defaultMessage:"邮箱地址"})}),null!=p&&p.emailVerified?(0,G.jsx)(j.Z,{icon:(0,G.jsx)(I.Z,{}),color:"success",children:e.formatMessage({id:"profile.verified",defaultMessage:"已验证"})}):(0,G.jsx)(j.Z,{icon:(0,G.jsx)(T.Z,{}),color:"error",children:e.formatMessage({id:"profile.not.verified",defaultMessage:"未验证"})})]}),(0,G.jsxs)(x.Z,{children:[(0,G.jsx)(re,{type:"secondary",children:(null==p?void 0:p.email)||e.formatMessage({id:"profile.not.set",defaultMessage:"未设置"})}),(0,G.jsx)(y.ZP,{type:"link",onClick:function(){ne(!0)},style:{fontWeight:"bold"},children:e.formatMessage({id:"pages.settings.reset.email",defaultMessage:"修改邮箱"})})]})]}),(0,G.jsx)(v.Z,{style:{margin:"8px 0"}}),(0,G.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"12px 0"},children:[(0,G.jsxs)(x.Z,{children:[(0,G.jsx)(z.Z,{style:{color:"#13c2c2"}}),(0,G.jsx)(re,{children:e.formatMessage({id:"profile.mobile.number",defaultMessage:"手机号码"})}),null!=p&&p.mobileVerified?(0,G.jsx)(j.Z,{icon:(0,G.jsx)(I.Z,{}),color:"success",children:e.formatMessage({id:"profile.verified",defaultMessage:"已验证"})}):(0,G.jsx)(j.Z,{icon:(0,G.jsx)(T.Z,{}),color:"error",children:e.formatMessage({id:"profile.not.verified",defaultMessage:"未验证"})})]}),(0,G.jsxs)(x.Z,{children:[(0,G.jsx)(re,{type:"secondary",children:(null==p?void 0:p.mobile)||e.formatMessage({id:"profile.not.set",defaultMessage:"未设置"})}),(0,G.jsx)(y.ZP,{type:"link",onClick:function(){ce(!0)},style:{fontWeight:"bold"},children:e.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"修改手机号"})})]})]})]})})})]}))]}),J&&(0,G.jsx)(_,{open:J,onClose:function(){Q(!1)}}),ae&&(0,G.jsx)(W,{open:ae,onSubmit:function(e){ne(!1),p.email=e,L(p),n.setFieldValue("email",e)},onClose:function(){ne(!1)}}),le&&(0,G.jsx)($,{open:le,onSubmit:function(e){ce(!1),p.mobile=e,L(p),n.setFieldValue("mobile",e)},onClose:function(){ce(!1)}})]})}},63327:function(e,s,r){r.d(s,{$g:function(){return d},N9:function(){return l},Qc:function(){return c},vC:function(){return o}});var t=r(46803),a=r.n(t),n=r(95660);function i(e){return"bytedesk_salt"!==e&&e?a().SHA256(e).toString().substring(0,16):"bytedesk_license"}function o(e,s){if(!e)throw new Error("密码不能为空");if(!s)throw new Error("盐值不能为空");try{var r=i(s),t=a().enc.Utf8.parse(r);return a().AES.encrypt(e,t,{mode:a().mode.ECB,padding:a().pad.Pkcs7}).toString()}catch(e){throw n.Z.error("密码加密失败:",e),new Error("密码加密失败: "+e.message)}}function l(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",r="",t=0;t<e;t++)r+=s.charAt(Math.floor(Math.random()*s.length));return r}function c(e){var s=0;return e?(e.length>=8&&(s+=20),e.length>=12&&(s+=10),/\d/.test(e)&&(s+=20),/[a-z]/.test(e)&&(s+=20),/[A-Z]/.test(e)&&(s+=20),/[!@#$%^&*(),.?":{}|<>]/.test(e)&&(s+=10),Math.min(s,100)):0}function d(e){return e>=80?"强":e>=60?"中":e>=40?"弱":"很弱"}}}]);