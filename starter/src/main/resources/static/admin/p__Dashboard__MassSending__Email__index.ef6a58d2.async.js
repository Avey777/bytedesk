"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3900],{62511:function(e,t,a){a.r(t),a.d(t,{default:function(){return G}});var r=a(44194),o=a(37963),n=a(14870),s=a(84176),i=a.n(s),l=a(73193),d=a.n(l),u=a(90819),c=a.n(u),f=a(89933),g=a.n(f),p=a(45332),w=a.n(p),m=a(68349),M=a(26411),y=a(5780),v=a(78359),x=a(5025),h=a(43940),k=a(5488),j=a(8065),b=a(15722),S=a(7358),C=a(10162),Z=a(11090),I=a(2484),z=a(18751),A=a(34599),B=a(81084),U=a(28977),T=a.n(U),P=a(18580),E=a(32394),D=a(47783),O=a(48821),F=a(16331),H=a(68724),R=a(49616),Y=a(31549),q=function(e){var t,a,o=e.isEdit,s=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,u=E.A.useForm(),c=w()(u,1)[0],f=(0,n.useIntl)(),g=(0,A.u)((function(e){return e.currentOrg})),p=(0,r.useState)(),m=w()(p,2),M=m[0],v=m[1],x=(0,j.v)((function(e){return e.categoryResult})),h=(0,z.Z)().translateString;(0,r.useEffect)((function(){if(o&&s&&c){var e;c.setFieldsValue({uid:null==s?void 0:s.uid,name:null==s?void 0:s.name,type:null==s?void 0:s.type,content:null==s?void 0:s.content,description:null==s?void 0:s.description,categoryUid:null==s?void 0:s.categoryUid});var t=null==x||null===(e=x.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==s?void 0:s.categoryUid)}));v(t)}else console.log("form resetFields"),c.resetFields()}),[s,c,o,null==x||null===(t=x.data)||void 0===t?void 0:t.content]);return(0,Y.jsx)("div",{children:(0,Y.jsx)(H.Z,{title:o?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,Y.jsxs)(R.Z,{children:[(0,Y.jsx)(y.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,Y.jsx)(y.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:o?null==s?void 0:s.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,Y.jsxs)(E.A,{form:c,name:"workflow",submitter:!1,children:[(0,Y.jsx)(D.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==x||null===(a=x.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),v(null==x||null===(t=x.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},W=a(33363),N=["current","pageSize","content"],L=function(e){var t=e.level,a=(e.type,(0,r.useRef)()),o=(0,n.useIntl)(),s=(0,r.useState)(!0),l=w()(s,2),u=l[0],f=l[1],p=(0,z.Z)().translateString,U=(0,r.useState)(1),E=w()(U,2),D=E[0],O=E[1],F=(0,r.useState)(10),H=w()(F,2),R=H[0],L=H[1],_=(0,r.useState)(!1),J=w()(_,2),K=J[0],G=J[1],Q=(0,r.useState)([]),V=w()(Q,2),$=(V[0],V[1]),X=(0,r.useState)({}),ee=w()(X,2),te=ee[0],ae=ee[1],re=(0,j.v)((function(e){return e.currentCategory})),oe=(0,A.u)((function(e){return e.currentOrg})),ne=m.Z.useModal(),se=w()(ne,2),ie=se[0],le=se[1],de=(0,r.useState)(0),ue=w()(de,2),ce=ue[0],fe=ue[1],ge=(0,r.useState)({}),pe=w()(ge,2),we=pe[0],me=pe[1],Me=function(){var e=g()(c()().mark((function e(t){var r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(o.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h._I)(t);case 3:200===(r=e.sent).code?(x.yw.destroy(),x.yw.success(o.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=a.current)||void 0===n||n.reload()):(x.yw.destroy(),x.yw.error(r.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=g()(c()().mark((function e(t){var r,n,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=8;break}return x.yw.loading(o.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.rI)(t);case 4:200===(r=e.sent).code?(x.yw.success(o.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(n=a.current)||void 0===n||n.reload(),G(!1)):x.yw.error(r.message),e.next=13;break;case 8:return x.yw.loading(o.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.$B)(t);case 11:200===(s=e.sent).code?(x.yw.success(o.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),G(!1)):x.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[re]);var ve=function(){var e=g()(c()().mark((function e(a,r,o){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,o),n=localStorage.getItem(k.LA8),s=d()({categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,level:t,accessToken:n||"",exportType:a},we),"current"===a?(s.pageNumber=String(D-1),s.pageSize=String(R)):"all"===a?(s.pageNumber="0",s.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==o&&(s.pageNumber=String(r),s.pageSize=String(o)),window.open((0,P.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),xe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),o=function(){var r=n,o=n*a+1,s=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(o,"-").concat(s," (").concat(s-o+1,"条)"),onClick:function(){return ve("range",r,a)}})},n=0;n<r;n++)o();return t},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:o.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:o.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:o.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:o.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:o.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:o.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",r=function(){var e=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,W.TE)(t);case 2:e.sent.success?x.yw.success(o.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):x.yw.error(o.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,Y.jsx)(M.Z,{content:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,Y.jsx)("span",{children:o.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,Y.jsx)(y.ZP,{type:"text",icon:(0,Y.jsx)(S.Z,{}),onClick:function(e){e.stopPropagation(),r(a)},title:o.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,Y.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:o.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,Y.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:o.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:o.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?T()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:o.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:o.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?T()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:o.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:o.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,Y.jsx)("a",{onClick:function(){return function(e){f(!0),ae(e),G(!0)}(t)},children:o.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,Y.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,Y.jsx)(b.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(e.name),"】？"),onOk:function(){Me(e)},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})});var e},children:o.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=g()(c()().mark((function e(a,r,n){var s,l,u,f,g,p,w,m,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(o.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,u=a.content,f=i()(a,N),O(s),L(l),me(d()(d()({},f),{},{content:u})),g=void 0,p=void 0,r&&Object.keys(r).length>0&&(w=Object.keys(r)[0],g=w,p="ascend"===r[w]?"ascend":"descend"),m=d()(d()({pageNumber:s-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,level:t},f),{},{content:u,sortBy:g,sortDirection:p}),e.next=11,(0,h.Au)(m);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,m),200!==M.code){e.next=20;break}return x.yw.destroy(),$(M.data.content),fe(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return x.yw.destroy(),x.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(B.Z,{columns:he,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){O(e),L(t)}},dateFormatter:"string",headerTitle:o.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,Y.jsx)(y.ZP,{type:"primary",onClick:function(){window.open((0,P.HU)(),"_blank")},icon:(0,Y.jsx)(C.Z,{}),children:o.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,Y.jsx)(Z.Z,{}),label:o.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,Y.jsx)(Z.Z,{}),label:o.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return ve("all")}}):t.push({key:"export-range",icon:(0,Y.jsx)(Z.Z,{}),label:o.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:xe(ce)})),e.push((0,Y.jsx)(v.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(y.ZP,{type:"primary",icon:(0,Y.jsx)(Z.Z,{}),children:[o.formatMessage({id:"export",defaultMessage:"导出"}),(0,Y.jsx)(I.Z,{})]})},"export")),e},request:ke}),K&&(0,Y.jsx)(q,{isEdit:u,workflow:te,level:t,open:K,onClose:function(){return G(!1)},onSubmit:ye}),le]})},_=function(e){var t,a,o=e.isEdit,s=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,u=E.A.useForm(),c=w()(u,1)[0],f=(0,n.useIntl)(),g=(0,A.u)((function(e){return e.currentOrg})),p=(0,r.useState)(),m=w()(p,2),M=m[0],v=m[1],x=(0,j.v)((function(e){return e.categoryResult})),h=(0,z.Z)().translateString;(0,r.useEffect)((function(){if(o&&s&&c){var e;c.setFieldsValue({uid:null==s?void 0:s.uid,name:null==s?void 0:s.name,type:null==s?void 0:s.type,content:null==s?void 0:s.content,description:null==s?void 0:s.description,categoryUid:null==s?void 0:s.categoryUid});var t=null==x||null===(e=x.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==s?void 0:s.categoryUid)}));v(t)}else console.log("form resetFields"),c.resetFields()}),[s,c,o,null==x||null===(t=x.data)||void 0===t?void 0:t.content]);return(0,Y.jsx)("div",{children:(0,Y.jsx)(H.Z,{title:o?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,Y.jsxs)(R.Z,{children:[(0,Y.jsx)(y.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,Y.jsx)(y.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:o?null==s?void 0:s.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,Y.jsxs)(E.A,{form:c,name:"workflow",submitter:!1,children:[(0,Y.jsx)(D.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==x||null===(a=x.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),v(null==x||null===(t=x.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},J=["current","pageSize","content"],K=function(e){var t=e.level,a=(e.type,(0,r.useRef)()),o=(0,n.useIntl)(),s=(0,r.useState)(!0),l=w()(s,2),u=l[0],f=l[1],p=(0,z.Z)().translateString,U=(0,r.useState)(1),E=w()(U,2),D=E[0],O=E[1],F=(0,r.useState)(10),H=w()(F,2),R=H[0],q=H[1],N=(0,r.useState)(!1),L=w()(N,2),K=L[0],G=L[1],Q=(0,r.useState)([]),V=w()(Q,2),$=(V[0],V[1]),X=(0,r.useState)({}),ee=w()(X,2),te=ee[0],ae=ee[1],re=(0,j.v)((function(e){return e.currentCategory})),oe=(0,A.u)((function(e){return e.currentOrg})),ne=m.Z.useModal(),se=w()(ne,2),ie=se[0],le=se[1],de=(0,r.useState)(0),ue=w()(de,2),ce=ue[0],fe=ue[1],ge=(0,r.useState)({}),pe=w()(ge,2),we=pe[0],me=pe[1],Me=function(){var e=g()(c()().mark((function e(t){var r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(o.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h._I)(t);case 3:200===(r=e.sent).code?(x.yw.destroy(),x.yw.success(o.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=a.current)||void 0===n||n.reload()):(x.yw.destroy(),x.yw.error(r.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=g()(c()().mark((function e(t){var r,n,s,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!u){e.next=8;break}return x.yw.loading(o.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.rI)(t);case 4:200===(r=e.sent).code?(x.yw.success(o.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(n=a.current)||void 0===n||n.reload(),G(!1)):x.yw.error(r.message),e.next=13;break;case 8:return x.yw.loading(o.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.$B)(t);case 11:200===(s=e.sent).code?(x.yw.success(o.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),G(!1)):x.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,r.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[re]);var ve=function(){var e=g()(c()().mark((function e(a,r,o){var n,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,o),n=localStorage.getItem(k.LA8),s=d()({categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,level:t,accessToken:n||"",exportType:a},we),"current"===a?(s.pageNumber=String(D-1),s.pageSize=String(R)):"all"===a?(s.pageNumber="0",s.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==o&&(s.pageNumber=String(r),s.pageSize=String(o)),window.open((0,P.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),xe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),o=function(){var r=n,o=n*a+1,s=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(o,"-").concat(s," (").concat(s-o+1,"条)"),onClick:function(){return ve("range",r,a)}})},n=0;n<r;n++)o();return t},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:o.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:o.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:o.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:o.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:o.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:o.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:o.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",r=function(){var e=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,W.TE)(t);case 2:e.sent.success?x.yw.success(o.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):x.yw.error(o.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,Y.jsx)(M.Z,{content:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,Y.jsx)("span",{children:o.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,Y.jsx)(y.ZP,{type:"text",icon:(0,Y.jsx)(S.Z,{}),onClick:function(e){e.stopPropagation(),r(a)},title:o.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,Y.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:o.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,Y.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:o.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:o.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?T()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:o.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:o.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?T()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:o.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:o.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,Y.jsx)("a",{onClick:function(){return function(e){f(!0),ae(e),G(!0)}(t)},children:o.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,Y.jsx)("a",{onClick:function(){return e=t,void ie.confirm({title:o.formatMessage({id:"deleteTip"}),icon:(0,Y.jsx)(b.Z,{}),content:"".concat(o.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(e.name),"】？"),onOk:function(){Me(e)},okText:o.formatMessage({id:"ok"}),cancelText:o.formatMessage({id:"cancel"})});var e},children:o.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=g()(c()().mark((function e(a,r,n){var s,l,u,f,g,p,w,m,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(o.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,u=a.content,f=i()(a,J),O(s),q(l),me(d()(d()({},f),{},{content:u})),g=void 0,p=void 0,r&&Object.keys(r).length>0&&(w=Object.keys(r)[0],g=w,p="ascend"===r[w]?"ascend":"descend"),m=d()(d()({pageNumber:s-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,categoryUid:(null==re?void 0:re.uid)===k.zBg?"":null==re?void 0:re.uid,level:t},f),{},{content:u,sortBy:g,sortDirection:p}),e.next=11,(0,h.Au)(m);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,m),200!==M.code){e.next=20;break}return x.yw.destroy(),$(M.data.content),fe(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return x.yw.destroy(),x.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(B.Z,{columns:he,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){O(e),q(t)}},dateFormatter:"string",headerTitle:o.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,Y.jsx)(y.ZP,{type:"primary",onClick:function(){window.open((0,P.HU)(),"_blank")},icon:(0,Y.jsx)(C.Z,{}),children:o.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,Y.jsx)(Z.Z,{}),label:o.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,Y.jsx)(Z.Z,{}),label:o.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return ve("all")}}):t.push({key:"export-range",icon:(0,Y.jsx)(Z.Z,{}),label:o.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:xe(ce)})),e.push((0,Y.jsx)(v.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(y.ZP,{type:"primary",icon:(0,Y.jsx)(Z.Z,{}),children:[o.formatMessage({id:"export",defaultMessage:"导出"}),(0,Y.jsx)(I.Z,{})]})},"export")),e},request:ke}),K&&(0,Y.jsx)(_,{isEdit:u,workflow:te,level:t,open:K,onClose:function(){return G(!1)},onSubmit:ye}),le]})},G=function(e){var t=e.level,a=void 0===t?"org":t,r=(0,n.useIntl)(),s=[{key:"template",label:r.formatMessage({id:"pages.email.template.tab",defaultMessage:"邮件模板"}),children:(0,Y.jsx)(L,{level:a,type:"email"})},{key:"send",label:r.formatMessage({id:"pages.email.send.tab",defaultMessage:"发送记录"}),children:(0,Y.jsx)(K,{level:a,type:"email"})}];return(0,Y.jsx)("div",{children:(0,Y.jsx)(o.Z,{defaultActiveKey:"template",items:s,style:{padding:"10px"}})})}},8065:function(e,t,a){a.d(t,{v:function(){return f}});var r=a(73193),o=a.n(r),n=a(76711),s=a.n(n),i=a(5488),l=a(16894),d=a(45034),u=a(47401),c=a(95660);var f=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,u.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(t){var a=function(e){var t=[];return e.data.content.forEach((function(e){var a={label:e.name,value:e.uid};t.push(a)})),t}(t),r=function(e){var t,a=(null==e||null===(t=e.data)||void 0===t?void 0:t.content)||[],r=function e(t){var a={title:t.name||"",key:t.uid||""};return t.children&&t.children.length>0&&(a.children=t.children.map((function(t){return e(t)}))),a};return a.filter((function(e){return e&&e.uid&&e.uid!==i.zBg})).map((function(e){return r(e)}))}(t),n=[{title:i.zBg,key:i.zBg}].concat(s()(r)),l={uid:i.zBg,name:i.zBg},d=o()(o()({},t),{},{data:o()(o()({},t.data),{},{content:[l].concat(s()(t.data.content))})});e({categoryResult:d,categoryTreeOptions:n,categorySelectOptions:a}),0===t.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var a=e.categoryResult.data.content,r=a.findIndex((function(e){return e.uid===t.uid}));-1!==r?a[r]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){c.Z.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(a){var r=t().categoryResult.data.content.find((function(e){return e.uid===a}));e({currentCategory:r})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))}}]);