"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[761],{82669:function(e,t,a){a.d(t,{Z:function(){return i}});var r=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},o=a(54183),l=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var i=n.forwardRef(l)},38197:function(e,t,a){var r=a(39328),n=a(17323),s=a(44194),o=a(64665),l=a(31549),i=["fieldProps","request","params","proFieldProps"],d=function(e,t){var a=e.fieldProps,s=e.request,d=e.params,c=e.proFieldProps,u=(0,n.Z)(e,i);return(0,l.jsx)(o.Z,(0,r.Z)({valueType:"treeSelect",fieldProps:a,ref:t,request:s,params:d,filedConfig:{customLightMode:!0},proFieldProps:c},u))},c=s.forwardRef(d);t.Z=c},16229:function(e,t,a){a.r(t),a.d(t,{default:function(){return _}});var r=a(93322),n=a(74424),s=a(5488),o=a(42699),l=a(84176),i=a.n(l),d=a(73193),c=a.n(d),u=a(90819),f=a.n(u),p=a(89933),g=a.n(p),w=a(45332),m=a.n(w),v=a(44194),x=a(68349),y=a(26411),M=a(5780),h=a(78359),k=a(5025),j=a(43940),b=a(14870),S=a(8065),Z=a(34599),C=a(32394),I=a(47783),O=a(48821),P=a(16331),E=a(68724),$=a(49616),A=a(18751),T=a(31549),U=function(e){var t,a,r=e.isEdit,n=e.workflow,o=e.open,l=(e.level,e.onClose),i=e.onSubmit,d=C.A.useForm(),c=m()(d,1)[0],u=(0,b.useIntl)(),f=(0,Z.u)((function(e){return e.currentOrg})),p=(0,v.useState)(),g=m()(p,2),w=g[0],x=g[1],y=(0,S.v)((function(e){return e.categoryResult})),h=(0,A.Z)().translateString;(0,v.useEffect)((function(){if(r&&n&&c){var e;c.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,type:null==n?void 0:n.type,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid});var t=null==y||null===(e=y.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==n?void 0:n.categoryUid)}));x(t)}else console.log("form resetFields"),c.resetFields()}),[n,c,r,null==y||null===(t=y.data)||void 0===t?void 0:t.content]);return(0,T.jsx)("div",{children:(0,T.jsx)(E.Z,{title:r?u.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):u.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:o,extra:(0,T.jsxs)($.Z,{children:[(0,T.jsx)(M.ZP,{onClick:l,children:u.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,T.jsx)(M.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){console.log("Form values:",e);var t={uid:r?null==n?void 0:n.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==w?void 0:w.uid,orgUid:null==f?void 0:f.uid};console.log("workflowObject:",t),i(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:u.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,T.jsxs)(C.A,{form:c,name:"workflow",submitter:!1,children:[(0,T.jsx)(I.Z,{label:u.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==y||null===(a=y.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==s.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),x(null==y||null===(t=y.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,T.jsx)(O.Z,{label:u.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:u.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,T.jsx)(O.Z,{label:u.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:u.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:u.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,T.jsx)(P.Z,{label:u.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:u.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,T.jsx)(P.Z,{label:u.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:u.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},z=a(15722),F=a(7358),B=a(10162),H=a(11090),q=a(2484),D=a(81084),G=a(28977),N=a.n(G),R=a(18580),Y=a(33363),L=["current","pageSize","content"],W=function(e){var t=e.level,a=(e.type,(0,v.useRef)()),r=(0,b.useIntl)(),n=(0,v.useState)(!0),o=m()(n,2),l=o[0],d=o[1],u=(0,A.Z)().translateString,p=(0,v.useState)(1),w=m()(p,2),C=w[0],I=w[1],O=(0,v.useState)(10),P=m()(O,2),E=P[0],$=P[1],G=(0,v.useState)(!1),W=m()(G,2),Q=W[0],V=W[1],_=(0,v.useState)([]),K=m()(_,2),X=(K[0],K[1]),J=(0,v.useState)({}),ee=m()(J,2),te=ee[0],ae=ee[1],re=(0,S.v)((function(e){return e.currentCategory})),ne=(0,Z.u)((function(e){return e.currentOrg})),se=x.Z.useModal(),oe=m()(se,2),le=oe[0],ie=oe[1],de=(0,v.useState)(0),ce=m()(de,2),ue=ce[0],fe=ce[1],pe=(0,v.useState)({}),ge=m()(pe,2),we=ge[0],me=ge[1],ve=function(){var e=g()(f()().mark((function e(t){var n,s;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,j._I)(t);case 3:200===(n=e.sent).code?(k.yw.destroy(),k.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(s=a.current)||void 0===s||s.reload()):(k.yw.destroy(),k.yw.error(n.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=g()(f()().mark((function e(t){var n,s,o,i;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l){e.next=8;break}return k.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,j.rI)(t);case 4:200===(n=e.sent).code?(k.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(s=a.current)||void 0===s||s.reload(),V(!1)):k.yw.error(n.message),e.next=13;break;case 8:return k.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,j.$B)(t);case 11:200===(o=e.sent).code?(k.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),V(!1)):k.yw.error(o.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[re]);var ye=function(){var e=g()(f()().mark((function e(a,r,n){var o,l;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),o=localStorage.getItem(s.LA8),l=c()({categoryUid:(null==re?void 0:re.uid)===s.zBg?"":null==re?void 0:re.uid,orgUid:t===s.Hxq?"":null==ne?void 0:ne.uid,level:t,accessToken:o||"",exportType:a},we),"current"===a?(l.pageNumber=String(C-1),l.pageSize=String(E)):"all"===a?(l.pageNumber="0",l.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(l.pageNumber=String(r),l.pageSize=String(n)),window.open((0,R.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(l).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),Me=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ye("range",r,a)}})},s=0;s<r;s++)n();return t},he=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:r.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:r.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:r.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:r.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-",n=function(){var e=g()(f()().mark((function e(t){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,Y.TE)(t);case 2:e.sent.success?k.yw.success(r.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):k.yw.error(r.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,T.jsx)(y.Z,{content:(0,T.jsxs)("div",{children:[(0,T.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,T.jsx)("span",{children:r.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,T.jsx)(M.ZP,{type:"text",icon:(0,T.jsx)(F.Z,{}),onClick:function(e){e.stopPropagation(),n(a)},title:r.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,T.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,T.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:r.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?N()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?N()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,T.jsx)("a",{onClick:function(){return function(e){d(!0),ae(e),V(!0)}(t)},children:r.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,T.jsx)("a",{onClick:function(){return e=t,void le.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,T.jsx)(z.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(u(e.name),"】？"),onOk:function(){ve(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],ke=function(){var e=g()(f()().mark((function e(a,n,o){var l,d,u,p,g,w,m,v,x;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return k.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),l=a.current,d=a.pageSize,u=a.content,p=i()(a,L),I(l),$(d),me(c()(c()({},p),{},{content:u})),g=void 0,w=void 0,n&&Object.keys(n).length>0&&(m=Object.keys(n)[0],g=m,w="ascend"===n[m]?"ascend":"descend"),v=c()(c()({pageNumber:l-1,pageSize:d,name:"",orgUid:t===s.Hxq?"":null==ne?void 0:ne.uid,categoryUid:(null==re?void 0:re.uid)===s.zBg?"":null==re?void 0:re.uid,level:t},p),{},{content:u,sortBy:g,sortDirection:w}),e.next=11,(0,j.Au)(v);case 11:if(x=e.sent,console.log("queryWorkflowsByOrg response:",x,v),200!==x.code){e.next=20;break}return k.yw.destroy(),X(x.data.content),fe(x.data.totalElements),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 20:return k.yw.destroy(),k.yw.error(x.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(D.Z,{columns:he,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){I(e),$(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,T.jsx)(M.ZP,{type:"primary",onClick:function(){window.open((0,R.HU)(),"_blank")},icon:(0,T.jsx)(B.Z,{}),children:r.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,T.jsx)(H.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ye("current")}}];return ue>0&&(ue<=1e3?t.push({key:"export-all",icon:(0,T.jsx)(H.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ue,"条)"),onClick:function(){return ye("all")}}):t.push({key:"export-range",icon:(0,T.jsx)(H.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ue,"条)"),children:Me(ue)})),e.push((0,T.jsx)(h.Z,{menu:{items:t},placement:"bottom",children:(0,T.jsxs)(M.ZP,{type:"primary",icon:(0,T.jsx)(H.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,T.jsx)(q.Z,{})]})},"export")),e},request:ke}),Q&&(0,T.jsx)(U,{isEdit:l,workflow:te,level:t,open:Q,onClose:function(){return V(!1)},onSubmit:xe}),ie]})},Q=r.Z.Sider,V=r.Z.Content,_=function(){var e=(0,n.Z)(),t=e.leftSiderStyle,a=e.leftSiderWidth,l=e.contentStyle;return(0,T.jsxs)(r.Z,{children:[(0,T.jsx)(Q,{width:a,style:t,children:(0,T.jsx)(o.Z,{type:s.H8R,level:s.whQ,showKbase:!1})}),(0,T.jsx)(r.Z,{children:(0,T.jsx)(V,{style:l,children:(0,T.jsx)(W,{level:s.whQ})})})]})}},90317:function(e,t,a){a.d(t,{Z:function(){return j}});var r=a(44194),n=a(51865),s=a.n(n),o=a(34573),l=a(86992),i=a(35779),d=a(79255),c=a(77167);const u=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],p=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var g=function(e,t){return s()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const a=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${a}`]:a&&u.includes(a)}})(e,t)),((e,t)=>{const a={};return p.forEach((r=>{a[`${e}-align-${r}`]=t.align===r})),a[`${e}-align-stretch`]=!t.align&&!!t.vertical,a})(e,t)),((e,t)=>{const a={};return f.forEach((r=>{a[`${e}-justify-${r}`]=t.justify===r})),a})(e,t)))};const w=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},m=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,a={};return u.forEach((e=>{a[`${t}-wrap-${e}`]={flexWrap:e}})),a},x=e=>{const{componentCls:t}=e,a={};return p.forEach((e=>{a[`${t}-align-${e}`]={alignItems:e}})),a},y=e=>{const{componentCls:t}=e,a={};return f.forEach((e=>{a[`${t}-justify-${e}`]={justifyContent:e}})),a};var M=(0,d.I$)("Flex",(e=>{const{paddingXS:t,padding:a,paddingLG:r}=e,n=(0,c.IX)(e,{flexGapSM:t,flexGap:a,flexGapLG:r});return[w(n),m(n),v(n),x(n),y(n)]}),(()=>({})),{resetStyle:!1}),h=function(e,t){var a={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(a[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(r=Object.getOwnPropertySymbols(e);n<r.length;n++)t.indexOf(r[n])<0&&Object.prototype.propertyIsEnumerable.call(e,r[n])&&(a[r[n]]=e[r[n]])}return a};const k=r.forwardRef(((e,t)=>{const{prefixCls:a,rootClassName:n,className:d,style:c,flex:u,gap:f,vertical:p=!1,component:w="div"}=e,m=h(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component"]),{flex:v,direction:x,getPrefixCls:y}=r.useContext(i.E_),k=y("flex",a),[j,b,S]=M(k),Z=null!=p?p:null==v?void 0:v.vertical,C=s()(d,n,null==v?void 0:v.className,k,b,S,g(k,e),{[`${k}-rtl`]:"rtl"===x,[`${k}-gap-${f}`]:(0,l.n)(f),[`${k}-vertical`]:Z}),I=Object.assign(Object.assign({},null==v?void 0:v.style),c);return u&&(I.flex=u),f&&!(0,l.n)(f)&&(I.gap=f),j(r.createElement(w,Object.assign({ref:t,className:C,style:I},(0,o.Z)(m,["justify","wrap","align"]))))}));var j=k}}]);