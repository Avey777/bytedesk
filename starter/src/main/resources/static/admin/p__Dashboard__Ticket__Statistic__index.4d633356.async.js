"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4480],{23684:function(t,e,a){a.r(e);var i=a(90819),s=a.n(i),n=a(89933),r=a.n(n),o=a(45332),c=a.n(o),l=a(44194),d=a(41123),u=a(34251),f=a(63065),g=a(43413),m=a(10337),v=a(59946),y=a(77407),x=a(5858),p=a(9248),k=a(14318),h=a(68525),j=a(46263),w=a(34551),M=a(74947),Z=a(12201),F=a(94011),D=a(35911),R=a(75699),S=a(45135),Y=a(61628),b=a(31756),O=a(31881),A=a(76001),T=a(7999),C=a(30234),U=a(25191),B=a(28977),E=a.n(B),I=a(89295),P=a(54693),q=a(31549),N=d.default.RangePicker,H=u.Z.Option;e.default=function(){var t,e,a=(0,R.useIntl)(),i=(0,C.Z)().translateStringTranct,n=(0,l.useState)(E()().startOf("day")),o=c()(n,2),d=o[0],B=o[1],W=(0,l.useState)(E()().endOf("day")),z=c()(W,2),Q=z[0],G=z[1],K=(0,l.useState)("today"),_=c()(K,2),J=_[0],L=_[1],V=(0,l.useState)(U.whQ),X=c()(V,2),$=X[0],tt=X[1],et=(0,l.useState)(),at=c()(et,2),it=at[0],st=at[1],nt=(0,l.useState)(),rt=c()(nt,2),ot=rt[0],ct=rt[1],lt=(0,O.u)((function(t){return t.currentOrg})),dt=(0,A.E)((function(t){return t})),ut=dt.agentResult,ft=dt.setAgentResult,gt=(0,P.H)((function(t){return t})),mt=gt.departmentResult,vt=gt.setDepartmentResult,yt=(0,l.useState)(),xt=c()(yt,2),pt=xt[0],kt=xt[1],ht=(0,l.useState)(U.OwA),jt=c()(ht,2),wt=jt[0],Mt=jt[1],Zt=(0,l.useState)(!1),Ft=c()(Zt,2),Dt=Ft[0],Rt=Ft[1],St=[{label:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,l.useEffect)((function(){if("custom"===J)B(d),G(Q),Mt(U.dd4);else{var t=E()();"today"===J?(B(t),G(t),Mt(U.OwA)):"yesterday"===J?(B(t.subtract(1,"day")),G(t.subtract(1,"day")),Mt(U.OwA)):"week"===J?(B(t.startOf("week")),G(t.endOf("week")),Mt(U.dd4)):"lastWeek"===J?(B(t.subtract(1,"week").startOf("week")),G(t.subtract(1,"week").endOf("week")),Mt(U.dd4)):"month"===J&&(B(t.startOf("month")),G(t.endOf("month")),Mt(U.dd4))}}),[J]);var Yt=function(){var t=r()(s()().mark((function t(){var e,a;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading("loading"),e={pageNumber:0,pageSize:100,orgUid:null==lt?void 0:lt.uid},t.next=4,(0,I.dF)(e);case 4:a=t.sent,console.log("queryDepartmentsByOrg:",a,e),200===a.code?(b.yw.destroy(),vt(a),a.data.content.length>0&&ct(a.data.content[0].uid)):(b.yw.destroy(),b.yw.error(a.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),bt=function(){var t=r()(s()().mark((function t(){var e,a;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading("loading"),e={pageNumber:0,pageSize:50,orgUid:null==lt?void 0:lt.uid},t.next=4,(0,T._t)(e);case 4:a=t.sent,console.log("fetchAllAgents: ",a),200===a.code?(b.yw.destroy(),ft(a),a.data.content.length>0&&st(a.data.content[0].uid)):(b.yw.destroy(),b.yw.error(i(a.message))),console.log("queryAllAgents response",a);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ot=function(){var t=r()(s()().mark((function t(){var e,i;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Rt(!0),t.prev=1,b.yw.loading("loading"),e={type:$,startDate:null==d?void 0:d.format("YYYY-MM-DD"),endDate:null==Q?void 0:Q.format("YYYY-MM-DD"),departmentUid:ot,assigneeUid:it,orgUid:null==lt?void 0:lt.uid},t.next=6,(0,Y.AD)(e);case 6:i=t.sent,console.log("queryStatisticTicketByDate response",i,e),200===i.code?(b.yw.destroy(),kt(i.data)):(b.yw.destroy(),b.yw.error(i.message)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),b.yw.error(a.formatMessage({id:"ticket.message.operation.failed"}));case 14:return t.prev=14,Rt(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),At=function(){var t=r()(s()().mark((function t(){var e,a;return s()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading("loading"),e={type:$,startDate:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),endDate:null==Q?void 0:Q.format("YYYY-MM-DD 23:59:59"),departmentUid:ot,assigneeUid:it,orgUid:null==lt?void 0:lt.uid},t.next=4,(0,Y.AD)(e);case 4:a=t.sent,console.log("queryStatisticTicketByDate response",a,e),200===a.code?b.yw.destroy():(b.yw.destroy(),b.yw.error(a.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,l.useEffect)((function(){Yt(),bt()}),[]),(0,l.useEffect)((function(){Ot()}),[$,it,ot]),(0,l.useEffect)((function(){At()}),[wt,$,it,ot]),(0,l.useEffect)((function(){Ot()}),[d,Q]);var Tt=[{title:a.formatMessage({id:"ticket.statistic.total"}),value:(null==pt?void 0:pt.totalTickets)||0,icon:(0,q.jsx)(j.Z,{}),color:"#1890ff"},{title:a.formatMessage({id:"ticket.statistic.resolved"}),value:(null==pt?void 0:pt.resolvedTickets)||0,icon:(0,q.jsx)(w.Z,{}),color:"#52c41a"},{title:a.formatMessage({id:"ticket.statistic.resolution.rate"}),value:"".concat((null==pt?void 0:pt.resolvedTickets)/(null==pt?void 0:pt.totalTickets)||0,"%"),icon:(0,q.jsx)(M.Z,{}),color:"#722ed1"},{title:a.formatMessage({id:"ticket.statistic.satisfaction"}),value:"".concat((null==pt?void 0:pt.customerSatisfactionRate)||0,"%"),icon:(0,q.jsx)(Z.Z,{}),color:"#fa8c16"}];return(0,q.jsxs)("div",{style:{padding:16},children:[(0,q.jsx)(f.Z,{style:{marginBottom:16},children:(0,q.jsxs)(g.Z,{direction:"vertical",style:{width:"100%"},children:[(0,q.jsxs)(g.Z,{wrap:!0,children:[(0,q.jsx)(m.ZP.Group,{value:J,onChange:function(t){return L(t.target.value)},children:St.map((function(t){return(0,q.jsx)(m.ZP.Button,{value:t.value,children:t.label},t.value)}))}),"custom"===J&&(0,q.jsx)(N,{value:[d,Q],onChange:function(t){B(t[0]),G(t[1])}})]}),(0,q.jsxs)(g.Z,{wrap:!0,children:[(0,q.jsxs)(u.Z,{placeholder:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.type"}),style:{width:200},value:$,onChange:function(t){return tt(t)},children:[(0,q.jsx)(H,{value:U.whQ,children:(0,q.jsx)(R.FormattedMessage,{id:"i18n.all"})}),(0,q.jsx)(H,{value:U.fyH,children:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.agent"})}),(0,q.jsx)(H,{value:U.nYM,children:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.department"})})]}),$===U.fyH&&(0,q.jsx)(u.Z,{placeholder:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.agent"}),style:{width:200},value:it,onChange:function(t){return st(t)},children:null===(t=ut.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(t){return(0,q.jsx)(H,{value:null==t?void 0:t.uid,children:i(null==t?void 0:t.nickname)},null==t?void 0:t.uid)}))}),$===U.nYM&&(0,q.jsx)(u.Z,{placeholder:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.department"}),style:{width:200},value:ot,onChange:function(t){return ct(t)},children:null===(e=mt.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(t){return(0,q.jsx)(H,{value:null==t?void 0:t.uid,children:i(null==t?void 0:t.name)},null==t?void 0:t.uid)}))}),(0,q.jsx)(v.Z,{title:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.export"}),children:(0,q.jsx)(y.ZP,{icon:(0,q.jsx)(F.Z,{}),onClick:function(){b.yw.warning("TODO: 待实现")},children:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.export"})})}),(0,q.jsx)(v.Z,{title:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.refresh"}),children:(0,q.jsx)(y.ZP,{icon:(0,q.jsx)(D.Z,{}),onClick:function(){return Ot()},children:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.filter.refresh"})})}),!1]})]})}),(0,q.jsx)(x.Z,{gutter:16,style:{marginBottom:24},children:Tt.map((function(t){return(0,q.jsx)(p.Z,{span:6,children:(0,q.jsx)(f.Z,{loading:Dt,children:(0,q.jsx)(k.Z,{title:t.title,value:t.value,prefix:l.cloneElement(t.icon,{style:{color:t.color}}),valueStyle:{color:t.color}})})},t.title)}))}),(0,q.jsx)(f.Z,{title:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.trend"}),style:{marginBottom:24,height:300},loading:Dt,children:(0,q.jsx)(S.Z,{data:[],xField:"date",yField:"value",seriesField:"type",legend:{position:"top"},meta:{type:{formatter:function(t){return a.formatMessage({id:"ticket.statistic.type.".concat(t)})}}}})}),(0,q.jsx)(f.Z,{title:(0,q.jsx)(R.FormattedMessage,{id:"ticket.statistic.agent.performance"}),loading:Dt,children:(0,q.jsx)(h.Z,{columns:[{title:a.formatMessage({id:"ticket.statistic.agent.name"}),dataIndex:"assigneeName",key:"assigneeName"},{title:a.formatMessage({id:"ticket.statistic.agent.tickets"}),dataIndex:"assigneeTickets",key:"assigneeTickets",sorter:!0},{title:a.formatMessage({id:"ticket.statistic.agent.resolution"}),dataIndex:"assigneeResolutionRate",key:"assigneeResolutionRate",render:function(t){return"".concat(t,"%")},sorter:!0},{title:a.formatMessage({id:"ticket.statistic.agent.satisfaction"}),dataIndex:"customerSatisfactionRate",key:"customerSatisfactionRate",render:function(t){return"".concat(t,"%")},sorter:!0}],rowKey:"assigneeUid",pagination:!1})})]})}}}]);