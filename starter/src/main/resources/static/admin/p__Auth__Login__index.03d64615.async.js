"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9368],{80556:function(e,a,t){t.d(a,{Z:function(){return l}});var n=t(11757),s=t(44194),r={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},o=t(54183),i=function(e,a){return s.createElement(o.Z,(0,n.Z)({},e,{ref:a,icon:r}))};var l=s.forwardRef(i)},85954:function(e,a,t){var n=t(17082),s=t(73457),r=t(82308),o=t(99749),i=t(44194),l=t(69088),c=t(35175),u=t(31549),d=["options","fieldProps","proFieldProps","valueEnum"],g=i.forwardRef((function(e,a){var t=e.options,o=e.fieldProps,i=e.proFieldProps,l=e.valueEnum,g=(0,s.Z)(e,d);return(0,u.jsx)(c.Z,(0,n.Z)({ref:a,valueType:"checkbox",valueEnum:(0,r.h)(l,void 0),fieldProps:(0,n.Z)({options:t},o),lightProps:(0,n.Z)({labelFormatter:function(){return(0,u.jsx)(c.Z,(0,n.Z)({ref:a,valueType:"checkbox",mode:"read",valueEnum:(0,r.h)(l,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:t},o),proFieldProps:i},g))}},g.lightProps),proFieldProps:i},g))})),p=i.forwardRef((function(e,a){var t=e.fieldProps,s=e.children;return(0,u.jsx)(o.Z,(0,n.Z)((0,n.Z)({ref:a},t),{},{children:s}))})),f=(0,l.G)(p,{valuePropName:"checked"});f.Group=g,a.Z=f},84881:function(e,a,t){var n=t(17082),s=t(73457),r=t(82308),o=t(44194),i=t(63653),l=t(35175),c=t(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],g=function(e,a){var t=e.fieldProps,d=e.children,g=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,m=e.request,v=e.showSearch,x=e.options,y=(0,s.Z)(e,u),M=(0,o.useContext)(i.Z);return(0,c.jsx)(l.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,r.h)(h),request:m,params:g,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:x,mode:f,showSearch:v,getPopupContainer:M.getPopupContainer},t),ref:a,proFieldProps:p},y),{},{children:d}))},p=o.forwardRef((function(e,a){var t=e.fieldProps,u=e.children,g=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,m=e.request,v=e.options,x=(0,s.Z)(e,d),y=(0,n.Z)({options:v,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},t),M=(0,o.useContext)(i.Z);return(0,c.jsx)(l.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,r.h)(h),request:m,params:g,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:M.getPopupContainer},y),ref:a,proFieldProps:p},x),{},{children:u}))})),f=o.forwardRef(g);f.SearchSelect=p,f.displayName="ProFormComponent",a.Z=f},88678:function(e,a,t){t.d(a,{Z:function(){return y}});var n=t(90819),s=t.n(n),r=t(89933),o=t.n(r),i=t(45332),l=t.n(i),c=t(55735),u=t(41159);function d(){return g.apply(this,arguments)}function g(){return(g=o()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/kaptcha/api/v1/get",{method:"GET",params:{client:c.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e,a){return f.apply(this,arguments)}function f(){return(f=o()(s()().mark((function e(a,t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:a,captchaCode:t,client:c.bVn}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var h=t(58087),m=t(52288),v=t(44194),x=t(31549),y=function(e){var a=e.onKaptchaChange,t=e.onKaptchaCheck,n=(0,u.useIntl)(),r=(0,v.useState)(),i=l()(r,2),c=i[0],g=i[1],f=(0,v.useState)(),y=l()(f,2),M=y[0],w=y[1],b=function(){var e=o()(s()().mark((function e(){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,d();case 2:200===(a=e.sent).code&&(g(a.data.captchaUid),w(a.data.captchaImage));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),k=function(){var e=o()(s()().mark((function e(a,n){var r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,p(a,n);case 2:r=e.sent,console.log("checkCaptcha response",r),200===r.code?t&&t(!0):t&&t(!1);case 5:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){b()}),[]);return(0,x.jsx)(x.Fragment,{children:M&&(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(m.Z,{onChange:function(e){a&&(a(c,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?k(c,e.target.value):t&&t(!1))},prefix:(0,x.jsx)(h.Z,{}),placeholder:n.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,x.jsx)("img",{src:M,alt:"captcha",onClick:b})]})})}},76750:function(e,a,t){var n=t(55735),s=t(65461),r=t(41159);a.Z=function(){var e=(0,r.useIntl)();return{translateString:function(a){return null==a?a:a&&(null!=a&&a.startsWith(n.VoP)||null!=a&&a.startsWith("ROLE_"))?e.formatMessage({id:a,defaultMessage:a}):a},translateStringTranct:function(a){return null==a?a:null!=a&&a.startsWith(n.VoP)||null!=a&&a.startsWith("ROLE_")?(0,s.aS)(e.formatMessage({id:a,defaultMessage:a}),10):(0,s.aS)(a,10)}}}},44040:function(e,a,t){t.r(a),t.d(a,{default:function(){return ue}});var n=t(73193),s=t.n(n),r=t(90819),o=t.n(r),i=t(89933),l=t.n(i),c=t(45332),u=t.n(c),d=t(45739),g=t(69169),p=t(60183),f=t(65821),h=t(57245),m=t(93769),v=t(41159),x=t(42540),y=t(53530),M=t(75365),w=t(8247),b=t(96839),k=t(98094),j=t(44194),C=t(56321),Z=t(51239),S=t(86803),P=t(98240),U=t(23864),F=t(55735),I=t(88678),T=t(10022),E=t(26978),L=t(4499),R=t(31549),K=function(e){var a=e.loginType,t=e.onKaptchaChange,n=e.onKaptchaCheck,s=(0,v.useIntl)(),r=function(){var e=l()(o()().mark((function e(a,n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&t(a,n);case 1:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}(),i=function(){var e=l()(o()().mark((function e(a){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&n(a);case 1:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return(0,R.jsx)(R.Fragment,{children:"account"===a&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(L.Z,{name:"username",fieldProps:{size:"large",prefix:(0,R.jsx)(T.Z,{})},placeholder:s.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"用户名/邮箱"}),rules:[{required:!0,message:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"请输入用户名/邮箱!"})}]}),(0,R.jsx)(L.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,R.jsx)(E.Z,{})},placeholder:s.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"密码"}),rules:[{required:!0,message:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"请输入密码！"})}]}),(0,R.jsx)(g.A.Item,{name:"captchaCode",rules:[{required:!0,message:s.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,R.jsx)(I.Z,{onKaptchaChange:r,onKaptchaCheck:i})})]})})},q=t(76750),D=t(65461),V=t(40795),A=t(84881),z=t(59129),N=t(88201),B=t(5602),O=t(32943),Q=function(e){var a=e.loginType,t=e.onKaptchaChange,n=e.onKaptchaCheck,s=(0,v.useIntl)(),r=(0,q.Z)().translateString,i=(0,j.useRef)(),c=(0,j.useState)(""),p=u()(c,2),f=p[0],h=p[1],m=(0,j.useState)(""),x=u()(m,2),y=x[0],M=x[1],w=(0,j.useState)(!1),b=u()(w,2),k=b[0],C=b[1],P=(0,Z.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid}})),U=P.deviceUid,T=P.setDeviceUid,K=function(){var e=l()(o()().mark((function e(a,n){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h(a),M(n),t&&t(a,n);case 3:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}(),Q=function(){var e=l()(o()().mark((function e(a){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:C(a),n&&n(a);case 2:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();(0,j.useEffect)((function(){void 0!==U&&""!==U||T((0,D.Zx)())}),[]);var W=[{label:s.formatMessage({id:"pages.login.country.china"}),value:"86",icon:"🇨🇳",code:"CN"},{label:s.formatMessage({id:"pages.login.country.hongkong"}),value:"852",icon:"🇭🇰",code:"HK"},{label:s.formatMessage({id:"pages.login.country.taiwan"}),value:"886",icon:"🇹🇼",code:"TW"},{label:s.formatMessage({id:"pages.login.country.macao"}),value:"853",icon:"🇲🇴",code:"MO"},{label:s.formatMessage({id:"pages.login.country.japan"}),value:"81",icon:"🇯🇵",code:"JP"},{label:s.formatMessage({id:"pages.login.country.korea"}),value:"82",icon:"🇰🇷",code:"KR"},{label:s.formatMessage({id:"pages.login.country.singapore"}),value:"65",icon:"🇸🇬",code:"SG"},{label:s.formatMessage({id:"pages.login.country.malaysia"}),value:"60",icon:"🇲🇾",code:"MY"},{label:s.formatMessage({id:"pages.login.country.thailand"}),value:"66",icon:"🇹🇭",code:"TH"},{label:s.formatMessage({id:"pages.login.country.vietnam"}),value:"84",icon:"🇻🇳",code:"VN"},{label:s.formatMessage({id:"pages.login.country.philippines"}),value:"63",icon:"🇵🇭",code:"PH"},{label:s.formatMessage({id:"pages.login.country.indonesia"}),value:"62",icon:"🇮🇩",code:"ID"},{label:s.formatMessage({id:"pages.login.country.usa"}),value:"1-us",icon:"🇺🇸",code:"US"},{label:s.formatMessage({id:"pages.login.country.canada"}),value:"1-ca",icon:"🇨🇦",code:"CA"},{label:s.formatMessage({id:"pages.login.country.uk"}),value:"44",icon:"🇬🇧",code:"GB"},{label:s.formatMessage({id:"pages.login.country.germany"}),value:"49",icon:"🇩🇪",code:"DE"},{label:s.formatMessage({id:"pages.login.country.france"}),value:"33",icon:"🇫🇷",code:"FR"},{label:s.formatMessage({id:"pages.login.country.italy"}),value:"39",icon:"🇮🇹",code:"IT"},{label:s.formatMessage({id:"pages.login.country.spain"}),value:"34",icon:"🇪🇸",code:"ES"},{label:s.formatMessage({id:"pages.login.country.russia"}),value:"7",icon:"🇷🇺",code:"RU"},{label:s.formatMessage({id:"pages.login.country.australia"}),value:"61",icon:"🇦🇺",code:"AU"},{label:s.formatMessage({id:"pages.login.country.newzealand"}),value:"64",icon:"🇳🇿",code:"NZ"}];return(0,R.jsx)(R.Fragment,{children:"mobile"===a&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(N.Z,{gutter:16,children:[(0,R.jsx)(B.Z,{span:10,children:(0,R.jsx)(A.Z,{name:"country",options:W,fieldProps:{size:"large",placeholder:s.formatMessage({id:"pages.login.country.placeholder",defaultMessage:"选择国家/地区"}),optionLabelProp:"label",optionItemRender:function(e){var a=e.value.includes("-")?e.value.split("-")[0]:e.value;return(0,R.jsxs)("div",{children:[(0,R.jsx)("span",{role:"img","aria-label":e.label,style:{marginRight:8},children:e.icon}),e.label," (+",a,")"]})}},initialValue:"86"})}),(0,R.jsx)(B.Z,{span:14,children:(0,R.jsx)(L.Z,{fieldProps:{size:"large",prefix:(0,R.jsx)(V.Z,{})},name:"mobile",placeholder:s.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]})})]}),(0,R.jsx)(g.A.Item,{name:"captchaCode",rules:[{required:!0,message:s.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,R.jsx)(I.Z,{onKaptchaChange:K,onKaptchaCheck:Q})}),(0,R.jsx)(z.Z,{fieldProps:{size:"large",prefix:(0,R.jsx)(E.Z,{})},captchaProps:{size:"large",disabled:!k},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,a){return e?"".concat(a," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:i,onGetCaptcha:function(){var e=l()(o()().mark((function e(a){var t,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",a),!a||11!==a.length){e.next=13;break}return t={mobile:a,type:F.UUF,captchaUid:f,captchaCode:y,deviceUid:U,platform:F.iw8},e.next=5,(0,d.Y7)(t);case 5:if(200===(n=e.sent).code){e.next=10;break}return S.yw.error(r(n.message)),setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=i.current)||void 0===e||e.endTiming()}),2),e.abrupt("return");case 10:S.yw.success(r(n.message)),e.next=14;break;case 13:S.yw.error("手机号格式错误");case 14:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}()}),(0,R.jsx)(O.Z,{message:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.auto.register",defaultMessage:"Mobile will auto register"}),type:"info"})]})})},W=t(88958),H=function(e){var a=e.loginType,t=(0,v.useIntl)(),n=(0,P.t)((function(e){return e.setAccessToken})),r=(0,Z.L)((function(e){return e.setUserInfo})),i=(0,v.useModel)("@@initialState").setInitialState,c=(0,Z.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid}})),g=c.deviceUid,p=c.setDeviceUid,f=(0,j.useState)("login"),h=u()(f,2),m=h[0],x=h[1],y=(0,j.useState)("loading"),M=u()(y,2),w=M[0],b=M[1],k=function(){var e=l()(o()().mark((function e(a){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(0,C.flushSync)((function(){i((function(e){return s()(s()({},e),{},{userInfo:a})}))}));case 1:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),U=function(){var e=l()(o()().mark((function e(a){var i,l,c;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleScanLogin values: ",a),S.yw.loading(t.formatMessage({id:"logging",defaultMessage:"logging..."})),e.next=4,(0,d.kZ)(s()({},a));case 4:i=e.sent,console.log("LoginMobileResult scanLogin:",i.data),200===i.code?(S.yw.destroy(),S.yw.success(t.formatMessage({id:"login.success",defaultMessage:"login success"})),n(null==i?void 0:i.data.accessToken),k(null==i||null===(l=i.data)||void 0===l?void 0:l.user),r(null==i||null===(c=i.data)||void 0===c?void 0:c.user),v.history.push("/")):(S.yw.destroy(),S.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),I=function(){var e=l()(o()().mark((function e(t){var n,s,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("scan"===a){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,d.Tm)(g,t);case 4:if(200!==(n=e.sent).code){e.next=30;break}if(s=n.data,console.log("handleScanQuery status: ",s.status),s.status!==F.C20){e.next=13;break}b("active"),x("deviceUid="+s.deviceUid+"&code="+s.content),e.next=28;break;case 13:if(s.status!==F.FM$){e.next=17;break}b("scanned"),e.next=28;break;case 17:if(s.status!==F.PhI){e.next=21;break}b("expired"),e.next=28;break;case 21:if(s.status!==F.Cml){e.next=28;break}if(void 0!==s.receiver&&""!==s.receiver){e.next=24;break}return e.abrupt("return");case 24:return r={mobile:s.receiver,code:s.content,platform:F.iw8},console.log("login scan info:",r),e.next=28,U(r);case 28:e.next=31;break;case 30:S.yw.error(n.message);case 31:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}();return(0,j.useEffect)((function(){console.log("scan deviceUid:",g),void 0!==g&&""!==g||p((0,D.Zx)()),I(!1);var e=setInterval((function(){I(!1)}),3e3);return function(){clearInterval(e)}}),[a,g]),(0,R.jsx)(R.Fragment,{children:"scan"===a&&(0,R.jsx)(R.Fragment,{children:(0,R.jsx)(W.Z,{style:{margin:"auto"},value:m,status:w,onRefresh:function(){console.log("onRefresh"),I(!0)}})})})},G=t(70185),_=t(36310),Y=t(99749),$=t(11757),J={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},X=t(54183),ee=function(e,a){return j.createElement(X.Z,(0,$.Z)({},e,{ref:a,icon:J}))};var ae=j.forwardRef(ee),te=t(85954),ne=function(){var e=x.Z.useToken().token,a=(0,j.useContext)(G.I),t=a.isCustomServer,n=a.setIsCustomServer,s=g.A.useForm(),r=u()(s,1)[0],o=(0,j.useState)(!1),i=u()(o,2),l=i[0],c=i[1],d=(0,j.useState)(""),p=u()(d,2),f=p[0],h=p[1],m=(0,j.useState)(""),v=u()(m,2),y=(v[0],v[1]);(0,j.useEffect)((function(){f&&f.length>0&&(r.setFieldsValue({apiUrl:f}),console.log("apiUrl:",f))}),[f]),(0,j.useEffect)((function(){if(t){var e=localStorage.getItem(F.Ss2);"true"===e&&(c(!0),r.setFieldsValue({isCustomServerEnabled:!0})),console.log("isCustomServer customEnabled:",e);var a=localStorage.getItem(F.DuM);a&&r.setFieldsValue({apiUrl:(0,D.Qj)(a)});var n=localStorage.getItem(F.sZT);n&&r.setFieldsValue({websocketUrl:(0,D.Qj)(n)})}}),[t]);return(0,R.jsx)("div",{className:"ant-pro-form-server-container",style:{backgroundColor:e.colorBgContainer,display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",width:"80%",marginLeft:"10%"},children:(0,R.jsxs)(g.A,{className:"ant-pro-form-server-main",form:r,submitter:{render:function(e,a){return console.log("props:",e,a),(0,R.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"8px"},children:[(0,R.jsx)(M.ZP,{icon:(0,R.jsx)(ae,{}),onClick:function(){console.log("switch server"),n((function(e){return!e}))},children:"返回"},"back"),(0,R.jsx)(M.ZP,{type:"primary",onClick:function(){var a=e.form.getFieldValue("apiUrl");a=(0,D.Qj)(a.trim());var t=e.form.getFieldValue("websocketUrl");t=(0,D.Qj)(t.trim()),a&&a.trim().length>0&&t&&t.trim().length>0?(localStorage.setItem(F.DuM,a),localStorage.setItem(F.sZT,t),localStorage.setItem(F.Ss2,"true"),S.yw.success("保存成功")):S.yw.error("请输入正确的服务器地址")},children:"保存"},"submit"),(0,R.jsx)(M.ZP,{onClick:function(){var a;null===(a=e.form)||void 0===a||a.resetFields(),h(""),localStorage.setItem(F.Ss2,"false"),localStorage.setItem(F.DuM,""),localStorage.setItem(F.sZT,""),S.yw.success("重置成功，已恢复默认云服务器")},children:"重置"},"reset"),(0,R.jsx)(M.ZP,{onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/agent/auth/login")},children:"帮助"},"help")]})}},children:[(0,R.jsx)(te.Z,{name:"isCustomServerEnabled",fieldProps:{onChange:function(e){console.log("e:",e),function(e){if(console.log("handleCustomServerChange e:",e),c(e.target.checked),e.target.checked){var a=localStorage.getItem(F.DuM);a&&r.setFieldsValue({apiUrl:(0,D.Qj)(a)});var t=localStorage.getItem(F.sZT);t&&r.setFieldsValue({websocketUrl:(0,D.Qj)(t)}),console.log("initData apiUrl:",a,"websocketUrl:",t)}else localStorage.setItem(F.Ss2,"false")}(e)}},children:"是否启用自定义服务器"}),l&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(L.Z,{name:"apiUrl",label:"API 服务器地址（例如：http://127.0.0.1:9003 或 https://api.bytedesk.com）",fieldProps:{disabled:!l,placeholder:"http://127.0.0.1:9003",onChange:function(e){return h(e.target.value)}}}),(0,R.jsx)(L.Z,{name:"websocketUrl",label:"WebSocket 服务器地址（例如：ws://127.0.0.1:9885/websocket 或 wss://api.bytedesk.com/websocket）",fieldProps:{disabled:!l,placeholder:"ws://127.0.0.1:9885/websocket",onChange:function(e){return y(e.target.value)}}})]})]})})},se=t(11184),re=t(786),oe=x.Z.defaultAlgorithm,ie=x.Z.darkAlgorithm,le=function(){var e=(0,m.l)((function(e){var a=e.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:a.borderRadius,":hover":{backgroundColor:a.colorBgTextHover}}}));return(0,R.jsx)("div",{className:e,"data-lang":!0,children:v.SelectLang&&(0,R.jsx)(v.SelectLang,{})})},ce=function(){var e=(0,v.useIntl)(),a=(0,q.Z)().translateString,t=g.A.useForm(),n=u()(t,1)[0],r=x.Z.useToken().token,i=(0,U.Z)().isDarkMode,c=(0,se.M)(),m=c.config,b=c.updateConfig,k=(0,j.useState)("https://www.weiyuai.cn/logo.png"),I=u()(k,2),T=I[0],E=I[1],L=(0,j.useState)(""),V=u()(L,2),A=V[0],z=V[1],N=(0,j.useState)(""),B=u()(N,2),O=B[0],W=B[1],$=(0,P.t)((function(e){return e.setAccessToken})),J=(0,j.useContext)(G.I),X=J.isCustomServer,ee=(J.setIsCustomServer,(0,j.useState)("mobile")),ae=u()(ee,2),te=ae[0],oe=ae[1],ie=(0,v.useModel)("@@initialState").setInitialState,ce=(0,j.useState)(!1),ue=u()(ce,2),de=ue[0],ge=(ue[1],(0,Z.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid,setUserInfo:e.setUserInfo}}))),pe=ge.deviceUid,fe=ge.setDeviceUid,he=ge.setUserInfo,me=(0,j.useState)(!1),ve=u()(me,2),xe=ve[0],ye=ve[1],Me=(0,j.useState)(),we=u()(Me,2),be=we[0],ke=we[1],je=(0,j.useState)("https://www.weiyuai.cn/privacy.html"),Ce=u()(je,2),Ze=Ce[0],Se=Ce[1],Pe=(0,j.useState)("https://www.weiyuai.cn/terms.html"),Ue=u()(Pe,2),Fe=Ue[0],Ie=Ue[1],Te=function(){window.open(Ze)},Ee=function(){window.open(Fe)},Le=(0,j.useState)(""),Re=u()(Le,2),Ke=Re[0],qe=Re[1],De=function(){var e=l()(o()().mark((function e(a,t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:qe(a),n.setFieldValue("captchaCode",t);case 2:case"end":return e.stop()}}),e)})));return function(a,t){return e.apply(this,arguments)}}(),Ve=function(){var e=l()(o()().mark((function e(a){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleKaptchaCheck:",a);case 1:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),Ae=function(a){y.Z.confirm({title:e.formatMessage({id:"pages.login.privacyModal.title",defaultMessage:"隐私协议确认"}),content:(0,R.jsxs)("div",{children:[(0,R.jsx)("p",{children:e.formatMessage({id:"pages.login.privacyModal.description",defaultMessage:"为了保护您的个人信息安全，请您阅读并同意以下协议："})}),(0,R.jsxs)("p",{children:[(0,R.jsx)(M.ZP,{size:"small",type:"link",onClick:Te,style:{padding:0,height:"auto"},children:e.formatMessage({id:"pages.login.privacyModal.privacyPolicy",defaultMessage:"《用户隐私协议》"})}),e.formatMessage({id:"pages.login.privacyModal.and",defaultMessage:"和"}),(0,R.jsx)(M.ZP,{size:"small",type:"link",onClick:Ee,style:{padding:0,height:"auto"},children:e.formatMessage({id:"pages.login.privacyModal.termsOfService",defaultMessage:"《服务条款》"})})]}),(0,R.jsx)("p",{children:e.formatMessage({id:"pages.login.privacyModal.confirmText",defaultMessage:"是否同意以上协议并继续登录？"})})]}),okText:e.formatMessage({id:"pages.login.privacyModal.agreeAndLogin",defaultMessage:"同意并登录"}),cancelText:e.formatMessage({id:"pages.login.privacyModal.cancel",defaultMessage:"取消"}),onOk:function(){ye(!0),a()}})},ze=function(){var a,t,n,s=[];return!1!==(null==be||null===(a=be.custom)||void 0===a?void 0:a.loginUsernameEnable)&&s.push({key:"account",label:e.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"账户密码登录"}),children:(0,R.jsx)(K,{loginType:te,onKaptchaChange:De,onKaptchaCheck:Ve})}),!1!==(null==be||null===(t=be.custom)||void 0===t?void 0:t.loginMobileEnable)&&s.push({key:"mobile",label:e.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"手机号登录"}),children:(0,R.jsx)(Q,{loginType:te,onKaptchaChange:De,onKaptchaCheck:Ve})}),!1!==(null==be||null===(n=be.custom)||void 0===n?void 0:n.loginScanEnable)&&s.push({key:"scan",label:e.formatMessage({id:"pages.login.scanLogin.tab",defaultMessage:"扫码登录"}),children:(0,R.jsx)(H,{loginType:te})}),0===s.length&&s.push({key:"account",label:e.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"账户密码登录"}),children:(0,R.jsx)(K,{loginType:te,onKaptchaChange:De,onKaptchaCheck:Ve})}),s},Ne=((0,p.uK)(r.colorTextBase,.2),function(){var a=l()(o()().mark((function a(){var t,n,s,r,i,l,c,u,d,g,p;return o()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return void 0!==pe&&""!==pe||fe((0,D.Zx)()),a.next=3,(0,_.Xs)();case 3:n=a.sent,ke(n),null!=n&&null!==(t=n.custom)&&void 0!==t&&t.enabled&&!(0,_._p)()?(null!=n&&null!==(s=n.custom)&&void 0!==s&&s.logo?E(null==n||null===(d=n.custom)||void 0===d?void 0:d.logo):E("https://www.weiyuai.cn/logo.png"),null!=n&&null!==(r=n.custom)&&void 0!==r&&r.name?z(null==n||null===(g=n.custom)||void 0===g?void 0:g.name):z(e.formatMessage({id:"app.title"})),null!=n&&null!==(i=n.custom)&&void 0!==i&&i.description?W(null==n||null===(p=n.custom)||void 0===p?void 0:p.description):W(e.formatMessage({id:"pages.layouts.userLayout.title"})),null!=n&&null!==(l=n.custom)&&void 0!==l&&l.showRightCornerChat||b({bubbleConfig:{show:!1},buttonConfig:{show:!1}}),null!=n&&null!==(c=n.custom)&&void 0!==c&&c.privacyPolicyUrl&&Se(n.custom.privacyPolicyUrl),null!=n&&null!==(u=n.custom)&&void 0!==u&&u.termsOfServiceUrl&&Ie(n.custom.termsOfServiceUrl)):(E("https://www.weiyuai.cn/logo.png"),z(e.formatMessage({id:"app.title"})),W(e.formatMessage({id:"pages.layouts.userLayout.title"}))),(0,_.ME)();case 7:case"end":return a.stop()}}),a)})));return function(){return a.apply(this,arguments)}}());(0,j.useEffect)((function(){(0,D.pr)(),Ne()}),[]),(0,j.useEffect)((function(){if(be){var e=ze();if(e.length>0){var a=e[0].key;a&&a!==te&&oe(a)}}}),[be]);var Be=function(){var e=l()(o()().mark((function e(a){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&(0,C.flushSync)((function(){ie((function(e){return s()(s()({},e),{},{userInfo:a})}))}));case 1:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),Oe=function(){var t=l()(o()().mark((function t(n){var r,i,l=arguments;return o()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r=l.length>1&&void 0!==l[1]&&l[1],t.prev=1,r||xe){t.next=5;break}return Ae((function(){Oe(n,!0)})),t.abrupt("return");case 5:return S.yw.loading(e.formatMessage({id:"logging",defaultMessage:"logging..."})),t.next=8,(0,d.x4)(s()({},n));case 8:i=t.sent,console.log("LoginResult:",i),200===i.code?(S.yw.destroy(),S.yw.success(e.formatMessage({id:"login.success",defaultMessage:"login success"})),$(i.data.accessToken),Be(i.data.user),he(i.data.user),v.history.push("/")):(S.yw.destroy(),S.yw.error(a(i.message))),t.next=17;break;case 13:t.prev=13,t.t0=t.catch(1),console.log(t.t0),S.yw.error(e.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 17:case"end":return t.stop()}}),t,null,[[1,13]])})));return function(e){return t.apply(this,arguments)}}(),Qe=function(){var a=l()(o()().mark((function a(t){var n,r,i,l,c=arguments;return o()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(n=c.length>1&&void 0!==c[1]&&c[1],a.prev=1,n||xe){a.next=5;break}return Ae((function(){Qe(t,!0)})),a.abrupt("return");case 5:return S.yw.loading(e.formatMessage({id:"logging",defaultMessage:"logging..."})),a.next=8,(0,d.N9)(s()({},t));case 8:r=a.sent,console.log("LoginMobileResult:",r),200===r.code?(S.yw.destroy(),S.yw.success(e.formatMessage({id:"login.success",defaultMessage:"login success"})),$(null==r?void 0:r.data.accessToken),Be(null==r||null===(i=r.data)||void 0===i?void 0:i.user),he(null==r||null===(l=r.data)||void 0===l?void 0:l.user),v.history.push("/")):(S.yw.destroy(),S.yw.error(e.formatMessage({id:r.message,defaultMessage:r.message}))),a.next=17;break;case 13:a.prev=13,a.t0=a.catch(1),console.log(a.t0),S.yw.error(e.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 17:case"end":return a.stop()}}),a,null,[[1,13]])})));return function(e){return a.apply(this,arguments)}}();return(0,R.jsxs)(f._Y,{hashed:!1,dark:i,children:[(0,R.jsx)(le,{}),(0,R.jsxs)("div",{style:{backgroundColor:r.colorBgContainer,textAlign:"center",height:"100%",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:[!X&&(0,R.jsxs)(h.U,{form:n,contentStyle:{minWidth:400,maxWidth:"75vw"},logo:(0,R.jsx)("img",{alt:"logo",src:T}),title:A,subTitle:O,actions:de&&!1,onFinish:function(){var e=l()(o()().mark((function e(a){var t,n;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("login values:",a),"account"!==te){e.next=8;break}return t={username:a.username,password:a.password,captchaUid:Ke,captchaCode:a.captchaCode,deviceUid:pe,platform:F.iw8},console.log("login info:",t),e.next=6,Oe(t);case 6:e.next=12;break;case 8:return n={mobile:a.mobile,code:a.code,captchaUid:Ke,captchaCode:a.captchaCode,deviceUid:pe,platform:F.iw8},console.log("login mobile info:",n),e.next=12,Qe(n);case 12:case"end":return e.stop()}}),e)})));return function(a){return e.apply(this,arguments)}}(),children:[(0,R.jsx)(w.Z,{activeKey:te,onChange:oe,centered:!0,items:ze()}),(0,R.jsx)("div",{style:{marginTop:14,marginBottom:14},children:(0,R.jsxs)("div",{style:{float:"right",marginBottom:24},children:[(0,R.jsx)(Y.Z,{checked:xe,onChange:function(e){console.log("checked = ".concat(e.target.checked)),ye(e.target.checked)},children:(0,R.jsxs)("span",{children:[e.formatMessage({id:"pages.login.privacy.agree",defaultMessage:"同意"}),(0,R.jsx)(M.ZP,{size:"small",type:"link",onClick:Te,style:{padding:0,height:"auto"},children:e.formatMessage({id:"pages.login.privacy.privacyPolicy",defaultMessage:"《用户隐私协议》"})}),e.formatMessage({id:"pages.login.privacy.and",defaultMessage:"和"}),(0,R.jsx)(M.ZP,{size:"small",type:"link",onClick:Ee,style:{padding:0,height:"auto"},children:e.formatMessage({id:"pages.login.privacy.termsOfService",defaultMessage:"《服务条款》"})})]})}),de&&(0,R.jsx)(v.Link,{to:"/auth/register",children:(0,R.jsx)(v.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"注册 "})}),!1]})})]}),X&&(0,R.jsx)(ne,{}),(0,R.jsx)(re.Q,s()(s()({},m),{},{onInit:function(){console.log("ByteDesk initialized admin")}}))]})]})},ue=function(){var e=(0,U.Z)().isDarkMode;return(0,R.jsx)(G.w,{children:(0,R.jsx)(b.ZP,{theme:{algorithm:e?ie:oe},children:(0,R.jsxs)(k.Z,{style:{height:"100%"},children:[(0,R.jsx)(S.ZP,{}),(0,R.jsx)(ce,{})]})})})}}}]);