"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9555],{15722:function(e,t,r){r.d(t,{Z:function(){return d}});var s=r(73743),a=r(44194),n={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},i=r(54183),o=function(e,t){return a.createElement(i.Z,(0,s.Z)({},e,{ref:t,icon:n}))};var d=a.forwardRef(o)},59993:function(e,t,r){var s=r(69578),a=r(7657),n=r(75101),i=r(81424),o=r(88638),d=r(1784),l=r(34573),c=r(44194),u=r(47563),p=r(31549),m=["fieldProps","proFieldProps"],f=["fieldProps","proFieldProps"],g="text",x=function(e){var t=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,s.Z)(t,2),n=r[0],l=r[1];return(0,p.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,s=t.getFieldValue(e.name||[]);return(0,p.jsx)(d.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return l(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,s),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:n,children:e.children}))}})},h=function(e){var t=e.fieldProps,r=e.proFieldProps,s=(0,n.Z)(e,m);return(0,p.jsx)(u.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:r},s))};h.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,i=(0,n.Z)(e,f),o=(0,c.useState)(!1),d=(0,s.Z)(o,2),m=d[0],h=d[1];return null!=t&&t.statusRender&&i.name?(0,p.jsx)(x,{name:i.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:m,onOpenChange:h,children:(0,p.jsx)("div",{children:(0,p.jsx)(u.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,l.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),h(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),h(!0)}}),proFieldProps:r,filedConfig:{valueType:g}},i))})}):(0,p.jsx)(u.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:g}},i))},h.displayName="ProFormComponent",t.Z=h},44517:function(e,t,r){var s=r(7657),a=r(75101),n=r(44194),i=r(47563),o=r(31549),d=["fieldProps","proFieldProps"],l=function(e,t){var r=e.fieldProps,n=e.proFieldProps,l=(0,a.Z)(e,d);return(0,o.jsx)(i.Z,(0,s.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:n},l))};t.Z=n.forwardRef(l)},15049:function(e,t,r){r.r(t),r.d(t,{default:function(){return re}});var s=r(75002),a=r(43906),n=r(84176),i=r.n(n),o=r(73193),d=r.n(o),l=r(90819),c=r.n(l),u=r(89933),p=r.n(u),m=r(45332),f=r.n(m),g=r(55567),x=r(39686),h=r(18232);function v(e){return M.apply(this,arguments)}function M(){return(M=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/query/org",{method:"GET",params:d()(d()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return y.apply(this,arguments)}function y(){return(y=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/create",{method:"POST",data:d()(d()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return b.apply(this,arguments)}function b(){return(b=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/update",{method:"POST",data:d()(d()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return F.apply(this,arguments)}function F(){return(F=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/delete",{method:"POST",data:d()(d()({},t),{},{client:h.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=r(9942),S=r(81343),P=r(15722),C=r(5321),T=r(59304),B=r(54881),I=r(11090),A=r(10162),O=r(2484),R=r(46336),z=r(99898),E=r(17966),q=r(34353),N=r(41994),U=r(28977),V=r.n(U),D=r(44194),Y=r(48792),K=r(59993),G=r(44517),H=r(68060),L=r(75843),J=r(31549),Q=function(e){var t=e.isEdit,r=e.customer,s=e.open,n=e.onClose,i=e.onSubmit,o=(0,a.useIntl)(),l=Y.A.useForm(),c=f()(l,1)[0],u=H.Z.Text;(0,D.useEffect)((function(){s&&(t&&r?c.setFieldsValue({nickname:r.nickname||"",email:r.email||"",mobile:r.mobile||"",description:r.description||"",notes:r.notes||"",extra:r.extra||"",client:r.client||""}):c.resetFields())}),[s,t,r,c]);var p=t?o.formatMessage({id:"customer.edit",defaultMessage:"编辑客户"}):o.formatMessage({id:"customer.create",defaultMessage:"新增客户"}),m=r&&!t,g=m?null:(0,J.jsxs)(z.Z,{children:[(0,J.jsx)(q.ZP,{onClick:n,children:(0,J.jsx)(a.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,J.jsx)(q.ZP,{type:"primary",onClick:function(){c.validateFields().then((function(e){var s=d()(d()({},e),t&&r?{uid:r.uid}:{});i(s)}))},children:(0,J.jsx)(a.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,J.jsx)(J.Fragment,{children:(0,J.jsx)(L.Z,{title:p,onClose:n,open:s,width:500,extra:g,children:m&&r?(0,J.jsxs)("div",{children:[(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",r.nickname||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),":"]})," ",r.email||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"mobile",defaultMessage:"手机"}),":"]})," ",r.mobile||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"}),":"]})," ",r.description||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"notes",defaultMessage:"备注"}),":"]})," ",r.notes||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"extra",defaultMessage:"额外信息"}),":"]})," ",r.extra||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",r.createdAt||"-"]}),(0,J.jsxs)("div",{style:{marginBottom:16},children:[(0,J.jsxs)(u,{strong:!0,children:[(0,J.jsx)(a.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",r.updatedAt||"-"]})]}):(0,J.jsxs)(Y.A,{form:c,name:"customerForm",submitter:!1,children:[(0,J.jsx)(K.Z,{name:"nickname",label:(0,J.jsx)(a.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:"请输入客户昵称"}]}),(0,J.jsx)(K.Z,{name:"email",label:(0,J.jsx)(a.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),rules:[{type:"email",message:"请输入有效的邮箱地址"}]}),(0,J.jsx)(K.Z,{name:"mobile",label:(0,J.jsx)(a.FormattedMessage,{id:"mobile",defaultMessage:"手机"})}),(0,J.jsx)(G.Z,{name:"description",label:(0,J.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"})}),(0,J.jsx)(G.Z,{name:"notes",label:(0,J.jsx)(a.FormattedMessage,{id:"notes",defaultMessage:"备注"})}),(0,J.jsx)(G.Z,{name:"extra",label:(0,J.jsx)(a.FormattedMessage,{id:"extra",defaultMessage:"额外信息"})})]})})})},W=["current","pageSize"],X=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,J.jsx)(a.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,J.jsx)(a.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,tooltip:(0,J.jsx)(a.FormattedMessage,{id:"customer.nickname.tooltip"})},{title:(0,J.jsx)(a.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",hideInSearch:!0,tooltip:(0,J.jsx)(a.FormattedMessage,{id:"customer.email.tooltip"})},{title:(0,J.jsx)(a.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",copyable:!0,tooltip:(0,J.jsx)(a.FormattedMessage,{id:"customer.mobile.tooltip"})},{title:(0,J.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,tooltip:(0,J.jsx)(a.FormattedMessage,{id:"customer.description.tooltip"})},{title:(0,J.jsx)(a.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,J.jsx)(a.FormattedMessage,{id:"customer.createdAt.tooltip"}),render:function(e,t,r,s){return V()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],$=function(e){e.isSuper;var t=(0,a.useIntl)(),r=(0,D.useRef)(),s=(0,D.useState)(1),n=f()(s,2),o=n[0],l=n[1],u=(0,D.useState)(10),m=f()(u,2),M=m[0],y=m[1],b=(0,w.u)((function(e){return e.currentOrg})),F=(0,D.useState)({}),U=f()(F,2),V=U[0],Y=U[1],K=(0,D.useState)(0),G=f()(K,2),H=G[0],L=G[1],$=(0,D.useState)([]),_=f()($,2),ee=_[0],te=_[1],re=(0,D.useState)([]),se=f()(re,2),ae=(se[0],se[1]),ne=(0,D.useState)(!1),ie=f()(ne,2),oe=ie[0],de=ie[1],le=(0,D.useState)(!1),ce=f()(le,2),ue=ce[0],pe=ce[1],me=(0,D.useState)(),fe=f()(me,2),ge=fe[0],xe=fe[1],he=function(){var e=p()(c()().mark((function e(s){var a,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!ue||!ge){e.next=7;break}return e.next=4,Z(d()(d()({},s),{},{uid:ge.uid,orgUid:null==b?void 0:b.uid}));case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,j(d()(d()({},s),{},{orgUid:null==b?void 0:b.uid}));case 9:a=e.sent;case 10:200===a.code?(g.yw.success(ue?t.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):t.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),de(!1),null===(n=r.current)||void 0===n||n.reload()):g.yw.error(a.message||t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),g.yw.error(t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),ve=function(){xe(void 0),pe(!1),de(!0)},Me=[].concat(X,[{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,s){return(0,J.jsxs)(z.Z,{children:[(0,J.jsx)(E.Z,{title:t.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,J.jsx)(q.ZP,{type:"text",icon:(0,J.jsx)(C.Z,{}),onClick:function(){return function(e){xe(e),pe(!1),de(!0)}(s)}})}),(0,J.jsx)(E.Z,{title:t.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,J.jsx)(q.ZP,{type:"text",icon:(0,J.jsx)(T.Z,{}),onClick:function(){return function(e){xe(e),pe(!0),de(!0)}(s)}})}),(0,J.jsx)(E.Z,{title:t.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,J.jsx)(q.ZP,{type:"text",danger:!0,icon:(0,J.jsx)(B.Z,{}),onClick:function(){return function(e){var s;x.Z.confirm({title:t.formatMessage({id:"customer.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,J.jsx)(P.Z,{}),content:t.formatMessage({id:"customer.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(s=p()(c()().mark((function s(){var a,n;return c()().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,k({uid:e.uid,orgUid:null==b?void 0:b.uid});case 3:200===(a=s.sent).code?(g.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=r.current)||void 0===n||n.reload()):g.yw.error(a.message||t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),s.next=11;break;case 7:s.prev=7,s.t0=s.catch(0),console.error("删除客户出错:",s.t0),g.yw.error(t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return s.stop()}}),s,null,[[0,7]])}))),function(){return s.apply(this,arguments)})})}(s)}})})]})}}]),je=function(){var e=p()(c()().mark((function e(t,r,s){var a,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,r,s),a=localStorage.getItem(h.LA8),n=d()({orgUid:(null==b?void 0:b.uid)||"",accessToken:a||"",exportType:t},V),"current"===t?(n.pageNumber=String(o-1),n.pageSize=String(M)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==r&&void 0!==s&&(n.pageNumber=String(r),n.pageSize=String(s)),window.open((0,S.kG)()+"/api/v1/customer/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,r,s){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],r=1e3,s=Math.ceil(e/r),a=function(){var s=n,a=n*r+1,i=Math.min((n+1)*r,e);t.push({key:"export-".concat(n),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return je("range",s,r)}})},n=0;n<s;n++)a();return t},Ze={selectedRowKeys:ee,onChange:function(e,t){te(e),ae(t)}};return(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(R.Z,{columns:Me,actionRef:r,cardBordered:!0,rowSelection:Ze,scroll:{x:1300},request:function(){var e=p()(c()().mark((function e(t,r,s){var a,n,o,u,p,m,f,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,n=t.pageSize,o=i()(t,W),l(a),y(n),Y(o),u=void 0,p=void 0,r&&Object.keys(r).length>0&&(m=Object.keys(r)[0],u=m,p="ascend"===r[m]?"ascend":"descend"),f=d()(d()({pageNumber:a-1,pageSize:n,orgUid:null==b?void 0:b.uid},o),{},{sortBy:u,sortDirection:p}),e.next=10,v(f);case 10:return x=e.sent,console.log("queryCustomersByOrg response:",x,f),200===x.code?L(x.data.totalElements):g.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,r,s){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),y(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"客户列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,J.jsx)(I.Z,{}),label:t.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return je("current")}}],H>0&&(H<=1e3?e.push({key:"export-all",icon:(0,J.jsx)(I.Z,{}),label:t.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(H,"条)"),onClick:function(){return je("all")}}):e.push({key:"export-range",icon:(0,J.jsx)(I.Z,{}),label:t.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(H,"条)"),children:ye(H)})),[(0,J.jsx)(q.ZP,{type:"primary",icon:(0,J.jsx)(A.Z,{}),onClick:ve,children:t.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,J.jsx)(N.Z,{menu:{items:e},placement:"bottom",children:(0,J.jsxs)(q.ZP,{type:"primary",icon:(0,J.jsx)(I.Z,{}),children:[t.formatMessage({id:"export",defaultMessage:"导出"}),(0,J.jsx)(O.Z,{})]})},"exportOperations")];var e}}),(0,J.jsx)(Q,{isEdit:ue,customer:ge,open:oe,onClose:function(){return de(!1)},onSubmit:he})]})},_=r(21349),ee=r(91034),te=r(96981),re=function(){var e=(0,a.useIntl)(),t=[{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,J.jsx)(te.Z,{isSuper:!1})},{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,J.jsx)(_.Z,{isSuper:!1})},{key:"blackip",label:e.formatMessage({id:"visitor.tab.blackip"}),children:(0,J.jsx)(ee.Z,{isSuper:!1})},{key:"customer",label:e.formatMessage({id:"customer"}),children:(0,J.jsx)($,{isSuper:!1})}];return(0,J.jsx)(s.Z,{defaultActiveKey:"visitor",items:t,style:{margin:10}})}}}]);