"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1720],{28031:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=a(5901),i=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var d=n.forwardRef(i)},80503:function(e,t,a){a.d(t,{Z:function(){return d}});var r=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=a(5901),i=function(e,t){return n.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var d=n.forwardRef(i)},19848:function(e,t,a){a.d(t,{XS:function(){return u},k4:function(){return f},uu:function(){return x},yr:function(){return m}});var r=a(90819),n=a.n(r),s=a(73193),o=a.n(s),i=a(89933),d=a.n(i),c=a(2622),l=a(59318);function u(e){return g.apply(this,arguments)}function g(){return(g=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/query/org",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/create",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/update",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=d()(n()().mark((function e(t){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,l.request)("/api/v1/category/delete",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},57706:function(e,t,a){var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),c=a(90819),l=a.n(c),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(78929),h=a(70543),x=a(89520),M=a(2622),y=a(32157),v=a(91768),w=a(28031),j=a(80503),b=a(99220),k=a(59318),S=a(71589),I=a(69755),F=a(61826),T=a(20374),A=a(44194),Z=a(58889),C=a(31549),E=["current","pageSize"];t.Z=function(e){var t=e.type,a=e.superUser,r=(0,k.useIntl)(),s=(0,A.useRef)(),i=(0,A.useState)(1),c=p()(i,2),u=c[0],f=c[1],D=(0,A.useState)(10),N=p()(D,2),R=N[0],O=N[1],z=(0,x.u)((function(e){return e.currentOrg})),U=S.Z.useModal(),B=p()(U,2),P=(B[0],B[1]),L=(0,A.useState)([]),q=p()(L,2),Y=q[0],H=q[1],_=(0,A.useState)([]),G=p()(_,2),V=G[0],K=G[1],J=(0,A.useState)(0),Q=p()(J,2),X=Q[0],W=Q[1],$=(0,A.useState)({}),ee=p()($,2),te=ee[0],ae=ee[1],re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,C.jsx)(k.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,C.jsx)(k.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,ellipsis:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case M.ach:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.new"});case M.j0C:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.roboting"});case M.Q7C:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.offline"});case M.v1N:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.queuing"});case M.hl2:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.chatting"});case M.V1n:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,C.jsx)(k.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,C.jsx)(k.FormattedMessage,{id:"channel"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.channel.tooltip"}),render:function(e,t){return(0,Z.YG)(t.channel)}},{title:(0,C.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,C.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,C.jsx)(k.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.type.tooltip"})},{title:(0,C.jsx)(k.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.topic.tooltip"})},{title:(0,C.jsx)(k.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.owner.tooltip"}),render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.tagList.tooltip"}),render:function(e,t){var a;return null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,C.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],ne=[].concat(re,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,a,n){return[(0,C.jsx)("a",{onClick:function(){se(t)},children:r.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,C.jsx)(I.Z,{title:r.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:r.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此群组记录吗？此操作不可恢复!"}),onConfirm:function(){return oe(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,C.jsx)("a",{style:{color:"red",marginLeft:8},children:r.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),se=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==z?void 0:z.uid,t:M.CCt,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},oe=function(){var e=g()(l()().mark((function e(t){var a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(a=s.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(r.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=g()(l()().mark((function e(){var t,a,n,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==V.length){e.next=3;break}return m.yw.warning(r.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,n=d()(V);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}m.yw.destroy(),0===a?m.yw.success(r.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(r.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),H([]),K([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=g()(l()().mark((function e(a,r,n){var s,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),s=localStorage.getItem(M.LA8),i=o()({componentType:t,orgUid:(null==z?void 0:z.uid)||"",accessToken:s||"",exportType:a,type:M.H_O},te),"current"===a?(i.pageNumber=String(u-1),i.pageSize=String(R)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(i.pageNumber=String(r),i.pageSize=String(n)),window.open((0,y.kG)()+"/api/v1/thread/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ce=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return de("range",r,a)}})},s=0;s<r;s++)n();return t},le={selectedRowKeys:Y,onChange:function(e,t){H(e),K(t)}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(b.Z,{columns:ne,actionRef:s,cardBordered:!0,rowSelection:le,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,r,s){var i,d,c,u,g,p,x,y;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.current,d=t.pageSize,c=n()(t,E),f(i),O(d),ae(c),u=void 0,g=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],u=p,g="ascend"===r[p]?"ascend":"descend"),x=o()(o()({pageNumber:i-1,pageSize:d,componentType:"",type:M.H_O,orgUid:null==z?void 0:z.uid,mergeByTopic:!1,superUser:a},c),{},{sortBy:u,sortDirection:g}),e.next=10,(0,h.fk)(x);case 10:return y=e.sent,console.log("getAllThreads response:",y,x),200===y.code?W(y.data.totalElements):m.yw.error(y.message),e.abrupt("return",{data:y.data.content,success:!0,total:y.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];Y.length>0&&t.push({key:"batchDelete",icon:(0,C.jsx)(v.Z,{}),danger:!0,label:r.formatMessage({id:"batch.delete"})+" (".concat(Y.length,")"),onClick:function(){S.Z.confirm({title:r.formatMessage({id:"batch.deleteTip"}),content:"".concat(r.formatMessage({id:"batch.deleteAffirm"})," ").concat(Y.length," ").concat(r.formatMessage({id:"items"}),"?"),onOk:ie,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,C.jsx)(w.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return de("current")}}];return X>0&&(X<=1e3?a.push({key:"export-all",icon:(0,C.jsx)(w.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(X,"条)"),onClick:function(){return de("all")}}):a.push({key:"export-range",icon:(0,C.jsx)(w.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(X,"条)"),children:ce(X)})),e.push((0,C.jsx)(F.Z,{menu:{items:a},placement:"bottom",children:(0,C.jsxs)(T.ZP,{icon:(0,C.jsx)(w.Z,{}),type:"primary",children:[r.formatMessage({id:"export",defaultMessage:"Export"}),(0,C.jsx)(j.Z,{})]},"button")},"export")),t.length>0&&e.push((0,C.jsx)(F.Z,{menu:{items:t},placement:"bottom",children:(0,C.jsxs)(T.ZP,{type:Y.length>0?"primary":"default",danger:Y.length>0,children:[Y.length>0?r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Y.length,")"):r.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,C.jsx)(j.Z,{})]})},"batchOperations")),e}()}}),P]})}},14075:function(e,t,a){var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),c=a(90819),l=a.n(c),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(78929),h=a(70543),x=a(89520),M=a(2622),y=a(32157),v=a(91768),w=a(28031),j=a(80503),b=a(99220),k=a(59318),S=a(71589),I=a(69755),F=a(61826),T=a(20374),A=a(44194),Z=a(58889),C=a(31549),E=["current","pageSize"];t.Z=function(e){var t=e.type,a=e.superUser,r=(0,k.useIntl)(),s=(0,A.useRef)(),i=(0,A.useState)(1),c=p()(i,2),u=c[0],f=c[1],D=(0,A.useState)(10),N=p()(D,2),R=N[0],O=N[1],z=(0,x.u)((function(e){return e.currentOrg})),U=S.Z.useModal(),B=p()(U,2),P=(B[0],B[1]),L=(0,A.useState)([]),q=p()(L,2),Y=q[0],H=q[1],_=(0,A.useState)([]),G=p()(_,2),V=G[0],K=G[1],J=(0,A.useState)(0),Q=p()(J,2),X=Q[0],W=Q[1],$=(0,A.useState)({}),ee=p()($,2),te=ee[0],ae=ee[1],re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left",tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.index.tooltip"})},{title:(0,C.jsx)(k.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left",tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.uid.tooltip"})},{title:(0,C.jsx)(k.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",copyable:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.userNickname.tooltip"}),render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"state",defaultMessage:"state"}),dataIndex:"status",copyable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.status.tooltip"}),render:function(e,t){switch(null==t?void 0:t.status){case M.ach:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.new"});case M.j0C:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.roboting"});case M.Q7C:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.offline"});case M.v1N:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.queuing"});case M.hl2:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.chatting"});case M.V1n:return(0,C.jsx)(k.FormattedMessage,{id:"thread.process.status.closed"});default:return(0,C.jsx)(k.FormattedMessage,{id:"queue.member.status.unknown"})}}},{title:(0,C.jsx)(k.FormattedMessage,{id:"channel"}),dataIndex:"client",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.channel.tooltip"}),render:function(e,t){return(0,Z.YG)(t.channel)}},{title:(0,C.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,C.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,C.jsx)(k.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"topic",defaultMessage:"Topic"}),dataIndex:"topic",ellipsis:!0,copyable:!0,hideInTable:!0,hideInSearch:!0},{title:(0,C.jsx)(k.FormattedMessage,{id:"owner",defaultMessage:"Owner"}),dataIndex:"owner",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return(0,C.jsx)(C.Fragment,{children:null==t||null===(a=t.owner)||void 0===a?void 0:a.nickname})}},{title:(0,C.jsx)(k.FormattedMessage,{id:"tagList",defaultMessage:"Tags"}),dataIndex:"tagList",hideInTable:!0,hideInSearch:!0,render:function(e,t){var a;return null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e,t){return(0,C.jsxs)("span",{style:{marginRight:4},children:["#",e]},t)}))}}],ne=[].concat(re,[{title:r.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",tooltip:(0,C.jsx)(k.FormattedMessage,{id:"thread.actions.tooltip"}),render:function(e,t,a,n){return[(0,C.jsx)("a",{onClick:function(){se(t)},children:r.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,C.jsx)(I.Z,{title:r.formatMessage({id:"deleteTip"}),description:"".concat(r.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return oe(t)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"}),children:(0,C.jsx)("a",{style:{color:"red",marginLeft:8},children:r.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),se=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==z?void 0:z.uid,t:M.CCt,sid:null==e?void 0:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},oe=function(){var e=g()(l()().mark((function e(t){var a;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(a=s.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(r.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=g()(l()().mark((function e(){var t,a,n,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==V.length){e.next=3;break}return m.yw.warning(r.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,n=d()(V);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}m.yw.destroy(),0===a?m.yw.success(r.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(r.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),H([]),K([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),de=function(){var e=g()(l()().mark((function e(a,r,n){var s,i;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,r,n),s=localStorage.getItem(M.LA8),i=o()({componentType:t,orgUid:(null==z?void 0:z.uid)||"",accessToken:s||"",exportType:a,type:M.n4F},te),"current"===a?(i.pageNumber=String(u-1),i.pageSize=String(R)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==r&&void 0!==n&&(i.pageNumber=String(r),i.pageSize=String(n)),window.open((0,y.kG)()+"/api/v1/thread/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ce=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return de("range",r,a)}})},s=0;s<r;s++)n();return t},le={selectedRowKeys:Y,onChange:function(e,t){H(e),K(t)}};return(0,C.jsxs)(C.Fragment,{children:[(0,C.jsx)(b.Z,{columns:ne,actionRef:s,cardBordered:!0,rowSelection:le,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(t,r,s){var i,d,c,u,g,p,x,y;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=t.current,d=t.pageSize,c=n()(t,E),f(i),O(d),ae(c),u=void 0,g=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],u=p,g="ascend"===r[p]?"ascend":"descend"),x=o()(o()({pageNumber:i-1,pageSize:d,componentType:"",type:M.n4F,orgUid:null==z?void 0:z.uid,mergeByTopic:!1,superUser:a},c),{},{sortBy:u,sortDirection:g}),e.next=10,(0,h.fk)(x);case 10:return y=e.sent,console.log("getAllThreads response:",y,x),200===y.code?W(y.data.totalElements):m.yw.error(y.message),e.abrupt("return",{data:y.data.content,success:!0,total:y.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"thread",defaultMessage:"Thread"}),toolBarRender:function(){return function(){var e=[],t=[];Y.length>0&&t.push({key:"batchDelete",icon:(0,C.jsx)(v.Z,{}),danger:!0,label:r.formatMessage({id:"batch.delete"})+" (".concat(Y.length,")"),onClick:function(){S.Z.confirm({title:r.formatMessage({id:"batch.deleteTip"}),content:"".concat(r.formatMessage({id:"batch.deleteAffirm"})," ").concat(Y.length," ").concat(r.formatMessage({id:"items"}),"?"),onOk:ie,okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,C.jsx)(w.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return de("current")}}];return X>0&&(X<=1e3?a.push({key:"export-all",icon:(0,C.jsx)(w.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(X,"条)"),onClick:function(){return de("all")}}):a.push({key:"export-range",icon:(0,C.jsx)(w.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(X,"条)"),children:ce(X)})),e.push((0,C.jsx)(F.Z,{menu:{items:a},placement:"bottom",children:(0,C.jsxs)(T.ZP,{icon:(0,C.jsx)(w.Z,{}),type:"primary",children:[r.formatMessage({id:"export",defaultMessage:"Export"}),(0,C.jsx)(j.Z,{})]},"button")},"export")),t.length>0&&e.push((0,C.jsx)(F.Z,{menu:{items:t},placement:"bottom",children:(0,C.jsxs)(T.ZP,{type:Y.length>0?"primary":"default",danger:Y.length>0,children:[Y.length>0?r.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Y.length,")"):r.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,C.jsx)(j.Z,{})]})},"batchOperations")),e}()}}),P]})}},54497:function(e,t,a){a.d(t,{Z:function(){return O}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),c=a(90819),l=a.n(c),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(78929),h=a(59318);function x(e){return M.apply(this,arguments)}function M(){return(M=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/thread/invite/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=a(67794),v=a(89520),w=a(2622),j=a(32157),b=a(91768),k=a(28031),S=a(80503),I=a(99220),F=a(71589),T=a(59983),A=a(69755),Z=a(61826),C=a(20374),E=a(44194),D=a(31549),N=["current","pageSize"],R={INVITE_PENDING:{text:"invite.status.pending",defaultMessage:"邀请待处理",color:"blue"},INVITE_ACCEPTED:{text:"invite.status.accepted",defaultMessage:"接受邀请",color:"green"},INVITE_REJECTED:{text:"invite.status.rejected",defaultMessage:"拒绝邀请",color:"red"},INVITE_TIMEOUT:{text:"invite.status.timeout",defaultMessage:"邀请超时",color:"orange"},INVITE_CANCELED:{text:"invite.status.canceled",defaultMessage:"取消邀请",color:"gray"}},O=function(e){var t=e.superUser,a=(0,h.useIntl)(),r=(0,E.useRef)(),s=(0,E.useState)(1),i=p()(s,2),c=i[0],u=i[1],f=(0,E.useState)(10),M=p()(f,2),O=M[0],z=M[1],U=(0,v.u)((function(e){return e.currentOrg})),B=(0,y.Z)().translateString,P=F.Z.useModal(),L=p()(P,2),q=(L[0],L[1]),Y=(0,E.useState)([]),H=p()(Y,2),_=H[0],G=H[1],V=(0,E.useState)([]),K=p()(V,2),J=K[0],Q=K[1],X=(0,E.useState)(0),W=p()(X,2),$=W[0],ee=W[1],te=(0,E.useState)({}),ae=p()(te,2),re=ae[0],ne=ae[1],se=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(h.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"sender",copyable:!0,ellipsis:!0,tooltip:(0,D.jsx)(h.FormattedMessage,{id:"invite.sender.tooltip"}),render:function(e,t,a,r){var n;return B(null===(n=t.sender)||void 0===n?void 0:n.nickname)}},{title:(0,D.jsx)(h.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,D.jsx)(h.FormattedMessage,{id:"invite.receiver.tooltip"}),render:function(e,t,a,r){var n;return B(null===(n=t.receiver)||void 0===n?void 0:n.nickname)}},{title:(0,D.jsx)(h.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,D.jsx)(h.FormattedMessage,{id:"invite.note.tooltip"})},{title:(0,D.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,D.jsx)(h.FormattedMessage,{id:"invite.status.tooltip"}),render:function(e,t){var a=t.status,r=R[a]||{text:"invite.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,D.jsx)(T.Z,{color:r.color,children:(0,D.jsx)(h.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,D.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,D.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],oe=[].concat(se,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,r,n){return[(0,D.jsx)("a",{onClick:function(){ie(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,D.jsx)(A.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return de(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,D.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ie=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==U?void 0:U.uid,t:w.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},de=function(){var e=g()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(n=r.current)||void 0===n||n.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=g()(l()().mark((function e(){var t,n,s,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==J.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,n=0,s=d()(J);try{for(s.s();!(o=s.n()).done;)o.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===n?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:n})),G([]),Q([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=g()(l()().mark((function e(t,a,r){var n,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(w.LA8),s=o()({orgUid:(null==U?void 0:U.uid)||"",accessToken:n||"",exportType:t},re),"current"===t?(s.pageNumber=String(c-1),s.pageSize=String(O)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,j.kG)()+"/api/v1/thread/invite/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ue=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return le("range",r,a)}})},s=0;s<r;s++)n();return t},ge={selectedRowKeys:_,onChange:function(e,t){G(e),Q(t)}};return(0,D.jsxs)(D.Fragment,{children:[(0,D.jsx)(I.Z,{columns:oe,actionRef:r,cardBordered:!0,rowSelection:ge,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(a,r,s){var i,d,c,g,f,p,h,M;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,d=a.pageSize,c=n()(a,N),u(i),z(d),ne(c),g=void 0,f=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],g=p,f="ascend"===r[p]?"ascend":"descend"),h=o()(o()({pageNumber:i-1,pageSize:d,orgUid:null==U?void 0:U.uid,superUser:t},c),{},{sortBy:g,sortDirection:f}),e.next=10,x(h);case 10:return M=e.sent,console.log("getAllThreadInvites response:",M,h),200===M.code?ee(M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread.tab.invite",defaultMessage:"ThreadInvite"}),toolBarRender:function(){return function(){var e=[],t=[];_.length>0&&t.push({key:"batchDelete",icon:(0,D.jsx)(b.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(_.length,")"),onClick:function(){F.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(_.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ce,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,D.jsx)(k.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return le("current")}}];return $>0&&($<=1e3?r.push({key:"export-all",icon:(0,D.jsx)(k.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat($,"条)"),onClick:function(){return le("all")}}):r.push({key:"export-range",icon:(0,D.jsx)(k.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat($,"条)"),children:ue($)})),e.push((0,D.jsx)(Z.Z,{menu:{items:r},placement:"bottom",children:(0,D.jsxs)(C.ZP,{icon:(0,D.jsx)(k.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,D.jsx)(S.Z,{})]},"button")},"export")),t.length>0&&e.push((0,D.jsx)(Z.Z,{menu:{items:t},placement:"bottom",children:(0,D.jsxs)(C.ZP,{type:_.length>0?"primary":"default",danger:_.length>0,children:[_.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(_.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,D.jsx)(S.Z,{})]})},"batchOperations")),e}()}}),q]})}},63021:function(e,t,a){a.d(t,{Z:function(){return N}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),c=a(90819),l=a.n(c),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(78929),h=a(2622),x=a(59318);function M(e){return y.apply(this,arguments)}function y(){return(y=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/thread/rating/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=a(89520),w=a(32157),j=a(91768),b=a(28031),k=a(80503),S=a(99220),I=a(69755),F=a(71589),T=a(61826),A=a(20374),Z=a(44194),C=a(31549),E=["current","pageSize"],D=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,C.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,C.jsx)(x.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,ellipsis:!0,tooltip:(0,C.jsx)(x.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t,a,r){var n;return null==t||null===(n=t.thread)||void 0===n||null===(n=n.user)||void 0===n?void 0:n.nickname}},{title:(0,C.jsx)(x.FormattedMessage,{id:"queue.member.agent",defaultMessage:"Nickname"}),dataIndex:"agentNickname",hideInSearch:!0,tooltip:(0,C.jsx)(x.FormattedMessage,{id:"rating.agent.tooltip"}),render:function(e,t,a,r){var n;return null==t||null===(n=t.thread)||void 0===n||null===(n=n.agentProtobuf)||void 0===n?void 0:n.nickname}},{title:(0,C.jsx)(x.FormattedMessage,{id:"score",defaultMessage:"Score"}),dataIndex:"score",tooltip:(0,C.jsx)(x.FormattedMessage,{id:"rating.score.tooltip"})},{title:(0,C.jsx)(x.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"comment",copyable:!0,tooltip:(0,C.jsx)(x.FormattedMessage,{id:"rating.comment.tooltip"})},{title:(0,C.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,C.jsx)(x.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],N=function(e){var t=e.superUser,a=(0,x.useIntl)(),r=(0,Z.useRef)(),s=(0,Z.useState)(1),i=p()(s,2),c=i[0],u=i[1],f=(0,Z.useState)(10),y=p()(f,2),N=y[0],R=y[1],O=(0,v.u)((function(e){return e.currentOrg})),z=(0,Z.useState)([]),U=p()(z,2),B=U[0],P=U[1],L=(0,Z.useState)([]),q=p()(L,2),Y=q[0],H=q[1],_=(0,Z.useState)(0),G=p()(_,2),V=G[0],K=G[1],J=(0,Z.useState)({}),Q=p()(J,2),X=Q[0],W=Q[1],$=[].concat(D,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,r,n){return[(0,C.jsx)("a",{onClick:function(){ee(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,C.jsx)(I.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return te(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,C.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ee=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==O?void 0:O.uid,t:h.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},te=function(){var e=g()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(n=r.current)||void 0===n||n.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=g()(l()().mark((function e(){var t,n,s,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Y.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,n=0,s=d()(Y);try{for(s.s();!(o=s.n()).done;)o.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===n?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:n})),P([]),H([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),re=function(){var e=g()(l()().mark((function e(t,a,r){var n,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(h.LA8),s=o()({orgUid:(null==O?void 0:O.uid)||"",accessToken:n||"",exportType:t},X),"current"===t?(s.pageNumber=String(c-1),s.pageSize=String(N)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,w.kG)()+"/api/v1/thread/rating/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ne=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return re("range",r,a)}})},s=0;s<r;s++)n();return t},se={selectedRowKeys:B,onChange:function(e,t){P(e),H(t)}};return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(S.Z,{columns:$,actionRef:r,cardBordered:!0,rowSelection:se,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(a,r,s){var i,d,c,g,f,p,h,x;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,d=a.pageSize,c=n()(a,E),u(i),R(d),W(c),g=void 0,f=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],g=p,f="ascend"===r[p]?"ascend":"descend"),h=o()(o()({pageNumber:i-1,pageSize:d,orgUid:null==O?void 0:O.uid,superUser:t},c),{},{sortBy:g,sortDirection:f}),e.next=10,M(h);case 10:return x=e.sent,console.log("queryRatesByOrgUid response:",x.data,h),200===x.code?K(x.data.totalElements):m.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"评价记录",toolBarRender:function(){return function(){var e=[],t=[];B.length>0&&t.push({key:"batchDelete",icon:(0,C.jsx)(j.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(B.length,")"),onClick:function(){F.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(B.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ae,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,C.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return re("current")}}];return V>0&&(V<=1e3?r.push({key:"export-all",icon:(0,C.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(V,"条)"),onClick:function(){return re("all")}}):r.push({key:"export-range",icon:(0,C.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(V,"条)"),children:ne(V)})),e.push((0,C.jsx)(T.Z,{menu:{items:r},placement:"bottom",children:(0,C.jsxs)(A.ZP,{icon:(0,C.jsx)(b.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,C.jsx)(k.Z,{})]},"button")},"export")),t.length>0&&e.push((0,C.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,C.jsxs)(A.ZP,{type:B.length>0?"primary":"default",danger:B.length>0,children:[B.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(B.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,C.jsx)(k.Z,{})]})},"batchOperations")),e}()}})})}},74690:function(e,t,a){a.d(t,{Z:function(){return z}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),c=a(90819),l=a.n(c),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(78929),h=a(67794),x=a(89520),M=a(2622),y=a(32157),v=a(91768),w=a(28031),j=a(80503),b=a(99220),k=a(59318),S=a(71589),I=a(59983),F=a(12722),T=a(69755),A=a(61826),Z=a(20374),C=a(44194);function E(e){return D.apply(this,arguments)}function D(){return(D=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,k.request)("/api/v1/thread/summary/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var N=a(19848),R=a(31549),O=["current","pageSize"],z=function(e){var t=e.superUser,a=(0,k.useIntl)(),r=(0,C.useRef)(),s=(0,C.useState)(1),i=p()(s,2),c=i[0],u=i[1],f=(0,C.useState)(10),D=p()(f,2),z=D[0],U=D[1],B=(0,x.u)((function(e){return e.currentOrg})),P=(0,h.Z)().translateString,L=S.Z.useModal(),q=p()(L,2),Y=(q[0],q[1]),H=(0,C.useState)([]),_=p()(H,2),G=(_[0],_[1]),V=(0,C.useState)({}),K=p()(V,2),J=K[0],Q=K[1],X=(0,C.useState)([]),W=p()(X,2),$=W[0],ee=W[1],te=(0,C.useState)([]),ae=p()(te,2),re=ae[0],ne=ae[1],se=(0,C.useState)(0),oe=p()(se,2),ie=oe[0],de=oe[1],ce=(0,C.useState)({}),le=p()(ce,2),ue=le[0],ge=le[1],fe=function(){var e=g()(l()().mark((function e(){var t,r,n,s,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:100,type:M.ics,orgUid:null==B?void 0:B.uid},e.next=4,(0,N.XS)(r);case 4:n=e.sent,console.log("queryCategoriesByOrg response:",n.data,r),200===(null==n?void 0:n.code)&&null!==(t=n.data)&&void 0!==t&&t.content&&(s=n.data.content,G(s),o={},s.forEach((function(e){o[e.uid]=e.name})),Q(o)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Fetch categories error:",e.t0),m.yw.error(a.formatMessage({id:"ticket.category.load.error"}));case 13:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,C.useEffect)((function(){null!=B&&B.uid&&fe()}),[null==B?void 0:B.uid]);var pe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(k.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,R.jsx)(k.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,tooltip:(0,R.jsx)(k.FormattedMessage,{id:"summary.title.tooltip"})},{title:(0,R.jsx)(k.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,tooltip:(0,R.jsx)(k.FormattedMessage,{id:"summary.content.tooltip"})},{title:(0,R.jsx)(k.FormattedMessage,{id:"solution",defaultMessage:"Solution"}),dataIndex:"solution",copyable:!0,tooltip:(0,R.jsx)(k.FormattedMessage,{id:"summary.solution.tooltip"})},{title:(0,R.jsx)(k.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,tooltip:(0,R.jsx)(k.FormattedMessage,{id:"summary.category.tooltip"}),render:function(e,t){var a=J[t.categoryUid]||t.categoryUid;return P(a)}},{title:(0,R.jsx)(k.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,R.jsx)(k.FormattedMessage,{id:"summary.status.tooltip"}),render:function(e,t){var r="",n="";switch(t.status){case M.kA8:r="orange",n=a.formatMessage({id:"summary.status.pending",defaultMessage:"待处理"});break;case M.zvK:r="blue",n=a.formatMessage({id:"summary.status.processing",defaultMessage:"处理中"});break;case M.fuK:r="green",n=a.formatMessage({id:"summary.status.resolved",defaultMessage:"已解决"});break;case M.cin:r="gray",n=a.formatMessage({id:"summary.status.closed",defaultMessage:"已关闭"});break;default:r="default",n=e}return(0,R.jsx)(I.Z,{color:r,children:n})}},{title:(0,R.jsx)(k.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),hideInSearch:!0,tooltip:(0,R.jsx)(k.FormattedMessage,{id:"summary.tags.tooltip"}),render:function(e,t){var a;return null!=t&&t.tagList&&Array.isArray(null==t?void 0:t.tagList)&&0!==(null==t?void 0:t.tagList.length)?(0,R.jsx)(F.Z,{size:[0,4],wrap:!0,children:null==t||null===(a=t.tagList)||void 0===a?void 0:a.map((function(e){return(0,R.jsx)(I.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,R.jsx)(k.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,R.jsx)(k.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],me=[].concat(pe,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,r,n){return[(0,R.jsx)("a",{onClick:function(){he(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,R.jsx)(T.Z,{title:a.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:a.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此总结记录吗？此操作不可恢复!"}),onConfirm:function(){return xe(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,R.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),he=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==B?void 0:B.uid,t:M.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},xe=function(){var e=g()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(n=r.current)||void 0===n||n.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=g()(l()().mark((function e(){var t,n,s,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==re.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,n=0,s=d()(re);try{for(s.s();!(o=s.n()).done;)o.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===n?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:n})),ee([]),ne([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ye=function(){var e=g()(l()().mark((function e(t,a,r){var n,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(M.LA8),s=o()({orgUid:(null==B?void 0:B.uid)||"",accessToken:n||"",exportType:t},ue),"current"===t?(s.pageNumber=String(c-1),s.pageSize=String(z)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,y.kG)()+"/api/v1/thread/summary/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),ve=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ye("range",r,a)}})},s=0;s<r;s++)n();return t},we={selectedRowKeys:$,onChange:function(e,t){ee(e),ne(t)}};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(b.Z,{columns:me,actionRef:r,cardBordered:!0,rowSelection:we,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(a,r,s){var i,d,c,g,f,p,h,x;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,d=a.pageSize,c=n()(a,O),u(i),U(d),ge(c),g=void 0,f=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],g=p,f="ascend"===r[p]?"ascend":"descend"),h=o()(o()({pageNumber:i-1,pageSize:d,orgUid:null==B?void 0:B.uid,superUser:t},c),{},{sortBy:g,sortDirection:f}),e.next=10,E(h);case 10:return x=e.sent,console.log("queryThreadSummariesByOrg response:",x,h),200===x.code?de(x.data.totalElements):m.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread.tab.summary",defaultMessage:"ThreadSummary"}),toolBarRender:function(){return function(){var e=[],t=[];$.length>0&&t.push({key:"batchDelete",icon:(0,R.jsx)(v.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat($.length,")"),onClick:function(){S.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat($.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:Me,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,R.jsx)(w.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ye("current")}}];return ie>0&&(ie<=1e3?r.push({key:"export-all",icon:(0,R.jsx)(w.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ie,"条)"),onClick:function(){return ye("all")}}):r.push({key:"export-range",icon:(0,R.jsx)(w.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ie,"条)"),children:ve(ie)})),e.push((0,R.jsx)(A.Z,{menu:{items:r},placement:"bottom",children:(0,R.jsxs)(Z.ZP,{icon:(0,R.jsx)(w.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,R.jsx)(j.Z,{})]},"button")},"export")),t.length>0&&e.push((0,R.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,R.jsxs)(Z.ZP,{type:$.length>0?"primary":"default",danger:$.length>0,children:[$.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat($.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,R.jsx)(j.Z,{})]})},"batchOperations")),e}()}}),Y]})}},53073:function(e,t,a){a.d(t,{Z:function(){return B}});var r=a(84176),n=a.n(r),s=a(73193),o=a.n(s),i=a(86222),d=a.n(i),c=a(90819),l=a.n(c),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(78929),h=a(59318);function x(e){return M.apply(this,arguments)}function M(){return(M=g()(l()().mark((function e(t){return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/thread/transfer/query/org",{method:"GET",params:o()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var y=a(67794),v=a(89520),w=a(2622),j=a(32157),b=a(91768),k=a(28031),S=a(80503),I=a(99220),F=a(71589),T=a(59983),A=a(69755),Z=a(61826),C=a(20374),E=a(44194),D=a(28977),N=a.n(D),R=a(31549),O=["current","pageSize"],z={TRANSFER_PENDING:{text:"transfer.status.pending",defaultMessage:"转接待处理",color:"blue"},TRANSFER_ACCEPTED:{text:"transfer.status.accepted",defaultMessage:"接受转接",color:"green"},TRANSFER_REJECTED:{text:"transfer.status.rejected",defaultMessage:"拒绝转接",color:"red"},TRANSFER_TIMEOUT:{text:"transfer.status.timeout",defaultMessage:"转接超时",color:"orange"},TRANSFER_CANCELED:{text:"transfer.status.canceled",defaultMessage:"取消转接",color:"gray"}},U={AGENT_TO_AGENT:{text:"transfer.type.agent_to_agent",defaultMessage:"人工转人工",color:"purple"},ROBOT_TO_AGENT:{text:"transfer.type.robot_to_agent",defaultMessage:"机器人转人工",color:"cyan"}},B=function(e){var t=e.superUser,a=(0,h.useIntl)(),r=(0,E.useRef)(),s=(0,E.useState)(1),i=p()(s,2),c=i[0],u=i[1],f=(0,E.useState)(10),M=p()(f,2),D=M[0],B=M[1],P=(0,v.u)((function(e){return e.currentOrg})),L=(0,y.Z)().translateString,q=F.Z.useModal(),Y=p()(q,2),H=(Y[0],Y[1]),_=(0,E.useState)([]),G=p()(_,2),V=G[0],K=G[1],J=(0,E.useState)([]),Q=p()(J,2),X=Q[0],W=Q[1],$=(0,E.useState)(0),ee=p()($,2),te=ee[0],ae=ee[1],re=(0,E.useState)({}),ne=p()(re,2),se=ne[0],oe=ne[1],ie=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,R.jsx)(h.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,ellipsis:!0,fixed:"left"},{title:(0,R.jsx)(h.FormattedMessage,{id:"sender",defaultMessage:"Sender"}),dataIndex:"senderNickname",copyable:!0,ellipsis:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.sender.tooltip"}),render:function(e,t,a,r){var n;return L(null===(n=t.sender)||void 0===n?void 0:n.nickname)}},{title:(0,R.jsx)(h.FormattedMessage,{id:"receiver",defaultMessage:"Receiver"}),dataIndex:"receiverNickname",copyable:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.receiver.tooltip"}),render:function(e,t,a,r){var n;return L(null===(n=t.receiver)||void 0===n?void 0:n.nickname)}},{title:(0,R.jsx)(h.FormattedMessage,{id:"note",defaultMessage:"Note"}),dataIndex:"note",hideInSearch:!0,copyable:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.note.tooltip"})},{title:(0,R.jsx)(h.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,copyable:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.status.tooltip"}),render:function(e,t){var a=t.status,r=z[a]||{text:"transfer.status.unknown",defaultMessage:"未知状态",color:"default"};return(0,R.jsx)(T.Z,{color:r.color,children:(0,R.jsx)(h.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,R.jsx)(h.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,copyable:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.type.tooltip"}),render:function(e,t){var a=t.type,r=U[a]||{text:"transfer.type.unknown",defaultMessage:"未知类型",color:"default"};return(0,R.jsx)(T.Z,{color:r.color,children:(0,R.jsx)(h.FormattedMessage,{id:r.text,defaultMessage:r.defaultMessage})})}},{title:(0,R.jsx)(h.FormattedMessage,{id:"transfer.transferAt",defaultMessage:"转接时间"}),dataIndex:"transferAt",hideInSearch:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.transferAt.tooltip"}),render:function(e,t){return t.transferAt?N()(t.transferAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(h.FormattedMessage,{id:"transfer.acceptAt",defaultMessage:"接受时间"}),dataIndex:"acceptAt",hideInSearch:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.acceptAt.tooltip"}),render:function(e,t){return t.acceptAt?N()(t.acceptAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(h.FormattedMessage,{id:"transfer.cancelAt",defaultMessage:"取消时间"}),dataIndex:"cancelAt",hideInSearch:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.cancelAt.tooltip"}),render:function(e,t){return t.cancelAt?N()(t.cancelAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(h.FormattedMessage,{id:"transfer.rejectAt",defaultMessage:"拒绝时间"}),dataIndex:"rejectAt",hideInSearch:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.rejectAt.tooltip"}),render:function(e,t){return t.rejectAt?N()(t.rejectAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(h.FormattedMessage,{id:"transfer.expireAt",defaultMessage:"超时时间"}),dataIndex:"expireAt",hideInSearch:!0,tooltip:(0,R.jsx)(h.FormattedMessage,{id:"transfer.expireAt.tooltip"}),render:function(e,t){return t.expireAt?N()(t.expireAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,R.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,R.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],de=[].concat(ie,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,r,n){return[(0,R.jsx)("a",{onClick:function(){ce(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,R.jsx)(A.Z,{title:a.formatMessage({id:"delete.tip",defaultMessage:"删除确认"}),description:a.formatMessage({id:"delete.confirm",defaultMessage:"确定要删除此转接记录吗？此操作不可恢复!"}),onConfirm:function(){return le(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,R.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ce=function(e){var t,a;console.log("handleShowChatHistory",e);var r={chatConfig:{org:null==P?void 0:P.uid,t:w.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(r)},le=function(){var e=g()(l()().mark((function e(t){var n;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(n=r.current)||void 0===n||n.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=g()(l()().mark((function e(){var t,n,s,o;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==X.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,n=0,s=d()(X);try{for(s.s();!(o=s.n()).done;)o.value}catch(e){s.e(e)}finally{s.f()}m.yw.destroy(),0===n?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:n})),K([]),W([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ge=function(){var e=g()(l()().mark((function e(t,a,r){var n,s;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,r),n=localStorage.getItem(w.LA8),s=o()({orgUid:(null==P?void 0:P.uid)||"",accessToken:n||"",exportType:t},se),"current"===t?(s.pageNumber=String(c-1),s.pageSize=String(D)):"all"===t?(s.pageNumber="0",s.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==r&&(s.pageNumber=String(a),s.pageSize=String(r)),window.open((0,j.kG)()+"/api/v1/thread/transfer/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),fe=function(e){for(var t=[],a=1e3,r=Math.ceil(e/a),n=function(){var r=s,n=s*a+1,o=Math.min((s+1)*a,e);t.push({key:"export-".concat(s),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return ge("range",r,a)}})},s=0;s<r;s++)n();return t},pe={selectedRowKeys:V,onChange:function(e,t){K(e),W(t)}};return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(I.Z,{columns:de,actionRef:r,cardBordered:!0,rowSelection:pe,scroll:{x:"max-content"},request:function(){var e=g()(l()().mark((function e(a,r,s){var i,d,c,g,f,p,h,M;return l()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,d=a.pageSize,c=n()(a,O),u(i),B(d),oe(c),g=void 0,f=void 0,r&&Object.keys(r).length>0&&(p=Object.keys(r)[0],g=p,f="ascend"===r[p]?"ascend":"descend"),h=o()(o()({pageNumber:i-1,pageSize:d,orgUid:null==P?void 0:P.uid,superUser:t},c),{},{sortBy:g,sortDirection:f}),e.next=10,x(h);case 10:return M=e.sent,console.log("getAllThreadTransfers response:",M,h),200===M.code?ae(M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"thread.tab.transfer",defaultMessage:"ThreadTransfer"}),toolBarRender:function(){return function(){var e=[],t=[];V.length>0&&t.push({key:"batchDelete",icon:(0,R.jsx)(b.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(V.length,")"),onClick:function(){F.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(V.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ue,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,R.jsx)(k.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ge("current")}}];return te>0&&(te<=1e3?r.push({key:"export-all",icon:(0,R.jsx)(k.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(te,"条)"),onClick:function(){return ge("all")}}):r.push({key:"export-range",icon:(0,R.jsx)(k.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(te,"条)"),children:fe(te)})),e.push((0,R.jsx)(Z.Z,{menu:{items:r},placement:"bottom",children:(0,R.jsxs)(C.ZP,{icon:(0,R.jsx)(k.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,R.jsx)(S.Z,{})]},"button")},"export")),t.length>0&&e.push((0,R.jsx)(Z.Z,{menu:{items:t},placement:"bottom",children:(0,R.jsxs)(C.ZP,{type:V.length>0?"primary":"default",danger:V.length>0,children:[V.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(V.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,R.jsx)(S.Z,{})]})},"batchOperations")),e}()}}),H]})}}}]);