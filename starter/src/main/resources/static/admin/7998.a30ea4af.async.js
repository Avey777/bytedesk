"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7998],{83381:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(77260),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=r(5901),i=function(e,t){return o.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var l=o.forwardRef(i)},90092:function(e,t,r){r.d(t,{Z:function(){return l}});var n=r(77260),o=r(44194),a={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M696 480H544V328c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v152H328c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h152v152c0 4.4 3.6 8 8 8h48c4.4 0 8-3.6 8-8V544h152c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"plus-circle",theme:"outlined"},s=r(5901),i=function(e,t){return o.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:a}))};var l=o.forwardRef(i)},91977:function(e,t,r){r.d(t,{Z:function(){return $}});var n=r(73193),o=r.n(n),a=r(90819),s=r.n(a),i=r(89933),l=r.n(i),u=r(45332),c=r.n(u),d=r(52795),f=r(44194),m=r(54338),p=r(31881),g=r(31756),h=r(75699),v=r(81213),y=r(99701),x=r(4363),R=r(57418),w=r(52544),j=r(30234),P=r(83381),M=r(90092),C=r(25191),Z=r(6373),b=r(22766),S=r(12581),k=r(55681),E=r(31549),O=function(e){var t=e.open,r=e.isSuperUser,n=e.isEdit,o=e.role,a=e.onCancel,i=e.onSubmit,u=k.Z.useForm(),d=c()(u,1)[0],m=(0,h.useIntl)(),y=(0,p.u)((function(e){return e.currentOrg}));(0,f.useEffect)((function(){n&&o?d.setFieldsValue({uid:o.uid,name:o.name,description:o.description}):d.resetFields()}),[n,o]);var x=function(){d.validateFields().then(function(){var e=l()(s()().mark((function e(t){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a={uid:n?null==o?void 0:o.uid:"",name:t.name,description:t.description,authorityUids:[],orgUid:null==y?void 0:y.uid,level:r?C.Hxq:C.whQ},i(a);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),g.yw.error(m.formatMessage({id:"role.message.operation.failed"}))}))};return(0,E.jsx)(v.Z,{title:m.formatMessage({id:n?"role.edit.title":"role.create.title"}),open:t,forceRender:!0,onOk:x,onCancel:a,children:(0,E.jsxs)(Z.A,{form:d,name:"roleForm",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,E.jsx)(b.Z,{label:m.formatMessage({id:"role.name"}),name:"name",rules:[{required:!0,message:m.formatMessage({id:"role.name.required"})}],fieldProps:{onPressEnter:function(){d.validateFields(["description"]).then((function(){x()}))}}}),(0,E.jsx)(S.Z,{label:m.formatMessage({id:"role.description"}),name:"description",rules:[{required:!0,message:m.formatMessage({id:"role.description.required"})}],fieldProps:{onPressEnter:function(){x()},autoSize:{minRows:2,maxRows:6}}})]})})},$=function(e){var t=e.isSuperUser,r=(0,h.useIntl)(),n=(0,w.Z)().isDarkMode,a=v.Z.useModal(),i=c()(a,2),u=i[0],Z=i[1],b=(0,j.Z)().translateString,S=(0,f.useState)(!1),k=c()(S,2),$=k[0],z=k[1],F=(0,f.useState)(!1),G=c()(F,2),I=G[0],U=G[1],q=(0,p.u)((function(e){return e.currentOrg})),N=(0,d.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform,insertRole:e.insertRole,insertRolePlatform:e.insertRolePlatform,upgradeRole:e.upgradeRole,upgradeRolePlatform:e.upgradeRolePlatform,currentRole:e.currentRole,currentRolePlatform:e.currentRolePlatform,removeRole:e.removeRole,removeRolePlatform:e.removeRolePlatform,setCurrentRole:e.setCurrentRole,setCurrentRolePlatform:e.setCurrentRolePlatform}})),A=N.roleResult,L=N.roleResultPlatform,W=N.setRoleResult,H=N.setRoleResultPlatform,T=N.insertRole,V=N.insertRolePlatform,_=N.upgradeRole,B=N.upgradeRolePlatform,D=N.removeRole,Q=N.removeRolePlatform,X=N.currentRole,J=N.currentRolePlatform,K=N.setCurrentRole,Y=N.setCurrentRolePlatform,ee=t?J:X,te=function(e){return[C.jGk,C.w7Z,C.nGQ,C.gJI].includes(null==e?void 0:e.uid)||!0===(null==e?void 0:e.system)},re=function(){var e=l()(s()().mark((function e(){var n,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"loading"})),n={pageNumber:0,pageSize:100,orgUid:t?"":null==q?void 0:q.uid,level:t?C.Hxq:C.whQ},e.next=4,(0,m.E9)(n);case 4:o=e.sent,console.log("queryRolesByOrg response: ",o.data,n),200===o.code?(g.yw.destroy(),t?(H(o),""===(null==J?void 0:J.uid)&&o.data.content.length>0&&Y(o.data.content[0])):(W(o),""===(null==X?void 0:X.uid)&&o.data.content.length>0&&K(o.data.content[0]))):(g.yw.destroy(),g.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,f.useEffect)((function(){re()}),[]);var ne=function(){var e=l()(s()().mark((function e(n){var a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"creating"})),e.next=3,(0,m.fA)(o()({},n));case 3:200===(a=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"create.success"})),z(!1),t?(V(a.data),Y(a.data)):(T(a.data),K(a.data))):(g.yw.destroy(),g.yw.error(a.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),oe=function(){var e=l()(s()().mark((function e(n){var o,a,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a={uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,description:null==n?void 0:n.description,authorityUids:(null==n||null===(o=n.authorities)||void 0===o?void 0:o.map((function(e){return e.uid})))||[],system:t},g.yw.loading(r.formatMessage({id:"updating"})),e.next=4,(0,m.ul)(a);case 4:200===(i=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"update.success"})),t?B(i.data):_(i.data),z(!1)):(g.yw.destroy(),g.yw.error(i.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=l()(s()().mark((function e(n){var o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(r.formatMessage({id:"deleting"})),e.next=3,(0,m.Rd)(n);case 3:200===(o=e.sent).code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"delete.success"})),t?Q(n.uid):D(n.uid),z(!1),re()):(g.yw.destroy(),g.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),se=t?L.data.content:A.data.content;return(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(y.Z,{gap:"small",wrap:"wrap",style:{padding:"10px"},children:[(0,E.jsx)(x.ZP,{type:"primary",size:"small",icon:(0,E.jsx)(M.Z,{}),onClick:function(){U(!1),z(!0)},children:r.formatMessage({id:"create"})}),(0,E.jsx)(x.ZP,{size:"small",onClick:re,children:r.formatMessage({id:"refresh"})}),!te(ee)&&(null==ee?void 0:ee.uid)&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(x.ZP,{size:"small",onClick:function(){te(ee)?g.yw.error(r.formatMessage({id:"role.system.noedit"})):(U(!0),z(!0))},children:r.formatMessage({id:"edit"})}),(0,E.jsx)(x.ZP,{onClick:function(){return function(e){te(e)?g.yw.error(r.formatMessage({id:"role.system.nodelete"})):u.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,E.jsx)(P.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm"}),"【").concat(b(e.name),"】？"),onOk:function(){ae(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})})}(ee)},size:"small",style:{float:"right"},danger:!0,children:r.formatMessage({id:"delete"})})]})]}),(0,E.jsx)(R.Z,{dataSource:se,renderItem:function(e){return(0,E.jsx)(R.Z.Item,{style:{backgroundColor:(null==ee?void 0:ee.uid)===e.uid?n?"#333333":"#dddddd":void 0,cursor:"pointer"},onClick:function(){return r=e,void(t?Y(r):K(r));var r},children:(0,E.jsx)(R.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,E.jsx)(E.Fragment,{children:b(e.name)}),description:b(e.description)})},e.uid)}}),$&&(0,E.jsx)(O,{open:$,isSuperUser:t,isEdit:I,role:ee,onCancel:function(){z(!1)},onSubmit:function(e){I?oe(e):ne(e)}}),Z]})}},57935:function(e,t,r){r.d(t,{Z:function(){return S}});var n=r(44194),o=r(90962),a=r(73193),s=r.n(a),i=r(76711),l=r.n(i),u=r(90819),c=r.n(u),d=r(89933),f=r.n(d),m=r(45332),p=r.n(m),g=r(31756),h=r(25191),v=r(75699);function y(e){return x.apply(this,arguments)}function x(){return(x=f()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/authority/query/org",{method:"GET",params:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=r(30234),w=r(52795),j=r(51438),P=r(94045),M=r(54338),C=r(31549),Z={width:"20%",textAlign:"center"},b=function(e){var t=e.isSuperUser,r=(0,v.useIntl)(),o=(0,R.Z)().translateString,a=(0,n.useState)({uid:""}),i=p()(a,2),u=i[0],d=i[1],m=(0,w.Z)((function(e){return{upgradeRole:e.upgradeRole,currentRole:e.currentRole,setCurrentRole:e.setCurrentRole,currentRolePlatform:e.currentRolePlatform,setCurrentRolePlatform:e.setCurrentRolePlatform}})),x=m.upgradeRole,b=m.currentRole,S=m.setCurrentRole,k=m.currentRolePlatform,E=m.setCurrentRolePlatform,O=(0,n.useState)([]),$=p()(O,2),z=$[0],F=$[1],G=(0,n.useState)(b.authorities),I=p()(G,2),U=I[0],q=I[1],N=function(){var e=f()(c()().mark((function e(){var t,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t={pageNumber:0,pageSize:100,level:h.Hxq},e.next=3,y(t);case 3:r=e.sent,console.log("getAuthorities response",r),200===r.code?F(r.data.content):(console.log("getAuthorities error",r),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),A=z.reduce((function(e,t){var r=t.name.split("_"),n=p()(r,1)[0];return e[n]||(e[n]=[]),e[n].push(t),e}),{});(0,n.useEffect)((function(){t?(d(k),q(k.authorities)):(d(b),q(b.authorities))}),[b,k,t]),(0,n.useEffect)((function(){N()}),[]);var L=function(e){return e.some((function(e){return U.some((function(t){return t.name===e.name}))}))},W=function(){var e=f()(c()().mark((function e(t){var n,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n={uid:t.uid,name:t.name,description:t.description,authorityUids:t.authorities.map((function(e){return e.uid}))},console.log("handleUpdateRole authority:",n),g.yw.loading(r.formatMessage({id:"updating"})),e.next=5,(0,M.ul)(n);case 5:o=e.sent,console.log("updateRole:",o),200===o.code?(g.yw.destroy(),g.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),x(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,C.jsx)(C.Fragment,{children:Object.keys(A).map((function(e){return(0,C.jsx)(j.Z,{title:(0,C.jsx)(P.Z,{checked:(r=A[e],r.every((function(e){return U.some((function(t){return t.name===e.name}))}))),indeterminate:L(A[e]),onChange:function(r){return function(e,r){var n,o=A[e];r?(n=l()(U),o.forEach((function(e){n.some((function(t){return t.name===e.name}))||n.push(e)}))):n=U.filter((function(e){return!o.some((function(t){return t.name===e.name}))})),q(n),t?(E(s()(s()({},k),{},{authorities:n})),W(s()(s()({},k),{},{authorities:n}))):(S(s()(s()({},b),{},{authorities:n})),W(s()(s()({},b),{},{authorities:n})))}(e,r.target.checked)},disabled:(null==u?void 0:u.system)||""===(null==u?void 0:u.uid),children:o(e)}),style:{marginTop:10},children:A[e].map((function(e){return(0,C.jsx)(j.Z.Grid,{style:Z,children:(0,C.jsx)(P.Z,{checked:null==U?void 0:U.some((function(t){return t.name===e.name})),disabled:!0,children:o(e.name)})},e.name)}))},e);var r}))})},S=function(e){var t=e.isSuperUser,r=[{key:"authority",label:"权限",children:(0,C.jsx)(b,{isSuperUser:t})}];return(0,C.jsx)(C.Fragment,{children:(0,C.jsx)(o.Z,{defaultActiveKey:"1",items:r,onChange:function(e){console.log(e)}})})}},53128:function(e,t,r){var n=r(52544);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},30234:function(e,t,r){var n=r(25191),o=r(32057),a=r(75699);t.Z=function(){var e=(0,a.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,o.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,o.aS)(t,10)}}}},99701:function(e,t,r){r.d(t,{Z:function(){return P}});var n=r(44194),o=r(51865),a=r.n(o),s=r(21762),i=r(80635),l=r(72329),u=r(20054),c=r(10750);const d=["wrap","nowrap","wrap-reverse"],f=["flex-start","flex-end","start","end","center","space-between","space-around","space-evenly","stretch","normal","left","right"],m=["center","start","end","flex-start","flex-end","self-start","self-end","baseline","normal","stretch"];var p=function(e,t){return a()(Object.assign(Object.assign(Object.assign({},((e,t)=>{const r=!0===t.wrap?"wrap":t.wrap;return{[`${e}-wrap-${r}`]:r&&d.includes(r)}})(e,t)),((e,t)=>{const r={};return m.forEach((n=>{r[`${e}-align-${n}`]=t.align===n})),r[`${e}-align-stretch`]=!t.align&&!!t.vertical,r})(e,t)),((e,t)=>{const r={};return f.forEach((n=>{r[`${e}-justify-${n}`]=t.justify===n})),r})(e,t)))};const g=e=>{const{componentCls:t}=e;return{[t]:{display:"flex",margin:0,padding:0,"&-vertical":{flexDirection:"column"},"&-rtl":{direction:"rtl"},"&:empty":{display:"none"}}}},h=e=>{const{componentCls:t}=e;return{[t]:{"&-gap-small":{gap:e.flexGapSM},"&-gap-middle":{gap:e.flexGap},"&-gap-large":{gap:e.flexGapLG}}}},v=e=>{const{componentCls:t}=e,r={};return d.forEach((e=>{r[`${t}-wrap-${e}`]={flexWrap:e}})),r},y=e=>{const{componentCls:t}=e,r={};return m.forEach((e=>{r[`${t}-align-${e}`]={alignItems:e}})),r},x=e=>{const{componentCls:t}=e,r={};return f.forEach((e=>{r[`${t}-justify-${e}`]={justifyContent:e}})),r};var R=(0,u.I$)("Flex",(e=>{const{paddingXS:t,padding:r,paddingLG:n}=e,o=(0,c.IX)(e,{flexGapSM:t,flexGap:r,flexGapLG:n});return[g(o),h(o),v(o),y(o),x(o)]}),(()=>({})),{resetStyle:!1}),w=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(r[n[o]]=e[n[o]])}return r};const j=n.forwardRef(((e,t)=>{const{prefixCls:r,rootClassName:o,className:u,style:c,flex:d,gap:f,vertical:m=!1,component:g="div"}=e,h=w(e,["prefixCls","rootClassName","className","style","flex","gap","vertical","component"]),{flex:v,direction:y,getPrefixCls:x}=n.useContext(l.E_),j=x("flex",r),[P,M,C]=R(j),Z=null!=m?m:null==v?void 0:v.vertical,b=a()(u,o,null==v?void 0:v.className,j,M,C,p(j,e),{[`${j}-rtl`]:"rtl"===y,[`${j}-gap-${f}`]:(0,i.n)(f),[`${j}-vertical`]:Z}),S=Object.assign(Object.assign({},null==v?void 0:v.style),c);return d&&(S.flex=d),f&&!(0,i.n)(f)&&(S.gap=f),P(n.createElement(g,Object.assign({ref:t,className:b,style:S},(0,s.Z)(h,["justify","wrap","align"]))))}));var P=j}}]);