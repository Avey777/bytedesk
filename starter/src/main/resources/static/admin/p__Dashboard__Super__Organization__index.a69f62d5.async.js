"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{59908:function(e,r,t){t.d(r,{Z:function(){return l}});var a=t(73743),n=t(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=t(54183),i=function(e,r){return n.createElement(s.Z,(0,a.Z)({},e,{ref:r,icon:o}))};var l=n.forwardRef(i)},17026:function(e,r,t){t.d(r,{Z:function(){return C}});var a=t(7657),n=t(75101),o=t(44194),s=t(29656),i=t(47563),l=t(31549),u=["proFieldProps","fieldProps"],d="date",c=o.forwardRef((function(e,r){var t=e.proFieldProps,c=e.fieldProps,f=(0,n.Z)(e,u),p=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:d,fieldProps:(0,a.Z)({getPopupContainer:p.getPopupContainer},c),proFieldProps:t,filedConfig:{valueType:d,customLightMode:!0}},f))})),f=["proFieldProps","fieldProps"],p="dateMonth",g=o.forwardRef((function(e,r){var t=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,f),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:p,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:t,filedConfig:{valueType:p,customLightMode:!0}},d))})),m=["fieldProps"],h="dateQuarter",v=o.forwardRef((function(e,r){var t=e.fieldProps,u=(0,n.Z)(e,m),d=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:h,fieldProps:(0,a.Z)({getPopupContainer:d.getPopupContainer},t),filedConfig:{valueType:h,customLightMode:!0}},u))})),y=["proFieldProps","fieldProps"],x="dateWeek",M=o.forwardRef((function(e,r){var t=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,y),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:x,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:t,filedConfig:{valueType:x,customLightMode:!0}},d))})),b=["proFieldProps","fieldProps"],w="dateYear",Z=o.forwardRef((function(e,r){var t=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,b),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:w,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:t,filedConfig:{valueType:w,customLightMode:!0}},d))})),j=c;j.Week=M,j.Month=g,j.Quarter=v,j.Year=Z,j.displayName="ProFormComponent";var C=j},7956:function(e,r,t){var a=t(7657),n=t(75101),o=t(21091),s=t(44194),i=t(29656),l=t(47563),u=t(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,r){var t=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,h=e.request,v=e.showSearch,y=e.options,x=(0,n.Z)(e,d),M=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(m),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:y,mode:g,showSearch:v,getPopupContainer:M.getPopupContainer},t),ref:r,proFieldProps:p},x),{},{children:c}))},p=s.forwardRef((function(e,r){var t=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,h=e.request,v=e.options,y=(0,n.Z)(e,c),x=(0,a.Z)({options:v,mode:g||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},t),M=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(m),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:M.getPopupContainer},x),ref:r,proFieldProps:p},y),{},{children:d}))})),g=s.forwardRef(f);g.SearchSelect=p,g.displayName="ProFormComponent",r.Z=g},65511:function(e,r,t){var a=t(7657),n=t(75101),o=t(44194),s=t(47563),i=t(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=o.forwardRef((function(e,r){var t=e.fieldProps,o=e.unCheckedChildren,u=e.checkedChildren,d=e.proFieldProps,c=(0,n.Z)(e,l);return(0,i.jsx)(s.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:o,checkedChildren:u},t),ref:r,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));r.Z=u},44517:function(e,r,t){var a=t(7657),n=t(75101),o=t(44194),s=t(47563),i=t(31549),l=["fieldProps","proFieldProps"],u=function(e,r){var t=e.fieldProps,o=e.proFieldProps,u=(0,n.Z)(e,l);return(0,i.jsx)(s.Z,(0,a.Z)({ref:r,valueType:"textarea",fieldProps:t,proFieldProps:o},u))};r.Z=o.forwardRef(u)},52380:function(e,r,t){t.d(r,{A8:function(){return c},FR:function(){return b},Kq:function(){return p},RL:function(){return v},c5:function(){return m},jM:function(){return x}});var a=t(90819),n=t.n(a),o=t(73193),s=t.n(o),i=t(89933),l=t.n(i),u=t(18232),d=t(43906);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/query",{method:"GET",params:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/create",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/create/by/super",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/update",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/update/by/super",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/delete",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},71208:function(e,r,t){t.d(r,{G:function(){return f}});var a=t(73193),n=t.n(a),o=(t(44194),t(50220)),s=t(18232),i=t(28977),l=t.n(i),u=t(55567),d=t(81343),c=t(31549),f=function(e){var r=e.children,t=e.onSuccess,a=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:s.IrL,categoryUid:"",kbUid:"",channel:s.XtJ},f={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var r=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=r,i.fileType=e.type,console.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var r=e.file.response.data.fileUrl;t(r),u.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,c.jsx)(o.Z,n()(n()({},f),{},{children:r}))}},40144:function(e,r,t){var a=t(14458);r.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},87511:function(e,r,t){t.r(r),t.d(r,{default:function(){return ae}});var a=t(40144),n=t(398),o=t(44194),s=t(45516),i=t(73193),l=t.n(i),u=t(84176),d=t.n(u),c=t(90819),f=t.n(c),p=t(89933),g=t.n(p),m=t(45332),h=t.n(m),v=t(55567),y=t(43848),x=t(10162),M=t(46336),b=t(1867),w=t(30915),Z=t(34353),j=t(76711),C=t.n(j),P=t(9942),S=t(48792),k=t(59993),F=t(44517),R=t(65511),T=t(17026),D=t(7956),I=t(88638),E=t(75843),z=t(99898),U=t(60762),A=t(99098),L=t(22578),Y=t(77259),q=t(43906),O=t(71208),B=t(59908),N=t(89222),H=t(31549),J=function(e){var r,t,a,n=e.isEdit,s=e.org,i=e.open,u=e.onClose,d=e.onSubmit,c=I.Z.useForm(),p=h()(c,1)[0],m=(0,q.useIntl)(),y=(0,P.u)((function(e){return e.currentOrg})),x=(0,o.useState)(""),M=h()(x,2),b=M[0],w=M[1],j=(0,o.useState)([]),J=h()(j,2),V=J[0],X=J[1];(0,o.useEffect)((function(){var e;n?p.setFieldsValue({name:null==s?void 0:s.name,logo:null==s?void 0:s.logo,code:null==s?void 0:s.code,description:null==s?void 0:s.description,verifiedType:null==s?void 0:s.verifiedType,identityType:null==s?void 0:s.identityType,identityImage:null==s?void 0:s.identityImage,identityNumber:null==s?void 0:s.identityNumber,verifyDate:null==s?void 0:s.verifyDate,verifyStatus:null==s?void 0:s.verifyStatus,rejectReason:null==s?void 0:s.rejectReason,vip:null==s?void 0:s.vip,vipExpireDate:null==s?void 0:s.vipExpireDate,userUid:null==s||null===(e=s.user)||void 0===e?void 0:e.uid,enabled:!1!==(null==s?void 0:s.enabled)}):(p.resetFields(),p.setFieldsValue({verifyStatus:"未认证",vip:!1,enabled:!0}))}),[i]),(0,o.useEffect)((function(){null!=s&&s.logo?w(s.logo):w("")}),[null==s?void 0:s.logo]),(0,o.useEffect)((function(){var e=function(){var e=g()(f()().mark((function e(){var r;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!i||null==y||!y.uid){e.next=4;break}return e.next=3,K();case 3:n&&null!=s&&s.user&&(r={label:"".concat(s.user.nickname||s.user.username," (").concat(s.user.mobile||s.user.email,") - 当前管理员"),value:s.user.uid},X((function(e){return e.some((function(e){return e.value===r.value}))?e:[r].concat(C()(e))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[i,null==y?void 0:y.uid,n,null==s?void 0:s.user]);var W,G,K=function(){var e=g()(f()().mark((function e(r){var t,a,n,o,s;return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:0,pageSize:20,searchText:r||"",orgUid:null==y?void 0:y.uid},console.log("Loading users with params:",a),e.next=5,(0,N.pz)(a);case 5:if(n=e.sent,console.log("loadUsers response:",n),200!==n.code||null===(t=n.data)||void 0===t||!t.content){e.next=15;break}return o=n.data.content.filter((function(e){var r=e.currentOrganization&&e.currentOrganization.uid;return r&&console.log("User ".concat(e.nickname||e.username," already has organization:"),e.currentOrganization.name),!r})),s=o.map((function(e){return{label:"".concat(e.nickname||e.username," (").concat(e.mobile||e.email,")"),value:e.uid}})),console.log("Total users:",n.data.content.length),console.log("Available users (no organization):",o.length),console.log("Generated user options:",s),X(s),e.abrupt("return",s);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Load users error:",e.t0);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(r){return e.apply(this,arguments)}}();return(0,H.jsx)(E.Z,{title:n?(0,H.jsx)(q.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,H.jsx)(q.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:u,open:i,width:600,extra:(0,H.jsxs)(z.Z,{children:[(0,H.jsx)(Z.ZP,{onClick:u,children:(0,H.jsx)(q.FormattedMessage,{id:"pages.common.cancel"})}),(0,H.jsx)(Z.ZP,{onClick:function(){p.validateFields().then((function(e){d(l()(l()(l()({},s),e),{},{logo:b,orgUid:null==y?void 0:y.uid}))})).catch((function(e){console.log("Form errors:",e),v.yw.error(m.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,H.jsx)(q.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,H.jsxs)(S.A,{form:p,submitter:!1,children:[(0,H.jsx)(k.Z,{name:"name",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:m.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,H.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,H.jsx)("div",{style:{marginBottom:"8px"},children:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"})}),(0,H.jsxs)(U.Z,{gutter:[16,16],align:"middle",children:[(0,H.jsx)(A.Z,{children:(0,H.jsx)(L.Z,{src:b,size:64,style:{border:"2px solid #d9d9d9",backgroundColor:"#f5f5f5"}})}),(0,H.jsx)(A.Z,{children:(0,H.jsx)(O.G,{onSuccess:function(e){console.log("handleLogoUploadSuccess:",e),w(e),p.setFieldValue("logo",e)},onError:function(e){console.log("handleLogoUploadError:",e)},children:(0,H.jsx)(Z.ZP,{type:"primary",icon:(0,H.jsx)(B.Z,{}),size:"small",children:m.formatMessage({id:"pages.org.logo.upload",defaultMessage:"上传Logo"})})})})]})]}),(0,H.jsx)(k.Z,{name:"code",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:m.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,H.jsx)(F.Z,{name:"description",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:m.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),(0,H.jsx)(R.Z,{name:"vip",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.vip",defaultMessage:"会员状态"}),checkedChildren:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.vip.yes",defaultMessage:"是"}),unCheckedChildren:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.vip.no",defaultMessage:"否"})}),(0,H.jsx)(T.Z,{name:"vipExpireDate",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.vipExpireDate",defaultMessage:"会员过期时间"}),placeholder:m.formatMessage({id:"pages.org.vipExpireDate.placeholder",defaultMessage:"请选择会员过期时间"}),fieldProps:{showTime:!1,format:"YYYY-MM-DD",showToday:!0},transform:function(e){if(e){var r=new Date(e);return r.setHours(0,0,0,0),r.toISOString()}return e}}),(0,H.jsx)(D.Z,{name:"userUid",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.admin",defaultMessage:"管理员"}),placeholder:m.formatMessage({id:"pages.org.admin.placeholder",defaultMessage:"请选择组织管理员"}),showSearch:!0,allowClear:!0,disabled:!0===(null==s||null===(r=s.user)||void 0===r?void 0:r.superUser),fieldProps:{showSearch:!0,filterOption:!1,onSearch:(G=g()(f()().mark((function e(r){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Searching for:",r),e.next=3,K(r);case 3:case"end":return e.stop()}}),e)}))),function(e){return G.apply(this,arguments)}),onFocus:(W=g()(f()().mark((function e(){return f()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Focus on user select"),e.next=3,K();case 3:case"end":return e.stop()}}),e)}))),function(){return W.apply(this,arguments)}),options:V}}),(0,H.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"-8px",marginBottom:"16px"},children:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.admin.tip",defaultMessage:"只显示未分配组织的用户，避免覆盖现有组织关系"})}),(0,H.jsx)(R.Z,{name:"enabled",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.enabled",defaultMessage:"状态"}),checkedChildren:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.status.disabled",defaultMessage:"禁用"}),disabled:!0===(null==s||null===(t=s.user)||void 0===t?void 0:t.superUser),transform:function(e){return!1!==e},fieldProps:{checked:!1!==(null==s?void 0:s.enabled),title:!0===(null==s||null===(a=s.user)||void 0===a?void 0:a.superUser)?m.formatMessage({id:"pages.org.superUser.disabled",defaultMessage:"超级用户组织不允许禁用"}):void 0}}),(0,H.jsx)(Y.Z,{defaultActiveKey:[],items:[{key:"1",label:"认证信息",children:(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(D.Z,{name:"verifiedType",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:[{label:"企业认证",value:"企业认证"},{label:"个人认证",value:"个人认证"},{label:"政府事业单位认证",value:"政府事业单位认证"}],placeholder:m.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,H.jsx)(D.Z,{name:"identityType",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:[{label:"营业执照",value:"营业执照"},{label:"身份证",value:"身份证"},{label:"护照",value:"护照"},{label:"其他",value:"其他"}],placeholder:m.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,H.jsx)(k.Z,{name:"identityImage",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:m.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"})}),(0,H.jsx)(k.Z,{name:"identityNumber",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:m.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,H.jsx)(k.Z,{name:"verifyDate",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.verifyDate",defaultMessage:"认证时间"}),placeholder:m.formatMessage({id:"pages.org.verifyDate.placeholder",defaultMessage:"请输入认证时间"})}),(0,H.jsx)(D.Z,{name:"verifyStatus",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:[{label:"未认证",value:"未认证"},{label:"已认证",value:"已认证"},{label:"审核中",value:"审核中"},{label:"审核失败",value:"审核失败"}],placeholder:m.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,H.jsx)(F.Z,{name:"rejectReason",label:(0,H.jsx)(q.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:m.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})}]})]})})},V=t(1738),X=t(58181),W=t(28619),G=t(28977),K=t.n(G),Q=t(18232),_=t(52380),$=t(10266),ee=["current","pageSize"],re=function(){var e=(0,q.useIntl)(),r=(0,o.useRef)(),t=(0,W.Z)().translateString,a=(0,o.useState)(!0),n=h()(a,2),s=n[0],i=n[1],u=(0,o.useState)(),c=h()(u,2),p=c[0],m=c[1],j=(0,o.useState)(!1),C=h()(j,2),S=C[0],k=C[1],F=(0,o.useState)(1),R=h()(F,2),T=(R[0],R[1]),D=(0,o.useState)(10),I=h()(D,2),E=I[0],z=I[1],U=(0,P.u)((function(e){return e.currentOrg})),A=(0,X.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),L=A.setRoleResult,Y=A.setRoleResultPlatform,O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0,fixed:"left"},{title:e.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,r){return r.logo?(0,H.jsx)("img",{src:r.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:e.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:e.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0},{title:e.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,r){return(0,$._i)(r.verifiedType)}},{title:e.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,r){return(0,$.Cy)(r.verifyStatus)}},{title:e.formatMessage({id:"pages.org.verifyDate"}),dataIndex:"verifyDate",hideInSearch:!0,width:180,render:function(e,r){return r.verifyDate?K()(r.verifyDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.vip"}),dataIndex:"vip",hideInSearch:!0,render:function(r,t){return t.vip?e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.org.vipExpireDate"}),dataIndex:"vipExpireDate",hideInSearch:!0,width:180,render:function(e,r){return r.vipExpireDate?K()(r.vipExpireDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(r,t){return!1===t.enabled?e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}):e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.org.admin",defaultMessage:"管理员"}),dataIndex:"user",hideInSearch:!0,render:function(e,r){return r.user?(0,H.jsxs)("div",{children:[(0,H.jsx)("div",{children:r.user.nickname||r.user.username}),(0,H.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:r.user.email})]}):"-"}},{title:e.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.createdAt?K()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.updatedAt?K()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],B=[].concat(O,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(r,t,a,n){var s,i=!0===(null===(s=t.user)||void 0===s?void 0:s.superUser);return[(0,H.jsx)("a",{onClick:function(){re(t)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!i&&(0,H.jsxs)(o.Fragment,{children:[(0,H.jsx)(b.Z,{type:"vertical"},"divider"),(0,H.jsx)(w.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:t.name||t.code}),onConfirm:function(){return te(t)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,H.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")].filter(Boolean)}}]),N=(0,V.v)((function(e){return e.currentCategory})),G=function(){m(void 0),i(!1),k(!0)},re=function(e){m(e),i(!0),k(!0)},te=function(){var a=g()(f()().mark((function a(n){var o,s,i;return f()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!0!==(null===(o=n.user)||void 0===o?void 0:o.superUser)){a.next=3;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDelete",defaultMessage:"超级用户组织不允许删除"})),a.abrupt("return");case 3:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),a.prev=4,a.next=7,(0,_.FR)({uid:n.uid});case 7:s=a.sent,v.yw.destroy(),200===s.code?(v.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=r.current)||void 0===i||i.reloadAndRest()):v.yw.error(t(s.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),a.next=17;break;case 12:a.prev=12,a.t0=a.catch(4),v.yw.destroy(),v.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete org error:",a.t0);case 17:case"end":return a.stop()}}),a,null,[[4,12]])})));return function(e){return a.apply(this,arguments)}}(),ae=function(){var t=g()(f()().mark((function t(a){var n,o,i;return f()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",a),!s||!0!==(null==p||null===(n=p.user)||void 0===n?void 0:n.superUser)||!1!==a.enabled){t.next=4;break}return v.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDisable",defaultMessage:"超级用户组织不允许禁用"})),t.abrupt("return");case 4:if(s?v.yw.loading(e.formatMessage({id:"updating"})):v.yw.loading(e.formatMessage({id:"creating"})),!s){t.next=11;break}return t.next=8,(0,_.jM)(a);case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,(0,_.c5)(a);case 13:t.t0=t.sent;case 14:o=t.t0,console.log("createOrg response:",a,o),200===o.code?(v.yw.destroy(),v.yw.success(s?e.formatMessage({id:"update.success",defaultMessage:"Update successful"}):e.formatMessage({id:"create.success",defaultMessage:"Create successful"})),k(!1),null===(i=r.current)||void 0===i||i.reloadAndRest()):(v.yw.destroy(),v.yw.error(o.message));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ne=function(){var r=g()(f()().mark((function r(){var t,a;return f()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,orgUid:null==U?void 0:U.uid},r.next=4,(0,y.E9)(t);case 4:a=r.sent,console.log("queryRolesByOrg response ",a),200===a.code?(v.yw.destroy(),L(a)):(v.yw.destroy(),v.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),oe=function(){var r=g()(f()().mark((function r(){var t,a;return f()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,level:Q.Hxq},r.next=4,(0,y.E9)(t);case 4:a=r.sent,console.log("queryRolesBySuper response ",a),200===a.code?(v.yw.destroy(),Y(a)):(v.yw.destroy(),v.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return(0,o.useEffect)((function(){ne(),oe()}),[]),(0,o.useEffect)((function(){var e;console.log("currentCategory:",N),null===(e=r.current)||void 0===e||e.reloadAndRest()}),[N]),(0,H.jsxs)(H.Fragment,{children:[(0,H.jsx)(M.Z,{columns:B,actionRef:r,cardBordered:!0,scroll:{x:"max-content"},request:function(){var r=g()(f()().mark((function r(a,n,o){var s,i,u,c,p;return f()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("request:",a,n,o),v.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,i=a.pageSize,u=d()(a,ee),T(s),z(i),c=l()({pageNumber:s-1,pageSize:i},u),r.next=8,(0,_.A8)(c);case 8:return p=r.sent,console.log("getAllOrgs response:",c,p),v.yw.destroy(),200===p.code||v.yw.error(t(p.message)),r.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 13:case"end":return r.stop()}}),r)})));return function(e,t,a){return r.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:E,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,r){console.log("pagination onChange:",e,r),T(e),z(r)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[(0,H.jsx)(Z.ZP,{icon:(0,H.jsx)(x.Z,{}),type:"primary",onClick:G,children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button")]}}),S&&(0,H.jsx)(J,{isEdit:s,open:S,org:p,onClose:function(){k(!1)},onSubmit:ae})]})},te=n.Z.Content,ae=function(){(0,s.s0)();var e=(0,a.Z)().contentStyle;return(0,H.jsx)(n.Z,{children:(0,H.jsx)(n.Z,{children:(0,H.jsx)(te,{style:e,children:(0,H.jsx)(re,{})})})})}},1738:function(e,r,t){t.d(r,{v:function(){return c}});var a=t(76711),n=t.n(a),o=t(73193),s=t.n(o),i=t(18232),l=t(16894),u=t(45034),d=t(47401);var c=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,d.n)((function(e,r){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(r){var t=function(e){var r=[];return e.data.content.forEach((function(e){var t={label:e.name,value:e.uid};r.push(t)})),r}(r),a={uid:i.zBg,name:i.zBg},o=s()(s()({},r),{},{data:s()(s()({},r.data),{},{content:[a].concat(n()(r.data.content))})}),l=function(e){var r=[];return e.data.content.forEach((function(e){var t={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(t.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),r.push(t)})),r}(o);e({categoryResult:o,categoryTreeOptions:l,categorySelectOptions:t}),0===r.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(r){e((function(e){e.categoryResult.data.content.unshift(r)}))},upgradeCategory:function(r){e((function(e){var t=e.categoryResult.data.content,a=t.findIndex((function(e){return e.uid===r.uid}));-1!==a?t[a]=r:console.warn("Category with uid ".concat(r.uid," not found."))}))},setCurrentCategory:function(r){e({currentCategory:r})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(t){var a=r().categoryResult.data.content.find((function(e){return e.uid===t}));e({currentCategory:a})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))}}]);