"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1065],{42298:function(e,t,a){a.r(t);var i=a(90819),s=a.n(i),n=a(89933),r=a.n(n),o=a(45332),l=a.n(o),c=a(44194),d=a(41123),u=a(34251),f=a(71373),m=a(63065),g=a(43413),k=a(10337),p=a(77407),x=a(5858),v=a(9248),y=a(14318),h=a(68525),j=a(35911),b=a(33e3),M=a(12201),w=a(16829),Z=a(14546),T=a(75699),Y=a(61628),R=a(31756),D=a(31881),S=a(76001),C=a(7999),F=a(30234),O=a(25191),I=a(28977),z=a.n(I),B=a(89295),E=a(54693),U=a(31549),P=d.default.RangePicker,W=u.Z.Option;t.default=function(){var e,t,a=(0,T.useIntl)(),i=(0,F.Z)().translateStringTranct,n=(0,c.useState)(z()().startOf("day")),o=l()(n,2),d=o[0],I=o[1],H=(0,c.useState)(z()().endOf("day")),L=l()(H,2),A=L[0],N=L[1],Q=(0,c.useState)("today"),q=l()(Q,2),G=q[0],_=q[1],J=(0,c.useState)(O.whQ),K=l()(J,2),V=K[0],X=K[1],$=(0,c.useState)(),ee=l()($,2),te=ee[0],ae=ee[1],ie=(0,c.useState)(),se=l()(ie,2),ne=se[0],re=se[1],oe=(0,D.u)((function(e){return e.currentOrg})),le=(0,S.E)((function(e){return e})),ce=le.agentResult,de=le.setAgentResult,ue=(0,E.H)((function(e){return e})),fe=ue.departmentResult,me=ue.setDepartmentResult,ge=(0,c.useState)(),ke=l()(ge,2),pe=ke[0],xe=ke[1],ve=(0,c.useState)(!1),ye=l()(ve,2),he=ye[0],je=ye[1],be=[{label:(0,U.jsx)(T.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,U.jsx)(T.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,U.jsx)(T.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,U.jsx)(T.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,U.jsx)(T.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,U.jsx)(T.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,c.useEffect)((function(){if("custom"===G)I(d),N(A);else{var e=z()();"today"===G?(I(e),N(e)):"yesterday"===G?(I(e.subtract(1,"day")),N(e.subtract(1,"day"))):"week"===G?(I(e.startOf("week")),N(e.endOf("week"))):"lastWeek"===G?(I(e.subtract(1,"week").startOf("week")),N(e.subtract(1,"week").endOf("week"))):"month"===G&&(I(e.startOf("month")),N(e.endOf("month")))}}),[G]);var Me=function(){var e=r()(s()().mark((function e(){var t,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==oe?void 0:oe.uid},e.next=4,(0,B.dF)(t);case 4:200===(a=e.sent).code?(R.yw.destroy(),me(a),a.data.content.length>0&&re(a.data.content[0].uid)):(R.yw.destroy(),R.yw.error(a.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),we=function(){var e=r()(s()().mark((function e(){var t,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==oe?void 0:oe.uid},e.next=4,(0,C._t)(t);case 4:200===(a=e.sent).code?(R.yw.destroy(),de(a),a.data.content.length>0&&ae(a.data.content[0].uid)):(R.yw.destroy(),R.yw.error(i(a.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=r()(s()().mark((function e(){var t,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return je(!0),e.prev=1,R.yw.loading("loading"),t={type:V,startDate:null==d?void 0:d.format("YYYY-MM-DD"),endDate:null==A?void 0:A.format("YYYY-MM-DD"),departmentUid:ne,assigneeUid:te,orgUid:null==oe?void 0:oe.uid},e.next=6,(0,Y.AD)(t);case 6:i=e.sent,console.log("queryStatisticTicketByDate response:",i.data,t),200===i.code?(R.yw.destroy(),xe(i.data)):(R.yw.destroy(),R.yw.error(i.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),R.yw.error(a.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,je(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){Me(),we()}),[]),(0,c.useEffect)((function(){Ze()}),[V,te,ne]),(0,c.useEffect)((function(){Ze()}),[d,A]);var Te=[{key:"1",date:null==d?void 0:d.format("YYYY-MM-DD"),totalTickets:(null==pe?void 0:pe.totalTickets)||0,satisfiedTickets:(null==pe?void 0:pe.satisfiedTickets)||0,unsatisfiedTickets:(null==pe?void 0:pe.unsatisfiedTickets)||0,satisfactionRate:(null==pe?void 0:pe.customerSatisfactionRate)||0,avgResponseTime:"".concat((null==pe?void 0:pe.averageFirstResponseTime)||0,"分钟")}],Ye=[{title:a.formatMessage({id:"bi.ticket.table.date"}),dataIndex:"date",key:"date"},{title:a.formatMessage({id:"bi.ticket.table.totalTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:a.formatMessage({id:"bi.ticket.table.satisfiedTickets"}),dataIndex:"satisfiedTickets",key:"satisfiedTickets",render:function(e,t){return(0,U.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:a.formatMessage({id:"bi.ticket.table.unsatisfiedTickets"}),dataIndex:"unsatisfiedTickets",key:"unsatisfiedTickets",render:function(e,t){return(0,U.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:a.formatMessage({id:"bi.ticket.table.satisfactionRate"}),dataIndex:"satisfactionRate",key:"satisfactionRate",render:function(e){return"".concat(e,"%")}},{title:a.formatMessage({id:"bi.ticket.table.avgResponseTime"}),dataIndex:"avgResponseTime",key:"avgResponseTime",render:function(e){return"".concat(e).concat(a.formatMessage({id:"bi.ticket.unit.minute"}))}}];return(0,U.jsxs)("div",{style:{padding:"24px"},children:[(0,U.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,U.jsx)("h2",{children:a.formatMessage({id:"bi.ticket.title.rating"})}),(0,U.jsxs)("p",{children:[a.formatMessage({id:"bi.ticket.description.rating"}),"today"===G&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD"),")"]}),"yesterday"===G&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD"),")"]}),("week"===G||"lastWeek"===G||"month"===G||"custom"===G)&&(0,U.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD")," ~ ",A.format("YYYY-MM-DD"),")"]})]})]}),(0,U.jsx)(m.Z,{style:{marginBottom:16},children:(0,U.jsx)(g.Z,{direction:"vertical",style:{width:"100%"},children:(0,U.jsxs)(g.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,U.jsxs)(g.Z,{wrap:!0,children:[(0,U.jsx)(k.ZP.Group,{value:G,onChange:function(e){return _(e.target.value)},children:be.map((function(e){return(0,U.jsx)(k.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===G&&(0,U.jsx)(P,{value:[d,A],onChange:function(e){I(e[0]),N(e[1])}})]}),(0,U.jsxs)(g.Z,{wrap:!0,children:[(0,U.jsxs)(u.Z,{value:V,onChange:X,style:{width:120},placeholder:a.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,U.jsx)(W,{value:O.whQ,children:a.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,U.jsx)(W,{value:O.fyH,children:a.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,U.jsx)(W,{value:O.nYM,children:a.formatMessage({id:"bi.ticket.filterType.department"})})]}),V===O.fyH&&(0,U.jsx)(u.Z,{value:te,onChange:ae,style:{width:150},placeholder:a.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(e=ce.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,U.jsx)(W,{value:e.uid,children:i(e.nickname)},e.uid)}))}),V===O.nYM&&(0,U.jsx)(u.Z,{value:ne,onChange:re,style:{width:150},placeholder:a.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(t=fe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,U.jsx)(W,{value:e.uid,children:i(e.name)},e.uid)}))}),(0,U.jsx)(p.ZP,{type:"primary",icon:(0,U.jsx)(j.Z,{}),onClick:function(){return Ze()},children:(0,U.jsx)(T.FormattedMessage,{id:"bi.common.refresh"})})]})]})})}),(0,U.jsxs)(x.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,U.jsx)(v.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:a.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==pe?void 0:pe.totalTickets)||0,prefix:(0,U.jsx)(b.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,U.jsx)(v.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:a.formatMessage({id:"bi.ticket.card.satisfactionRate"}),value:(null==pe?void 0:pe.customerSatisfactionRate)||0,prefix:(0,U.jsx)(M.Z,{}),valueStyle:{color:"#1890ff"},suffix:a.formatMessage({id:"bi.ticket.unit.percent"})})})}),(0,U.jsx)(v.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:a.formatMessage({id:"bi.ticket.table.satisfiedTickets"}),value:(null==pe?void 0:pe.satisfiedTickets)||0,prefix:(0,U.jsx)(w.Z,{}),valueStyle:{color:"#722ed1"}})})}),(0,U.jsx)(v.Z,{span:6,children:(0,U.jsx)(m.Z,{children:(0,U.jsx)(y.Z,{title:a.formatMessage({id:"bi.ticket.table.avgResponseTime"}),value:(null==pe?void 0:pe.averageFirstResponseTime)||0,prefix:(0,U.jsx)(Z.Z,{}),valueStyle:{color:"#eb2f96"},suffix:a.formatMessage({id:"bi.ticket.unit.minute"})})})})]}),(0,U.jsxs)(x.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,U.jsx)(v.Z,{span:12,children:(0,U.jsx)(m.Z,{title:a.formatMessage({id:"bi.ticket.satisfactionDistribution"})})}),(0,U.jsx)(v.Z,{span:12,children:(0,U.jsx)(m.Z,{title:a.formatMessage({id:"bi.ticket.satisfactionTrend"})})})]}),(0,U.jsx)(m.Z,{title:"满意度详细数据",loading:he,children:(0,U.jsx)(h.Z,{columns:Ye,dataSource:Te,pagination:!1,size:"middle"})})]})}}}]);