"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[868],{21698:function(e,n,t){t.r(n),t.d(n,{default:function(){return W}});var r=t(90819),i=t.n(r),a=t(73193),c=t.n(a),s=t(89933),l=t.n(s),o=t(45332),d=t.n(o),u=t(44194),p=t(34251),x=t(8957),h=t(43443),f=t(43413),m=t(77407),j=t(63065),Z=t(25950),v=t(68525),y=t(41881),k=t(32164),b=t(91768),g=t(6992),w=t(25191),S=t(75699);function P(e){return C.apply(this,arguments)}function C(){return(C=l()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/quality/plan/query/org",{method:"GET",params:c()({},n)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function I(e){return z.apply(this,arguments)}function z(){return(z=l()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/quality/plan/create",{method:"POST",data:c()(c()({},n),{},{channel:w.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return F.apply(this,arguments)}function F(){return(F=l()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/quality/plan/update",{method:"POST",data:c()(c()({},n),{},{channel:w.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function N(e){return T.apply(this,arguments)}function T(){return(T=l()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,S.request)("/api/v1/quality/plan/delete",{method:"POST",data:c()(c()({},n),{},{channel:w.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var O=t(76711),E=t.n(O),B=t(55738),A=t(34651),D=t(24418),J=t(5858),X=t(9248),K=t(38862),U=t(35129),V=t(61978),G=t(92395),L=t(67702),Y=t(31549),_=(B.Z.Title,B.Z.Text),H=Z.Z.TextArea,M=p.Z.Option,Q=function(e){var n=e.open,t=e.onClose,r=e.onSave,i=e.initialPlan,a=(0,u.useState)(null),s=d()(a,2),l=s[0],o=s[1],x=(0,u.useState)(!1),h=d()(x,2),k=h[0],w=h[1],S=(0,u.useState)(null),P=d()(S,2),C=P[0],I=P[1],z=(0,u.useState)(-1),q=d()(z,2),F=q[0],N=q[1],T=A.Z.useForm(),O=d()(T,1)[0],B=A.Z.useForm(),Q=d()(B,1)[0];(0,u.useEffect)((function(){if(i){var e={uid:i.uid,name:i.name,description:i.description,type:i.type,indicators:i.indicators||[],enabled:i.enabled,orgUid:i.orgUid};o(e),O.setFieldsValue(e)}else{o({name:"",description:"",type:"标准",indicators:[],enabled:!0}),O.resetFields()}}),[i,O]);var R,W=[{title:"序号",dataIndex:"index",key:"index",width:80,render:function(e,n,t){return t+1}},{title:"指标名称",dataIndex:"indicatorName",key:"indicatorName"},{title:"分值",dataIndex:"indicatorScore",key:"indicatorScore",render:function(e,n){return(0,Y.jsxs)("span",{style:{color:n.deduction?"red":"green"},children:[n.deduction?"-":"+",e||0]})}},{title:"类型",key:"type",render:function(e,n){return(0,Y.jsxs)(f.Z,{children:[n.deduction&&(0,Y.jsx)("span",{style:{color:"red"},children:"减分"}),n.mandatory&&(0,Y.jsx)("span",{style:{color:"blue"},children:"必检"})]})}},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"操作",key:"action",width:200,render:function(e,n,t){var r;return(0,Y.jsxs)(f.Z,{size:"small",children:[(0,Y.jsx)(m.ZP,{type:"text",size:"small",icon:(0,Y.jsx)(y.Z,{}),onClick:function(){return $(n,t)}}),(0,Y.jsx)(m.ZP,{type:"text",size:"small",danger:!0,icon:(0,Y.jsx)(b.Z,{}),onClick:function(){return ee(t)}}),(0,Y.jsx)(m.ZP,{type:"text",size:"small",icon:(0,Y.jsx)(G.Z,{}),disabled:0===t,onClick:function(){return ne(t,"up")}}),(0,Y.jsx)(m.ZP,{type:"text",size:"small",icon:(0,Y.jsx)(L.Z,{}),disabled:t===((null==l||null===(r=l.indicators)||void 0===r?void 0:r.length)||0)-1,onClick:function(){return ne(t,"down")}})]})}}],$=function(e,n){I(e),N(n),Q.setFieldsValue(e),w(!0)},ee=function(e){if(l){var n=E()(l.indicators||[]);n.splice(e,1);var t=c()(c()({},l),{},{indicators:n});o(t)}},ne=function(e,n){if(l){var t=E()(l.indicators||[]);if("up"===n&&e>0){var r=[t[e-1],t[e]];t[e]=r[0],t[e-1]=r[1]}else if("down"===n&&e<t.length-1){var i=[t[e+1],t[e]];t[e]=i[0],t[e+1]=i[1]}var a=c()(c()({},l),{},{indicators:t});o(a)}};return(0,Y.jsxs)(D.Z,{title:i?"编辑质检方案: ".concat(i.name):"新建质检方案",open:n,onClose:t,width:800,extra:(0,Y.jsxs)(f.Z,{children:[(0,Y.jsx)(m.ZP,{onClick:t,children:"取消"}),(0,Y.jsx)(m.ZP,{type:"primary",onClick:function(){O.validateFields().then((function(e){if(l){var n=c()(c()({},l),e);r(n)}}))},children:"保存"})]}),children:[(0,Y.jsxs)("div",{style:{height:"calc(100vh - 200px)",overflowY:"auto"},children:[(0,Y.jsx)(j.Z,{title:"基本信息",style:{marginBottom:16},children:(0,Y.jsxs)(A.Z,{form:O,layout:"vertical",children:[(0,Y.jsxs)(J.Z,{gutter:16,children:[(0,Y.jsx)(X.Z,{span:12,children:(0,Y.jsx)(A.Z.Item,{name:"name",label:"方案名称",rules:[{required:!0,message:"请输入方案名称"}],children:(0,Y.jsx)(Z.Z,{placeholder:"请输入方案名称"})})}),(0,Y.jsx)(X.Z,{span:12,children:(0,Y.jsx)(A.Z.Item,{name:"type",label:"方案类型",rules:[{required:!0,message:"请选择方案类型"}],children:(0,Y.jsxs)(p.Z,{placeholder:"请选择方案类型",children:[(0,Y.jsx)(M,{value:"标准",children:"标准"}),(0,Y.jsx)(M,{value:"高级",children:"高级"}),(0,Y.jsx)(M,{value:"自定义",children:"自定义"})]})})})]}),(0,Y.jsx)(A.Z.Item,{name:"description",label:"方案描述",children:(0,Y.jsx)(H,{rows:3,placeholder:"请输入方案描述"})}),(0,Y.jsx)(A.Z.Item,{name:"enabled",label:"是否启用",valuePropName:"checked",children:(0,Y.jsx)(K.Z,{})})]})}),(0,Y.jsxs)(j.Z,{title:(0,Y.jsxs)(f.Z,{children:["质检指标",(0,Y.jsxs)(_,{type:"secondary",children:["(总分: ",(R=(null==l?void 0:l.indicators)||[],R.reduce((function(e,n){var t=n.indicatorScore||0;return e+(n.deduction?-t:t)}),0)),")"]})]}),style:{marginBottom:16},children:[(0,Y.jsx)(v.Z,{columns:W,dataSource:(null==l?void 0:l.indicators)||[],pagination:!1,size:"small",rowKey:function(e,n){return(null==n?void 0:n.toString())||"0"}}),(0,Y.jsx)("div",{style:{marginTop:16},children:(0,Y.jsx)(m.ZP,{type:"primary",icon:(0,Y.jsx)(g.Z,{}),onClick:function(){I(null),Q.resetFields(),w(!0)},children:"添加质检指标"})})]})]}),(0,Y.jsx)(U.Z,{title:C?"编辑质检指标":"添加质检指标",open:k,onOk:function(){Q.validateFields().then((function(e){if(l){var n,t={indicatorName:e.indicatorName,indicatorScore:e.indicatorScore||0,deduction:e.deduction||!1,mandatory:e.mandatory||!1,description:e.description};C&&F>=0?(n=E()(l.indicators||[]))[F]=t:n=[].concat(E()(l.indicators||[]),[t]);var r=c()(c()({},l),{},{indicators:n});o(r),w(!1),Q.resetFields()}}))},onCancel:function(){w(!1),Q.resetFields()},children:(0,Y.jsxs)(A.Z,{form:Q,layout:"vertical",children:[(0,Y.jsx)(A.Z.Item,{name:"indicatorName",label:"指标名称",rules:[{required:!0,message:"请输入指标名称"}],children:(0,Y.jsx)(Z.Z,{placeholder:"请输入指标名称"})}),(0,Y.jsxs)(J.Z,{gutter:16,children:[(0,Y.jsx)(X.Z,{span:12,children:(0,Y.jsx)(A.Z.Item,{name:"indicatorScore",label:"指标分值",rules:[{required:!0,message:"请输入指标分值"}],children:(0,Y.jsx)(V.Z,{min:0,max:100,style:{width:"100%"}})})}),(0,Y.jsx)(X.Z,{span:12,children:(0,Y.jsx)(A.Z.Item,{name:"deduction",label:"减分指标",valuePropName:"checked",children:(0,Y.jsx)(K.Z,{})})})]}),(0,Y.jsx)(A.Z.Item,{name:"mandatory",label:"必检指标",valuePropName:"checked",children:(0,Y.jsx)(K.Z,{})}),(0,Y.jsx)(A.Z.Item,{name:"description",label:"指标描述",children:(0,Y.jsx)(H,{rows:3,placeholder:"请输入指标描述"})})]})})]})},R=p.Z.Option,W=function(){var e=(0,u.useState)(!1),n=d()(e,2),t=n[0],r=n[1],a=(0,u.useState)(null),s=d()(a,2),o=s[0],w=s[1],S=(0,u.useState)(!1),C=d()(S,2),z=C[0],F=C[1],T=(0,u.useState)([]),O=d()(T,2),E=O[0],B=O[1],A=(0,u.useState)({current:1,pageSize:10,total:0}),D=d()(A,2),J=D[0],X=D[1],K=function(){var e=l()(i()().mark((function e(n){var t,r;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return F(!0),e.prev=1,t=c()({pageNumber:(null==n?void 0:n.current)||1,pageSize:(null==n?void 0:n.pageSize)||10},n),e.next=5,P(t);case 5:200===(r=e.sent).code&&r.data&&(B(r.data.content||[]),X({current:r.data.number||1,pageSize:r.data.numberOfElements||10,total:r.data.totalElements||0})),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),x.ZP.error("获取质检方案列表失败"),console.error("Fetch quality plans error:",e.t0);case 13:return e.prev=13,F(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(n){return e.apply(this,arguments)}}();(0,u.useEffect)((function(){K()}),[]);var U=[{title:"方案名称",dataIndex:"name",key:"name"},{title:"描述",dataIndex:"description",key:"description",ellipsis:!0},{title:"类型",dataIndex:"type",key:"type",render:function(e){return(0,Y.jsx)(h.Z,{color:"blue",children:e||"标准"})}},{title:"质检指标数量",key:"indicatorsCount",render:function(e,n){var t;return(0,Y.jsx)("span",{children:(null===(t=n.indicators)||void 0===t?void 0:t.length)||0})}},{title:"状态",dataIndex:"enabled",key:"enabled",render:function(e){return(0,Y.jsx)(h.Z,{color:e?"green":"red",children:e?"启用":"禁用"})}},{title:"创建时间",dataIndex:"createdAt",key:"createdAt",render:function(e){return e?new Date(e).toLocaleString("zh-CN"):"-"}},{title:"操作",key:"action",render:function(e,n){return(0,Y.jsxs)(f.Z,{size:"middle",children:[(0,Y.jsx)(m.ZP,{type:"link",size:"small",icon:(0,Y.jsx)(y.Z,{}),onClick:function(){return V(n)},children:"编辑"}),(0,Y.jsx)(m.ZP,{type:"link",size:"small",icon:(0,Y.jsx)(k.Z,{}),onClick:function(){return G(n)},children:"复制"}),(0,Y.jsx)(m.ZP,{type:"link",size:"small",danger:!0,icon:(0,Y.jsx)(b.Z,{}),onClick:function(){return L(n)},children:"删除"})]})}}],V=function(e){w(e),r(!0)},G=function(e){var n=c()(c()({},e),{},{uid:void 0,name:"".concat(e.name,"_副本")});w(n),r(!0)},L=function(){var e=l()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,N({uid:n.uid});case 3:x.ZP.success("删除成功"),K(),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),x.ZP.error("删除失败"),console.error("Delete quality plan error:",e.t0);case 11:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=l()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!n.uid){e.next=7;break}return e.next=4,q(n);case 4:x.ZP.success("更新成功"),e.next=10;break;case 7:return e.next=9,I(n);case 9:x.ZP.success("创建成功");case 10:r(!1),K(),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(0),x.ZP.error("保存失败"),console.error("Save quality plan error:",e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,14]])})));return function(n){return e.apply(this,arguments)}}();return(0,Y.jsx)("div",{style:{padding:"20px"},children:(0,Y.jsxs)(j.Z,{title:"质检方案管理",extra:(0,Y.jsx)(m.ZP,{type:"primary",icon:(0,Y.jsx)(g.Z,{}),onClick:function(){w(null),r(!0)},children:"新建方案"}),children:[(0,Y.jsx)("div",{style:{marginBottom:16},children:(0,Y.jsxs)(f.Z,{wrap:!0,children:[(0,Y.jsx)(Z.Z,{placeholder:"搜索方案名称",style:{width:200},onPressEnter:function(e){K({name:e.target.value})}}),(0,Y.jsxs)(p.Z,{placeholder:"状态",style:{width:120},onChange:function(e){"all"===e?K():K({enabled:"enabled"===e})},children:[(0,Y.jsx)(R,{value:"all",children:"全部"}),(0,Y.jsx)(R,{value:"enabled",children:"启用"}),(0,Y.jsx)(R,{value:"disabled",children:"禁用"})]}),(0,Y.jsx)(m.ZP,{type:"primary",onClick:function(){return K()},children:"搜索"})]})}),(0,Y.jsx)(v.Z,{columns:U,dataSource:E,loading:z,pagination:J,onChange:function(e,n,t){K(c()({current:e.current,pageSize:e.pageSize,sortBy:t.field,sortDirection:"ascend"===t.order?"asc":"desc"},n))},rowKey:"uid"}),(0,Y.jsx)(Q,{open:t,onClose:function(){return r(!1)},onSave:_,initialPlan:o})]})})}},9248:function(e,n,t){var r=t(70065);n.Z=r.Z},5858:function(e,n,t){var r=t(70231);n.Z=r.Z}}]);