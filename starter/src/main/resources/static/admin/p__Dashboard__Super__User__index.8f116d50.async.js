"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4693],{3e3:function(e,r,s){var t=s(39328),a=s(17323),n=s(44194),i=s(77929),o=s(31549),d=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=n.forwardRef((function(e,r){var s=e.fieldProps,n=e.unCheckedChildren,u=e.checkedChildren,l=e.proFieldProps,c=(0,a.Z)(e,d);return(0,o.jsx)(i.Z,(0,t.Z)({valueType:"switch",fieldProps:(0,t.Z)({unCheckedChildren:n,checkedChildren:u},s),ref:r,valuePropName:"checked",proFieldProps:l,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));r.Z=u},90907:function(e,r,s){s.r(r),s.d(r,{default:function(){return J}});var t=s(83857),a=s(93686),n=s(99626),i=s(90962),o=s(73193),d=s.n(o),u=s(84176),l=s.n(u),c=s(90819),g=s.n(c),f=s(89933),m=s.n(f),p=s(45332),h=s.n(p),M=s(31756),x=s(25400),y=s(54338),b=s(6992),v=s(28031),w=s(24418),k=s(81020),j=s(68943),C=s(90343),S=s(37799),Z=s(4363),R=s(44194),I=s(31881),F=s(6373),U=s(22766),z=s(3e3),A=s(55681),P=s(65318),E=s(75699),q=s(31549),D=function(e){var r=e.isEdit,s=e.user,t=e.open,a=e.onClose,n=e.onSubmit,i=A.Z.useForm(),o=h()(i,1)[0],u=(0,E.useIntl)(),l=(0,I.u)((function(e){return e.currentOrg}));(0,R.useEffect)((function(){r?o.setFieldsValue({username:null==s?void 0:s.username,nickname:null==s?void 0:s.nickname,email:null==s?void 0:s.email,emailVerified:null==s?void 0:s.emailVerified,mobile:null==s?void 0:s.mobile,mobileVerified:null==s?void 0:s.mobileVerified,enabled:null==s?void 0:s.enabled}):(o.resetFields(),o.setFieldsValue({enabled:!0}))}),[t]);return(0,q.jsx)(P.Z,{title:r?(0,q.jsx)(E.FormattedMessage,{id:"pages.user.edit",defaultMessage:"Edit User"}):(0,q.jsx)(E.FormattedMessage,{id:"pages.user.create",defaultMessage:"Create User"}),onClose:a,open:t,width:600,extra:(0,q.jsxs)(k.Z,{children:[(0,q.jsx)(Z.ZP,{onClick:a,children:(0,q.jsx)(E.FormattedMessage,{id:"pages.common.cancel"})}),(0,q.jsx)(Z.ZP,{onClick:function(){o.validateFields().then((function(e){null==s||!s.superUser||!1!==e.enabled&&!1!==e.mobileVerified&&!1!==e.emailVerified?n(d()(d()(d()({},s),e),{},{orgUid:null==l?void 0:l.uid})):M.yw.error(u.formatMessage({id:"pages.user.superUser.notAllow"}))})).catch((function(e){console.log("Form errors:",e),M.yw.error(u.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,q.jsx)(E.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,q.jsxs)(F.A,{form:o,submitter:!1,children:[(0,q.jsx)(U.Z,{name:"username",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.username"}),rules:[{required:!0,message:u.formatMessage({id:"pages.user.username.required"})}]}),(0,q.jsx)(U.Z,{name:"nickname",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.nickname"}),rules:[{required:!0,message:u.formatMessage({id:"pages.user.nickname.required"})}]}),(0,q.jsx)(U.Z,{name:"email",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.email"}),rules:[{required:!0,message:u.formatMessage({id:"pages.user.email.required"})},{type:"email",message:u.formatMessage({id:"pages.user.email.invalid"})}]}),(0,q.jsx)(z.Z,{name:"emailVerified",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.email.verified"})}),(0,q.jsx)(U.Z,{name:"mobile",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.mobile"}),rules:[{required:!0,message:u.formatMessage({id:"pages.user.mobile.required"})},{pattern:/^1[3-9]\d{9}$/,message:u.formatMessage({id:"pages.user.mobile.invalid"})}]}),(0,q.jsx)(z.Z,{name:"mobileVerified",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.mobile.verified"})}),(0,q.jsx)(z.Z,{name:"enabled",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.enabled",defaultMessage:"Status"}),checkedChildren:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.status.disabled",defaultMessage:"禁用"})}),(0,q.jsx)(U.Z.Password,{name:"password",label:(0,q.jsx)(E.FormattedMessage,{id:"pages.user.password"}),rules:[{required:!r,message:u.formatMessage({id:"pages.user.password.required"})}]})]})})},V=s(65105),B=s(52795),O=s(30234),T=s(28977),Y=s.n(T),L=s(25191),N=s(32597),H=["current","pageSize"],K=function(){var e=(0,E.useIntl)(),r=(0,R.useRef)(),s=(0,O.Z)().translateString,t=(0,R.useState)(!0),a=h()(t,2),n=a[0],i=a[1],o=(0,R.useState)(),u=h()(o,2),c=u[0],f=u[1],p=(0,R.useState)(!1),F=h()(p,2),U=F[0],z=F[1],A=(0,R.useState)(1),P=h()(A,2),T=P[0],K=P[1],W=(0,R.useState)(10),J=h()(W,2),G=J[0],Q=J[1],$=(0,I.u)((function(e){return e.currentOrg})),_=(0,B.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),X=(_.roleResult,_.roleResultPlatform,_.setRoleResult),ee=_.setRoleResultPlatform,re=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:e.formatMessage({id:"pages.user.username"}),dataIndex:"username",copyable:!0},{title:e.formatMessage({id:"pages.user.nickname"}),dataIndex:"nickname",copyable:!0},{title:e.formatMessage({id:"pages.user.email"}),dataIndex:"email",width:300,render:function(r,s){return(0,q.jsxs)(k.Z,{direction:"vertical",size:4,children:[(0,q.jsx)("span",{children:s.email||"-"}),(0,q.jsx)(j.Z,{color:s.emailVerified?"success":"default",children:s.emailVerified?e.formatMessage({id:"pages.user.email.verified.yes"}):e.formatMessage({id:"pages.user.email.verified.no"})})]})}},{title:e.formatMessage({id:"pages.user.mobile"}),dataIndex:"mobile",width:250,render:function(r,s){return(0,q.jsxs)(k.Z,{direction:"vertical",size:4,children:[(0,q.jsx)("span",{children:s.mobile||"-"}),(0,q.jsx)(j.Z,{color:s.mobileVerified?"success":"default",children:s.mobileVerified?e.formatMessage({id:"pages.user.mobile.verified.yes"}):e.formatMessage({id:"pages.user.mobile.verified.no"})})]})}},{title:e.formatMessage({id:"pages.user.organization"}),dataIndex:"currentOrganization",hideInSearch:!0,render:function(e,r){return r.currentOrganization?(0,q.jsx)(j.Z,{color:"blue",children:r.currentOrganization.name||"-"}):"-"}},{title:e.formatMessage({id:"pages.user.roles"}),dataIndex:"currentRoles",hideInSearch:!0,width:250,render:function(e,r){return r.currentRoles&&r.currentRoles.length>0?(0,q.jsx)(k.Z,{wrap:!0,children:r.currentRoles.map((function(e,r){return(0,q.jsx)(j.Z,{color:"green",children:s(e.name)},r)}))}):null}},{title:e.formatMessage({id:"pages.user.description"}),dataIndex:"description",hideInSearch:!0,hideInTable:!0},{title:e.formatMessage({id:"pages.user.enabled"}),dataIndex:"enabled",hideInSearch:!0,width:100,render:function(r,s){return s.enabled?e.formatMessage({id:"pages.user.status.enabled",defaultMessage:"启用"}):e.formatMessage({id:"pages.user.status.disabled",defaultMessage:"禁用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.user.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.user.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.user.superUser"}),dataIndex:"superUser",hideInSearch:!0,width:100,render:function(r,s){return s.superUser?e.formatMessage({id:"pages.user.superUser.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.user.superUser.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.user.superUser.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.user.superUser.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.user.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.createdAt?Y()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.user.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.updatedAt?Y()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],se=[].concat(re,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(r,s,t,a){return[(0,q.jsx)("a",{onClick:function(){ne(s)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!s.superUser&&(0,q.jsxs)(R.Fragment,{children:[(0,q.jsx)(C.Z,{type:"vertical"},"divider"),(0,q.jsx)(S.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:s.nickname||s.username}),onConfirm:function(){return ie(s)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,q.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")]}}]),te=(0,V.v)((function(e){return e.currentCategory})),ae=function(){f(void 0),i(!1),z(!0)},ne=function(e){f(e),i(!0),z(!0)},ie=function(){var t=m()(g()().mark((function t(a){var n,i;return g()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!a.superUser){t.next=3;break}return M.yw.error(e.formatMessage({id:"pages.user.superUser.notDelete"})),t.abrupt("return");case 3:return M.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),t.prev=4,t.next=7,(0,x.h8)({uid:a.uid});case 7:n=t.sent,M.yw.destroy(),200===n.code?(M.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=r.current)||void 0===i||i.reloadAndRest()):M.yw.error(s(n.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),M.yw.destroy(),M.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete user error:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(e){return t.apply(this,arguments)}}(),oe=function(){var s=m()(g()().mark((function s(t){var a,i;return g()().wrap((function(s){for(;;)switch(s.prev=s.next){case 0:if(console.log("handleSubmitDrawer",t),n?M.yw.loading(e.formatMessage({id:"updating"})):M.yw.loading(e.formatMessage({id:"creating"})),!n){s.next=8;break}return s.next=5,(0,x.Nq)(t);case 5:s.t0=s.sent,s.next=11;break;case 8:return s.next=10,(0,x.r4)(t);case 10:s.t0=s.sent;case 11:a=s.t0,console.log("createUser response:",t,a),200===a.code?(M.yw.destroy(),M.yw.loading(e.formatMessage({id:"create.success"})),z(!1),null===(i=r.current)||void 0===i||i.reloadAndRest()):(M.yw.destroy(),M.yw.error(a.message));case 14:case"end":return s.stop()}}),s)})));return function(e){return s.apply(this,arguments)}}(),de=function(){var r=m()(g()().mark((function r(){var s,t;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return M.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),s={pageNumber:0,pageSize:100,orgUid:null==$?void 0:$.uid},r.next=4,(0,y.E9)(s);case 4:t=r.sent,console.log("queryRolesByOrg response ",t),200===t.code?(M.yw.destroy(),X(t)):(M.yw.destroy(),M.yw.error(t.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),ue=function(){var r=m()(g()().mark((function r(){var s,t;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return M.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),s={pageNumber:0,pageSize:100,level:L.Hxq},r.next=4,(0,y.E9)(s);case 4:t=r.sent,console.log("queryRolesBySuper response ",t),200===t.code?(M.yw.destroy(),ee(t)):(M.yw.destroy(),M.yw.error(t.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();(0,R.useEffect)((function(){de(),ue()}),[]),(0,R.useEffect)((function(){var e;console.log("currentCategory:",te),null===(e=r.current)||void 0===e||e.reloadAndRest()}),[te]);var le=function(){var e=m()(g()().mark((function e(){var r;return g()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",T,G),r=localStorage.getItem(L.LA8),window.open((0,N.kG)()+"/api/v1/user/export?"+new URLSearchParams({pageNumber:String(T-1),pageSize:String(G),accessToken:r||""}).toString());case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(w.Z,{columns:se,actionRef:r,cardBordered:!0,scroll:{x:2500},request:function(){var r=m()(g()().mark((function r(t,a,n){var i,o,u,c,f;return g()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("request:",t,a,n),M.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),i=t.current,o=t.pageSize,u=l()(t,H),K(i),Q(o),c=d()({pageNumber:i-1,pageSize:o,isSuperUser:!0},u),r.next=8,(0,x._9)(c);case 8:return f=r.sent,console.log("getAllUsers response:",c,f),M.yw.destroy(),200===f.code||M.yw.error(s(f.message)),r.abrupt("return",{data:f.data.content,success:!0,total:f.data.totalElements});case 13:case"end":return r.stop()}}),r)})));return function(e,s,t){return r.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:G,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,r){console.log("pagination onChange:",e,r),K(e),Q(r)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.user.list",defaultMessage:"用户列表"}),toolBarRender:function(){return[(0,q.jsx)(Z.ZP,{icon:(0,q.jsx)(b.Z,{}),type:"primary",onClick:ae,children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button"),(0,q.jsx)(Z.ZP,{icon:(0,q.jsx)(v.Z,{}),type:"primary",onClick:le,children:e.formatMessage({id:"export",defaultMessage:"Export"})},"button")]}}),U&&(0,q.jsx)(D,{isEdit:n,open:U,user:c,onClose:function(){z(!1)},onSubmit:oe})]})},W=s(22837),J=function(){var e=(0,E.useIntl)(),r=[{key:"user",label:e.formatMessage({id:"user"}),children:(0,q.jsx)(K,{})},{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,q.jsx)(n.Z,{isSuperUser:!0})},{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,q.jsx)(t.Z,{isSuperUser:!0})},{key:"blackip",label:e.formatMessage({id:"visitor.tab.blackip"}),children:(0,q.jsx)(a.Z,{isSuperUser:!0})},{key:"browse",label:e.formatMessage({id:"browse.tab.all"}),children:(0,q.jsx)(W.Z,{isSuperUser:!0})}];return(0,q.jsx)(i.Z,{defaultActiveKey:"user",items:r,style:{padding:"10px"}})}},65105:function(e,r,s){s.d(r,{v:function(){return c}});var t=s(76711),a=s.n(t),n=s(73193),i=s.n(n),o=s(25191),d=s(16894),u=s(45034),l=s(47401);var c=(0,d.Ue)()((0,u.mW)((0,u.tJ)((0,l.n)((function(e,r){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:o.zBg,name:o.zBg},setCategoryResult:function(r){var s=function(e){var r=[];return e.data.content.forEach((function(e){var s={label:e.name,value:e.uid};r.push(s)})),r}(r),t={uid:o.zBg,name:o.zBg},n=i()(i()({},r),{},{data:i()(i()({},r.data),{},{content:[t].concat(a()(r.data.content))})}),d=function(e){var r=[];return e.data.content.forEach((function(e){var s={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(s.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),r.push(s)})),r}(n);e({categoryResult:n,categoryTreeOptions:d,categorySelectOptions:s}),0===r.data.content.length&&e({currentCategory:{uid:o.zBg,name:o.zBg}})},insertCategory:function(r){e((function(e){e.categoryResult.data.content.unshift(r)}))},upgradeCategory:function(r){e((function(e){var s=e.categoryResult.data.content,t=s.findIndex((function(e){return e.uid===r.uid}));-1!==t?s[t]=r:console.warn("Category with uid ".concat(r.uid," not found."))}))},setCurrentCategory:function(r){e({currentCategory:r})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:o.zBg,name:o.zBg}})},setCurrentCategoryUid:function(s){var t=r().categoryResult.data.content.find((function(e){return e.uid===s}));e({currentCategory:t})},deleteCategoryCache:function(){return e({},!0)}}})),{name:o.OMm})))}}]);