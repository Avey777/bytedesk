"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{35644:function(e,n,t){t.r(n),t.d(n,{default:function(){return ml}});var r=t(40144),s=t(398),a=t(45332),l=t.n(a),i=t(14458),o=t(73193),c=t.n(o),u=t(76711),d=t.n(u),p=t(18232),h=t(16894),f=t(45034),m=t(47401),x=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,s=n().currentChannel;""!==s.uid&&void 0!==s||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().llmproviderResult),{},{data:{content:a}});e({llmproviderResult:l,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({llmproviderResult:c()(c()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),g=t(29513),j=t(22578),y=t(44194),v=t(81343),b=t(31549),Z=[{name:"web",nickname:"网站/H5",description:"用于网站/H5页面的客服接入"},{name:"npm",nickname:"Npm包",description:"通过Npm包集成到前端项目"}],k=function(){var e=(0,i.Z)().isDarkMode,n=(0,y.useState)([]),t=l()(n,2),r=t[0],s=t[1],a=x((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),o=a.currentChannel,c=a.setCurrentChannel;return(0,y.useEffect)((function(){var e=[].concat(Z);!(0,v.Ox)()&&(0,v.OJ)()&&e.push({name:"app",nickname:"App应用",description:"App应用内嵌客服"},{name:"wechat",nickname:"微信应用",description:"微信小程序/公众号接入"},{name:"messenger",nickname:"Messenger",description:"Facebook Messenger客服"},{name:"instagram",nickname:"Instagram",description:"Instagram客服"},{name:"whatsapp",nickname:"Whatsapp",description:"Whatsapp客服"},{name:"telegram",nickname:"Telegram",description:"Telegram客服"},{name:"line",nickname:"Line",description:"Line客服"},{name:"email",nickname:"Email",description:"邮件客服"},{name:"douyin",nickname:"抖音",description:"抖音私信客服"},{name:"xiaohongshu",nickname:"小红书",description:"小红书私信客服"}),s(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(n,t){return(0,b.jsx)(g.Z.Item,{className:"".concat(e?"list-item-dark":"list-item"," ")+((null==o?void 0:o.name)===n.name?e?"dark-active":"active":""),onClick:function(){c(n)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,b.jsx)(j.Z,{src:"".concat((0,v.kG)(),"/avatars/").concat(n.name,".png")}),title:(0,b.jsx)(b.Fragment,{children:null==n?void 0:n.nickname}),description:(0,b.jsx)("span",{className:"channel-desc",children:null==n?void 0:n.description})})})}})})},w=t(75002),C=t(43906),E=function(){var e=(0,C.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(C.Access,{accessible:e.canDebug(),fallback:(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(C.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},S=t(90819),M=t.n(S),A=t(89933),I=t.n(A),P=t(10154),T=t.n(P),R=t(55567);function L(e){return B.apply(this,arguments)}function B(){return(B=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function W(e){return D.apply(this,arguments)}function D(){return(D=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return z.apply(this,arguments)}function z(){return(z=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return N.apply(this,arguments)}function N(){return(N=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return U.apply(this,arguments)}function U(){return(U=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function H(e){return _.apply(this,arguments)}function _(){return(_=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var V=t(9942),K=t(15722),Y=t(82669),J=t(80556),G=t(59304),X=t(54881),Q=t(2484),$=t(39686),ee=t(88561),ne=t(34353),te=t(41994),re=t(28619),se=t(17817),ae=t(88192),le=function(){var e=I()(M()().mark((function e(n,t){var r,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=3;break}return R.yw.error("组织UID不能为空"),e.abrupt("return",null);case 3:return null!=t&&t.showLoading&&R.yw.loading(t.loadingMessage||"Loading"),e.prev=4,r={pageNumber:0,pageSize:(null==t?void 0:t.pageSize)||50,sortDirection:p.oys,orgUid:n},e.next=8,(0,ae.LE)(r);case 8:if(s=e.sent,null!=t&&t.showLoading&&R.yw.destroy(),200!==s.code){e.next=15;break}return null!=t&&t.successMessage&&R.yw.success(t.successMessage),e.abrupt("return",s);case 15:return R.yw.error((null==t?void 0:t.errorMessage)||s.message),e.abrupt("return",null);case 17:e.next=25;break;case 19:return e.prev=19,e.t0=e.catch(4),null!=t&&t.showLoading&&R.yw.destroy(),R.yw.error((null==t?void 0:t.errorMessage)||"获取工作组列表失败"),console.error("getWorkgroups error:",e.t0),e.abrupt("return",null);case 25:case"end":return e.stop()}}),e,null,[[4,19]])})));return function(n,t){return e.apply(this,arguments)}}(),ie=function(){var e=I()(M()().mark((function e(n,t,r,s){var a,l;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(null!=t&&null!==(a=t.data)&&void 0!==a&&a.content&&t.data.content.length>0)){e.next=2;break}return e.abrupt("return",!0);case 2:return e.next=4,le(n,s);case 4:if(!(l=e.sent)){e.next=8;break}return r(l),e.abrupt("return",!0);case 8:return e.abrupt("return",!1);case 9:case"end":return e.stop()}}),e)})));return function(n,t,r,s){return e.apply(this,arguments)}}(),oe=function(e){var n;return(null==e||null===(n=e.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0?e.data.content[0].uid:""},ce=function(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=n.autoLoad,r=void 0===t||t,s=n.showLoading,a=void 0===s||s,i=n.loadingMessage,o=void 0===i?"loading":i,c=(0,y.useState)(!1),u=l()(c,2),d=u[0],p=u[1],h=(0,V.u)((function(e){return e.currentOrg})),f=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),m=f.workgroupResult,x=f.setWorkgroupResult,g=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=h&&h.uid){e.next=2;break}return e.abrupt("return",!1);case 2:return p(!0),e.next=5,ie(h.uid,m,x,{showLoading:a,loadingMessage:o});case 5:return n=e.sent,p(!1),e.abrupt("return",n);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),j=function(){return oe(m)},v=function(){var e;return(null==m||null===(e=m.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return{label:e.nickname,value:e.uid}})))||[]};return(0,y.useEffect)((function(){r&&null!=h&&h.uid&&g()}),[r,null==h?void 0:h.uid]),{workgroupResult:m,workgroups:(null==m||null===(e=m.data)||void 0===e?void 0:e.content)||[],loading:d,loadWorkgroups:g,getDefaultUid:j,getWorkgroupOptions:v}},ue=t(48792),de=t(59993),pe=t(7956),he=t(65511),fe=t(75843),me=t(99898),xe="MP",ge="MINI",je="WORK",ye="KEFU",ve=function(e){var n=e.isEdit,t=e.wechatApp,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=(0,re.Z)().translateStringTranct,h=(0,V.u)((function(e){return e.currentOrg})),f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=ce(),Z=j.workgroups,k=j.getDefaultUid,w=j.getWorkgroupOptions,C=function(){console.log("handleSubmit"),g(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),o(n)})).catch((function(){g(!1)}))};(0,y.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||je,appId:null==t?void 0:t.appId,appSecret:null==t?void 0:t.appSecret,token:null==t?void 0:t.token,encodingAesKey:null==t?void 0:t.encodingAesKey,encryptMode:null==t?void 0:t.encryptMode,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1});else{var e=k();d.setFieldsValue({name:"",description:"",type:je,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:e,enabled:!0,debug:!1})}}),[n,t,d,Z]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"微信应用配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:C,loading:x||a,children:x||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"wechatWorkForm",onFinish:C,submitter:!1,children:[(0,b.jsx)(de.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,b.jsx)(pe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:xe},{label:"微信小程序",value:ge},{label:"企业微信",value:je},{label:"微信客服",value:ye}],fieldProps:{defaultValue:je},rules:[{required:!0}]}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,b.jsx)(de.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===je?(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,b.jsx)(de.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===je?(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,b.jsx)(de.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({token:n})},children:"随机生成"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,b.jsx)(pe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:w().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(he.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,b.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},be=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(n){e((function(e){e.wechatAppResult.data.content.unshift(n)}))},updateWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},deleteWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},setWechatAppResult:function(t){var r;(e({wechatAppResult:t}),""===n().currentWechatApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:t.data.content[0]}))},setCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().wechatAppResult),{},{data:{content:a}});e({wechatAppResult:l,currentWechatApp:t})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:t})},refreshCurrentWechatApp:function(n){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),n);var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({wechatAppResult:c()(c()({},n().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("WechatApp not found in cache:",t),n().currentWechatApp.uid===t&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),Ze=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),ke=function(e){e.type;var n=(0,C.useIntl)(),t=(0,y.useRef)(!1),r=(0,re.Z)().translateStringTranct,s=(0,i.Z)().isDarkMode,a=(0,y.useState)(!1),o=l()(a,2),c=o[0],u=o[1],d=(0,y.useState)(!1),p=l()(d,2),h=p[0],f=p[1],m=(0,y.useState)(!1),x=l()(m,2),j=x[0],v=x[1],Z=(0,V.u)((function(e){return e.currentOrg})),k=be((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),w=k.wechatAppResult,E=k.currentWechatApp,S=k.setWechatAppResult,A=k.insertWechatApp,P=k.setCurrentWechatApp,T=k.deleteCurrentWechatApp,B=$.Z.useModal(),W=l()(B,2),D=W[0],z=W[1],N=function(){var e=I()(M()().mark((function e(t){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete wechatApp",t),R.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,O(t);case 4:r=e.sent,console.log("delete wechatApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),T(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),U=function(){var e=I()(M()().mark((function e(){var n,r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,L(n);case 8:r=e.sent,console.log("getWechatApps",r),200===r.code?(R.yw.destroy(),S(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){U();var e=function(e){f(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var H=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),v(!0),e.prev=2,!h){e.next=8;break}return e.next=6,se(n);case 6:e.next=10;break;case 8:return e.next=10,_(n);case 10:return e.prev=10,v(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,F(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateWechatApp response:",t),200===t.code?(A(t.data),P(t.data),u(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==E?void 0:E.uid,R.yw.loading("正在更新..."),e.next=4,q(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateWechatApp response:",t),200===t.code?(P(t.data),u(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){u(!0),f(!1)},children:n.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:U,children:n.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==E?void 0:E.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:n.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){f(!0),u(!0)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:n.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=E,void D.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){N(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:w.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:E.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(b.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,b.jsxs)("span",{style:{color:"#1677ff"},children:["(",Ze[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,b.jsx)(ve,{isEdit:h,open:c,loading:j,wechatApp:E,onClose:function(){u(!1)},onSubmit:H}),z]})},we=t(68060),Ce=t(64827),Ee=t(54818),Se=t(41313),Me=t(93383),Ae=t(56017),Ie=t(17966),Pe=t(1867),Te=t(83337),Re=t(34600),Le=t(15892),Be=t(54800),We=t(32693),De=t(5716),Fe=t(5321),ze=t(34545),qe=t(28977),Ne=t.n(qe),Oe=we.Z.Text,Ue=we.Z.Paragraph,He=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),_e=T()(T()(T()(T()({},p.a4q,(0,b.jsx)(Te.Z,{})),p.qRy,(0,b.jsx)(Re.Z,{})),p._oo,(0,b.jsx)(Le.Z,{})),p.rWo,(0,b.jsx)(Be.Z,{})),Ve={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},Ke={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},Ye=function(){var e,n=(0,C.useIntl)(),t=be((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),r=t.currentWechatApp,s=t.refreshCurrentWechatApp,a=(0,y.useState)(!1),i=l()(a,2),o=i[0],c=i[1],u=(0,y.useState)(!1),d=l()(u,2),p=d[0],h=d[1],f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=(0,y.useState)(!1),Z=l()(j,2),k=Z[0],w=Z[1],E=(0,y.useState)(!1),S=l()(E,2),A=(S[0],S[1],(0,y.useState)(!1)),P=l()(A,2),T=P[0],L=P[1],B=(0,y.useState)(!1),D=l()(B,2),F=D[0],z=D[1],N=(0,y.useState)(!1),O=l()(N,2),U=O[0],_=O[1],V=(0,y.useState)(!1),K=l()(V,2),Y=K[0],X=K[1],Q=function(e,n){return e?n?e:"******":"-"},$=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return L(!0),e.prev=4,e.next=7,H({uid:r.uid});case 7:n=e.sent,console.log("refreshAccessTokenWechatApp response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),s&&s(n.data),ee()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,L(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),ee=function(){var e=I()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return z(!0),e.prev=4,e.next=7,W({uid:r.uid});case 7:n=e.sent,console.log("queryWechatAppByUid refresh detail",n),200===n.code?(t=n.data,R.yw.success("应用详情刷新成功"),s&&s(t)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,z(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return _(!0),e.prev=4,e.next=7,q({uid:r.uid,enabled:n});case 7:t=e.sent,console.log("updateWechatApp enabled response",t),200===t.code?(R.yw.success("应用已".concat(n?"启用":"禁用")),s&&s(t.data)):R.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,_(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return X(!0),e.prev=4,e.next=7,q({uid:r.uid,debug:n});case 7:t=e.sent,console.log("updateWechatApp debug response",t),200===t.code?(R.yw.success("调试模式已".concat(n?"开启":"关闭")),s&&s(t.data)):R.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,X(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,b.jsxs)(Ce.Z,{title:(0,b.jsxs)(me.Z,{children:[_e[r.type]||(0,b.jsx)(Te.Z,{}),(0,b.jsx)("span",{children:r.name||"微信应用详情"}),(0,b.jsx)(Se.Z,{color:"blue",children:He[r.type]||r.type})]}),extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:ee,loading:F,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,b.jsx)(Oe,{copyable:!0,children:r.uid})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,b.jsx)(Se.Z,{color:"blue",children:He[r.type]||r.type})}),(0,b.jsx)(Me.Z.Item,{label:"启用状态",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:!1!==r.enabled,onChange:te,loading:U,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,b.jsx)(Oe,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:r.debug||!1,onChange:re,loading:Y,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,b.jsx)(Oe,{type:r.debug?"warning":"secondary",children:r.debug?"已开启":"已关闭"})]})}),(0,b.jsx)(Me.Z.Item,{label:"AppID/企业ID",children:(0,b.jsx)(Oe,{copyable:!0,children:r.appId})}),(0,b.jsx)(Me.Z.Item,{label:"AppSecret",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Oe,{copyable:!!p&&{text:r.appSecret||""},children:Q(r.appSecret,p)}),(0,b.jsx)(Ie.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,b.jsx)(ne.ZP,{type:"text",icon:p?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return h(!p)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"加密模式",children:(0,b.jsx)(Se.Z,{color:Ke[r.encryptMode]||"default",children:Ve[r.encryptMode]||r.encryptMode})}),(0,b.jsx)(Me.Z.Item,{label:"URL",children:(0,b.jsx)(Oe,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/webhooks/"+r.uid})}),(0,b.jsx)(Me.Z.Item,{label:"Token",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Oe,{copyable:!!x&&{text:r.token||""},children:Q(r.token,x)}),(0,b.jsx)(Ie.Z,{title:x?"隐藏Token":"显示Token",children:(0,b.jsx)(ne.ZP,{type:"text",icon:x?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return g(!x)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"EncodingAESKey",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Oe,{copyable:!!k&&{text:r.encodingAesKey||""},children:Q(r.encodingAesKey,k)}),(0,b.jsx)(Ie.Z,{title:k?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,b.jsx)(ne.ZP,{type:"text",icon:k?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return w(!k)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"AccessToken",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Oe,{copyable:!!o&&{text:r.accessToken||""},children:Q(r.accessToken,o)}),(0,b.jsx)(Ie.Z,{title:o?"隐藏Token":"显示Token",children:(0,b.jsx)(ne.ZP,{type:"text",icon:o?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return c(!o)},size:"small"})}),(0,b.jsx)(Ie.Z,{title:"刷新AccessToken",children:(0,b.jsx)(ne.ZP,{type:"primary",icon:(0,b.jsx)(ze.Z,{}),onClick:$,size:"small",loading:T,children:"刷新Token"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?Ne()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(Ue,{children:r.description})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(Ue,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,b.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,b.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,b.jsx)(Ce.Z,{variant:"borderless",title:"微信应用详情",extra:(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),children:(0,b.jsx)(Ee.Z,{description:"请先在左侧列表选择一个微信应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},Je=function(e){console.log(e)},Ge=[{key:"detail",label:"应用详情",children:(0,b.jsx)(Ye,{})}],Xe=function(e){e.type;var n=(0,y.useState)(Ge),t=l()(n,2),r=t[0],s=t[1];return(0,y.useEffect)((function(){var e=[].concat(Ge);s(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:r,onChange:Je})})},Qe=s.Z.Sider,$e=s.Z.Content,en=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth,i=t.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(Qe,{width:l,style:a,children:(0,b.jsx)(ke,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)($e,{style:i,children:(0,b.jsx)(Xe,{type:n})})})]})},nn=t(66942),tn=t(24052),rn=t(39038),sn=t(71529),an=function(e){var n,t=e.platform,r=void 0===t?"react":t,s=(0,C.useIntl)(),a=(0,y.useState)(r),i=l()(a,2),o=i[0],c=i[1],u=o.charAt(0).toUpperCase()+o.slice(1),d="vanilla"===o?"BytedeskVanilla":"Bytedesk".concat(u);return(0,b.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,b.jsxs)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,b.jsx)("h2",{children:(0,b.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:s.formatMessage({id:"install.guide.github"})})}),(0,b.jsx)(ne.ZP,{type:"primary",icon:(0,b.jsx)(sn.Z,{}),href:(n=(0,v.V)()+"/docs/zh-CN/docs/channel/","".concat(n).concat("vanilla"===o?"web":o)),target:"_blank",children:s.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===o?"Web":o.charAt(0).toUpperCase()+o.slice(1)})})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"选择框架"}),(0,b.jsx)(rn.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:o,onChange:function(e){c(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,b.jsx)("h2",{children:s.formatMessage({id:"install.guide.steps"})}),(0,b.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,b.jsx)("h3",{children:s.formatMessage({id:"install.guide.step1.title"})}),(0,b.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(s.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,b.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,b.jsx)("h3",{children:s.formatMessage({id:"install.guide.step2.title"})}),(0,b.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:function(){switch(o){case"react":return"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';";case"vue":return"import { BytedeskVue } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';";case"svelte":return"import { BytedeskSvelte } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';";default:return"import { BytedeskVanilla } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"}}()})]}),(0,b.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,b.jsx)("h3",{children:s.formatMessage({id:"install.guide.step3.title"})}),(0,b.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(s.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(s.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,b.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,b.jsx)("h3",{children:s.formatMessage({id:"install.guide.step4.title"})}),(0,b.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('".concat(function(){switch(o){case"react":return"BytedeskReact";case"vue":return"BytedeskVue";case"svelte":return"BytedeskSvelte";default:return"BytedeskVanilla"}}()," initialized');\n  };\n\n  return (\n    <div>\n      <").concat(d," {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ").concat(s.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{children:s.formatMessage({id:"install.guide.step5.title"})}),(0,b.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,b.jsxs)("li",{children:[(0,b.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",s.formatMessage({id:"install.guide.step5.show"})]}),(0,b.jsxs)("li",{children:[(0,b.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",s.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},ln=t(36914),on=we.Z.Title,cn=we.Z.Text,un=function(e){var n=e.channel,t=((0,y.useRef)(!1),(0,re.Z)().translateString),r=x((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),s=r.currentType,a=r.setCurrentType,i=(0,V.u)((function(e){return e.currentOrg})),o=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],c=(0,ln.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),u=c.agentResult,d=c.currentAgent,h=c.setAgentResult,f=c.setCurrentAgent,m=(0,y.useState)([]),g=l()(m,2),j=g[0],v=g[1],Z=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),k=Z.workgroupResult,w=Z.currentWorkgroup,C=Z.setWorkgroupResult,E=Z.setCurrentWorkgroup,S=(0,y.useState)(null==d?void 0:d.uid),A=l()(S,2),P=A[0],T=A[1],L=(0,y.useState)(null==w?void 0:w.uid),B=l()(L,2),W=B[0],D=B[1],F=(0,y.useState)([]),z=l()(F,2),q=z[0],N=z[1],O=function(){var e=I()(M()().mark((function e(){var n,r,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==i?void 0:i.uid},e.next=4,(0,nn._t)(n);case 4:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(R.yw.destroy(),h(r),r.data.content.length>0&&(f(r.data.content[0]),T(r.data.content[0].uid)),s=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};s.push(n)})),v(s)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=I()(M()().mark((function e(){var n,r,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==i?void 0:i.uid},e.next=4,(0,ae.LE)(n);case 4:r=e.sent,console.log("getWorkgroups",r),200===r.code?(R.yw.destroy(),C(r),r.data.content.length>0&&(E(r.data.content[0]),D(r.data.content[0].uid)),s=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};s.push(n)})),N(s)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){O(),U()}),[s]);var H=["web","npm"].includes((null==n?void 0:n.name)||"");return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(rn.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),a(e.target.value)},options:o,defaultValue:s,optionType:"button",buttonStyle:"solid"}),(0,b.jsx)("br",{}),(0,b.jsx)("br",{}),s===p.Njn&&(null==d?void 0:d.uid)&&(0,b.jsx)(rn.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=u.data.content.find((function(n){return n.uid===e.target.value}));f(n)},options:j,defaultValue:P,optionType:"button",buttonStyle:"solid"}),s===p.aZD&&(null==d?void 0:d.uid)&&(0,b.jsx)(rn.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=k.data.content.find((function(n){return n.uid===e.target.value}));E(n)},options:q,defaultValue:W,optionType:"button",buttonStyle:"solid"}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(on,{level:5,children:"组织orgUid"}),(0,b.jsx)(cn,{code:!0,copyable:!0,children:null==i?void 0:i.uid}),(0,b.jsx)(on,{level:5,children:"一对一当前客服Uid"}),(0,b.jsx)(cn,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,b.jsx)(on,{level:5,children:"当前技能组Uid"}),(0,b.jsx)(cn,{code:!0,copyable:!0,children:null==w?void 0:w.uid}),(0,b.jsx)(Pe.Z,{}),H&&("web"===(null==n?void 0:n.name)?(0,b.jsx)(tn.Z,{type:p.aZD}):"npm"===(null==n?void 0:n.name)?(0,b.jsx)(an,{}):null)]})};function dn(e){return pn.apply(this,arguments)}function pn(){return(pn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function hn(e){return fn.apply(this,arguments)}function fn(){return(fn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function mn(e){return xn.apply(this,arguments)}function xn(){return(xn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function gn(e){return jn.apply(this,arguments)}function jn(){return(jn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var yn=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(n){e((function(e){e.appResult.data.content.unshift(n)}))},updateApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("App with uid ".concat(n.uid," not found."))}))},deleteApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("App with uid ".concat(n.uid," not found."))}))},setAppResult:function(t){var r;(e({appResult:t}),""===n().currentApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:t.data.content[0]}))},setCurrentApp:function(t){var r=n().appResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().appResult),{},{data:{content:a}});e({appResult:l,currentApp:t})}else e({currentApp:t})},deleteCurrentApp:function(t){var r=n().appResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({appResult:c()(c()({},n().appResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("App not found in cache:",t),n().currentApp.uid===t&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),vn=t(44517),bn=function(e){var n=e.open,t=e.isEdit,r=e.app,s=e.onClose,a=e.onSubmit,i=(0,C.useIntl)(),o=ue.A.useForm(),u=l()(o,1)[0],d=(0,V.u)((function(e){return e.currentOrg})),h=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,y.useEffect)((function(){n&&t&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[n,t,r,u]),(0,b.jsx)(fe.Z,{title:t?i.formatMessage({id:"edit",defaultMessage:"编辑应用"}):i.formatMessage({id:"add",defaultMessage:"添加应用"}),width:600,open:n,onClose:s,maskClosable:!0,extra:(0,b.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,b.jsx)(ne.ZP,{onClick:s,children:i.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,b.jsx)(ne.ZP,{onClick:function(){u.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:t?r.uid:void 0});a(n)}))},type:"primary",children:i.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,b.jsxs)(ue.A,{form:u,layout:"vertical",submitter:!1,children:[(0,b.jsx)(de.Z,{name:"name",label:i.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:i.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:i.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,b.jsx)(pe.Z,{name:"appPlatform",label:i.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:i.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:i.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:h}),(0,b.jsx)(de.Z,{name:"appPackage",label:i.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:i.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:i.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,b.jsx)(de.Z,{name:"appKey",label:"App Key",placeholder:i.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,b.jsx)(ne.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:n})},children:"随机生成"})}}),(0,b.jsx)(de.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:i.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,b.jsx)(vn.Z,{name:"description",label:i.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:i.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},Zn=function(e){e.type;var n=(0,C.useIntl)(),t=(0,y.useRef)(!1),r=(0,re.Z)().translateStringTranct,s=(0,i.Z)().isDarkMode,a=(0,y.useState)(!1),o=l()(a,2),c=o[0],u=o[1],d=(0,y.useState)(!1),p=l()(d,2),h=p[0],f=p[1],m=(0,V.u)((function(e){return e.currentOrg})),x=yn((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),j=x.appResult,v=x.currentApp,Z=x.setAppResult,k=x.insertApp,w=x.setCurrentApp,E=x.deleteCurrentApp,S=$.Z.useModal(),A=l()(S,2),P=A[0],T=A[1],L=function(){var e=I()(M()().mark((function e(t){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete app",t),R.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除"})),e.next=4,gn(t);case 4:r=e.sent,console.log("delete app response",r),200===r.code?(R.yw.destroy(),R.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),E(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),B=function(){var e=I()(M()().mark((function e(){var n,r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=8,dn(n);case 8:r=e.sent,console.log("getApps",r),200===r.code?(R.yw.destroy(),Z(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){B()}),[]);var W=function(){var e=I()(M()().mark((function e(t){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,hn(t);case 2:r=e.sent,console.log("handleCreateApp response:",r),200===r.code?(k(r.data),u(!1),R.yw.success(n.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):R.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),D=function(){var e=I()(M()().mark((function e(t){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==v?void 0:v.uid,e.next=3,mn(t);case 3:r=e.sent,console.log("handleUpdateApp response:",r),200===r.code?(w(r.data),u(!1),R.yw.success(n.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):R.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,b.jsx)(ne.ZP,{size:"small",type:"primary",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){u(!0),f(!1)},children:n.formatMessage({id:"create",defaultMessage:"新建"})}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){f(!0),u(!0)},disabled:""===(null==v?void 0:v.uid),children:n.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,b.jsx)(ne.ZP,{size:"small",danger:!0,onClick:function(){return function(e){P.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(e.name,"】？"),onOk:function(){L(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(v)},disabled:""===(null==v?void 0:v.uid),children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:j.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:v.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){w(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(b.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,b.jsxs)("span",{style:{color:"#1677ff"},children:["(",r(null==e?void 0:e.appPlatform),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,b.jsx)(bn,{isEdit:h,open:c,app:v,onClose:function(){u(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),h?D(e):W(e)}}),T]})},kn=t(2523),wn=t(48006),Cn=t(40795),En=we.Z.Text,Sn=we.Z.Paragraph,Mn={android:(0,b.jsx)(kn.Z,{}),ios:(0,b.jsx)(wn.Z,{}),flutter:(0,b.jsx)(Cn.Z,{}),uniapp:(0,b.jsx)(Re.Z,{})},An={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},In=function(){var e=(0,C.useIntl)(),n=yn().currentApp;return null!=n&&n.uid?(0,b.jsxs)(Ce.Z,{title:(0,b.jsxs)(me.Z,{children:[Mn[n.appPlatform]||(0,b.jsx)(Cn.Z,{}),(0,b.jsx)("span",{children:n.name||"应用详情"}),(0,b.jsx)(Se.Z,{color:"blue",children:An[n.appPlatform]||n.appPlatform})]}),variant:"borderless",children:[(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,b.jsx)(En,{copyable:!0,children:n.uid})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:n.name}),n.appKey&&(0,b.jsx)(Me.Z.Item,{label:"App Key",children:(0,b.jsx)(En,{copyable:!0,children:n.appKey})}),"android"===n.appPlatform&&n.appPackage&&(0,b.jsx)(Me.Z.Item,{label:"Package Name",children:n.appPackage}),n.description&&(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(Sn,{children:n.description})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:n.createdAt})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(Sn,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的应用凭证（App Key 等），避免泄露"}),(0,b.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,b.jsx)(Ce.Z,{variant:"borderless",children:(0,b.jsx)(Ee.Z,{description:"请先选择或创建一个应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},Pn=t(69079),Tn=t(83941),Rn=we.Z.Title,Ln=we.Z.Paragraph,Bn=we.Z.Text,Wn=(we.Z.Link,w.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),Dn=function(){(0,C.useIntl)();var e=yn().currentApp,n=(0,V.u)((function(e){return e.currentOrg}));if(null==e||!e.uid)return(0,b.jsx)(Ce.Z,{variant:"borderless",children:(0,b.jsx)(Ee.Z,{description:"请先选择或创建一个应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})});return(0,b.jsxs)(Ce.Z,{title:"集成指南",variant:"borderless",extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(Pn.Z,{}),onClick:function(){var n=e.appPlatform,t=Wn[n];t?window.open(t,"_blank"):Tn.ZP.info("该平台暂无GitHub仓库链接")},children:"查看源码"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(sn.Z,{}),onClick:function(){window.open((0,v.L5)()+"/docs/zh-CN/docs/category/channel","_blank")},children:"查看文档"})]}),children:[(0,b.jsxs)(Rn,{level:4,children:["集成 ",e.name," (",e.appPlatform,")"]}),(0,b.jsxs)(Ln,{children:["以下是将客服功能集成到 ",e.name," 应用的步骤说明。请按照指南完成配置，使用提供的App Key和其他凭证进行初始化。"]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(Rn,{level:5,children:"1. 基本配置"}),(0,b.jsx)(Ln,{children:(0,b.jsxs)("ul",{children:[e.appKey&&(0,b.jsxs)("li",{children:[(0,b.jsx)(Bn,{strong:!0,children:"App Key:"})," ",(0,b.jsx)(Bn,{copyable:!0,children:e.appKey})]}),(0,b.jsxs)("li",{children:[(0,b.jsx)(Bn,{strong:!0,children:"组织ID:"})," ",(0,b.jsx)(Bn,{copyable:!0,children:null==n?void 0:n.uid})]})]})}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(Ln,{type:"secondary",children:"如果在集成过程中遇到任何问题，请联系技术支持团队：270580156@qq.com"})]})},Fn=function(e){console.log(e)},zn=[{key:"details",label:"应用详情",children:(0,b.jsx)(In,{})},{key:"integration",label:"集成指南",children:(0,b.jsx)(Dn,{})}],qn=function(e){e.type;var n=(0,y.useState)([]),t=l()(n,2),r=t[0],s=t[1];yn((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,y.useEffect)((function(){var e=[].concat(zn);s(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"details",items:r,onChange:Fn})})},Nn=s.Z.Sider,On=s.Z.Content,Un=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth;return(0,b.jsxs)(s.Z,{children:[(0,b.jsx)(Nn,{width:l,style:a,children:(0,b.jsx)(Zn,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(On,{children:(0,b.jsx)(qn,{type:n})})})]})};function Hn(e){return _n.apply(this,arguments)}function _n(){return(_n=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Vn(e){return Kn.apply(this,arguments)}function Kn(){return(Kn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Yn(e){return Jn.apply(this,arguments)}function Jn(){return Jn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Jn.apply(this,arguments)}function Gn(e){return Xn.apply(this,arguments)}function Xn(){return(Xn=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qn(e){return $n.apply(this,arguments)}function $n(){return $n=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),$n.apply(this,arguments)}function et(e){return nt.apply(this,arguments)}function nt(){return(nt=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/sync/start",{method:"POST",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var tt,rt=t(36099),st=t(93689),at=t(61338),lt=t(98976),it=t(58422),ot="IMAP",ct="POP3",ut="SMTP",dt="EXCHANGE",pt="QQ",ht="TENCENT_ENTERPRISE",ft="SINA",mt="GMAIL",xt="NETEASE_163",gt="NETEASE_ENTERPRISE",jt="ALIYUN_ENTERPRISE",yt="HOTMAIL",vt="FEISHU_ENTERPRISE",bt="YAHOO",Zt="OTHER",kt=(tt={},T()(T()(T()(T()(T()(T()(T()(T()(T()(T()(tt,pt,{smtpHost:"smtp.qq.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qq.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qq.com",pop3Port:995,pop3SslEnabled:!0}),ht,{smtpHost:"smtp.exmail.qq.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.exmail.qq.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.exmail.qq.com",pop3Port:995,pop3SslEnabled:!0}),ft,{smtpHost:"smtp.sina.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.sina.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.sina.com",pop3Port:995,pop3SslEnabled:!0}),mt,{smtpHost:"smtp.gmail.com",smtpPort:587,smtpSslEnabled:!1,smtpTlsEnabled:!0,imapHost:"imap.gmail.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.gmail.com",pop3Port:995,pop3SslEnabled:!0}),xt,{smtpHost:"smtp.163.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.163.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.163.com",pop3Port:995,pop3SslEnabled:!0}),gt,{smtpHost:"smtp.qiye.163.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qiye.163.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qiye.163.com",pop3Port:995,pop3SslEnabled:!0}),jt,{smtpHost:"smtp.qiye.aliyun.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qiye.aliyun.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qiye.aliyun.com",pop3Port:995,pop3SslEnabled:!0}),yt,{smtpHost:"smtp-mail.outlook.com",smtpPort:587,smtpSslEnabled:!1,smtpTlsEnabled:!0,imapHost:"outlook.office365.com",imapPort:993,imapSslEnabled:!0,pop3Host:"outlook.office365.com",pop3Port:995,pop3SslEnabled:!0}),vt,{smtpHost:"smtp.feishu.cn",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.feishu.cn",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.feishu.cn",pop3Port:995,pop3SslEnabled:!0}),bt,{smtpHost:"smtp.mail.yahoo.com",smtpPort:587,smtpSslEnabled:!1,smtpTlsEnabled:!0,imapHost:"imap.mail.yahoo.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.mail.yahoo.com",pop3Port:995,pop3SslEnabled:!0}),T()(tt,Zt,{smtpHost:"",smtpPort:587,smtpSslEnabled:!0,smtpTlsEnabled:!0,imapHost:"",imapPort:993,imapSslEnabled:!0,pop3Host:"",pop3Port:995,pop3SslEnabled:!0})),wt=function(e){var n=e.isEdit,t=e.email,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=(0,re.Z)().translateStringTranct,h=(0,V.u)((function(e){return e.currentOrg})),f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=(0,y.useState)(ot),Z=l()(j,2),k=Z[0],w=Z[1],C=(0,y.useState)(!1),E=l()(C,2),S=E[0],M=E[1],A=ce(),I=A.workgroups,P=A.getDefaultUid,T=A.getWorkgroupOptions,R=function(){console.log("handleSubmit"),g(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),o(n)})).catch((function(){g(!1)}))};(0,y.useEffect)((function(){if(n){var e=(null==t?void 0:t.protocol)||ot;w(e),d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||jt,protocol:e,enabled:!1!==(null==t?void 0:t.enabled),workgroupUid:null==t?void 0:t.workgroupUid,emailAddress:null==t?void 0:t.emailAddress,emailPassword:null==t?void 0:t.emailPassword,smtpHost:null==t?void 0:t.smtpHost,smtpPort:(null==t?void 0:t.smtpPort)||587,smtpSslEnabled:!1!==(null==t?void 0:t.smtpSslEnabled),smtpTlsEnabled:!1!==(null==t?void 0:t.smtpTlsEnabled),imapHost:null==t?void 0:t.imapHost,imapPort:(null==t?void 0:t.imapPort)||993,imapSslEnabled:!1!==(null==t?void 0:t.imapSslEnabled),pop3Host:null==t?void 0:t.pop3Host,pop3Port:(null==t?void 0:t.pop3Port)||995,pop3SslEnabled:!1!==(null==t?void 0:t.pop3SslEnabled),exchangeHost:null==t?void 0:t.exchangeHost,exchangePort:(null==t?void 0:t.exchangePort)||443,exchangeSslEnabled:!1!==(null==t?void 0:t.exchangeSslEnabled),senderName:null==t?void 0:t.senderName,syncInterval:(null==t?void 0:t.syncInterval)||5,autoSyncEnabled:!1!==(null==t?void 0:t.autoSyncEnabled),autoReplyEnabled:(null==t?void 0:t.autoReplyEnabled)||!1,autoReplyContent:null==t?void 0:t.autoReplyContent,debug:(null==t?void 0:t.debug)||!1})}else{var r=P();w(ot),d.setFieldsValue({name:"",description:"",type:jt,protocol:ot,enabled:!0,workgroupUid:r,emailAddress:"",emailPassword:"",smtpHost:"smtp.qiye.aliyun.com",smtpPort:465,smtpSslEnabled:!0,smtpTlsEnabled:!1,imapHost:"imap.qiye.aliyun.com",imapPort:993,imapSslEnabled:!0,pop3Host:"pop.qiye.aliyun.com",pop3Port:995,pop3SslEnabled:!0,exchangeHost:"",exchangePort:443,exchangeSslEnabled:!0,senderName:"",syncInterval:5,autoSyncEnabled:!0,autoReplyEnabled:!1,autoReplyContent:"",debug:!1})}}),[n,t,d,I]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"邮件应用配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:R,loading:x||a,children:x||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"emailForm",onFinish:R,submitter:!1,children:[(0,b.jsxs)(Ce.Z,{title:"基本信息",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(de.Z,{label:"应用名称",name:"name",rules:[{required:!0,message:"请输入应用名称"}],placeholder:"请输入邮件应用名称"}),(0,b.jsx)(de.Z,{label:"应用描述",name:"description",placeholder:"请输入应用描述，如：客服邮箱"}),(0,b.jsx)(pe.Z,{label:"邮箱类型",name:"type",options:[{label:"阿里云企业邮箱",value:jt},{label:"QQ邮箱",value:pt},{label:"腾讯企业邮箱",value:ht},{label:"新浪邮箱",value:ft},{label:"Gmail",value:mt},{label:"网易163邮箱",value:xt},{label:"网易企业邮箱",value:gt},{label:"Hotmail/Outlook",value:yt},{label:"飞书企业邮箱",value:vt},{label:"Yahoo邮箱",value:bt},{label:"其他邮箱",value:Zt}],rules:[{required:!0,message:"请选择邮箱类型"}],extra:"选择您使用的邮箱服务商类型，系统将自动填充相应的服务器配置",fieldProps:{onChange:function(e){var n=kt[e];n&&d.setFieldsValue({smtpHost:n.smtpHost,smtpPort:n.smtpPort,smtpSslEnabled:n.smtpSslEnabled,smtpTlsEnabled:n.smtpTlsEnabled,imapHost:n.imapHost,imapPort:n.imapPort,imapSslEnabled:n.imapSslEnabled,pop3Host:n.pop3Host,pop3Port:n.pop3Port,pop3SslEnabled:n.pop3SslEnabled})}}}),(0,b.jsx)(pe.Z,{label:"邮箱协议",name:"protocol",options:[{label:"IMAP协议(推荐)",value:ot},{label:"POP3协议",value:ct},{label:"SMTP协议",value:ut},{label:"Exchange协议",value:dt}],rules:[{required:!0,message:"请选择邮箱协议"}],extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/email#邮件协议说明",target:"_blank",rel:"noopener noreferrer",children:"邮件协议说明"}),fieldProps:{onChange:function(e){w(e)}}})]}),(0,b.jsxs)(Ce.Z,{title:"邮箱账户",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(de.Z,{label:(0,b.jsxs)("span",{children:["邮箱地址",(0,b.jsx)(Ie.Z,{title:"用于接收和发送邮件的邮箱地址",children:(0,b.jsx)(We.Z,{style:{marginLeft:4}})})]}),name:"emailAddress",rules:[{required:!0,message:"请输入邮箱地址"},{type:"email",message:"请输入有效的邮箱地址"}],placeholder:"example@company.com"}),(0,b.jsx)(de.Z.Password,{label:(0,b.jsxs)("span",{children:["邮箱密码/授权码",(0,b.jsx)(Ie.Z,{title:"邮箱密码或第三方应用授权码，建议使用授权码以提高安全性",children:(0,b.jsx)(We.Z,{style:{marginLeft:4}})})]}),name:"emailPassword",rules:[{required:!0,message:"请输入邮箱密码或授权码"}],placeholder:"请输入邮箱密码或授权码",extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/email#%E7%94%9F%E6%88%90%E4%B8%93%E6%9C%89%E5%AF%86%E7%A0%81%E9%9D%9E%E9%82%AE%E7%AE%B1%E7%99%BB%E5%BD%95%E5%AF%86%E7%A0%81",target:"_blank",rel:"noopener noreferrer",children:"查看如何获取邮箱密码/授权码说明"})}),(0,b.jsx)(de.Z,{label:(0,b.jsxs)("span",{children:["发件人显示名称",(0,b.jsx)(Ie.Z,{title:"邮件发送时显示的发件人名称",children:(0,b.jsx)(We.Z,{style:{marginLeft:4}})})]}),name:"senderName",placeholder:"客服中心",extra:"留空则使用邮箱地址作为发件人名称"})]}),(0,b.jsxs)(Ce.Z,{title:"SMTP服务器配置（发件）",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(de.Z,{label:(0,b.jsxs)("span",{children:["SMTP服务器地址",(0,b.jsx)(Ie.Z,{title:"查看SMTP服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"docs/zh-CN/docs/channel/email#smtp服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"smtpHost",rules:[{required:!0,message:"请输入SMTP服务器地址"}],placeholder:"smtp.gmail.com",extra:"用于发送邮件的SMTP服务器地址"}),(0,b.jsx)(lt.Z,{label:"SMTP端口",name:"smtpPort",min:1,max:65535,fieldProps:{precision:0},extra:"常用端口：25(不加密), 587(TLS), 465(SSL)"}),(0,b.jsx)(he.Z,{label:"启用SSL",name:"smtpSslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用SSL加密连接（端口通常为465）"}),(0,b.jsx)(he.Z,{label:"启用TLS",name:"smtpTlsEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用TLS加密连接（端口通常为587）"})]}),(0,b.jsxs)(Ce.Z,{title:"IMAP服务器配置（收件）",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(de.Z,{label:(0,b.jsxs)("span",{children:["IMAP服务器地址",(0,b.jsx)(Ie.Z,{title:"查看IMAP服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"docs/zh-CN/docs/channel/email#imap服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"imapHost",rules:k===ot?[{required:!0,message:"请输入IMAP服务器地址"}]:[],placeholder:"imap.gmail.com",extra:"用于接收邮件的IMAP服务器地址"}),(0,b.jsx)(lt.Z,{label:"IMAP端口",name:"imapPort",min:1,max:65535,fieldProps:{precision:0},extra:"常用端口：143(不加密), 993(SSL)"}),(0,b.jsx)(he.Z,{label:"IMAP启用SSL",name:"imapSslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用SSL加密IMAP连接"})]}),(0,b.jsxs)(Ce.Z,{title:"POP3服务器配置（收件）",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(de.Z,{label:(0,b.jsxs)("span",{children:["POP3服务器地址",(0,b.jsx)(Ie.Z,{title:"查看POP3服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"docs/zh-CN/docs/channel/email#pop3服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"pop3Host",rules:[{required:!0,message:"请输入POP3服务器地址"}],placeholder:"pop.gmail.com",extra:"POP3服务器地址，用于接收邮件"}),(0,b.jsx)(lt.Z,{label:"POP3端口",name:"pop3Port",min:1,max:65535,fieldProps:{precision:0},extra:"常用端口：110(不加密), 995(SSL)"}),(0,b.jsx)(he.Z,{label:"POP3启用SSL",name:"pop3SslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"使用SSL加密POP3连接"})]}),(0,b.jsxs)(Ce.Z,{title:"基本设置",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:T().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0,message:"请选择客服技能组"}],extra:"邮件消息将分配给选中的技能组处理"}),(0,b.jsx)(he.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理邮件"})]}),(0,b.jsx)("div",{style:{textAlign:"center",margin:"16px 0"},children:(0,b.jsx)(ne.ZP,{type:"dashed",onClick:function(){return M(!S)},icon:S?(0,b.jsx)("span",{children:"▼"}):(0,b.jsx)("span",{children:"▶"}),children:S?"收起高级设置":"展开高级设置"})}),S&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(Ce.Z,{title:"Exchange服务器配置（可选）",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(de.Z,{label:(0,b.jsxs)("span",{children:["Exchange服务器地址",(0,b.jsx)(Ie.Z,{title:"查看Exchange服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"docs/zh-CN/docs/channel/email#exchange服务器配置","_blank")},style:{cursor:"pointer",marginLeft:4}})})]}),name:"exchangeHost",rules:[{message:"请输入Exchange服务器地址"}],placeholder:"mail.company.com",extra:"Exchange服务器地址或Office 365服务器"}),(0,b.jsx)(lt.Z,{label:"Exchange端口",name:"exchangePort",min:1,max:65535,fieldProps:{precision:0},extra:"Exchange常用端口：443(HTTPS), 993(IMAP over SSL)"}),(0,b.jsx)(he.Z,{label:"启用SSL/TLS",name:"exchangeSslEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"Exchange服务器通常要求SSL/TLS加密"})]}),(0,b.jsxs)(Ce.Z,{title:"邮件同步设置",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(he.Z,{label:"自动同步邮件",name:"autoSyncEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"是否自动定期同步邮件".concat(k===ct?"（POP3协议会删除服务器邮件）":"")}),(0,b.jsx)(lt.Z,{label:"同步间隔（分钟）",name:"syncInterval",min:1,max:1440,fieldProps:{precision:0},extra:"邮件同步的时间间隔，建议".concat(k===ct?"10-60":"5-30","分钟")}),k===ct&&(0,b.jsxs)("div",{style:{background:"#fff7e6",border:"1px solid #ffd591",borderRadius:"6px",padding:"12px",margin:"12px 0"},children:[(0,b.jsx)("strong",{children:"注意："})," POP3协议会将邮件从服务器下载到本地，并可能删除服务器上的邮件副本。请谨慎配置同步间隔。"]})]}),(0,b.jsxs)(Ce.Z,{title:"自动回复设置",size:"small",style:{marginBottom:16},children:[(0,b.jsx)(he.Z,{label:"启用自动回复",name:"autoReplyEnabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"收到邮件时是否自动发送回复"}),(0,b.jsx)(vn.Z,{label:"自动回复内容",name:"autoReplyContent",fieldProps:{rows:4,maxLength:1e3,showCount:!0},placeholder:"感谢您的邮件，我们已收到并将尽快回复您。",extra:"启用自动回复时发送的内容，最多1000字符"})]}),(0,b.jsx)(Ce.Z,{title:"调试设置",size:"small",style:{marginBottom:16},children:(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"})})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsxs)("div",{style:{color:"#666",fontSize:"12px"},children:[(0,b.jsx)("p",{children:(0,b.jsx)("strong",{children:"协议说明："})}),k===ot&&(0,b.jsxs)("div",{children:["• IMAP协议支持多设备同步，邮件保留在服务器上",(0,b.jsx)("br",{}),"• 需要配置SMTP用于发送邮件，IMAP用于接收邮件",(0,b.jsx)("br",{}),"• 推荐端口：IMAP 993(SSL), SMTP 587(TLS)或465(SSL)"]}),k===ct&&(0,b.jsxs)("div",{children:["• POP3协议会将邮件下载到本地，可能从服务器删除",(0,b.jsx)("br",{}),"• 需要配置SMTP用于发送邮件，POP3用于接收邮件",(0,b.jsx)("br",{}),"• 推荐端口：POP3 995(SSL), SMTP 587(TLS)或465(SSL)",(0,b.jsx)("br",{}),"• ",(0,b.jsx)("span",{style:{color:"#fa8c16"},children:"注意：POP3不支持多设备同步"})]}),k===ut&&(0,b.jsxs)("div",{children:["• SMTP协议仅用于发送邮件，无法接收邮件",(0,b.jsx)("br",{}),"• 推荐端口：587(TLS)或465(SSL)",(0,b.jsx)("br",{}),"• 适用于只需要发送邮件通知的场景"]}),k===dt&&(0,b.jsxs)("div",{children:["• Exchange协议适用于Microsoft Exchange服务器和Office 365",(0,b.jsx)("br",{}),"• 支持邮件、日历、联系人等功能",(0,b.jsx)("br",{}),"• 通常使用443端口(HTTPS)或993端口(IMAP over SSL)",(0,b.jsx)("br",{}),"• 需要企业管理员配置相关权限"]}),(0,b.jsxs)("p",{style:{marginTop:"12px"},children:[(0,b.jsx)("strong",{children:"通用提示："}),(0,b.jsx)("br",{}),"• 请确保邮箱服务商已开启相应协议服务",(0,b.jsx)("br",{}),"• Gmail等邮箱建议使用应用专用密码而非账户密码",(0,b.jsx)("br",{}),"• 建议启用SSL/TLS加密以提高安全性"]})]})]})})})},Ct=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{emailResult:{data:{content:[]}},currentEmail:{uid:"",nickname:"",avatar:"",description:""},insertEmail:function(n){e((function(e){e.emailResult.data.content.unshift(n)}))},updateEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Email with uid ".concat(n.uid," not found."))}))},deleteEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Email with uid ".concat(n.uid," not found."))}))},setEmailResult:function(t){var r;(e({emailResult:t}),""===n().currentEmail.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentEmail:t.data.content[0]}))},setCurrentEmail:function(t){var r=n().emailResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().emailResult),{},{data:{content:a}});e({emailResult:l,currentEmail:t})}else console.warn("Email with the specified uid not found."),e({currentEmail:t})},refreshCurrentEmail:function(n){e((function(e){e.currentEmail=c()(c()({},e.currentEmail),n);var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentEmail:function(t){var r=n().emailResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({emailResult:c()(c()({},n().emailResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("Email not found in cache:",t),n().currentEmail.uid===t&&e({currentEmail:{uid:""}})},deleteEmailCache:function(){return e({},!0)}}})),{name:p.e73}))),Et=function(e){var n=e.type,t=(0,C.useIntl)(),r=(0,y.useRef)(!1),s=(0,re.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,o=(0,y.useState)(!1),u=l()(o,2),d=u[0],p=u[1],h=(0,y.useState)(!1),f=l()(h,2),m=f[0],x=f[1],j=(0,y.useState)(!1),v=l()(j,2),Z=v[0],k=v[1],w=(0,V.u)((function(e){return e.currentOrg})),E=(0,y.useState)(null),S=l()(E,2),A=S[0],P=S[1],T=Ct((function(e){return{emailResult:e.emailResult,currentEmail:e.currentEmail,setEmailResult:e.setEmailResult,insertEmail:e.insertEmail,setCurrentEmail:e.setCurrentEmail,deleteCurrentEmail:e.deleteCurrentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})),L=T.emailResult,B=T.currentEmail,W=T.setEmailResult,D=T.insertEmail,F=T.setCurrentEmail,z=T.deleteCurrentEmail,q=T.refreshCurrentEmail,N=$.Z.useModal(),O=l()(N,2),U=O[0],H=O[1],_=function(){var e=I()(M()().mark((function e(n){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete email",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Qn(n);case 4:r=e.sent,console.log("delete email response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==w?void 0:w.uid},e.next=8,Hn(n);case 8:t=e.sent,console.log("getEmails response:",t,n),200===t.code?(R.yw.destroy(),W(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){se();var e=function(e){x(!0),p(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var ae=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,ie(n);case 6:e.next=10;break;case 8:return e.next=10,le(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Yn(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateEmail response:",t),200===t.code?(D(t.data),F(t.data),p(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==B?void 0:B.uid,R.yw.loading("正在更新..."),e.next=4,Gn(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateEmail response:",t),200===t.code?(F(t.data),p(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=I()(M()().mark((function e(n,t){var r,s,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(n.uid),e.prev=1,e.next=4,Gn({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateEmail enabled response",r),200===r.code?(R.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=L&&null!==(s=L.data)&&void 0!==s&&s.content&&(a=L.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),W(c()(c()({},L),{},{data:c()(c()({},L.data),{},{content:a})}))),(null==B?void 0:B.uid)===n.uid&&q&&q(r.data)):R.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,P(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){p(!0),x(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:se,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==B?void 0:B.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){x(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==B.enabled?(0,b.jsx)(rt.Z,{}):(0,b.jsx)(st.Z,{}),label:!1!==B.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return oe(B,!1===B.enabled)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){U.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(B)}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:L.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:B.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){F(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsx)("div",{style:{display:"flex",flexDirection:"column",gap:"6px"},children:(0,b.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px",flexWrap:"nowrap"},children:[(0,b.jsx)("span",{style:{fontWeight:"bold",minWidth:"fit-content"},children:s(null==e?void 0:e.name)}),(0,b.jsx)(at.Z,{spinning:A===(null==e?void 0:e.uid),size:"small",children:(0,b.jsx)(Se.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),style:{fontSize:"11px"},children:!1!==(null==e?void 0:e.enabled)?"启用":"禁用"})})]})}),description:(0,b.jsxs)("div",{style:{marginTop:"4px"},children:[(0,b.jsx)("div",{style:{color:"#666",fontSize:"13px",marginBottom:"2px"},children:s(null==e?void 0:e.description)}),(null==e?void 0:e.emailAddress)&&(0,b.jsxs)("div",{style:{color:"#999",fontSize:"11px",marginBottom:"2px"},children:["邮箱：",e.emailAddress]}),(null==e?void 0:e.lastSyncTime)&&(0,b.jsxs)("div",{style:{color:"#999",fontSize:"11px"},children:["最后同步：",new Date(e.lastSyncTime).toLocaleString()]})]})})})}}),d&&(0,b.jsx)(wt,{type:n,isEdit:m,open:d,loading:Z,email:B,onClose:function(){p(!1)},onSubmit:ae}),H]})},St=t(60762),Mt=t(99098),At=t(64890),It=t(31806),Pt=t(16852),Tt=we.Z.Text,Rt=we.Z.Paragraph,Lt={QQ:"QQ邮箱",TENCENT_ENTERPRISE:"腾讯企业邮箱",SINA:"新浪邮箱",GMAIL:"Gmail",NETEASE_163:"网易163邮箱",NETEASE_ENTERPRISE:"网易企业邮箱",ALIYUN_ENTERPRISE:"阿里云企业邮箱",HOTMAIL:"Hotmail/Outlook",FEISHU_ENTERPRISE:"飞书企业邮箱",YAHOO:"Yahoo邮箱"},Bt={IMAP:"IMAP协议",POP3:"POP3协议",SMTP:"SMTP协议",EXCHANGE:"Exchange协议"},Wt={QQ:(0,b.jsx)(It.Z,{}),TENCENT_ENTERPRISE:(0,b.jsx)(It.Z,{}),SINA:(0,b.jsx)(It.Z,{}),GMAIL:(0,b.jsx)(It.Z,{}),NETEASE_163:(0,b.jsx)(It.Z,{}),NETEASE_ENTERPRISE:(0,b.jsx)(It.Z,{}),ALIYUN_ENTERPRISE:(0,b.jsx)(It.Z,{}),HOTMAIL:(0,b.jsx)(It.Z,{}),FEISHU_ENTERPRISE:(0,b.jsx)(It.Z,{}),YAHOO:(0,b.jsx)(It.Z,{})},Dt=function(){var e,n,t=Ct((function(e){return{currentEmail:e.currentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})),r=t.currentEmail,s=t.refreshCurrentEmail,a=(0,y.useState)(!1),i=l()(a,2),o=i[0],c=i[1],u=(0,y.useState)(!1),d=l()(u,2),p=d[0],h=d[1],f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=(0,y.useState)(!1),Z=l()(j,2),k=Z[0],w=Z[1],C=(0,y.useState)(!1),E=l()(C,2),S=E[0],A=E[1],P=function(){var e=I()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return h(!0),e.prev=4,e.next=7,Vn({uid:r.uid});case 7:n=e.sent,console.log("queryEmailByUid refresh detail",n),200===n.code?(t=n.data,R.yw.success("应用详情刷新成功"),s&&s(t)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,h(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return g(!0),e.prev=4,e.next=7,Gn({uid:r.uid,enabled:n});case 7:t=e.sent,console.log("updateEmail enabled response",t),200===t.code?(R.yw.success("应用已".concat(n?"启用":"禁用")),s&&s(t.data)):R.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,g(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),L=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return w(!0),e.prev=4,e.next=7,Gn({uid:r.uid,debug:n});case 7:t=e.sent,console.log("updateEmail debug response",t),200===t.code?(R.yw.success("调试模式已".concat(n?"开启":"关闭")),s&&s(t.data)):R.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,w(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),B=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法启动同步，应用信息不完整"),e.abrupt("return");case 3:return A(!0),e.prev=4,e.next=7,et({uid:r.uid});case 7:n=e.sent,console.log("startEmailSync response",n),200===n.code?(R.yw.success("同步任务启动成功"),P()):R.yw.error("启动同步失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("启动同步出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,A(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,b.jsxs)(Ce.Z,{title:(0,b.jsxs)(me.Z,{children:[Wt[r.type]||(0,b.jsx)(It.Z,{}),(0,b.jsx)("span",{children:r.name||"邮件应用详情"}),(0,b.jsx)(Se.Z,{color:"blue",children:Lt[r.type]||r.type}),r.protocol&&(0,b.jsx)(Se.Z,{color:"green",children:Bt[r.protocol]||r.protocol}),(0,b.jsx)(Se.Z,{color:!1!==r.enabled?"success":"default",icon:!1!==r.enabled?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==r.enabled?"已启用":"已禁用"})]}),extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(ze.Z,{}),onClick:B,loading:S,type:"default",children:"同步"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:P,loading:p,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[(0,b.jsxs)(St.Z,{gutter:16,style:{marginBottom:16},children:[(0,b.jsx)(Mt.Z,{span:24,children:(0,b.jsx)(At.Z,{message:(0,b.jsxs)(me.Z,{children:["CONNECTED"===r.connectionStatus?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(st.Z,{style:{color:"#52c41a"}}),(0,b.jsx)("span",{style:{color:"#52c41a"},children:"连接成功"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(Pt.Z,{style:{color:"#ff4d4f"}}),(0,b.jsx)("span",{style:{color:"#ff4d4f"},children:"连接失败"})]}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:P,loading:p,type:"link",children:"刷新状态"})]}),type:"CONNECTED"===r.connectionStatus?"success":"error"})}),r.connectionError&&(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(At.Z,{message:"连接错误",description:(0,b.jsx)(Ie.Z,{title:r.connectionError,children:(0,b.jsx)("div",{style:{maxWidth:"100%",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},children:r.connectionError})}),type:"error",showIcon:!0,icon:(0,b.jsx)(K.Z,{}),style:{height:"100%"}})})]}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:"应用UID",children:(0,b.jsx)(Tt,{copyable:!0,children:r.uid})}),(0,b.jsx)(Me.Z.Item,{label:"应用名称",children:r.name}),(0,b.jsx)(Me.Z.Item,{label:"应用描述",children:r.description||"-"}),(0,b.jsx)(Me.Z.Item,{label:"邮箱类型",children:(0,b.jsx)(Se.Z,{color:"blue",children:Lt[r.type]||r.type})}),r.protocol&&(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"邮箱协议"}),(0,b.jsx)(Ie.Z,{title:"查看邮箱协议说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/email#邮件协议说明","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsx)(Se.Z,{color:"green",children:Bt[r.protocol]||r.protocol})}),(0,b.jsx)(Me.Z.Item,{label:"启用状态",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:!1!==r.enabled,onChange:T,loading:x,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,b.jsx)(Tt,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:r.debug||!1,onChange:L,loading:k,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,b.jsx)(Tt,{type:r.debug?"warning":"secondary",children:r.debug?"已开启":"已关闭"})]})})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"邮箱账户信息"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:"邮箱地址",children:(0,b.jsx)(Tt,{copyable:!0,children:r.emailAddress||"-"})}),(0,b.jsx)(Me.Z.Item,{label:"邮箱密码/授权码",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Tt,{copyable:!!o&&{text:r.emailPassword||""},children:(e=r.emailPassword,n=o,e?n?e:"*".repeat(Math.min(e.length,12)):"-")}),(0,b.jsx)(Ie.Z,{title:o?"隐藏密码":"显示密码",children:(0,b.jsx)(ne.ZP,{type:"text",icon:o?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){c(!o)},size:"small"})}),(0,b.jsx)(Ie.Z,{title:"如何获取邮箱密码/授权码？",children:(0,b.jsx)(ne.ZP,{type:"text",icon:(0,b.jsx)(it.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/email#如何获取邮箱密码","_blank")},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"发件人显示名称",children:r.senderName||"-"})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"SMTP服务器配置（发件）"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"SMTP服务器地址"}),(0,b.jsx)(Ie.Z,{title:"查看SMTP服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/email#smtp服务器配置","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsx)(Tt,{copyable:!0,children:r.smtpHost||"-"})}),(0,b.jsx)(Me.Z.Item,{label:"SMTP端口",children:r.smtpPort||"-"}),(0,b.jsx)(Me.Z.Item,{label:"SMTP SSL",children:(0,b.jsx)(Se.Z,{color:r.smtpSslEnabled?"success":"default",children:r.smtpSslEnabled?"已启用":"未启用"})}),(0,b.jsx)(Me.Z.Item,{label:"SMTP TLS",children:(0,b.jsx)(Se.Z,{color:r.smtpTlsEnabled?"success":"default",children:r.smtpTlsEnabled?"已启用":"未启用"})})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"IMAP服务器配置（收件）"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"IMAP服务器地址"}),(0,b.jsx)(Ie.Z,{title:"查看IMAP服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"docs/zh-CN/docs/channel/email#imap服务器配置","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsx)(Tt,{copyable:!0,children:r.imapHost||"-"})}),(0,b.jsx)(Me.Z.Item,{label:"IMAP端口",children:r.imapPort||"-"}),(0,b.jsx)(Me.Z.Item,{label:"IMAP SSL",children:(0,b.jsx)(Se.Z,{color:r.imapSslEnabled?"success":"default",children:r.imapSslEnabled?"已启用":"未启用"})})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"POP3服务器配置（备选收件）"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"POP3服务器地址"}),(0,b.jsx)(Ie.Z,{title:"查看POP3服务器配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.V)()+"docs/zh-CN/docs/channel/email#pop3服务器配置","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsx)(Tt,{copyable:!0,children:r.pop3Host||"-"})}),(0,b.jsx)(Me.Z.Item,{label:"POP3端口",children:r.pop3Port||"-"}),(0,b.jsx)(Me.Z.Item,{label:"POP3 SSL",children:(0,b.jsx)(Se.Z,{color:r.pop3SslEnabled?"success":"default",children:r.pop3SslEnabled?"已启用":"未启用"})})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"邮件同步设置"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:"自动同步",children:(0,b.jsx)(Se.Z,{color:r.autoSyncEnabled?"success":"default",children:r.autoSyncEnabled?"已启用":"已禁用"})}),(0,b.jsx)(Me.Z.Item,{label:"同步间隔",children:r.syncInterval?"".concat(r.syncInterval," 分钟"):"-"}),(0,b.jsx)(Me.Z.Item,{label:"最后同步时间",children:r.lastSyncTime?Ne()(r.lastSyncTime).format("YYYY-MM-DD HH:mm:ss"):"未同步"})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"自动回复设置"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:"自动回复",children:(0,b.jsx)(Se.Z,{color:r.autoReplyEnabled?"success":"default",children:r.autoReplyEnabled?"已启用":"已禁用"})}),r.autoReplyEnabled&&(0,b.jsx)(Me.Z.Item,{label:"自动回复内容",children:(0,b.jsx)(Rt,{copyable:!0,ellipsis:{rows:3,expandable:!0,symbol:"展开"},children:r.autoReplyContent||"-"})})]}),(0,b.jsx)(Pe.Z,{orientation:"left",children:"其他信息"}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:"创建时间",children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),(0,b.jsx)(Me.Z.Item,{label:"更新时间",children:r.updatedAt?Ne()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(Rt,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的邮箱密码和授权码，避免泄露给他人"}),(0,b.jsx)("li",{children:"建议使用邮箱服务商提供的应用专用密码，而非账户登录密码"}),(0,b.jsx)("li",{children:"定期检查邮箱访问日志，确保没有异常登录"}),(0,b.jsx)("li",{children:"为邮箱账户启用双重身份验证（2FA）以提高安全性"}),(0,b.jsx)("li",{children:"确保SMTP/IMAP/POP3连接使用SSL/TLS加密"}),(0,b.jsx)("li",{children:"建议定期更换邮箱密码和授权码"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,b.jsx)("li",{children:"应用启用状态控制着是否接收和处理邮件，禁用后将暂停邮件处理"})]})})]}):(0,b.jsx)(Ce.Z,{variant:"borderless",title:"邮件应用详情",extra:(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),children:(0,b.jsx)(Ee.Z,{description:"请先在左侧列表选择一个邮件应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},Ft=t(30915),zt=t(37141),qt=t(40209),Nt=t(86994),Ot=t(77647);function Ut(e){return Ht.apply(this,arguments)}function Ht(){return(Ht=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/message/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _t(e){return Vt.apply(this,arguments)}function Vt(){return Vt=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/message/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Vt.apply(this,arguments)}function Kt(e){return Yt.apply(this,arguments)}function Yt(){return Yt=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/message/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Yt.apply(this,arguments)}function Jt(e){return Gt.apply(this,arguments)}function Gt(){return Gt=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/message/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Gt.apply(this,arguments)}function Xt(e){return Qt.apply(this,arguments)}function Qt(){return Qt=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/email/message/send",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Qt.apply(this,arguments)}var $t=t(54985),er=t(97868),nr=t(88638),tr=$t.Z.TextArea,rr=er.Z.Option,sr=we.Z.Title,ar=function(e){var n=e.open,t=e.onClose,r=e.onSuccess,s=(e.workgroupUid,e.replyToEmail),a=nr.Z.useForm(),i=l()(a,1)[0],o=y.useState(!1),u=l()(o,2),d=u[0],p=u[1],h=Ct((function(e){return e.currentEmail})),f=!!s,m=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return p(!0),e.prev=1,e.next=4,Xt(c()(c()({},n),{},{emailConfigUid:null==h?void 0:h.uid}));case 4:200===(s=e.sent).code?(R.yw.success("邮件发送成功"),i.resetFields(),t(),null==r||r()):R.yw.error(s.message||"邮件发送失败"),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),R.yw.error("邮件发送失败");case 11:return e.prev=11,p(!1),e.finish(11);case 14:case"end":return e.stop()}}),e,null,[[1,8,11,14]])})));return function(n){return e.apply(this,arguments)}}(),x=function(){i.resetFields(),t()};return y.useEffect((function(){if(n&&f&&s){var e,t=null!==(e=s.subject)&&void 0!==e&&e.startsWith("Re:")?s.subject:"Re: ".concat(s.subject||""),r="\n\n---------- 原始邮件 ----------\n发件人: ".concat(s.fromName||""," <").concat(s.fromAddress||"",">\n发送时间: ").concat(s.emailDate?new Date(s.emailDate).toLocaleString():"","\n收件人: ").concat(s.toAddresses||"","\n主题: ").concat(s.subject||"","\n\n").concat(s.contentText||"");i.setFieldsValue({subject:t,toAddresses:s.fromAddress,textContent:r})}else n&&!f&&i.resetFields()}),[n,f,s,i]),(0,b.jsx)(fe.Z,{title:(0,b.jsxs)(me.Z,{children:[f?(0,b.jsx)(Nt.Z,{}):(0,b.jsx)(Ot.Z,{}),(0,b.jsx)(sr,{level:4,style:{margin:0},children:f?"回复邮件":"发送邮件"})]}),open:n,onClose:x,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:x,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",icon:f?(0,b.jsx)(Nt.Z,{}):(0,b.jsx)(Ot.Z,{}),loading:d,onClick:function(){return i.submit()},children:f?"回复":"发送"})]}),children:(0,b.jsxs)(nr.Z,{form:i,layout:"vertical",onFinish:m,initialValues:{priority:3,requestReceipt:!1,encoding:"UTF-8"},children:[(0,b.jsx)(nr.Z.Item,{label:"发送者邮箱",children:(0,b.jsx)($t.Z,{value:(null==h?void 0:h.emailAddress)||"未选择邮箱",readOnly:!0,disabled:!0,style:{backgroundColor:"#f5f5f5"}})}),(0,b.jsx)(nr.Z.Item,{name:"subject",label:"邮件主题",rules:[{required:!0,message:"请输入邮件主题"}],children:(0,b.jsx)($t.Z,{placeholder:"请输入邮件主题"})}),(0,b.jsx)(nr.Z.Item,{name:"toAddresses",label:"收件人",rules:[{required:!0,message:"请输入收件人邮箱"}],children:(0,b.jsx)($t.Z,{placeholder:"收件人邮箱地址，多个用逗号分隔"})}),(0,b.jsxs)(St.Z,{gutter:16,children:[(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"ccAddresses",label:"抄送",children:(0,b.jsx)($t.Z,{placeholder:"抄送邮箱地址，多个用逗号分隔"})})}),(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"bccAddresses",label:"密送",children:(0,b.jsx)($t.Z,{placeholder:"密送邮箱地址，多个用逗号分隔"})})})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(nr.Z.Item,{name:"textContent",label:"邮件内容（文本）",rules:[{required:!0,message:"请输入邮件内容"}],children:(0,b.jsx)(tr,{rows:8,placeholder:"请输入邮件文本内容",showCount:!0,maxLength:5e3})}),(0,b.jsx)(nr.Z.Item,{name:"htmlContent",label:"邮件内容（HTML）",help:"可选，如果填写HTML内容，将以HTML格式发送",children:(0,b.jsx)(tr,{rows:6,placeholder:"邮件HTML内容（可选）",showCount:!0,maxLength:1e4})}),(0,b.jsx)(Pe.Z,{}),(0,b.jsxs)(St.Z,{gutter:16,children:[(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"priority",label:"优先级",children:(0,b.jsxs)(er.Z,{placeholder:"选择优先级",children:[(0,b.jsx)(rr,{value:1,children:"高优先级"}),(0,b.jsx)(rr,{value:3,children:"普通优先级"}),(0,b.jsx)(rr,{value:5,children:"低优先级"})]})})}),(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"requestReceipt",label:"请求送达回执",children:(0,b.jsxs)(er.Z,{placeholder:"是否请求送达回执",children:[(0,b.jsx)(rr,{value:!0,children:"是"}),(0,b.jsx)(rr,{value:!1,children:"否"})]})})})]}),(0,b.jsx)(nr.Z.Item,{name:"encoding",label:"邮件编码",children:(0,b.jsxs)(er.Z,{placeholder:"选择邮件编码",children:[(0,b.jsx)(rr,{value:"UTF-8",children:"UTF-8"}),(0,b.jsx)(rr,{value:"GBK",children:"GBK"}),(0,b.jsx)(rr,{value:"ISO-8859-1",children:"ISO-8859-1"})]})})]})})},lr=function(e){var n=e.content,t=e.style,r=e.maxHeight,s=void 0===r?300:r,a=e.showBorder,l=void 0===a||a,i=e.className;if(!n||""===n.trim())return(0,b.jsx)("div",{className:i,style:c()({border:l?"1px solid #d9d9d9":"none",borderRadius:"6px",padding:"16px",minHeight:"60px",display:"flex",alignItems:"center",justifyContent:"center",backgroundColor:"#fafafa"},t),children:(0,b.jsx)(Ee.Z,{description:"无内容",image:Ee.Z.PRESENTED_IMAGE_SIMPLE,style:{margin:0}})});return(0,b.jsx)("div",{className:i,style:c()({border:l?"1px solid #d9d9d9":"none",borderRadius:"6px",padding:"12px",backgroundColor:"#fff",maxHeight:s,overflow:"auto"},t),children:(0,b.jsx)("div",{dangerouslySetInnerHTML:{__html:n},style:{lineHeight:1.6,fontSize:"14px",color:"#333",wordWrap:"break-word",wordBreak:"break-all"}})})},ir=t(55785),or=$t.Z.TextArea,cr=er.Z.Option,ur=we.Z.Title,dr=we.Z.Text,pr=function(e){var n=e.open,t=e.onClose,r=e.onSuccess,s=e.workgroupUid,a=e.editingRecord,i=e.mode,o=void 0===i?"view":i,u=nr.Z.useForm(),d=l()(u,1)[0],p=y.useState(!1),h=l()(p,2),f=h[0],m=h[1],x="view"===o,g="edit"===o,j="create"===o;y.useEffect((function(){n&&a?d.setFieldsValue(a):n&&j&&d.resetFields()}),[n,a,d,j]);var v,Z,k=function(){var e=I()(M()().mark((function e(n){var t,l,i;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(!0),e.prev=1,!g||!a){e.next=9;break}return e.next=5,Kt(c()(c()({},n),{},{uid:a.uid,workgroupUid:s}));case 5:200===(l=e.sent).code&&Tn.ZP.success("更新成功"),e.next=14;break;case 9:if(!j){e.next=14;break}return e.next=12,_t(c()(c()({},n),{},{workgroupUid:s}));case 12:200===(l=e.sent).code&&Tn.ZP.success("创建成功");case 14:200===(null===(t=l)||void 0===t?void 0:t.code)?(w(),null==r||r()):Tn.ZP.error((null===(i=l)||void 0===i?void 0:i.message)||"操作失败"),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(1),Tn.ZP.error("保存失败");case 20:return e.prev=20,m(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[1,17,20,23]])})));return function(n){return e.apply(this,arguments)}}(),w=function(){d.resetFields(),t()};return(0,b.jsx)(fe.Z,{title:(0,b.jsxs)(me.Z,{children:[x?(0,b.jsx)(Fe.Z,{}):(0,b.jsx)(G.Z,{}),(0,b.jsx)(ur,{level:4,style:{margin:0},children:x?"邮件详情":g?"编辑邮件记录":j?"新增邮件记录":"邮件记录"})]}),open:n,onClose:w,width:700,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:w,children:"取消"}),!x&&(0,b.jsx)(ne.ZP,{type:"primary",icon:(0,b.jsx)(ir.Z,{}),loading:f,onClick:function(){return d.submit()},children:"保存"})]}),children:x?(0,b.jsx)("div",{children:(0,b.jsxs)(Me.Z,{column:1,bordered:!0,children:[(0,b.jsx)(Me.Z.Item,{label:"邮件主题",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(It.Z,{}),(0,b.jsx)(dr,{strong:!0,children:(null==a?void 0:a.subject)||"无主题"})]})}),(0,b.jsx)(Me.Z.Item,{label:"邮件ID",children:(null==a?void 0:a.messageId)||"-"}),(0,b.jsx)(Me.Z.Item,{label:"发件人",children:(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:(0,b.jsx)(dr,{strong:!0,children:(null==a?void 0:a.fromName)||"未知"})}),(0,b.jsx)(dr,{type:"secondary",children:null==a?void 0:a.fromAddress})]})}),(0,b.jsx)(Me.Z.Item,{label:"收件人",children:(null==a?void 0:a.toAddresses)||"-"}),(0,b.jsx)(Me.Z.Item,{label:"抄送",children:(null==a?void 0:a.ccAddresses)||"-"}),(0,b.jsx)(Me.Z.Item,{label:"密送",children:(null==a?void 0:a.bccAddresses)||"-"}),(0,b.jsx)(Me.Z.Item,{label:"状态",children:null!=a&&a.status?(v=a.status,Z={SUCCESS:{color:"green",text:"成功"},FAILED:{color:"red",text:"失败"},PENDING:{color:"orange",text:"待发送"},RETRY:{color:"blue",text:"重试中"}}[v]||{color:"default",text:"未知"},(0,b.jsx)(Se.Z,{color:Z.color,children:Z.text})):"-"}),(0,b.jsx)(Me.Z.Item,{label:"重要性",children:null!=a&&a.important?(0,b.jsx)(Se.Z,{color:"red",children:"重要"}):(0,b.jsx)(Se.Z,{children:"普通"})}),(0,b.jsx)(Me.Z.Item,{label:"是否有附件",children:null!=a&&a.hasAttachments?(0,b.jsx)(Se.Z,{color:"blue",children:"有附件"}):(0,b.jsx)(Se.Z,{children:"无附件"})}),(0,b.jsx)(Me.Z.Item,{label:"邮件时间",children:null!=a&&a.emailDate?new Date(a.emailDate).toLocaleString():"-"}),(0,b.jsx)(Me.Z.Item,{label:"邮件大小",children:null!=a&&a.emailSize?"".concat((a.emailSize/1024).toFixed(1),"KB"):"-"}),(0,b.jsx)(Me.Z.Item,{label:"邮件内容（文本）",children:(0,b.jsx)("div",{style:{maxHeight:"200px",overflow:"auto",whiteSpace:"pre-wrap",backgroundColor:"#f5f5f5",padding:"8px",borderRadius:"4px"},children:(null==a?void 0:a.contentText)||"无内容"})}),(null==a?void 0:a.contentHtml)&&(0,b.jsx)(Me.Z.Item,{label:"邮件内容（HTML）",children:(0,b.jsx)(lr,{content:a.contentHtml,maxHeight:300,style:{backgroundColor:"#f5f5f5"}})}),(null==a?void 0:a.errorMessage)&&(0,b.jsx)(Me.Z.Item,{label:"错误信息",children:(0,b.jsx)(dr,{type:"danger",children:a.errorMessage})})]})}):(0,b.jsxs)(nr.Z,{form:d,layout:"vertical",onFinish:k,children:[(0,b.jsxs)(St.Z,{gutter:16,children:[(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"subject",label:"邮件主题",rules:[{required:!0,message:"请输入邮件主题"}],children:(0,b.jsx)($t.Z,{placeholder:"请输入邮件主题"})})}),(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"messageId",label:"邮件ID",children:(0,b.jsx)($t.Z,{placeholder:"邮件唯一标识符"})})})]}),(0,b.jsxs)(St.Z,{gutter:16,children:[(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"fromAddress",label:"发件人邮箱",rules:[{required:!0,message:"请输入发件人邮箱"},{type:"email",message:"请输入有效的邮箱地址"}],children:(0,b.jsx)($t.Z,{placeholder:"发件人邮箱地址"})})}),(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"fromName",label:"发件人姓名",children:(0,b.jsx)($t.Z,{placeholder:"发件人姓名"})})})]}),(0,b.jsx)(nr.Z.Item,{name:"toAddresses",label:"收件人",rules:[{required:!0,message:"请输入收件人邮箱"}],children:(0,b.jsx)($t.Z,{placeholder:"收件人邮箱地址，多个用逗号分隔"})}),(0,b.jsxs)(St.Z,{gutter:16,children:[(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"ccAddresses",label:"抄送",children:(0,b.jsx)($t.Z,{placeholder:"抄送邮箱地址，多个用逗号分隔"})})}),(0,b.jsx)(Mt.Z,{span:12,children:(0,b.jsx)(nr.Z.Item,{name:"bccAddresses",label:"密送",children:(0,b.jsx)($t.Z,{placeholder:"密送邮箱地址，多个用逗号分隔"})})})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(nr.Z.Item,{name:"contentText",label:"邮件内容（文本）",children:(0,b.jsx)(or,{rows:6,placeholder:"邮件文本内容",showCount:!0,maxLength:5e3})}),(0,b.jsx)(nr.Z.Item,{name:"contentHtml",label:"邮件内容（HTML）",children:(0,b.jsx)(or,{rows:4,placeholder:"邮件HTML内容",showCount:!0,maxLength:1e4})}),(0,b.jsx)(Pe.Z,{}),(0,b.jsxs)(St.Z,{gutter:16,children:[(0,b.jsx)(Mt.Z,{span:8,children:(0,b.jsx)(nr.Z.Item,{name:"status",label:"状态",children:(0,b.jsxs)(er.Z,{placeholder:"选择状态",children:[(0,b.jsx)(cr,{value:"SUCCESS",children:"成功"}),(0,b.jsx)(cr,{value:"FAILED",children:"失败"}),(0,b.jsx)(cr,{value:"PENDING",children:"待发送"}),(0,b.jsx)(cr,{value:"RETRY",children:"重试中"})]})})}),(0,b.jsx)(Mt.Z,{span:8,children:(0,b.jsx)(nr.Z.Item,{name:"important",label:"重要性",children:(0,b.jsxs)(er.Z,{placeholder:"选择重要性",children:[(0,b.jsx)(cr,{value:!0,children:"重要"}),(0,b.jsx)(cr,{value:!1,children:"普通"})]})})}),(0,b.jsx)(Mt.Z,{span:8,children:(0,b.jsx)(nr.Z.Item,{name:"hasAttachments",label:"是否有附件",children:(0,b.jsxs)(er.Z,{placeholder:"是否有附件",children:[(0,b.jsx)(cr,{value:!0,children:"有"}),(0,b.jsx)(cr,{value:!1,children:"无"})]})})})]}),(0,b.jsx)(nr.Z.Item,{name:"errorMessage",label:"错误信息",children:(0,b.jsx)(or,{rows:2,placeholder:"错误信息"})})]})})},hr=we.Z.Text,fr=we.Z.Title,mr=function(e){var n=e.workgroupUid,t=(0,y.useState)(!1),r=l()(t,2),s=r[0],a=r[1],i=(0,y.useState)([]),o=l()(i,2),c=o[0],u=o[1],d=(0,y.useState)(0),p=l()(d,2),h=p[0],f=p[1],m=(0,y.useState)(1),x=l()(m,2),g=x[0],j=x[1],v=(0,y.useState)(10),Z=l()(v,2),k=Z[0],w=Z[1],C=(0,y.useState)(!1),E=l()(C,2),S=E[0],A=E[1],P=(0,y.useState)("view"),T=l()(P,2),R=T[0],L=T[1],B=(0,y.useState)(!1),W=l()(B,2),D=W[0],F=W[1],z=(0,y.useState)(null),q=l()(z,2),N=q[0],O=q[1],U=(0,y.useState)(null),H=l()(U,2),_=H[0],Y=H[1],Q=(0,V.u)((function(e){return e.currentOrg})),$=Ct((function(e){return e.currentEmail})),ee=function(){var e=I()(M()().mark((function e(){var n,t,r,s,l=arguments;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=l.length>0&&void 0!==l[0]?l[0]:1,t=l.length>1&&void 0!==l[1]?l[1]:10,a(!0),e.prev=3,r={pageNumber:n-1,pageSize:t,emailAddress:(null==$?void 0:$.emailAddress)||"",orgUid:null==Q?void 0:Q.uid},e.next=7,Ut(r);case 7:s=e.sent,console.log("Fetched email messages:",s,r),200===s.code&&(u(s.data.content||[]),f(s.data.totalElements||0),j(n),w(t)),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),Tn.ZP.error("获取邮件消息失败");case 15:return e.prev=15,a(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[3,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Jt({uid:n.uid});case 3:200===e.sent.code&&(Tn.ZP.success("删除成功"),ee(g,k)),e.next=10;break;case 7:e.prev=7,e.t0=e.catch(0),Tn.ZP.error("删除失败");case 10:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(n){return e.apply(this,arguments)}}(),re=[{title:"主题",dataIndex:"subject",key:"subject",fixed:"left",width:200,ellipsis:!0,render:function(e,n){return(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(It.Z,{}),(0,b.jsx)(Ie.Z,{title:e,children:(0,b.jsx)(hr,{strong:!n.read,children:e||"无主题"})}),n.hasAttachments&&(0,b.jsx)(qt.Z,{})]})}},{title:"类型",dataIndex:"type",key:"type",width:100,render:function(e){var n={SENT:{color:"blue",text:"发送"},RECEIVED:{color:"green",text:"接收"},DRAFT:{color:"orange",text:"草稿"},REPLY:{color:"purple",text:"回复"},FORWARD:{color:"cyan",text:"转发"}}[e]||{color:"default",text:"未知"};return(0,b.jsx)(Se.Z,{color:n.color,children:n.text})}},{title:"发件人",dataIndex:"fromAddress",key:"fromAddress",width:200,render:function(e,n){return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{children:n.fromName||"未知"}),(0,b.jsx)(hr,{type:"secondary",style:{fontSize:"12px"},children:e})]})}},{title:"收件人",dataIndex:"toAddresses",key:"toAddresses",ellipsis:!0,width:200,render:function(e){return(0,b.jsx)(Ie.Z,{title:e,children:(0,b.jsx)(hr,{children:e})})}},{title:"抄送",dataIndex:"ccAddresses",key:"ccAddresses",ellipsis:!0,width:200,render:function(e){return(0,b.jsx)(Ie.Z,{title:e,children:(0,b.jsx)(hr,{children:e||"-"})})}},{title:"状态",dataIndex:"status",key:"status",width:100,render:function(e){var n={SUCCESS:{color:"green",text:"成功"},FAILED:{color:"red",text:"失败"},PENDING:{color:"orange",text:"待发送"},RETRY:{color:"blue",text:"重试中"}}[e]||{color:"default",text:"未知"};return(0,b.jsx)(Se.Z,{color:n.color,children:n.text})}},{title:"重要性",dataIndex:"important",key:"important",width:80,render:function(e){return e?(0,b.jsx)(K.Z,{style:{color:"red"}}):null}},{title:"时间",dataIndex:"emailDate",key:"emailDate",width:150,render:function(e){return e?new Date(e).toLocaleString():"-"}},{title:"大小",dataIndex:"emailSize",key:"emailSize",width:100,render:function(e){return e?"".concat((e/1024).toFixed(1),"KB"):"-"}},{title:"内容预览",dataIndex:"contentText",key:"contentText",width:300,ellipsis:!0,render:function(e,n){return(0,b.jsxs)("div",{children:[(0,b.jsx)("div",{style:{marginBottom:"4px"},children:(0,b.jsx)(Se.Z,{color:"default",style:{fontSize:"10px",padding:"0 4px"},children:"TEXT"})}),(0,b.jsx)(Ie.Z,{title:e,children:(0,b.jsx)(hr,{type:"secondary",style:{fontSize:"12px"},children:(null==e?void 0:e.substring(0,50))||"-"})})]})}},{title:"操作",key:"action",fixed:"right",width:200,render:function(e,n){return(0,b.jsxs)(me.Z,{size:"small",children:[(0,b.jsx)(Ie.Z,{title:"查看",children:(0,b.jsx)(ne.ZP,{type:"text",icon:(0,b.jsx)(Fe.Z,{}),onClick:function(){Y(n),L("view"),A(!0)}})}),(0,b.jsx)(Ie.Z,{title:"回复",children:(0,b.jsx)(ne.ZP,{type:"text",icon:(0,b.jsx)(Nt.Z,{}),onClick:function(){return function(e){O(e),F(!0)}(n)}})}),(0,b.jsx)(Ie.Z,{title:"编辑",children:(0,b.jsx)(ne.ZP,{type:"text",icon:(0,b.jsx)(G.Z,{}),onClick:function(){Y(n),L("edit"),A(!0)}})}),(0,b.jsx)(Ft.Z,{title:"确定删除这条邮件记录吗？",onConfirm:function(){return te(n)},okText:"确定",cancelText:"取消",children:(0,b.jsx)(ne.ZP,{type:"text",danger:!0,icon:(0,b.jsx)(X.Z,{})})})]})}}];return(0,y.useEffect)((function(){ee()}),[n]),(0,b.jsxs)("div",{children:[(0,b.jsxs)(Ce.Z,{children:[(0,b.jsx)("div",{style:{marginBottom:16},children:(0,b.jsxs)(St.Z,{justify:"space-between",align:"middle",children:[(0,b.jsx)(Mt.Z,{children:(0,b.jsxs)(fr,{level:4,children:[(0,b.jsx)(It.Z,{})," 邮件消息管理"]})}),(0,b.jsx)(Mt.Z,{children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{type:"primary",icon:(0,b.jsx)(Ot.Z,{}),onClick:function(){O(null),F(!0)},children:"发送邮件"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:function(){return ee(g,k)},loading:s,children:"刷新"})]})})]})}),(0,b.jsx)(zt.Z,{columns:re,dataSource:c,rowKey:"uid",loading:s,pagination:{current:g,pageSize:k,total:h,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e){return"共 ".concat(e," 条记录")},onChange:function(e,n){return ee(e,n)}},scroll:{x:2600,y:600}})]}),(0,b.jsx)(pr,{open:S,onClose:function(){A(!1),Y(null)},onSuccess:function(){ee(g,k)},workgroupUid:n,editingRecord:_,mode:R}),(0,b.jsx)(ar,{open:D,onClose:function(){F(!1),O(null)},onSuccess:function(){ee(g,k)},workgroupUid:n,replyToEmail:N})]})},xr=function(e){console.log(e)},gr=function(e){e.type;var n=[{key:"detail",label:"应用详情",children:(0,b.jsx)(Dt,{})},{key:"message",label:"邮件消息",children:(0,b.jsx)(mr,{})}],t=(0,y.useState)(n),r=l()(t,2),s=r[0],a=r[1];return(0,y.useEffect)((function(){var e=[].concat(n);a(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:s,onChange:xr})})},jr=s.Z.Sider,yr=s.Z.Content,vr=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth,i=t.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(jr,{width:l,style:a,children:(0,b.jsx)(Et,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(yr,{style:i,children:(0,b.jsx)(gr,{type:n})})})]})};function br(e){return Zr.apply(this,arguments)}function Zr(){return(Zr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/telegram/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kr(e){return wr.apply(this,arguments)}function wr(){return wr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/telegram/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),wr.apply(this,arguments)}function Cr(e){return Er.apply(this,arguments)}function Er(){return(Er=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/telegram/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Sr(e){return Mr.apply(this,arguments)}function Mr(){return Mr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/telegram/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Mr.apply(this,arguments)}function Ar(){return Ir.apply(this,arguments)}function Ir(){return(Ir=I()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/telegram/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Pr="BOT",Tr=function(e){var n=e.isEdit,t=e.telegram,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=(0,re.Z)().translateStringTranct,h=(0,V.u)((function(e){return e.currentOrg})),f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=ce(),Z=j.workgroups,k=j.getDefaultUid,w=j.getWorkgroupOptions,C=function(){console.log("handleSubmit"),g(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),o(n)})).catch((function(){g(!1)}))};(0,y.useEffect)((function(){if(n)d.setFieldsValue({nickname:null==t?void 0:t.nickname,username:null==t?void 0:t.username,description:null==t?void 0:t.description,token:null==t?void 0:t.token,type:(null==t?void 0:t.type)||Pr,enabled:void 0===(null==t?void 0:t.enabled)||t.enabled,workgroupUid:null==t?void 0:t.workgroupUid,debug:(null==t?void 0:t.debug)||!1});else{var e=k();d.setFieldsValue({nickname:"",username:"",description:"",token:"",type:Pr,enabled:!0,workgroupUid:e,debug:!1})}}),[n,t,d,Z]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"Telegram Bot 配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:C,loading:x||a,children:x||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"telegramForm",onFinish:C,submitter:!1,children:[(0,b.jsx)(de.Z,{label:"Bot 名称",name:"nickname",rules:[{required:!0,message:"请输入 Bot 名称"}],placeholder:"请输入 Bot 显示名称",extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,b.jsx)(de.Z,{label:"Bot 用户名",name:"username",rules:[{required:!0,message:"请输入 Bot 用户名"}],placeholder:"请输入 Bot 用户名（不包含@）",extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,b.jsx)(de.Z,{label:"Bot Token",name:"token",rules:[{required:!0,message:"请输入 Bot Token"}],placeholder:"请输入从 BotFather 获取的 Token",fieldProps:{addonAfter:(0,b.jsx)(me.Z,{children:(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})})},extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,b.jsx)(de.Z,{label:"Bot 描述",name:"description",placeholder:"请输入 Bot 描述信息"}),(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:w().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(he.Z,{label:"启用 Bot",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制 Bot 是否启用，禁用后 Bot 将无法接收和处理消息"}),(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,b.jsx)("p",{children:"注：请确保您已经在 BotFather 创建了 Bot 并获取了 Token"})]})})})},Rr=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{telegramResult:{data:{content:[]}},currentTelegram:{uid:"",nickname:"",avatar:"",description:"",enabled:!0},insertTelegram:function(n){e((function(e){e.telegramResult.data.content.unshift(n)}))},updateTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Telegram with uid ".concat(n.uid," not found."))}))},deleteTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Telegram with uid ".concat(n.uid," not found."))}))},setTelegramResult:function(t){var r;(e({telegramResult:t}),""===n().currentTelegram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentTelegram:t.data.content[0]}))},setCurrentTelegram:function(t){var r=n().telegramResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().telegramResult),{},{data:{content:a}});e({telegramResult:l,currentTelegram:t})}else console.warn("Telegram with the specified uid not found."),e({currentTelegram:t})},refreshCurrentTelegram:function(n){e((function(e){e.currentTelegram=c()(c()({},e.currentTelegram),n);var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentTelegram:function(t){var r=n().telegramResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({telegramResult:c()(c()({},n().telegramResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("Telegram not found in cache:",t),n().currentTelegram.uid===t&&e({currentTelegram:{uid:"",enabled:!0}})},deleteTelegramCache:function(){return e({},!0)}}})),{name:p.I2C}))),Lr=function(e){var n=e.type,t=(0,C.useIntl)(),r=(0,y.useRef)(!1),s=(0,re.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,o=(0,y.useState)(!1),c=l()(o,2),u=c[0],d=c[1],p=(0,y.useState)(!1),h=l()(p,2),f=h[0],m=h[1],x=(0,y.useState)(!1),j=l()(x,2),v=j[0],Z=j[1],k=(0,V.u)((function(e){return e.currentOrg})),w=Rr((function(e){return{telegramResult:e.telegramResult,currentTelegram:e.currentTelegram,setTelegramResult:e.setTelegramResult,insertTelegram:e.insertTelegram,setCurrentTelegram:e.setCurrentTelegram,deleteCurrentTelegram:e.deleteCurrentTelegram}})),E=w.telegramResult,S=w.currentTelegram,A=w.setTelegramResult,P=w.insertTelegram,T=w.setCurrentTelegram,L=w.deleteCurrentTelegram,B=$.Z.useModal(),W=l()(B,2),D=W[0],F=W[1],z=function(){var e=I()(M()().mark((function e(n){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete telegram",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Sr(n);case 4:r=e.sent,console.log("delete telegram response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),L(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),q=function(){var e=I()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==k?void 0:k.uid},e.next=8,br(n);case 8:t=e.sent,console.log("getTelegrams response",t,n),200===t.code?(R.yw.destroy(),A(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){q();var e=function(e){m(!0),d(!0)};return window.addEventListener("telegram-edit",e),function(){window.removeEventListener("telegram-edit",e)}}),[]);var N=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),Z(!0),e.prev=2,!f){e.next=8;break}return e.next=6,U(n);case 6:e.next=10;break;case 8:return e.next=10,O(n);case 10:return e.prev=10,Z(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,kr(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateTelegram response:",t),200===t.code?(P(t.data),T(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),U=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==S?void 0:S.uid,R.yw.loading("正在更新..."),e.next=4,Cr(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateTelegram response:",t),200===t.code?(T(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"绑定 Bot"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:q,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==S?void 0:S.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){D.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.nickname,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(S)}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:E.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:S.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(ee.Z,{align:"center",gap:"small",children:[(0,b.jsxs)("span",{children:[s(null==e?void 0:e.nickname)," ",(0,b.jsxs)("span",{style:{color:"#1677ff"},children:["(@",null==e?void 0:e.username,")"]})]}),(0,b.jsx)(Se.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?"启用":"禁用"})]}),description:null==e?void 0:e.description})})}}),u&&(0,b.jsx)(Tr,{type:n,isEdit:f,open:u,loading:v,telegram:S,onClose:function(){d(!1)},onSubmit:N}),F]})},Br=we.Z.Text,Wr=we.Z.Paragraph,Dr={BOT:(0,b.jsx)(Be.Z,{})},Fr={createBot:(0,v.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",botToken:(0,v.V)()+"/docs/zh-CN/docs/channel/telegram/#3-%E5%88%9B%E5%BB%BA%E6%96%B0%E6%9C%BA%E5%99%A8%E4%BA%BA",botApi:"https://core.telegram.org/bots/api"},zr=function(e){e.type;var n=(0,C.useIntl)(),t=Rr((function(e){return{currentTelegram:e.currentTelegram,refreshCurrentTelegram:e.refreshCurrentTelegram}})),r=t.currentTelegram,s=t.refreshCurrentTelegram,a=(0,y.useState)(!1),i=l()(a,2),o=i[0],c=i[1],u=(0,y.useState)(!1),d=l()(u,2),p=d[0],h=d[1],f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=(0,y.useState)(!1),Z=l()(j,2),k=Z[0],w=Z[1],E=(0,y.useState)(null),S=l()(E,2),A=S[0],P=S[1],T=(0,y.useState)(!1),L=l()(T,2),B=L[0],W=L[1],D=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return W(!0),e.prev=1,e.next=4,Ar();case 4:n=e.sent,console.log("checkServiceReachable response",n),200===n.code?P(n.data):(P(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),P(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,W(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){D()}),[]);var F,z,q=function(){var e=I()(M()().mark((function e(t){var a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error(n.formatMessage({id:"telegram.bot.toggle.error.incomplete",defaultMessage:"无法切换状态，Bot信息不完整"})),e.abrupt("return");case 3:return g(!0),e.prev=4,e.next=7,Cr({uid:r.uid,enabled:t});case 7:a=e.sent,console.log("updateTelegram enabled response",a),200===a.code?(R.yw.success(n.formatMessage({id:t?"telegram.bot.toggle.success.enabled":"telegram.bot.toggle.success.disabled",defaultMessage:t?"Bot已启用":"Bot已禁用"})),s&&s(a.data)):R.yw.error(n.formatMessage({id:"telegram.bot.toggle.error.operation",defaultMessage:"操作失败"})+": ".concat(a.message||n.formatMessage({id:"telegram.bot.toggle.error.unknown",defaultMessage:"未知错误"}))),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error(n.formatMessage({id:"telegram.bot.toggle.error.exception",defaultMessage:"操作出错"})+": ".concat(e.t0 instanceof Error?e.t0.message:n.formatMessage({id:"telegram.bot.toggle.error.unknown",defaultMessage:"未知错误"})));case 15:return e.prev=15,g(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=I()(M()().mark((function e(t){var a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error(n.formatMessage({id:"telegram.bot.toggle.debug.error.incomplete",defaultMessage:"无法切换调试状态，Bot信息不完整"})),e.abrupt("return");case 3:return w(!0),e.prev=4,e.next=7,Cr({uid:r.uid,debug:t});case 7:a=e.sent,console.log("updateTelegram debug response",a),200===a.code?(R.yw.success(n.formatMessage({id:t?"telegram.bot.toggle.debug.success.enabled":"telegram.bot.toggle.debug.success.disabled",defaultMessage:t?"调试模式已开启":"调试模式已关闭"})),s&&s(a.data)):R.yw.error(n.formatMessage({id:"telegram.bot.toggle.debug.error.operation",defaultMessage:"操作失败"})+": ".concat(a.message||n.formatMessage({id:"telegram.bot.toggle.debug.error.unknown",defaultMessage:"未知错误"}))),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error(n.formatMessage({id:"telegram.bot.toggle.debug.error.exception",defaultMessage:"操作出错"})+": ".concat(e.t0 instanceof Error?e.t0.message:n.formatMessage({id:"telegram.bot.toggle.debug.error.unknown",defaultMessage:"未知错误"})));case 15:return e.prev=15,w(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=I()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error(n.formatMessage({id:"telegram.bot.refresh.error.incomplete",defaultMessage:"无法刷新详情，应用信息不完整"})),e.abrupt("return");case 3:h(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,b.jsxs)(Ce.Z,{title:(0,b.jsxs)(me.Z,{children:[Dr[r.type]||(0,b.jsx)(Be.Z,{}),(0,b.jsx)("span",{children:(null==r?void 0:r.nickname)||n.formatMessage({id:"telegram.bot.detail",defaultMessage:"Telegram Bot 详情"})}),(0,b.jsx)(Se.Z,{color:r.enabled?"success":"default",icon:r.enabled?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:r.enabled?n.formatMessage({id:"telegram.bot.enabled",defaultMessage:"已启用"}):n.formatMessage({id:"telegram.bot.disabled",defaultMessage:"已禁用"})}),null!==A&&(0,b.jsx)(Se.Z,{color:A?"success":"error",icon:A?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:A?"服务可用":"服务不可用"}),B&&(0,b.jsx)(Se.Z,{color:"processing",children:"检查服务中..."})]}),extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open("https://core.telegram.org/bots/api","_blank")},type:"link",children:n.formatMessage({id:"telegram.bot.documentation",defaultMessage:"文档"})}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("telegram-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:n.formatMessage({id:"telegram.bot.edit",defaultMessage:"编辑"})}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(st.Z,{}),onClick:D,loading:B,type:"default",children:"检查服务"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:O,loading:p,type:"primary",children:n.formatMessage({id:"telegram.bot.refresh.details",defaultMessage:"刷新详情"})})]}),variant:"borderless",children:[!1===A&&(0,b.jsx)("div",{style:{marginBottom:16},children:(0,b.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(rt.Z,{}),(0,b.jsx)("strong",{children:"服务不可用警告："}),"Telegram服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"Bot UID"}),children:(0,b.jsx)(Br,{copyable:!0,children:r.uid})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[n.formatMessage({id:"telegram.bot.name",defaultMessage:"Bot 名称"}),(0,b.jsx)(Ie.Z,{title:"查看 Telegram Bot 创建说明",children:(0,b.jsx)(We.Z,{onClick:function(){return window.open(Fr.createBot,"_blank")}})})]}),children:r.nickname}),(0,b.jsxs)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[n.formatMessage({id:"telegram.bot.username",defaultMessage:"Bot 用户名"}),(0,b.jsx)(Ie.Z,{title:"查看 Telegram Bot 创建说明",children:(0,b.jsx)(We.Z,{onClick:function(){return window.open(Fr.createBot,"_blank")}})})]}),children:["@",r.username]}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"telegram.bot.description",defaultMessage:"Bot 描述"}),children:r.description||"-"}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"telegram.bot.enabled.status",defaultMessage:"启用状态"}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:r.enabled,onChange:q,loading:x,checkedChildren:n.formatMessage({id:"telegram.bot.enable",defaultMessage:"启用"}),unCheckedChildren:n.formatMessage({id:"telegram.bot.disable",defaultMessage:"禁用"})}),(0,b.jsx)(Br,{type:r.enabled?"success":"danger",children:r.enabled?n.formatMessage({id:"telegram.bot.enabled",defaultMessage:"已启用"}):n.formatMessage({id:"telegram.bot.disabled",defaultMessage:"已禁用"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:r.debug||!1,onChange:N,loading:k,checkedChildren:n.formatMessage({id:"telegram.bot.debug.enable",defaultMessage:"开启"}),unCheckedChildren:n.formatMessage({id:"telegram.bot.debug.disable",defaultMessage:"关闭"})}),(0,b.jsx)(Br,{type:r.debug?"warning":"secondary",children:r.debug?n.formatMessage({id:"telegram.bot.debug.enabled",defaultMessage:"已开启"}):n.formatMessage({id:"telegram.bot.debug.disabled",defaultMessage:"已关闭"})})]})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[n.formatMessage({id:"telegram.bot.token",defaultMessage:"Bot Token"}),(0,b.jsx)(Ie.Z,{title:"查看如何获取 Bot Token",children:(0,b.jsx)(We.Z,{onClick:function(){return window.open(Fr.botToken,"_blank")}})})]}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Br,{copyable:!0,children:(F=r.token,z=o,F?z?F:"******":"-")}),(0,b.jsx)(ne.ZP,{type:"text",icon:o?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return c(!o)}})]})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"telegram.bot.created.time",defaultMessage:"创建时间"}),children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[n.formatMessage({id:"telegram.bot.service.status",defaultMessage:"服务状态"}),(0,b.jsx)(Ie.Z,{title:"查看 Telegram Bot API 文档",children:(0,b.jsx)(We.Z,{onClick:function(){return window.open(Fr.botApi,"_blank")}})})]}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Br,{type:!0===A?"success":!1===A?"danger":void 0,children:!0===A?n.formatMessage({id:"telegram.bot.service.available",defaultMessage:"服务可用"}):!1===A?n.formatMessage({id:"telegram.bot.service.unavailable",defaultMessage:"服务不可用"}):n.formatMessage({id:"telegram.bot.service.checking",defaultMessage:"检查中..."})}),(0,b.jsx)(ne.ZP,{type:"text",icon:!0===A?(0,b.jsx)(st.Z,{}):!1===A?(0,b.jsx)(rt.Z,{}):(0,b.jsx)(ze.Z,{spin:!0}),onClick:D,loading:B})]})})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:n.formatMessage({id:"telegram.bot.security.instructions",defaultMessage:"安全说明"})}),(0,b.jsx)(Wr,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.warning",defaultMessage:"请妥善保管您的 Bot Token，避免泄露"})}),(0,b.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.credential",defaultMessage:"Bot Token 是访问 Bot API 的唯一凭证，泄露可能导致 Bot 被他人控制"})}),(0,b.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.rotation",defaultMessage:"建议定期更换 Bot Token，特别是在怀疑可能泄露的情况下"})}),(0,b.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.token.reset",defaultMessage:"如发现安全问题，请立即在 BotFather 中重置 Token 并联系我们的支持团队"})}),(0,b.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.enabled.control",defaultMessage:"Bot启用状态控制着是否接收和处理消息，禁用后Bot将暂停工作"})}),(0,b.jsx)("li",{children:n.formatMessage({id:"telegram.bot.security.maintenance",defaultMessage:"建议在维护或调试时临时禁用Bot，避免接收不必要的消息"})})]})}),(0,b.jsx)("div",{style:{marginTop:"16px",textAlign:"center"},children:(0,b.jsx)(ne.ZP,{type:"link",icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open(Fr.botToken,"_blank")},children:n.formatMessage({id:"telegram.bot.more.information",defaultMessage:"查看更多 Telegram Bot 文档"})})})]}):(0,b.jsx)(Ce.Z,{variant:"borderless",title:n.formatMessage({id:"telegram.bot.detail",defaultMessage:"Telegram Bot 详情"}),extra:(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/telegram","_blank")},type:"link",children:n.formatMessage({id:"telegram.bot.documentation",defaultMessage:"文档"})}),children:(0,b.jsx)(Ee.Z,{description:n.formatMessage({id:"telegram.bot.select.prompt",defaultMessage:"请先在左侧列表选择一个 Telegram Bot"}),image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},qr=function(e){console.log(e)},Nr=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,b.jsx)(zr,{type:n})}],r=(0,y.useState)(t),s=l()(r,2),a=s[0],i=s[1];return(0,y.useEffect)((function(){var e=[].concat(t);i(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:a,onChange:qr})})},Or=s.Z.Sider,Ur=s.Z.Content,Hr=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth,i=t.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(Or,{width:l,style:a,children:(0,b.jsx)(Lr,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(Ur,{style:i,children:(0,b.jsx)(Nr,{type:n})})})]})};function _r(e){return Vr.apply(this,arguments)}function Vr(){return(Vr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Kr(e){return Yr.apply(this,arguments)}function Yr(){return Yr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Yr.apply(this,arguments)}function Jr(e){return Gr.apply(this,arguments)}function Gr(){return(Gr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xr(e){return Qr.apply(this,arguments)}function Qr(){return Qr=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/update/kid",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),Qr.apply(this,arguments)}function $r(e){return es.apply(this,arguments)}function es(){return es=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/update/accessToken",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),es.apply(this,arguments)}function ns(e){return ts.apply(this,arguments)}function ts(){return ts=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)}))),ts.apply(this,arguments)}function rs(){return ss.apply(this,arguments)}function ss(){return(ss=I()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/line/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var as=function(e){var n=e.isEdit,t=e.line,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=(0,re.Z)().translateStringTranct,h=(0,V.u)((function(e){return e.currentOrg})),f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=ce(),Z=j.workgroups,k=j.getDefaultUid,w=j.getWorkgroupOptions,C=function(){var e=I()(M()().mark((function e(){var t,r,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleSubmit"),g(!0),e.prev=2,e.next=5,d.validateFields();case 5:if(t=e.sent,n||t.privateKey&&t.publicKey){e.next=12;break}return e.next=9,E();case 9:r=e.sent,t.privateKey=r.privateKey,t.publicKey=r.publicKey;case 12:s=c()(c()({},t),{},{orgUid:null==h?void 0:h.uid}),console.log("submit",s),o(s),e.next=20;break;case 17:e.prev=17,e.t0=e.catch(2),g(!1);case 20:case"end":return e.stop()}}),e,null,[[2,17]])})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||"MESSAGING_API",enabled:!1!==(null==t?void 0:t.enabled),workgroupUid:null==t?void 0:t.workgroupUid,channelId:null==t?void 0:t.channelId,channelSecret:null==t?void 0:t.channelSecret,channelAccessToken:null==t?void 0:t.channelAccessToken,kid:null==t?void 0:t.kid,privateKey:null==t?void 0:t.privateKey,publicKey:null==t?void 0:t.publicKey,debug:(null==t?void 0:t.debug)||!1});else{var e=k();d.setFieldsValue({name:"",description:"",type:"MESSAGING_API",enabled:!0,workgroupUid:e,channelId:"",channelSecret:"",channelAccessToken:"",kid:"",privateKey:"",publicKey:"",debug:!1})}}),[n,t,d,Z]);var E=function(){var e=I()(M()().mark((function e(){var n,t,r,s,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 2:return n=e.sent,e.next=5,crypto.subtle.exportKey("jwk",n.privateKey);case 5:return t=e.sent,e.next=8,crypto.subtle.exportKey("jwk",n.publicKey);case 8:return r=e.sent,s=JSON.stringify(t,null,2),a=JSON.stringify(r,null,2),e.abrupt("return",{privateKey:s,publicKey:a});case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"Line应用配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:C,loading:x||a,children:x||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"lineAppForm",onFinish:C,submitter:!1,children:[(0,b.jsx)(de.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,b.jsx)(pe.Z,{label:"应用类型",name:"type",options:[{label:"LINE Messaging API",value:"MESSAGING_API"}],fieldProps:{defaultValue:"MESSAGING_API"},rules:[{required:!0}]}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,b.jsx)(de.Z,{label:"Channel ID",name:"channelId",rules:[{required:!0}],fieldProps:{addonAfter:(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("channelId");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})},extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Channel ID获取说明"})})}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,b.jsx)(de.Z,{label:"Channel Secret",name:"channelSecret",rules:[{required:!0}],fieldProps:{addonAfter:(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("channelSecret");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})},extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Channel Secret获取说明"})})}),n&&(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,b.jsx)(de.Z,{label:"Kid",name:"kid",fieldProps:{placeholder:"JWT签名的Key ID，可选配置"},extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Kid获取说明"})})}),(0,b.jsx)(de.Z,{name:"channelAccessToken",hidden:!0}),(0,b.jsx)(de.Z,{name:"privateKey",hidden:!0}),(0,b.jsx)(de.Z,{name:"publicKey",hidden:!0}),(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:w().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(he.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,b.jsx)("p",{children:"注：请到 LINE Developers 平台获取 Channel ID 和 Channel Secret"})]})})})},ls=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{lineResult:{data:{content:[]}},currentLine:{uid:"",nickname:"",avatar:"",description:""},insertLine:function(n){e((function(e){e.lineResult.data.content.unshift(n)}))},updateLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Line with uid ".concat(n.uid," not found."))}))},deleteLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Line with uid ".concat(n.uid," not found."))}))},setLineResult:function(t){var r;(e({lineResult:t}),""===n().currentLine.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLine:t.data.content[0]}))},setCurrentLine:function(t){var r=n().lineResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().lineResult),{},{data:{content:a}});e({lineResult:l,currentLine:t})}else console.warn("Line with the specified uid not found."),e({currentLine:t})},refreshCurrentLine:function(n){e((function(e){e.currentLine=c()(c()({},e.currentLine),n);var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentLine:function(t){var r=n().lineResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({lineResult:c()(c()({},n().lineResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("Line not found in cache:",t),n().currentLine.uid===t&&e({currentLine:{uid:""}})},deleteLineCache:function(){return e({},!0)}}})),{name:p.yRi}))),is=function(e){var n=e.type,t=(0,C.useIntl)(),r=(0,y.useRef)(!1),s=(0,re.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,o=(0,y.useState)(!1),u=l()(o,2),d=u[0],p=u[1],h=(0,y.useState)(!1),f=l()(h,2),m=f[0],x=f[1],j=(0,y.useState)(!1),v=l()(j,2),Z=v[0],k=v[1],w=(0,V.u)((function(e){return e.currentOrg})),E=(0,y.useState)(null),S=l()(E,2),A=S[0],P=S[1],T=ls((function(e){return{lineResult:e.lineResult,currentLine:e.currentLine,setLineResult:e.setLineResult,insertLine:e.insertLine,setCurrentLine:e.setCurrentLine,deleteCurrentLine:e.deleteCurrentLine,refreshCurrentLine:e.refreshCurrentLine}})),L=T.lineResult,B=T.currentLine,W=T.setLineResult,D=T.insertLine,F=T.setCurrentLine,z=T.deleteCurrentLine,q=T.refreshCurrentLine,N=$.Z.useModal(),O=l()(N,2),U=O[0],H=O[1],_=function(){var e=I()(M()().mark((function e(n){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete line",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,ns(n);case 4:r=e.sent,console.log("delete line response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(){var n,t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==w?void 0:w.uid},e.next=8,_r(n);case 8:t=e.sent,console.log("getLines response:",t,n),200===t.code?(R.yw.destroy(),W(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){se();var e=function(e){x(!0),p(!0)};return window.addEventListener("lineapp-edit",e),function(){window.removeEventListener("lineapp-edit",e)}}),[]);var ae=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,ie(n);case 6:e.next=10;break;case 8:return e.next=10,le(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Kr(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateLine response:",t),200===t.code?(D(t.data),F(t.data),p(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==B?void 0:B.uid,R.yw.loading("正在更新..."),e.next=4,Jr(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateLine response:",t),200===t.code?(F(t.data),p(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=I()(M()().mark((function e(n,t){var r,s,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(n.uid),e.prev=1,e.next=4,Jr({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateLine enabled response",r),200===r.code?(R.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=L&&null!==(s=L.data)&&void 0!==s&&s.content&&(a=L.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),W(c()(c()({},L),{},{data:c()(c()({},L.data),{},{content:a})}))),(null==B?void 0:B.uid)===n.uid&&q&&q(r.data)):R.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,P(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){p(!0),x(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:se,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==B?void 0:B.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){x(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==B.enabled?(0,b.jsx)(rt.Z,{}):(0,b.jsx)(st.Z,{}),label:!1!==B.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return oe(B,!1===B.enabled)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){U.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(B)}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:L.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:B.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){F(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:s(null==e?void 0:e.name)}),(0,b.jsx)(at.Z,{spinning:A===(null==e?void 0:e.uid),size:"small",children:(0,b.jsx)(Se.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]})})})}}),d&&(0,b.jsx)(as,{type:n,isEdit:m,open:d,loading:Z,line:B,onClose:function(){p(!1)},onSubmit:ae}),H]})},os=we.Z.Text,cs=we.Z.Paragraph,us=function(e){e.type;var n=(0,C.useIntl)(),t=ls((function(e){return{currentLine:e.currentLine,refreshCurrentLine:e.refreshCurrentLine}})),r=t.currentLine,s=t.refreshCurrentLine,a=(0,y.useState)(!1),i=l()(a,2),o=i[0],u=i[1],d=(0,y.useState)(!1),p=l()(d,2),h=p[0],f=p[1],m=(0,y.useState)(!1),x=l()(m,2),g=x[0],j=x[1],Z=(0,y.useState)(!1),k=l()(Z,2),w=k[0],E=k[1],S=(0,y.useState)(!1),A=l()(S,2),P=A[0],T=A[1],L=(0,y.useState)(!1),B=l()(L,2),W=B[0],D=B[1],F=(0,y.useState)(""),z=l()(F,2),q=z[0],N=z[1],O=(0,y.useState)(null),U=l()(O,2),H=U[0],_=U[1],V=(0,y.useState)(!1),K=l()(V,2),Y=K[0],X=K[1],Q=function(e,n){return e?n?e:"******":"-"},$=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return X(!0),e.prev=1,e.next=4,rs();case 4:n=e.sent,console.log("checkLineServiceReachable response",n),200===n.code?_(n.data):(_(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),_(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,X(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){$()}),[]);var ee=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return f(!0),e.prev=4,e.next=7,Jr(c()(c()({},r),{},{enabled:n}));case 7:t=e.sent,console.log("updateLine enabled response",t),200===t.code?(R.yw.success("应用已".concat(n?"启用":"禁用")),s&&s(t.data)):R.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,f(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),te=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return j(!0),e.prev=4,e.next=7,Jr(c()(c()({},r),{},{debug:n}));case 7:t=e.sent,console.log("updateLine debug response",t),200===t.code?(R.yw.success("调试模式已".concat(n?"开启":"关闭")),s&&s(t.data)):R.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,j(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=I()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:u(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(){var n,t,a,l,i,o;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法重新生成密钥，应用信息不完整"),e.abrupt("return");case 3:return E(!0),e.prev=4,R.yw.loading("正在生成新的密钥对...",0),e.next=8,crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign","verify"]);case 8:return n=e.sent,e.next=11,crypto.subtle.exportKey("jwk",n.privateKey);case 11:return t=e.sent,e.next=14,crypto.subtle.exportKey("jwk",n.publicKey);case 14:return a=e.sent,l=JSON.stringify(t,null,2),i=JSON.stringify(a,null,2),e.next=19,Jr(c()(c()({},r),{},{privateKey:l,publicKey:i}));case 19:o=e.sent,R.yw.destroy(),200===o.code?(R.yw.success("密钥对重新生成成功！"),s&&s(o.data),console.log("=== new private key ==="),console.log(l),console.log("=== new public key ==="),console.log(i)):R.yw.error("密钥生成失败: ".concat(o.message||"未知错误")),e.next=29;break;case 24:e.prev=24,e.t0=e.catch(4),R.yw.destroy(),R.yw.error("密钥生成出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误")),console.error("Key regeneration failed:",e.t0);case 29:return e.prev=29,E(!1),e.finish(29);case 32:case"end":return e.stop()}}),e,null,[[4,24,29,32]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法更新 Key ID，应用信息不完整"),e.abrupt("return");case 3:if(r.privateKey&&r.publicKey){e.next=6;break}return R.yw.warning("请先生成密钥对，然后再设置 Key ID"),e.abrupt("return");case 6:return e.prev=6,e.next=9,Xr(c()(c()({},r),{},{kid:q}));case 9:200===(n=e.sent).code?(R.yw.success("Key ID 更新成功！"),s&&s(n.data),D(!1)):R.yw.error("Key ID 更新失败: ".concat(n.message||"未知错误")),e.next=16;break;case 13:e.prev=13,e.t0=e.catch(6),R.yw.error("Key ID 更新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 16:case"end":return e.stop()}}),e,null,[[6,13]])})));return function(){return e.apply(this,arguments)}}(),le=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新 Access Token，应用信息不完整"),e.abrupt("return");case 3:if(r.kid){e.next=6;break}return R.yw.warning("请先设置 Key ID (kid)，然后再刷新 Access Token"),e.abrupt("return");case 6:return T(!0),e.prev=7,R.yw.loading("正在刷新 Access Token...",0),e.next=11,$r({uid:r.uid,kid:r.kid});case 11:n=e.sent,R.yw.destroy(),200===n.code?(R.yw.success("Access Token 刷新成功！"),s&&s(n.data)):R.yw.error("Access Token 刷新失败: ".concat(n.message||"未知错误")),e.next=20;break;case 16:e.prev=16,e.t0=e.catch(7),R.yw.destroy(),R.yw.error("Access Token 刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 20:return e.prev=20,T(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,16,20,23]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,b.jsxs)(Ce.Z,{title:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:r.name||"Line应用详情"}),(0,b.jsx)(Se.Z,{color:!1!==r.enabled?"success":"default",icon:!1!==r.enabled?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==r.enabled?"已启用":"已禁用"}),null!==H&&(0,b.jsx)(Se.Z,{color:H?"success":"error",icon:H?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:H?"服务可用":"服务不可用"}),Y&&(0,b.jsx)(Se.Z,{color:"processing",children:"检查服务中..."})]}),extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/line","_blank")},type:"link",children:"文档"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("lineapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(st.Z,{}),onClick:$,loading:Y,type:"default",children:"检查服务"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:re,loading:o,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[!1===H&&(0,b.jsx)("div",{style:{marginBottom:16},children:(0,b.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(rt.Z,{}),(0,b.jsx)("strong",{children:"服务不可用警告："}),"Line服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,styles:{label:{width:"200px",minWidth:"200px"}},children:[(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,b.jsx)(os,{copyable:!0,children:r.uid})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"line.channelId",defaultMessage:"Channel ID"}),children:(0,b.jsx)(os,{copyable:{text:r.channelId},children:Q(r.channelId,!0)})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"line.channelSecret",defaultMessage:"Channel Secret"}),children:(0,b.jsx)(os,{copyable:{text:r.channelSecret},children:Q(r.channelSecret,!1)})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"line.privateKey",defaultMessage:"私钥 (Private Key)"}),children:(0,b.jsx)(me.Z,{direction:"vertical",style:{width:"100%"},children:(0,b.jsx)(os,{copyable:{text:r.privateKey},children:(0,b.jsx)("div",{style:{maxHeight:"100px",overflow:"auto",background:"#f5f5f5",padding:"8px",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:r.privateKey})})})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"line.publicKey",defaultMessage:"公钥 (Public Key)"}),children:(0,b.jsxs)(me.Z,{direction:"vertical",style:{width:"100%"},children:[(0,b.jsx)(os,{copyable:{text:r.publicKey},children:(0,b.jsx)("div",{style:{maxHeight:"100px",overflow:"auto",background:"#f5f5f5",padding:"8px",borderRadius:"4px",fontSize:"12px",whiteSpace:"pre-wrap"},children:r.publicKey})}),(0,b.jsx)(ne.ZP,{size:"small",onClick:se,loading:w,type:"primary",danger:!0,children:"重新生成密钥对"})]})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"line.kid",defaultMessage:"Kid (kid)"}),children:(0,b.jsx)(me.Z,{direction:"vertical",style:{width:"100%"},children:W?(0,b.jsxs)(me.Z,{children:[(0,b.jsx)($t.Z,{value:q,onChange:function(e){return N(e.target.value)},placeholder:"请输入 Key ID",style:{width:200}}),(0,b.jsx)(ne.ZP,{size:"small",type:"primary",onClick:ae,children:"保存"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){D(!1),N("")},children:"取消"})]}):(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(os,{copyable:{text:r.kid},children:r.kid||"-"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){N((null==r?void 0:r.kid)||""),D(!0)},type:"link",children:"编辑"})]})})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"line.channelAccessToken",defaultMessage:"Channel Access Token"}),children:(0,b.jsx)(me.Z,{direction:"vertical",style:{width:"100%"},children:r.channelAccessToken?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(os,{strong:!0,children:"Access Token: "}),(0,b.jsx)(os,{copyable:{text:r.channelAccessToken.accessToken},children:Q(r.channelAccessToken.accessToken,!1)})]}),r.channelAccessToken.tokenType&&(0,b.jsxs)("div",{children:[(0,b.jsx)(os,{strong:!0,children:"Token Type: "}),(0,b.jsx)(os,{children:r.channelAccessToken.tokenType})]}),r.channelAccessToken.expiresIn&&(0,b.jsxs)("div",{children:[(0,b.jsx)(os,{strong:!0,children:"Expires In: "}),(0,b.jsxs)(os,{children:[r.channelAccessToken.expiresIn," 秒"]})]}),r.channelAccessToken.keyId&&(0,b.jsxs)("div",{children:[(0,b.jsx)(os,{strong:!0,children:"Key ID: "}),(0,b.jsx)(os,{copyable:{text:r.channelAccessToken.keyId},children:r.channelAccessToken.keyId})]}),(0,b.jsx)(ne.ZP,{size:"small",onClick:le,loading:P,type:"primary",children:"刷新 Access Token"})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(os,{type:"secondary",children:"-"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:le,loading:P,type:"primary",children:"刷新 Access Token"})]})})}),(0,b.jsx)(Me.Z.Item,{label:"Webhook URL",children:(0,b.jsx)(os,{copyable:!0,children:(0,v.kG)()+"/line/webhooks/"+r.uid})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:!1!==r.enabled,onChange:ee,loading:h,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,b.jsx)(os,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:r.debug||!1,onChange:te,loading:g,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,b.jsx)(os,{type:r.debug?"warning":"secondary",children:r.debug?"已开启":"已关闭"})]})}),(0,b.jsx)(Me.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Ne()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(cs,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的Line应用凭证，避免泄露"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,b.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,b.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,b.jsx)(Ce.Z,{variant:"borderless",title:"Line应用详情",extra:(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/channel/line","_blank")},type:"link",children:"文档"}),children:(0,b.jsx)(Ee.Z,{description:"请先在左侧列表选择一个Line应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},ds=function(e){console.log(e)},ps=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,b.jsx)(us,{type:n})}],r=(0,y.useState)(t),s=l()(r,2),a=s[0],i=s[1];return(0,y.useEffect)((function(){var e=[].concat(t);i(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:a,onChange:ds})})},hs=s.Z.Sider,fs=s.Z.Content,ms=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth,i=t.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(hs,{width:l,style:a,children:(0,b.jsx)(is,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(fs,{style:i,children:(0,b.jsx)(ps,{type:n})})})]})};function xs(e){return gs.apply(this,arguments)}function gs(){return(gs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/whatsapp/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function js(e){return ys.apply(this,arguments)}function ys(){return(ys=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/whatsapp/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function vs(e){return bs.apply(this,arguments)}function bs(){return(bs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/whatsapp/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zs(e){return ks.apply(this,arguments)}function ks(){return(ks=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/whatsapp/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ws(e){return Cs.apply(this,arguments)}function Cs(){return(Cs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/whatsapp/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Es(){return Ss.apply(this,arguments)}function Ss(){return(Ss=I()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/whatsapp/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ms={YCLOUD:p.QVR,CLOUD:p.bcD},As=function(e){var n=e.isEdit,t=e.whatsApp,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=(0,re.Z)().translateStringTranct,h=(0,V.u)((function(e){return e.currentOrg})),f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=(0,y.useState)(Ms.YCLOUD),Z=l()(j,2),k=Z[0],w=Z[1],C=ce(),E=C.workgroups,S=C.getDefaultUid,M=C.getWorkgroupOptions,A=function(){console.log("handleSubmit"),g(!0),d.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),o(n)})).catch((function(){g(!1)}))};return(0,y.useEffect)((function(){if(n){var e=(null==t?void 0:t.type)||Ms.YCLOUD;d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:e,key:null==t?void 0:t.key,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1}),w(e)}else{var r=S();d.setFieldsValue({name:"",description:"",type:Ms.YCLOUD,key:"",workgroupUid:r,enabled:!0,debug:!1}),w(Ms.YCLOUD)}}),[n,t,d,E]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"WhatsApp应用配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:A,loading:x||a,children:x||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"wechatWorkForm",onFinish:A,submitter:!1,children:[(0,b.jsx)(de.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,b.jsx)(pe.Z,{label:"应用类型",name:"type",options:[{label:"YCloud版",value:Ms.YCLOUD},{label:"云服务版",value:Ms.CLOUD,disabled:!0}],fieldProps:{defaultValue:Ms.YCLOUD,onChange:function(e){return w(e)}},rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"应用密钥",name:"key",rules:[{required:!0}],extra:(0,b.jsxs)(b.Fragment,{children:["请输入WhatsApp应用的密钥配置信息",k===Ms.YCLOUD&&(0,b.jsx)("div",{style:{marginTop:8},children:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/whatsapp#%E5%88%9B%E5%BB%BA-api-key",target:"_blank",rel:"noopener noreferrer",children:"查看YCloud版应用密钥获取说明"})})]})}),(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:M().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(he.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,b.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Is=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{whatsAppResult:{data:{content:[]}},currentWhatsApp:{uid:"",nickname:"",avatar:"",description:""},insertWhatsApp:function(n){e((function(e){e.whatsAppResult.data.content.unshift(n)}))},updateWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},deleteWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},setWhatsAppResult:function(t){var r;(e({whatsAppResult:t}),""===n().currentWhatsApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWhatsApp:t.data.content[0]}))},setCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().whatsAppResult),{},{data:{content:a}});e({whatsAppResult:l,currentWhatsApp:t})}else console.warn("WhatsApp with the specified uid not found."),e({currentWhatsApp:t})},refreshCurrentWhatsApp:function(n){e((function(e){e.currentWhatsApp=c()(c()({},e.currentWhatsApp),n);var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({whatsAppResult:c()(c()({},n().whatsAppResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("WhatsApp not found in cache:",t),n().currentWhatsApp.uid===t&&e({currentWhatsApp:{uid:""}})},deleteWhatsAppCache:function(){return e({},!0)}}})),{name:p.TvW}))),Ps=function(){var e=(0,C.useIntl)(),n=(0,y.useRef)(!1),t=(0,re.Z)().translateStringTranct,r=(0,i.Z)().isDarkMode,s=(0,y.useState)(!1),a=l()(s,2),o=a[0],u=a[1],d=(0,y.useState)(!1),p=l()(d,2),h=p[0],f=p[1],m=(0,y.useState)(!1),x=l()(m,2),j=x[0],v=x[1],Z=(0,V.u)((function(e){return e.currentOrg})),k=(0,y.useState)(null),w=l()(k,2),E=w[0],S=w[1],A=Is((function(e){return{whatsAppResult:e.whatsAppResult,currentWhatsApp:e.currentWhatsApp,setWhatsAppResult:e.setWhatsAppResult,insertWhatsApp:e.insertWhatsApp,setCurrentWhatsApp:e.setCurrentWhatsApp,deleteCurrentWhatsApp:e.deleteCurrentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),P=A.whatsAppResult,T=A.currentWhatsApp,L=A.setWhatsAppResult,B=A.insertWhatsApp,W=A.setCurrentWhatsApp,D=A.deleteCurrentWhatsApp,F=A.refreshCurrentWhatsApp,z=$.Z.useModal(),q=l()(z,2),N=q[0],O=q[1],U=function(){var n=I()(M()().mark((function n(t){var r;return M()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("delete whatsApp",t),R.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting"})),n.next=4,ws(t);case 4:r=n.sent,console.log("delete whatsApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),D(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),H=function(){var e=I()(M()().mark((function e(){var t,r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!n.current){e.next=3;break}return console.log("isLoading: 1",n.current),e.abrupt("return");case 3:return n.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,xs(t);case 8:r=e.sent,console.log("getWhatsApps response",r,t),200===r.code?(R.yw.destroy(),L(r)):(R.yw.destroy(),R.yw.error(r.message)),n.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){H();var e=function(e){f(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var _=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),v(!0),e.prev=2,!h){e.next=8;break}return e.next=6,ae(n);case 6:e.next=10;break;case 8:return e.next=10,se(n);case 10:return e.prev=10,v(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,vs(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateWhatsApp response:",t),200===t.code?(B(t.data),W(t.data),u(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==T?void 0:T.uid,R.yw.loading("正在更新..."),e.next=4,Zs(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateWhatsApp response:",t),200===t.code?(W(t.data),u(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=I()(M()().mark((function e(n,t){var r,s,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return S(n.uid),e.prev=1,e.next=4,Zs({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateWhatsApp enabled response",r),200===r.code?(R.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=P&&null!==(s=P.data)&&void 0!==s&&s.content&&(a=P.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),L(c()(c()({},P),{},{data:c()(c()({},P.data),{},{content:a})}))),(null==T?void 0:T.uid)===n.uid&&F&&F(r.data)):R.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,S(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){u(!0),f(!1)},children:e.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:H,children:e.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==T?void 0:T.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:e.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){f(!0),u(!0)}},{key:"toggle_enabled",icon:!1!==T.enabled?(0,b.jsx)(rt.Z,{}):(0,b.jsx)(st.Z,{}),label:!1!==T.enabled?e.formatMessage({id:"app.disable",defaultMessage:"禁用"}):e.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return le(T,!1===T.enabled)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:e.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return n=T,void N.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.name,"】？"),onOk:function(){U(n)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})});var n}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:P.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:T.uid===(null==e?void 0:e.uid)?{backgroundColor:r?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){W(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:t(null==e?void 0:e.name)}),(0,b.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]}),(0,b.jsx)(at.Z,{spinning:E===(null==e?void 0:e.uid),size:"small",children:(0,b.jsx)(Se.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:t(null==e?void 0:e.description)})})}}),o&&(0,b.jsx)(As,{isEdit:h,open:o,loading:j,whatsApp:T,onClose:function(){u(!1)},onSubmit:_}),O]})},Ts=t(77274),Rs=we.Z.Text,Ls=we.Z.Paragraph,Bs=T()(T()({},p.QVR,"YCloud版"),p.bcD,"云服务版"),Ws=T()(T()({},p.QVR,(0,b.jsx)(Te.Z,{})),p.bcD,(0,b.jsx)(Ts.Z,{})),Ds=function(){var e=(0,C.useIntl)(),n=Is((function(e){return{currentWhatsApp:e.currentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),t=n.currentWhatsApp,r=n.refreshCurrentWhatsApp,s=(0,y.useState)(!1),a=l()(s,2),i=a[0],o=a[1],c=(0,y.useState)(!1),u=l()(c,2),d=u[0],p=u[1],h=(0,y.useState)(!1),f=l()(h,2),m=f[0],x=f[1],g=(0,y.useState)(!1),j=l()(g,2),Z=j[0],k=j[1],w=(0,y.useState)(null),E=l()(w,2),S=E[0],A=E[1],P=(0,y.useState)(!1),T=l()(P,2),L=T[0],B=T[1],W=function(){return o(!i)},D=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return B(!0),e.prev=1,e.next=4,Es();case 4:n=e.sent,console.log("checkServiceReachable response",n),200===n.code?A(n.data):(A(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),A(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,B(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){D()}),[]);var F,z,q=function(){var e=I()(M()().mark((function e(){var n,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return p(!0),e.prev=4,e.next=7,js({uid:t.uid});case 7:n=e.sent,console.log("queryWhatsAppByUid refresh detail",n),200===n.code?(s=n.data,R.yw.success("应用详情刷新成功"),r&&r(s)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,p(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return x(!0),e.prev=4,e.next=7,Zs({uid:t.uid,enabled:n});case 7:s=e.sent,console.log("updateWhatsApp enabled response",s),200===s.code?(R.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(s.data)):R.yw.error("操作失败: ".concat(s.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,x(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return k(!0),e.prev=4,e.next=7,Zs({uid:t.uid,debug:n});case 7:s=e.sent,console.log("updateWhatsApp debug response",s),200===s.code?(R.yw.success("调试模式已".concat(n?"开启":"关闭")),r&&r(s.data)):R.yw.error("操作失败: ".concat(s.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,k(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return(0,b.jsx)(Ce.Z,{title:null!=t&&t.uid?(0,b.jsxs)(me.Z,{children:[Ws[t.type]||(0,b.jsx)(Te.Z,{}),(0,b.jsx)("span",{children:t.name||"WhatsApp应用详情"}),(0,b.jsx)(Se.Z,{color:"blue",children:Bs[t.type]||t.type}),(0,b.jsx)(Se.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"}),null!==S&&(0,b.jsx)(Se.Z,{color:S?"success":"error",icon:S?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:S?"服务可用":"服务不可用"}),L&&(0,b.jsx)(Se.Z,{color:"processing",children:"检查服务中..."})]}):"WhatsApp应用详情",extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/whatsapp","_blank")},type:"link",children:"文档"}),(null==t?void 0:t.uid)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(st.Z,{}),onClick:D,loading:L,type:"default",children:"检查服务"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:q,loading:d,type:"primary",children:"刷新详情"})]})]}),variant:"borderless",children:null!=t&&t.uid?(0,b.jsxs)(b.Fragment,{children:[!1===S&&(0,b.jsx)("div",{style:{marginBottom:16},children:(0,b.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(rt.Z,{}),(0,b.jsx)("strong",{children:"服务不可用警告："}),"WhatsApp服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,b.jsx)(Rs,{copyable:!0,children:t.uid})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,b.jsx)(Se.Z,{color:"blue",children:Bs[t.type]||t.type})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:!1!==t.enabled,onChange:N,loading:m,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,b.jsx)(Rs,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:t.debug||!1,onChange:O,loading:Z,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,b.jsx)(Rs,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,b.jsx)(Me.Z.Item,{label:"应用密钥",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Rs,{copyable:!!i&&{text:t.key||""},children:(F=t.key,z=i,F?z?F:"******":"-")}),(0,b.jsx)(Ie.Z,{title:i?"隐藏密钥":"显示密钥",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:W,size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"Webhook URL",children:(0,b.jsx)(Rs,{copyable:!0,children:(0,v.kG)()+"/whatsapp/webhooks/"+t.uid})}),(0,b.jsx)(Me.Z.Item,{label:"AccessToken",children:(0,b.jsx)(me.Z,{children:(0,b.jsx)(Rs,{copyable:!0,children:t.accessToken||"-"})})}),(0,b.jsx)(Me.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Ne()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(Ls,{children:t.description})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(Ls,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的WhatsApp应用凭证，避免泄露"}),(0,b.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,b.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,b.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,b.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,b.jsx)(Ee.Z,{description:"请先在左侧列表选择一个WhatsApp应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},Fs=(t(57902),t(10985),function(e){console.log(e)}),zs=function(){(0,C.useIntl)();var e=[{key:"detail",label:"应用详情",children:(0,b.jsx)(Ds,{})}],n=(0,y.useState)(e),t=l()(n,2),r=t[0],s=t[1];return(0,y.useEffect)((function(){var n=[].concat(e);s(n)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:r,onChange:Fs})})},qs=s.Z.Sider,Ns=s.Z.Content,Os=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.leftSiderWidth,a=e.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(qs,{width:t,style:n,children:(0,b.jsx)(Ps,{})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(Ns,{style:a,children:(0,b.jsx)(zs,{})})})]})};function Us(e){return Hs.apply(this,arguments)}function Hs(){return(Hs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function _s(e){return Vs.apply(this,arguments)}function Vs(){return(Vs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ks(e){return Ys.apply(this,arguments)}function Ys(){return(Ys=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Js(e){return Gs.apply(this,arguments)}function Gs(){return(Gs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Xs(e){return Qs.apply(this,arguments)}function Qs(){return(Qs=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $s(e){return ea.apply(this,arguments)}function ea(){return(ea=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/checkServiceReachable",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var na=t(84176),ta=t.n(na),ra=["token"],sa="WEBHOOK",aa="MESSENGER",la="INSTAGRAM",ia="WHATSAPP",oa=function(e){var n=e.isEdit,t=e.messenger,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=(0,re.Z)().translateStringTranct,h=(0,V.u)((function(e){return e.currentOrg})),f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=ce(),Z=j.workgroups,k=j.getDefaultUid,w=j.getWorkgroupOptions,C=function(){console.log("handleSubmit"),g(!0),d.validateFields().then((function(e){var n=e.token,t=ta()(e,ra),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==h?void 0:h.uid});console.log("submit",r),o(r)})).catch((function(){g(!1)}))};(0,y.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||aa,appId:null==t?void 0:t.appId,appSecret:null==t?void 0:t.appSecret,token:null==t?void 0:t.verifyToken,pageId:null==t?void 0:t.pageId,pageAccessToken:null==t?void 0:t.pageAccessToken,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1});else{var e=k();d.setFieldsValue({name:"",description:"",type:aa,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:e,enabled:!0,debug:!1})}}),[n,t,d,Z]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"Meta应用配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:C,loading:x||a,children:x||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"wechatWorkForm",onFinish:C,submitter:!1,children:[(0,b.jsx)(de.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,b.jsx)(pe.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:sa},{label:"Messenger",value:aa},{label:"Instagram",value:la},{label:"Whatsapp",value:ia}],fieldProps:{defaultValue:sa},rules:[{required:!0}]}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,b.jsx)(de.Z,{label:"应用ID(App ID)",name:"appId",rules:[{required:!0}],extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App ID获取说明"})})}}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,b.jsx)(de.Z,{label:"应用Secret(App Secret)",name:"appSecret",rules:[{required:!0}],extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App Secret获取说明"})})}}),(0,b.jsx)(de.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({token:n})},children:"随机生成"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,b.jsx)(de.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token",extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-access-token",target:"_blank",rel:"noopener noreferrer",children:"查看Page Access Token获取说明"})})}}),(0,b.jsx)(ue.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,b.jsx)(de.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID",extra:(0,b.jsx)("a",{href:(0,v.V)()+"/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-id",target:"_blank",rel:"noopener noreferrer",children:"查看Page ID获取说明"})})}}),(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:w().map((function(e){return{label:p(e.label),value:e.value}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(he.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,b.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},ca=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{messengerResult:{data:{content:[]}},currentMessenger:{uid:"",nickname:"",avatar:"",description:""},insertMessenger:function(n){e((function(e){e.messengerResult.data.content.unshift(n)}))},updateMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Messenger with uid ".concat(n.uid," not found."))}))},deleteMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Messenger with uid ".concat(n.uid," not found."))}))},setMessengerResult:function(t){var r;(e({messengerResult:t}),""===n().currentMessenger.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentMessenger:t.data.content[0]}))},setCurrentMessenger:function(t){var r=n().messengerResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().messengerResult),{},{data:{content:a}});e({messengerResult:l,currentMessenger:t})}else console.warn("Messenger with the specified uid not found."),e({currentMessenger:t})},refreshCurrentMessenger:function(n){e((function(e){e.currentMessenger=c()(c()({},e.currentMessenger),n);var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentMessenger:function(t){var r=n().messengerResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({messengerResult:c()(c()({},n().messengerResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("Messenger not found in cache:",t),n().currentMessenger.uid===t&&e({currentMessenger:{uid:""}})},deleteMessengerCache:function(){return e({},!0)}}})),{name:p.Gmi}))),ua=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),da=function(e){var n=e.type,t=(0,C.useIntl)(),r=(0,y.useRef)(!1),s=(0,re.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,o=(0,y.useState)(!1),u=l()(o,2),d=u[0],p=u[1],h=(0,y.useState)(!1),f=l()(h,2),m=f[0],x=f[1],j=(0,y.useState)(!1),v=l()(j,2),Z=v[0],k=v[1],w=(0,V.u)((function(e){return e.currentOrg})),E=(0,y.useState)(null),S=l()(E,2),A=S[0],P=S[1],T=ca((function(e){return{messengerResult:e.messengerResult,currentMessenger:e.currentMessenger,setMessengerResult:e.setMessengerResult,insertMessenger:e.insertMessenger,setCurrentMessenger:e.setCurrentMessenger,deleteCurrentMessenger:e.deleteCurrentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),L=T.messengerResult,B=T.currentMessenger,W=T.setMessengerResult,D=T.insertMessenger,F=T.setCurrentMessenger,z=T.deleteCurrentMessenger,q=T.refreshCurrentMessenger,N=$.Z.useModal(),O=l()(N,2),U=O[0],H=O[1],_=function(){var e=I()(M()().mark((function e(n){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete messenger",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Xs(n);case 4:r=e.sent,console.log("delete messenger response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(){var t,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==w?void 0:w.uid},e.next=8,Us(t);case 8:s=e.sent,console.log("getMessengers response",s,t),200===s.code?(R.yw.destroy(),W(s)):(R.yw.destroy(),R.yw.error(s.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){se();var e=function(e){x(!0),p(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var ae=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,ie(n);case 6:e.next=10;break;case 8:return e.next=10,le(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Ks(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateMessenger response:",t),200===t.code?(D(t.data),F(t.data),p(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==B?void 0:B.uid,R.yw.loading("正在更新..."),e.next=4,Js(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateMessenger response:",t),200===t.code?(F(t.data),p(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=I()(M()().mark((function e(n,t){var r,s,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(n.uid),e.prev=1,e.next=4,Js({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateMessenger enabled response",r),200===r.code?(R.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=L&&null!==(s=L.data)&&void 0!==s&&s.content&&(a=L.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),W(c()(c()({},L),{},{data:c()(c()({},L.data),{},{content:a})}))),(null==B?void 0:B.uid)===n.uid&&q&&q(r.data)):R.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,P(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){p(!0),x(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:se,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==B?void 0:B.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){x(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==B.enabled?(0,b.jsx)(rt.Z,{}):(0,b.jsx)(st.Z,{}),label:!1!==B.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return oe(B,!1===B.enabled)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){U.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(B)}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:L.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:(null==B?void 0:B.uid)===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){F(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:s(null==e?void 0:e.name)}),(0,b.jsxs)("span",{style:{color:"#1677ff"},children:["(",ua[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]}),(0,b.jsx)(at.Z,{spinning:A===(null==e?void 0:e.uid),size:"small",children:(0,b.jsx)(Se.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:s(null==e?void 0:e.description)})})}}),d&&(0,b.jsx)(oa,{isEdit:m,open:d,loading:Z,messenger:B,onClose:function(){p(!1)},onSubmit:ae}),H]})},pa=we.Z.Text,ha=we.Z.Paragraph,fa=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),ma=T()(T()(T()(T()({},p.Iap,(0,b.jsx)(Fe.Z,{})),p.Ff2,(0,b.jsx)(Te.Z,{})),p.cRk,(0,b.jsx)(Re.Z,{})),p.SbP,(0,b.jsx)(Le.Z,{})),xa="appSecret",ga="verifyToken",ja="accessToken",ya="pageAccessToken",va=function(){var e=(0,C.useIntl)(),n=ca((function(e){return{currentMessenger:e.currentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),t=n.currentMessenger,r=n.refreshCurrentMessenger,s=(0,y.useState)(T()(T()(T()(T()({},xa,!1),ga,!1),ja,!1),ya,!1)),a=l()(s,2),i=a[0],o=a[1],u=(0,y.useState)(!1),d=l()(u,2),p=d[0],h=d[1],f=(0,y.useState)(!1),m=l()(f,2),x=m[0],g=m[1],j=(0,y.useState)(!1),Z=l()(j,2),k=Z[0],w=Z[1],E=(0,y.useState)(null),S=l()(E,2),A=S[0],P=S[1],L=(0,y.useState)(!1),B=l()(L,2),W=B[0],D=B[1],F=function(e){o((function(n){return c()(c()({},n),{},T()({},e,!n[e]))}))},z=function(e,n){return e?n?e:"******":"-"},q=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return D(!0),e.prev=1,e.next=4,$s({});case 4:n=e.sent,console.log("checkMessengerServiceReachable response",n),200===n.code?P(n.data):(P(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),P(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,D(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){q()}),[]);var N,O=function(){var e=I()(M()().mark((function e(){var n,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return h(!0),e.prev=4,e.next=7,_s({uid:t.uid});case 7:n=e.sent,console.log("queryMessengerByUid refresh detail",n),200===n.code?(s=n.data,R.yw.success("应用详情刷新成功"),r&&r(s)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,h(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),U=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return g(!0),e.prev=4,e.next=7,Js({uid:t.uid,enabled:n});case 7:s=e.sent,console.log("updateMessenger enabled response",s),200===s.code?(R.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(s.data)):R.yw.error("操作失败: ".concat(s.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,g(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return w(!0),e.prev=4,e.next=7,Js({uid:t.uid,debug:n});case 7:s=e.sent,console.log("updateMessenger debug response",s),200===s.code?(R.yw.success("调试模式已".concat(n?"开启":"关闭")),r&&r(s.data)):R.yw.error("操作失败: ".concat(s.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,w(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return(0,b.jsx)(Ce.Z,{title:null!=t&&t.uid?(0,b.jsxs)(me.Z,{children:[ma[t.type]||(0,b.jsx)(Te.Z,{}),(0,b.jsx)("span",{children:t.name||"Messenger应用详情"}),(0,b.jsx)(Se.Z,{color:"blue",children:fa[t.type]||t.type}),(0,b.jsx)(Se.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"}),null!==A&&(0,b.jsx)(Se.Z,{color:A?"success":"error",icon:A?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:A?"服务可用":"服务不可用"}),W&&(0,b.jsx)(Se.Z,{color:"processing",children:"检查服务中..."})]}):"Messenger应用详情",extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook","_blank")},type:"link",children:"文档"}),(null==t?void 0:t.uid)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(st.Z,{}),onClick:q,loading:W,type:"default",children:"检查服务"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:O,loading:p,type:"primary",children:"刷新详情"})]})]}),variant:"borderless",children:null!=t&&t.uid?(0,b.jsxs)(b.Fragment,{children:[!1===A&&(0,b.jsx)("div",{style:{marginBottom:16},children:(0,b.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(rt.Z,{}),(0,b.jsx)("strong",{children:"服务不可用警告："}),"Messenger服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,b.jsx)(pa,{copyable:!0,children:t.uid})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,b.jsx)(Se.Z,{color:"blue",children:fa[t.type]||t.type})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:!1!==t.enabled,onChange:U,loading:x,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,b.jsx)(pa,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:t.debug||!1,onChange:H,loading:k,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,b.jsx)(pa,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"AppID"}),(0,b.jsx)(Ie.Z,{title:"查看获取App ID说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsx)(pa,{copyable:!0,children:t.appId})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"AppSecret"}),(0,b.jsx)(Ie.Z,{title:"查看获取App Secret说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(pa,{copyable:!!i[xa]&&{text:t.appSecret||""},children:z(t.appSecret,i[xa])}),(0,b.jsx)(Ie.Z,{title:i[xa]?"隐藏AppSecret":"显示AppSecret",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[xa]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return F(xa)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"Webhook URL"}),(0,b.jsx)(Ie.Z,{title:"查看Webhook配置说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook#%E9%85%8D%E7%BD%AE-webhook","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsxs)(me.Z,{direction:"vertical",size:0,children:[(0,b.jsx)(pa,{copyable:!0,children:(0,v.kG)()+"/meta/webhooks/"+t.uid}),(N=(0,v.kG)()+"/meta/webhooks/"+t.uid,/(\d{1,3}\.){3}\d{1,3}/.test(N)&&(0,b.jsx)(At.Z,{message:"Webhook URL中包含IP地址，Facebook仅支持https+域名的方式。",type:"warning",action:(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){window.open((0,v.L5)()+"docs/zh-CN/docs/deploy/depend/nginx","_blank")},children:"-》解决方案: Nginx反向代理"})}))]})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"验证口令"}),(0,b.jsx)(Ie.Z,{title:"查看验证口令使用说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook#%E9%85%8D%E7%BD%AE-webhook","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(pa,{copyable:!!i[ga]&&{text:t.verifyToken||""},children:z(t.verifyToken,i[ga])}),(0,b.jsx)(Ie.Z,{title:i[ga]?"隐藏Verify Token":"显示Verify Token",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[ga]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return F(ga)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"Page Access Token"}),(0,b.jsx)(Ie.Z,{title:"查看获取Page Access Token说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-access-token","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(pa,{copyable:!!i[ya]&&{text:t.pageAccessToken||""},children:z(t.pageAccessToken,i[ya])}),(0,b.jsx)(Ie.Z,{title:i[ya]?"隐藏Page Access Token":"显示Page Access Token",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[ya]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return F(ya)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:"Page ID"}),(0,b.jsx)(Ie.Z,{title:"查看获取Page ID说明",children:(0,b.jsx)(it.Z,{onClick:function(){return window.open((0,v.L5)()+"docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-id","_blank")},style:{cursor:"pointer"}})})]}),children:(0,b.jsx)(pa,{copyable:!0,children:t.pageId||"-"})}),t.description&&(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(ha,{children:t.description})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(ha,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的Messenger应用凭证，避免泄露"}),(0,b.jsx)("li",{children:"请妥善保存 验证口令 和 AppSecret，这些信息不应公开"}),(0,b.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,b.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,b.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,b.jsx)(Ee.Z,{description:"请先在左侧列表选择一个Messenger应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},ba=function(e){console.log(e)},Za=[{key:"detail",label:"应用详情",children:(0,b.jsx)(va,{})}],ka=function(e){e.type;var n=(0,y.useState)(Za),t=l()(n,2),r=t[0],s=t[1];return(0,y.useEffect)((function(){var e=[].concat(Za);s(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:r,onChange:ba})})},wa=s.Z.Sider,Ca=s.Z.Content,Ea=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth,i=t.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(wa,{width:l,style:a,children:(0,b.jsx)(da,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(Ca,{style:i,children:(0,b.jsx)(ka,{type:n})})})]})};function Sa(e){return Ma.apply(this,arguments)}function Ma(){return(Ma=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Aa(e){return Ia.apply(this,arguments)}function Ia(){return(Ia=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pa(e){return Ta.apply(this,arguments)}function Ta(){return(Ta=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ra(e){return La.apply(this,arguments)}function La(){return(La=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ba(e){return Wa.apply(this,arguments)}function Wa(){return(Wa=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Da(e){return Fa.apply(this,arguments)}function Fa(){return(Fa=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{channel:p.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function za(){return qa.apply(this,arguments)}function qa(){return(qa=I()(M()().mark((function e(){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,C.request)("/api/v1/meta/app/checkServiceReachable",{method:"GET",params:{channel:p.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Na=["token"],Oa="WEBHOOK",Ua="MESSENGER",Ha="INSTAGRAM",_a="WHATSAPP",Va=function(e){var n=e.isEdit,t=e.instagram,r=e.open,s=e.loading,a=void 0!==s&&s,i=e.onClose,o=e.onSubmit,u=ue.A.useForm(),d=l()(u,1)[0],p=((0,re.Z)().translateStringTranct,(0,V.u)((function(e){return e.currentOrg}))),h=(0,y.useState)(!1),f=l()(h,2),m=f[0],x=f[1],g=ce(),j=g.workgroups,v=g.getDefaultUid,Z=g.getWorkgroupOptions,k=function(){console.log("handleSubmit"),x(!0),d.validateFields().then((function(e){var n=e.token,t=ta()(e,Na),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==p?void 0:p.uid});console.log("submit",r),o(r)})).catch((function(){x(!1)}))};(0,y.useEffect)((function(){if(n)d.setFieldsValue({name:null==t?void 0:t.name,description:null==t?void 0:t.description,type:(null==t?void 0:t.type)||Ha,appId:null==t?void 0:t.appId,appSecret:null==t?void 0:t.appSecret,token:null==t?void 0:t.verifyToken,pageId:null==t?void 0:t.pageId,pageAccessToken:null==t?void 0:t.pageAccessToken,workgroupUid:null==t?void 0:t.workgroupUid,enabled:!1!==(null==t?void 0:t.enabled),debug:(null==t?void 0:t.debug)||!1});else{var e=v();d.setFieldsValue({name:"",description:"",type:Ha,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:e,enabled:!0,debug:!1})}}),[n,t,d,j,v]);return(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(fe.Z,{title:"Meta应用配置",onClose:i,open:r,width:600,extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{onClick:i,children:"取消"}),(0,b.jsx)(ne.ZP,{type:"primary",onClick:k,loading:m||a,children:m||a?"保存中...":"保存"})]}),children:(0,b.jsxs)(ue.A,{form:d,name:"wechatWorkForm",onFinish:k,submitter:!1,children:[(0,b.jsx)(de.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,b.jsx)(pe.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:Oa},{label:"Messenger",value:Ua},{label:"Instagram",value:Ha},{label:"Whatsapp",value:_a}],fieldProps:{defaultValue:Oa},rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}d.setFieldsValue({token:n})},children:"随机生成"}),(0,b.jsx)(ne.ZP,{size:"small",onClick:function(){var e=d.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,b.jsx)(de.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,b.jsx)(de.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID"}),(0,b.jsx)(pe.Z,{label:"客服技能组",name:"workgroupUid",options:Z(),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,b.jsx)(he.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,b.jsx)(he.Z,{label:"调试模式",name:"debug",fieldProps:{checkedChildren:"开启",unCheckedChildren:"关闭"},extra:"开启调试模式后，系统会记录详细的日志信息，便于问题排查"}),(0,b.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Ka=(0,h.Ue)()((0,f.mW)((0,f.tJ)((0,m.n)((function(e,n){return{instagramResult:{data:{content:[]}},currentInstagram:{uid:"",nickname:"",avatar:"",description:""},insertInstagram:function(n){e((function(e){e.instagramResult.data.content.unshift(n)}))},updateInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Instagram with uid ".concat(n.uid," not found."))}))},deleteInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Instagram with uid ".concat(n.uid," not found."))}))},setInstagramResult:function(t){var r;(e({instagramResult:t}),""===n().currentInstagram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentInstagram:t.data.content[0]}))},setCurrentInstagram:function(t){var r=n().instagramResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var a=[].concat(d()(r.slice(0,s)),[t],d()(r.slice(s+1))),l=c()(c()({},n().instagramResult),{},{data:{content:a}});e({instagramResult:l,currentInstagram:t})}else console.warn("Instagram with the specified uid not found."),e({currentInstagram:t})},refreshCurrentInstagram:function(n){e((function(e){e.currentInstagram=c()(c()({},e.currentInstagram),n);var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentInstagram:function(t){var r=n().instagramResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({instagramResult:c()(c()({},n().instagramResult),{},{data:{content:[].concat(d()(r.slice(0,s)),d()(r.slice(s+1)))}})}):console.warn("Instagram not found in cache:",t),n().currentInstagram.uid===t&&e({currentInstagram:{uid:""}})},deleteInstagramCache:function(){return e({},!0)}}})),{name:p.S6e}))),Ya=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Ja=function(e){var n=e.type,t=(0,C.useIntl)(),r=(0,y.useRef)(!1),s=(0,re.Z)().translateStringTranct,a=(0,i.Z)().isDarkMode,o=(0,y.useState)(!1),u=l()(o,2),d=u[0],p=u[1],h=(0,y.useState)(!1),f=l()(h,2),m=f[0],x=f[1],j=(0,y.useState)(!1),v=l()(j,2),Z=v[0],k=v[1],w=(0,V.u)((function(e){return e.currentOrg})),E=(0,y.useState)(null),S=l()(E,2),A=S[0],P=S[1],T=Ka((function(e){return{instagramResult:e.instagramResult,currentInstagram:e.currentInstagram,setInstagramResult:e.setInstagramResult,insertInstagram:e.insertInstagram,setCurrentInstagram:e.setCurrentInstagram,deleteCurrentInstagram:e.deleteCurrentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),L=T.instagramResult,B=T.currentInstagram,W=T.setInstagramResult,D=T.insertInstagram,F=T.setCurrentInstagram,z=T.deleteCurrentInstagram,q=T.refreshCurrentInstagram,N=$.Z.useModal(),O=l()(N,2),U=O[0],H=O[1],_=function(){var e=I()(M()().mark((function e(n){var r;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete instagram",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Ba(n);case 4:r=e.sent,console.log("delete instagram response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),se=function(){var e=I()(M()().mark((function e(){var t,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==w?void 0:w.uid},e.next=8,Sa(t);case 8:s=e.sent,console.log("getInstagram response",s,t),200===s.code?(R.yw.destroy(),W(s)):(R.yw.destroy(),R.yw.error(s.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){se();var e=function(e){x(!0),p(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var ae=function(){var e=I()(M()().mark((function e(n){return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,ie(n);case 6:e.next=10;break;case 8:return e.next=10,le(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Pa(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateInstagram response:",t),200===t.code?(D(t.data),F(t.data),p(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=I()(M()().mark((function e(n){var t;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==B?void 0:B.uid,R.yw.loading("正在更新..."),e.next=4,Ra(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateInstagram response:",t),200===t.code?(F(t.data),p(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=I()(M()().mark((function e(n,t){var r,s,a;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P(n.uid),e.prev=1,e.next=4,Ra({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateInstagram enabled response",r),200===r.code?(R.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=L&&null!==(s=L.data)&&void 0!==s&&s.content&&(a=L.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),W(c()(c()({},L),{},{data:c()(c()({},L.data),{},{content:a})}))),(null==B?void 0:B.uid)===n.uid&&q&&q(r.data)):R.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,P(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,b.jsxs)(ee.Z,{gap:"small",children:[(0,b.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,b.jsx)(Y.Z,{}),onClick:function(){p(!0),x(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(J.Z,{}),onClick:se,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==B?void 0:B.uid)&&(0,b.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,b.jsx)(G.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){x(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==B.enabled?(0,b.jsx)(rt.Z,{}):(0,b.jsx)(st.Z,{}),label:!1!==B.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return oe(B,!1===B.enabled)}},{key:"delete",icon:(0,b.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){U.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,b.jsx)(K.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(B)}}]},children:(0,b.jsx)(ne.ZP,{size:"small",icon:(0,b.jsx)(Q.Z,{})})})]}),(0,b.jsx)(g.Z,{itemLayout:"horizontal",dataSource:L.data.content,renderItem:function(e,n){return(0,b.jsx)(g.Z.Item,{style:(null==B?void 0:B.uid)===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){F(e)},children:(0,b.jsx)(g.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)("span",{children:s(null==e?void 0:e.name)}),(0,b.jsxs)("span",{style:{color:"#1677ff"},children:["(",Ya[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]}),(0,b.jsx)(at.Z,{spinning:A===(null==e?void 0:e.uid),size:"small",children:(0,b.jsx)(Se.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:s(null==e?void 0:e.description)})})}}),d&&(0,b.jsx)(Va,{isEdit:m,open:d,loading:Z,instagram:B,onClose:function(){p(!1)},onSubmit:ae}),H]})},Ga=we.Z.Text,Xa=we.Z.Paragraph,Qa=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),$a=T()(T()(T()(T()({},p.Iap,(0,b.jsx)(Fe.Z,{})),p.Ff2,(0,b.jsx)(Te.Z,{})),p.cRk,(0,b.jsx)(Re.Z,{})),p.SbP,(0,b.jsx)(Le.Z,{})),el="appSecret",nl="verifyToken",tl="accessToken",rl="pageAccessToken",sl=function(){var e=(0,C.useIntl)(),n=Ka((function(e){return{currentInstagram:e.currentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),t=n.currentInstagram,r=n.refreshCurrentInstagram,s=(0,y.useState)(T()(T()(T()(T()({},el,!1),nl,!1),tl,!1),rl,!1)),a=l()(s,2),i=a[0],o=a[1],u=(0,y.useState)(!1),d=l()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),h=l()(p,2),f=h[0],m=h[1],x=(0,y.useState)(!1),g=l()(x,2),j=g[0],Z=g[1],k=(0,y.useState)(!1),w=l()(k,2),E=w[0],S=w[1],A=(0,y.useState)(!1),P=l()(A,2),L=P[0],B=P[1],W=(0,y.useState)(null),D=l()(W,2),F=D[0],z=D[1],q=(0,y.useState)(!1),N=l()(q,2),O=N[0],U=N[1],H=function(e){o((function(n){return c()(c()({},n),{},T()({},e,!n[e]))}))},_=function(e,n){return e?n?e:"******":"-"},V=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return U(!0),e.prev=1,e.next=4,za();case 4:n=e.sent,console.log("checkInstagramServiceReachable response",n),200===n.code?z(n.data):(z(!1),console.error("服务检查失败:",n.message)),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(1),z(!1),console.error("服务检查出错:",e.t0);case 13:return e.prev=13,U(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[1,9,13,16]])})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V()}),[]);var K=function(){var e=I()(M()().mark((function e(){var n;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return m(!0),e.prev=4,e.next=7,Da({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenInstagram response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),r&&r(n.data),Y()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,m(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=I()(M()().mark((function e(){var n,s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return Z(!0),e.prev=4,e.next=7,Aa({uid:t.uid});case 7:n=e.sent,console.log("queryInstagramByUid refresh detail",n),200===n.code?(s=n.data,R.yw.success("应用详情刷新成功"),r&&r(s)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,Z(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return S(!0),e.prev=4,e.next=7,Ra({uid:t.uid,enabled:n});case 7:s=e.sent,console.log("updateInstagram enabled response",s),200===s.code?(R.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(s.data)):R.yw.error("操作失败: ".concat(s.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,S(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),Q=function(){var e=I()(M()().mark((function e(n){var s;return M()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法切换调试状态，应用信息不完整"),e.abrupt("return");case 3:return B(!0),e.prev=4,e.next=7,Ra({uid:t.uid,debug:n});case 7:s=e.sent,console.log("updateInstagram debug response",s),200===s.code?(R.yw.success("调试模式已".concat(n?"开启":"关闭")),r&&r(s.data)):R.yw.error("操作失败: ".concat(s.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,B(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,b.jsxs)(Ce.Z,{title:(0,b.jsxs)(me.Z,{children:[$a[t.type]||(0,b.jsx)(Te.Z,{}),(0,b.jsx)("span",{children:t.name||"Instagram应用详情"}),(0,b.jsx)(Se.Z,{color:"blue",children:Qa[t.type]||t.type}),(0,b.jsx)(Se.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"}),null!==F&&(0,b.jsx)(Se.Z,{color:F?"success":"error",icon:F?(0,b.jsx)(st.Z,{}):(0,b.jsx)(rt.Z,{}),children:F?"服务可用":"服务不可用"}),O&&(0,b.jsx)(Se.Z,{color:"processing",children:"检查服务中..."})]}),extra:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(G.Z,{}),onClick:function(){var e=new CustomEvent("instagram-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(st.Z,{}),onClick:V,loading:O,type:"default",children:"检查服务"}),(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(J.Z,{}),onClick:Y,loading:j,type:"primary",children:"刷新详情"})]}),variant:"borderless",children:[!1===F&&(0,b.jsx)("div",{style:{marginBottom:16},children:(0,b.jsx)("div",{style:{padding:"12px 16px",background:"#fff2f0",border:"1px solid #ffccc7",borderRadius:"6px",color:"#ff4d4f"},children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(rt.Z,{}),(0,b.jsx)("strong",{children:"服务不可用警告："}),"Instagram服务当前不可用，可能影响消息收发功能。请检查网络连接或联系管理员。"]})})}),(0,b.jsxs)(Me.Z,{bordered:!0,column:1,children:[(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,b.jsx)(Ga,{copyable:!0,children:t.uid})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,b.jsx)(Se.Z,{color:"blue",children:Qa[t.type]||t.type})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:!1!==t.enabled,onChange:X,loading:E,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,b.jsx)(Ga,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,b.jsx)(Me.Z.Item,{label:"调试模式",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ae.Z,{checked:t.debug||!1,onChange:Q,loading:L,checkedChildren:"开启",unCheckedChildren:"关闭"}),(0,b.jsx)(Ga,{type:t.debug?"warning":"secondary",children:t.debug?"已开启":"已关闭"})]})}),(0,b.jsx)(Me.Z.Item,{label:"AppID",children:(0,b.jsx)(Ga,{copyable:!0,children:t.appId})}),(0,b.jsx)(Me.Z.Item,{label:"AppSecret",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ga,{copyable:!!i[el]&&{text:t.appSecret||""},children:_(t.appSecret,i[el])}),(0,b.jsx)(Ie.Z,{title:i[el]?"隐藏AppSecret":"显示AppSecret",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[el]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return H(el)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"回调网址",children:(0,b.jsx)(Ga,{copyable:!0,children:(0,v.kG)()+"/meta/webhooks/"+t.uid})}),(0,b.jsx)(Me.Z.Item,{label:"验证口令",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ga,{copyable:!!i[nl]&&{text:t.verifyToken||""},children:_(t.verifyToken,i[nl])}),(0,b.jsx)(Ie.Z,{title:i[nl]?"隐藏Verify Token":"显示Verify Token",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[nl]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return H(nl)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"Page Access Token",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ga,{copyable:!!i[rl]&&{text:t.pageAccessToken||""},children:_(t.pageAccessToken,i[rl])}),(0,b.jsx)(Ie.Z,{title:i[rl]?"隐藏Page Access Token":"显示Page Access Token",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[rl]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return H(rl)},size:"small"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"Page ID",children:(0,b.jsx)(Ga,{copyable:!0,children:t.pageId||"-"})}),(0,b.jsx)(Me.Z.Item,{label:"AccessToken",children:(0,b.jsxs)(me.Z,{children:[(0,b.jsx)(Ga,{copyable:!!i[tl]&&{text:t.accessToken||""},children:_(t.accessToken,i[tl])}),(0,b.jsx)(Ie.Z,{title:i[tl]?"隐藏AccessToken":"显示AccessToken",children:(0,b.jsx)(ne.ZP,{type:"text",icon:i[tl]?(0,b.jsx)(De.Z,{}):(0,b.jsx)(Fe.Z,{}),onClick:function(){return H(tl)},size:"small"})}),(0,b.jsx)(Ie.Z,{title:"刷新AccessToken",children:(0,b.jsx)(ne.ZP,{type:"primary",icon:(0,b.jsx)(ze.Z,{}),onClick:K,size:"small",loading:f,children:"刷新Token"})})]})}),(0,b.jsx)(Me.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Ne()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,b.jsx)(Xa,{children:t.description})}),(0,b.jsx)(Me.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Ne()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,b.jsx)(Pe.Z,{}),(0,b.jsx)(we.Z.Title,{level:5,children:"安全说明"}),(0,b.jsx)(Xa,{children:(0,b.jsxs)("ul",{children:[(0,b.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,b.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,b.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,b.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,b.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,b.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,b.jsx)(Ce.Z,{variant:"borderless",title:"Instagram应用详情",extra:(0,b.jsx)(ne.ZP,{icon:(0,b.jsx)(We.Z,{}),onClick:function(){return window.open((0,v.V)()+"/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),children:(0,b.jsx)(Ee.Z,{description:"请先在左侧列表选择一个Instagram应用",image:Ee.Z.PRESENTED_IMAGE_SIMPLE})})},al=function(e){console.log(e)},ll=[{key:"detail",label:"应用详情",children:(0,b.jsx)(sl,{})}],il=function(e){e.type;var n=(0,y.useState)(ll),t=l()(n,2),r=t[0],s=t[1];return(0,y.useEffect)((function(){var e=[].concat(ll);s(e)}),[]),(0,b.jsx)(b.Fragment,{children:(0,b.jsx)(w.Z,{defaultActiveKey:"agent",items:r,onChange:al})})},ol=s.Z.Sider,cl=s.Z.Content,ul=function(e){var n=e.type,t=(0,r.Z)(),a=t.leftSiderStyle,l=t.leftSiderWidth,i=t.contentStyle;return(0,b.jsxs)(s.Z,{style:{height:"100vh"},children:[(0,b.jsx)(ol,{width:l,style:a,children:(0,b.jsx)(Ja,{type:n})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(cl,{style:i,children:(0,b.jsx)(il,{type:n})})})]})},dl=function(e){var n=e.channel,t="web"===(null==n?void 0:n.name)||"npm"===(null==n?void 0:n.name);return(0,b.jsxs)("div",{children:[t&&(0,b.jsx)(un,{channel:n}),"app"===(null==n?void 0:n.name)&&(0,b.jsx)(Un,{type:null==n?void 0:n.name}),"wechat"===(null==n?void 0:n.name)&&(0,b.jsx)(en,{type:null==n?void 0:n.name}),"messenger"===(null==n?void 0:n.name)&&(0,b.jsx)(Ea,{type:p.Ff2}),"instagram"===(null==n?void 0:n.name)&&(0,b.jsx)(ul,{type:p.cRk}),"whatsapp"===(null==n?void 0:n.name)&&(0,b.jsx)(Os,{}),"telegram"===(null==n?void 0:n.name)&&(0,b.jsx)(Hr,{type:null==n?void 0:n.name}),"line"===(null==n?void 0:n.name)&&(0,b.jsx)(ms,{type:null==n?void 0:n.name}),"email"===(null==n?void 0:n.name)&&(0,b.jsx)(vr,{type:null==n?void 0:n.name}),"douyin"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"baidu"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"weibo"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"pdd"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"jd"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"qianniu"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"doudian"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"telegram"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"facebook"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"line"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"shopify"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"lazada"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"wordpress"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"opencart"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"magento"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"prestashop"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"dify"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{}),"coze"===(null==n?void 0:n.name)&&(0,b.jsx)(E,{})]})},pl=function(){var e,n=(0,i.Z)().isDarkMode,t=(0,y.useState)(""),r=l()(t,2),s=r[0],a=r[1],o=(0,y.useState)([]),u=l()(o,2),p=u[0],h=u[1],f=x().currentChannel;(0,y.useEffect)((function(){f&&m(f)}),[f]);var m=function(e){var n=e.name;-1===p.findIndex((function(e){return e.key===n}))&&h([].concat(d()(p),[{label:e.nickname,key:n,children:(0,b.jsx)(dl,{channel:e}),channelInfo:e,closable:!0}])),a(n)},g=null===(e=p.find((function(e){return e.key===s})))||void 0===e?void 0:e.children;return(0,b.jsxs)("div",{className:"channel-tab-container",children:[(0,b.jsx)("div",{className:"channel-tab-sticky ".concat(n?"dark":""),children:(0,b.jsx)(w.Z,{hideAdd:!0,onChange:function(e){a(e)},activeKey:s,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=p.findIndex((function(n){return n.key===e})),t=p.filter((function(n){return n.key!==e}));if(t.length&&e===s){var r=t[n===t.length?n-1:n].key;a(r)}h(t)}(e)},items:p.map((function(e){return c()(c()({},e),{},{children:null})}))})}),(0,b.jsx)("div",{className:"channel-tab-content",children:g&&(0,b.jsx)("div",{className:"tab-pane",children:g})})]})},hl=s.Z.Sider,fl=s.Z.Content,ml=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,b.jsx)(b.Fragment,{children:(0,b.jsxs)(s.Z,{children:[(0,b.jsx)(hl,{style:n,children:(0,b.jsx)(k,{})}),(0,b.jsx)(s.Z,{children:(0,b.jsx)(fl,{style:t,children:(0,b.jsx)(pl,{})})})]})})}}}]);