"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9400],{98899:function(e,n,t){t.d(n,{Z:function(){return y}});var r=t(90819),a=t.n(r),s=t(89933),i=t.n(s),o=t(45332),c=t.n(o),l=t(31756),u=t(25191),d=t(75699);function f(){return p.apply(this,arguments)}function p(){return(p=i()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e,n){return h.apply(this,arguments)}function h(){return(h=i()(a()().mark((function e(n,t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:n,captchaCode:t,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=t(80597),x=t(16799),v=t(44194),j=t(31549),y=function(e){var n=e.onKaptchaChange,t=e.onKaptchaCheck,r=(0,d.useIntl)(),s=(0,v.useState)(),o=c()(s,2),u=o[0],p=o[1],h=(0,v.useState)(),y=c()(h,2),b=y[0],Z=y[1],M=function(){var e=i()(a()().mark((function e(){var n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f();case 2:200===(n=e.sent).code?(p(n.data.captchaUid),Z(n.data.captchaImage)):l.yw.error(r.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),w=function(){var e=i()(a()().mark((function e(n,r){var s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g(n,r);case 2:s=e.sent,console.log("checkCaptcha response",s),200===s.code?t&&t(!0):t&&t(!1);case 5:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,j.jsx)(j.Fragment,{children:b&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(x.Z,{onChange:function(e){n&&(n(u,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?w(u,e.target.value):t&&t(!1))},prefix:(0,j.jsx)(m.Z,{}),placeholder:r.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,j.jsx)("img",{src:b,alt:"captcha",onClick:M})]})})}},30234:function(e,n,t){var r=t(25191),a=t(32057),s=t(75699);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},34235:function(e,n,t){t.r(n),t.d(n,{default:function(){return Y}});var r=t(75699),a=t(1670),s=t(51438),i=t(90962),o=t(57039),c=t(77260),l=t(44194),u={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M866.9 169.9L527.1 54.1C523 52.7 517.5 52 512 52s-11 .7-15.1 2.1L157.1 169.9c-8.3 2.8-15.1 12.4-15.1 21.2v482.4c0 8.8 5.7 20.4 12.6 25.9L499.3 968c3.5 2.7 8 4.1 12.6 4.1s9.2-1.4 12.6-4.1l344.7-268.6c6.9-5.4 12.6-17 12.6-25.9V191.1c.2-8.8-6.6-18.3-14.9-21.2zM810 654.3L512 886.5 214 654.3V226.7l298-101.6 298 101.6v427.6zm-405.8-201c-3-4.1-7.8-6.6-13-6.6H336c-6.5 0-10.3 7.4-6.5 12.7l126.4 174a16.1 16.1 0 0026 0l212.6-292.7c3.8-5.3 0-12.7-6.5-12.7h-55.2c-5.1 0-10 2.5-13 6.6L468.9 542.4l-64.7-89.1z"}}]},name:"safety-certificate",theme:"outlined"},d=t(5901),f=function(e,n){return l.createElement(d.Z,(0,c.Z)({},e,{ref:n,icon:u}))};var p=l.forwardRef(f),g=t(45332),h=t.n(g),m=t(76790),x=t(6373),v=t(19924),j=t(17129),y=t(81020),b=t(68943),Z=t(4363),M=t(38086),w=t(16829),k=t(38722),C=t(15883),S=t(90819),F=t.n(S),U=t(89933),I=t.n(U),z=t(31756),V=t(14163),T=t(25400),A=t(98899),L=t(30234),R=t(31881),E=t(25191),P=t(82325),q=t(76630),K=t(22766),N=t(97913),O=t(81213),W=t(31549),B=function(e){var n=e.open,t=e.onSubmit,a=e.onClose,s=(0,r.useIntl)(),i=x.A.useForm(),o=h()(i,1)[0],c=(0,L.Z)().translateString,u=(0,m.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),d=u.userInfo,f=u.deviceUid,p=(0,R.u)((function(e){return e.currentOrg})),g=(0,l.useRef)(),v=(0,l.useState)(""),j=h()(v,2),y=j[0],b=j[1],Z=(0,l.useState)(""),M=h()(Z,2),w=M[0],k=M[1],C=(0,l.useState)(!1),S=h()(C,2),U=S[0],B=S[1],G=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=g.current)||void 0===e||e.endTiming()}),2)};(0,l.useEffect)((function(){n?o.setFieldsValue({email:null==d?void 0:d.email}):(o.resetFields(),G())}),[n]);var _=function(){var e=I()(F()().mark((function e(n,t){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",n," captchaValue",t),b(n),k(t);case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),D=function(){var e=I()(F()().mark((function e(n){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",n),B(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=I()(F()().mark((function e(){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=I()(F()().mark((function e(n){var r,s;return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("changeEmail:",n),r={email:n.email,code:n.code,platform:E.iw8},e.next=4,(0,T.Uk)(r);case 4:s=e.sent,console.log("changeEmail response:",s),200===s.code?(z.yw.success("Email verify successfully!"),t(n.email),a()):z.yw.error(c(s.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(O.Z,{title:s.formatMessage({id:"pages.settings.verify.email",defaultMessage:"验证邮箱"}),forceRender:!0,open:n,footer:null,onCancel:function(){a()},children:(0,W.jsxs)(x.A,{form:o,onFinish:function(){var e=I()(F()().mark((function e(n){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeEmail:",n),H();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,W.jsx)(K.Z,{fieldProps:{size:"large",prefix:(0,W.jsx)(P.Z,{})},name:"email",placeholder:s.formatMessage({id:"pages.login.email.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,W.jsx)(r.FormattedMessage,{id:"pages.login.email.required",defaultMessage:"请输入邮箱！"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}],readonly:!0}),(0,W.jsx)(x.A.Item,{name:"captchaCode",rules:[],children:(0,W.jsx)(A.Z,{onKaptchaChange:_,onKaptchaCheck:D})}),(0,W.jsx)(N.Z,{fieldProps:{size:"large",prefix:(0,W.jsx)(q.Z,{}),allowClear:!0},captchaProps:{size:"large",disabled:!U},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,n){return e?"".concat(n," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"email",name:"code",rules:[{required:!0,message:(0,W.jsx)(r.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:g,onGetCaptcha:function(){var e=I()(F()().mark((function e(n){var t,r;return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("email:",n),!n){e.next=14;break}return t={email:n,type:E.UMe,captchaUid:y,captchaCode:w,deviceUid:f,userUid:null==d?void 0:d.uid,orgUid:null==p?void 0:p.uid,platform:E.iw8},e.next=5,(0,V.O8)(t);case 5:if(r=e.sent,console.log("sendEmailCode",r),200===r.code){e.next=11;break}return z.yw.error(c(r.message)),G(),e.abrupt("return");case 11:z.yw.success(c(r.message)),e.next=15;break;case 14:z.yw.error("手机号格式错误");case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()})]})})})},G=function(e){var n=e.open,t=e.onSubmit,a=e.onClose,s=(0,r.useIntl)(),i=x.A.useForm(),o=h()(i,1)[0],c=(0,L.Z)().translateString,u=(0,m.L)((function(e){return{userInfo:e.userInfo,deviceUid:e.deviceUid}})),d=u.userInfo,f=u.deviceUid,p=(0,R.u)((function(e){return e.currentOrg})),g=(0,l.useRef)(),v=(0,l.useState)(""),j=h()(v,2),y=j[0],b=j[1],Z=(0,l.useState)(""),M=h()(Z,2),w=M[0],k=M[1],C=(0,l.useState)(!1),S=h()(C,2),U=S[0],B=S[1],G=function(){setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=g.current)||void 0===e||e.endTiming()}),2)};(0,l.useEffect)((function(){n?o.setFieldsValue({mobile:null==d?void 0:d.mobile}):(o.resetFields(),G())}),[n]);var _=function(){var e=I()(F()().mark((function e(n,t){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captchaUid",n," captchaValue",t),b(n),k(t);case 3:case"end":return e.stop()}}),e)})));return function(n,t){return e.apply(this,arguments)}}(),D=function(){var e=I()(F()().mark((function e(n){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("captcha check result",n),B(n);case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),H=function(){var e=I()(F()().mark((function e(){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o.validateFields().then(function(){var e=I()(F()().mark((function e(n){var r,s;return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("changeMobile:",n),r={mobile:n.mobile,code:n.code,platform:E.iw8},e.next=4,(0,T.KF)(r);case 4:s=e.sent,console.log("changeMobile response:",s),200===s.code?(z.yw.success("Mobile verify successfully!"),t(n.mobile),a()):z.yw.error(c(s.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}());case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return(0,W.jsx)(W.Fragment,{children:(0,W.jsx)(O.Z,{title:s.formatMessage({id:"pages.settings.verify.mobile",defaultMessage:"验证手机号"}),forceRender:!0,open:n,footer:null,onCancel:function(){a()},children:(0,W.jsxs)(x.A,{form:o,onFinish:function(){var e=I()(F()().mark((function e(n){return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("changeMobile:",n),H();case 2:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),children:[(0,W.jsx)(K.Z,{fieldProps:{size:"large",prefix:(0,W.jsx)(P.Z,{})},name:"mobile",placeholder:s.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,W.jsx)(r.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,W.jsx)(r.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}],readonly:!0}),(0,W.jsx)(x.A.Item,{name:"captchaCode",rules:[],children:(0,W.jsx)(A.Z,{onKaptchaChange:_,onKaptchaCheck:D})}),(0,W.jsx)(N.Z,{fieldProps:{size:"large",prefix:(0,W.jsx)(q.Z,{}),allowClear:!0},captchaProps:{size:"large",disabled:!U},placeholder:s.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,n){return e?"".concat(n," ").concat(s.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):s.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,W.jsx)(r.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:g,onGetCaptcha:function(){var e=I()(F()().mark((function e(n){var t,r;return F()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",n),!n||11!==n.length){e.next=14;break}return t={mobile:n,type:E.aak,captchaUid:y,captchaCode:w,deviceUid:f,userUid:null==d?void 0:d.uid,orgUid:null==p?void 0:p.uid,platform:E.iw8},e.next=5,(0,V.Y7)(t);case 5:if(r=e.sent,console.log("sendMobileCode",r),200===r.code){e.next=11;break}return z.yw.error(c(r.message)),G(),e.abrupt("return");case 11:z.yw.success(c(r.message)),e.next=15;break;case 14:z.yw.error("手机号格式错误");case 15:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()})]})})})},_=t(52544),D=a.Z.Text,H=function(){var e=(0,r.useIntl)(),n=(0,_.Z)().isDarkMode,t=(0,r.useNavigate)(),a=x.A.useForm(),i=h()(a,1)[0],o=(0,m.L)((function(e){return{userInfo:e.userInfo,setUserInfo:e.setUserInfo}})),c=o.userInfo,u=o.setUserInfo,d=(0,l.useState)(!1),f=h()(d,2),g=f[0],S=f[1],F=(0,l.useState)(!1),U=h()(F,2),I=U[0],z=U[1];(0,l.useEffect)((function(){i.setFieldsValue({uid:c.uid,username:c.username,nickname:c.nickname,email:c.email,mobile:c.mobile})}),[]);return(0,W.jsxs)("div",{style:{padding:"16px",backgroundColor:n?"#1f1f1f":void 0},children:[(0,W.jsx)(s.Z,{title:(0,W.jsxs)(D,{strong:!0,style:{fontSize:"16px"},children:[(0,W.jsx)(p,{style:{marginRight:"8px",color:"#52c41a"}}),e.formatMessage({id:"personal.certification.title",defaultMessage:"个人身份验证"})]}),size:"small",style:{marginBottom:"16px",backgroundColor:n?"#262626":void 0},children:(0,W.jsxs)(x.A,{form:i,submitter:!1,layout:"vertical",children:[(0,W.jsx)(s.Z,{type:"inner",size:"small",style:{marginBottom:"16px",backgroundColor:n?"#232323":"#fafafa"},children:(0,W.jsxs)(v.Z,{justify:"space-between",align:"middle",children:[(0,W.jsx)(j.Z,{flex:"auto",children:(0,W.jsxs)(y.Z,{direction:"vertical",size:"small",children:[(0,W.jsxs)(y.Z,{children:[(0,W.jsx)(M.Z,{style:{color:"#722ed1"}}),(0,W.jsx)(D,{strong:!0,children:"邮箱地址"}),null!=c&&c.emailVerified?(0,W.jsx)(b.Z,{icon:(0,W.jsx)(w.Z,{}),color:"success",children:"已验证"}):(0,W.jsx)(b.Z,{icon:(0,W.jsx)(k.Z,{}),color:"error",children:"未验证"})]}),(0,W.jsx)(D,{type:"secondary",style:{marginLeft:"20px"},children:(null==c?void 0:c.email)||"未设置"})]})}),(0,W.jsx)(j.Z,{children:(0,W.jsxs)(y.Z,{children:[!(null!=c&&c.emailVerified)&&null!=c.email&&(0,W.jsx)(Z.ZP,{type:"primary",onClick:function(){S(!0)},children:e.formatMessage({id:"pages.settings.verify.email",defaultMessage:"验证邮箱"})}),(0,W.jsx)(Z.ZP,{type:"link",onClick:function(){t("/setting/profile")},children:e.formatMessage({id:"pages.settings.reset.email",defaultMessage:"重置邮箱"})})]})})]})}),(0,W.jsx)(s.Z,{type:"inner",size:"small",style:{backgroundColor:n?"#232323":"#fafafa"},children:(0,W.jsxs)(v.Z,{justify:"space-between",align:"middle",children:[(0,W.jsx)(j.Z,{flex:"auto",children:(0,W.jsxs)(y.Z,{direction:"vertical",size:"small",children:[(0,W.jsxs)(y.Z,{children:[(0,W.jsx)(C.Z,{style:{color:"#13c2c2"}}),(0,W.jsx)(D,{strong:!0,children:"手机号码"}),null!=c&&c.mobileVerified?(0,W.jsx)(b.Z,{icon:(0,W.jsx)(w.Z,{}),color:"success",children:"已验证"}):(0,W.jsx)(b.Z,{icon:(0,W.jsx)(k.Z,{}),color:"error",children:"未验证"})]}),(0,W.jsx)(D,{type:"secondary",style:{marginLeft:"20px"},children:(null==c?void 0:c.mobile)||"未设置"})]})}),(0,W.jsx)(j.Z,{children:(0,W.jsxs)(y.Z,{children:[!(null!=c&&c.mobileVerified)&&null!=c.mobile&&(0,W.jsx)(Z.ZP,{type:"primary",onClick:function(){z(!0)},children:e.formatMessage({id:"pages.settings.verify.mobile",defaultMessage:"验证手机号"})}),(0,W.jsx)(Z.ZP,{type:"link",onClick:function(){t("/setting/profile")},children:e.formatMessage({id:"pages.settings.reset.mobile",defaultMessage:"重置手机号"})})]})})]})})]})}),g&&(0,W.jsx)(B,{open:g,onSubmit:function(e){S(!1),c.email=e,c.emailVerified=!0,u(c),i.setFieldValue("email",e)},onClose:function(){S(!1)}}),I&&(0,W.jsx)(G,{open:I,onSubmit:function(e){z(!1),c.mobile=e,c.mobileVerified=!0,u(c),i.setFieldValue("mobile",e)},onClose:function(){z(!1)}})]})},J=(a.Z.Text,function(e){console.log(e)}),X=a.Z.Title,$=[{key:"personal",label:(0,W.jsxs)("span",{children:[(0,W.jsx)(o.Z,{}),"个人认证"]}),children:(0,W.jsx)(H,{})}],Y=function(){var e=(0,r.useIntl)(),n=(0,_.Z)().isDarkMode;return(0,W.jsx)("div",{style:{padding:"24px",backgroundColor:n?"#1f1f1f":"#f0f2f5",minHeight:"100vh"},children:(0,W.jsxs)(s.Z,{variant:"borderless",style:{maxWidth:800,margin:"0 auto",borderRadius:"12px",boxShadow:n?"0 2px 8px rgba(255, 255, 255, 0.05)":"0 2px 8px rgba(0, 0, 0, 0.1)"},children:[(0,W.jsxs)(X,{level:2,style:{marginBottom:"24px",textAlign:"center"},children:[(0,W.jsx)(p,{style:{marginRight:"8px",color:"#1890ff"}}),e.formatMessage({id:"certification.title",defaultMessage:"身份认证"})]}),(0,W.jsx)(i.Z,{defaultActiveKey:"personal",items:$,onChange:J,size:"large"})]})})}}}]);