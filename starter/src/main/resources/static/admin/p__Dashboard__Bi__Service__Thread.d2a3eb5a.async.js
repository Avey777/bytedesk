"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1163],{50930:function(e,t,a){a.r(t);var i=a(90819),s=a.n(i),r=a(89933),n=a.n(r),o=a(45332),d=a.n(o),c=a(44194),l=a(41123),u=a(34251),g=a(8957),f=a(63065),h=a(43413),m=a(10337),x=a(77407),v=a(59946),p=a(3867),j=a(5858),M=a(9248),b=a(14318),y=a(68525),Z=a(35911),T=a(94011),k=a(34937),R=a(60107),Y=a(57039),D=a(12201),S=a(14546),w=a(21474),C=a(20621),W=a(7999),z=a(28977),F=a.n(z),I=a(31881),O=a(75699),U=a(25191),P=a(32597),q=a(31549),B=l.default.RangePicker,L=u.Z.Option;t.default=function(){var e=(0,O.useIntl)(),t=(0,c.useState)(!1),a=d()(t,2),i=a[0],r=a[1],o=(0,I.u)((function(e){return e.currentOrg})),l=(0,c.useState)([]),z=d()(l,2),E=z[0],H=z[1],N=(0,c.useState)({totalThreads:0,activeThreads:0,avgDuration:0,satisfaction:0,acceptRate:0,abandonRate:0,avgWaitingTime:0,avgFirstResponseTime:0}),Q=d()(N,2),G=Q[0],A=Q[1],J=(0,c.useState)(F()().startOf("day")),_=d()(J,2),K=_[0],V=_[1],X=(0,c.useState)(F()().endOf("day")),$=d()(X,2),ee=$[0],te=$[1],ae=(0,c.useState)("today"),ie=d()(ae,2),se=ie[0],re=ie[1],ne=(0,c.useState)([F()().startOf("day"),F()().endOf("day")]),oe=d()(ne,2),de=oe[0],ce=oe[1],le=(0,c.useState)({current:1,pageSize:20,total:0}),ue=d()(le,2),ge=ue[0],fe=ue[1],he=(0,c.useState)(U.whQ),me=d()(he,2),xe=me[0],ve=me[1],pe=(0,c.useState)(),je=d()(pe,2),Me=je[0],be=je[1],ye=(0,c.useState)(),Ze=d()(ye,2),Te=Ze[0],ke=Ze[1],Re=(0,c.useState)([]),Ye=d()(Re,2),De=Ye[0],Se=Ye[1],we=(0,c.useState)([]),Ce=d()(we,2),We=Ce[0],ze=Ce[1],Fe=[{label:(0,q.jsx)(O.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,q.jsx)(O.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,q.jsx)(O.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,q.jsx)(O.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,q.jsx)(O.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,q.jsx)(O.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,c.useEffect)((function(){null!=o&&o.uid&&((0,C.LE)({orgUid:o.uid,pageNumber:0,pageSize:100}).then((function(e){var t;200===e.code&&Se((null===(t=e.data)||void 0===t?void 0:t.content)||[])})),(0,W._t)({orgUid:o.uid,pageNumber:0,pageSize:100}).then((function(e){var t;200===e.code&&ze((null===(t=e.data)||void 0===t?void 0:t.content)||[])})))}),[o]);var Ie=function(){var e=n()(s()().mark((function e(){var t,a,i,n,d,c,l=arguments;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:1,a=l.length>1&&void 0!==l[1]?l[1]:20,r(!0),e.prev=3,i={pageNumber:t-1,pageSize:a,orgUid:null==o?void 0:o.uid,startDate:de[0].format("YYYY-MM-DD"),endDate:de[1].format("YYYY-MM-DD"),type:xe,workgroupUid:xe===U.v5D?Me:void 0,agentUid:xe===U.fyH?Te:void 0},e.next=7,(0,w.RU)(i);case 7:n=e.sent,console.log("queryStatisticServiceByDate response:",n.data,i),200===n.code&&n.data&&(d=n.data,fe({current:t,pageSize:a,total:1}),c=[{key:d.date||F()().format("YYYY-MM-DD"),date:d.date||F()().format("YYYY-MM-DD"),totalThreads:d.totalIncomingThreads||0,activeThreads:d.currentThreadCount||0,avgDuration:d.avgConversationTime?Math.round(d.avgConversationTime/60):0,satisfaction:d.satisfactionRate||0,acceptRate:d.acceptRate||0,abandonRate:d.abandonRate||0,avgWaitingTime:d.avgWaitingTime?Math.round(d.avgWaitingTime/60):0,avgFirstResponseTime:d.avgFirstResponseTime?Math.round(d.avgFirstResponseTime/60):0,transferRate:d.transferRate||0,avgMessagePerThread:d.avgMessagePerThread||0,queuingThreadCount:d.queuingThreadCount||0,maxWaitingTime:d.maxWaitingTime?Math.round(d.maxWaitingTime/60):0}],H(c)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(3),g.ZP.error("获取会话数据失败"),console.error("获取会话数据失败:",e.t0);case 16:return e.prev=16,r(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,12,16,19]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){if("custom"===se)V(K),te(ee);else{var e=F()();"today"===se?(V(e.startOf("day")),te(e.endOf("day"))):"yesterday"===se?(V(e.subtract(1,"day").startOf("day")),te(e.subtract(1,"day").endOf("day"))):"week"===se?(V(e.startOf("week")),te(e.endOf("week"))):"lastWeek"===se?(V(e.subtract(1,"week").startOf("week")),te(e.subtract(1,"week").endOf("week"))):"month"===se&&(V(e.startOf("month")),te(e.endOf("month")))}}),[se]),(0,c.useEffect)((function(){ce([K,ee])}),[K,ee]);var Oe=function(){var e=n()(s()().mark((function e(){var t,a,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={orgUid:null==o?void 0:o.uid,startDate:de[0].format("YYYY-MM-DD"),endDate:de[1].format("YYYY-MM-DD"),type:xe,workgroupUid:xe===U.v5D?Me:void 0,agentUid:xe===U.fyH?Te:void 0},e.next=4,(0,w.RU)(t);case 4:a=e.sent,console.log("queryStatisticServiceByDate response:",a.data,t),200===a.code&&a.data&&(i=a.data,A({totalThreads:i.totalIncomingThreads||0,activeThreads:i.currentThreadCount||0,avgDuration:i.avgConversationTime?Math.round(i.avgConversationTime/60):0,satisfaction:i.satisfactionRate||0,acceptRate:i.acceptRate||0,abandonRate:i.abandonRate||0,avgWaitingTime:i.avgWaitingTime?Math.round(i.avgWaitingTime/60):0,avgFirstResponseTime:i.avgFirstResponseTime?Math.round(i.avgFirstResponseTime/60):0})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("获取统计数据失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){Oe(),Ie()}),[de,xe,Me,Te]);var Ue=[{title:e.formatMessage({id:"bi.thread.table.date"}),dataIndex:"date",key:"date"},{title:e.formatMessage({id:"bi.thread.table.totalThreads"}),dataIndex:"totalThreads",key:"totalThreads"},{title:e.formatMessage({id:"bi.thread.table.activeThreads"}),dataIndex:"activeThreads",key:"activeThreads"},{title:e.formatMessage({id:"bi.thread.table.queuingThreads"}),dataIndex:"queuingThreadCount",key:"queuingThreadCount"},{title:e.formatMessage({id:"bi.thread.table.acceptRate"}),dataIndex:"acceptRate",key:"acceptRate",render:function(e){return"".concat(e,"%")}},{title:e.formatMessage({id:"bi.thread.table.abandonRate"}),dataIndex:"abandonRate",key:"abandonRate",render:function(e){return"".concat(e,"%")}},{title:e.formatMessage({id:"bi.thread.table.avgWaitingTime"}),dataIndex:"avgWaitingTime",key:"avgWaitingTime",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.minute"}))}},{title:e.formatMessage({id:"bi.thread.table.avgFirstResponseTime"}),dataIndex:"avgFirstResponseTime",key:"avgFirstResponseTime",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.minute"}))}},{title:e.formatMessage({id:"bi.thread.table.avgDuration"}),dataIndex:"avgDuration",key:"avgDuration",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.minute"}))}},{title:e.formatMessage({id:"bi.thread.table.transferRate"}),dataIndex:"transferRate",key:"transferRate",render:function(e){return"".concat(e,"%")}},{title:e.formatMessage({id:"bi.thread.table.avgMessagePerThread"}),dataIndex:"avgMessagePerThread",key:"avgMessagePerThread"},{title:e.formatMessage({id:"bi.thread.table.satisfaction"}),dataIndex:"satisfaction",key:"satisfaction",render:function(t){return t>0?"".concat(t,"%"):e.formatMessage({id:"bi.common.noRating"})}}];return(0,q.jsxs)("div",{style:{padding:"24px"},children:[(0,q.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,q.jsx)("h2",{children:e.formatMessage({id:"bi.thread.title"})}),(0,q.jsxs)("p",{children:[e.formatMessage({id:"bi.thread.description"}),"today"===se&&(0,q.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",K.format("YYYY-MM-DD"),")"]}),"yesterday"===se&&(0,q.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",K.format("YYYY-MM-DD"),")"]}),("week"===se||"lastWeek"===se||"month"===se||"custom"===se)&&(0,q.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",K.format("YYYY-MM-DD")," ~ ",ee.format("YYYY-MM-DD"),")"]})]})]}),(0,q.jsx)(f.Z,{style:{marginBottom:"24px"},children:(0,q.jsx)(h.Z,{direction:"vertical",style:{width:"100%"},children:(0,q.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,q.jsxs)(h.Z,{wrap:!0,children:[(0,q.jsx)(m.ZP.Group,{value:se,onChange:function(e){return re(e.target.value)},children:Fe.map((function(e){return(0,q.jsx)(m.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===se&&(0,q.jsx)(B,{value:[K,ee],onChange:function(e){V(e[0]),te(e[1])}})]}),(0,q.jsxs)(h.Z,{wrap:!0,children:[(0,q.jsxs)(u.Z,{value:xe,style:{width:120},onChange:function(e){ve(e),be(void 0),ke(void 0)},children:[(0,q.jsx)(L,{value:U.whQ,children:e.formatMessage({id:"bi.statistic.level.organization"})}),(0,q.jsx)(L,{value:U.v5D,children:e.formatMessage({id:"bi.statistic.level.workgroup"})}),(0,q.jsx)(L,{value:U.fyH,children:e.formatMessage({id:"bi.statistic.level.agent"})})]}),xe===U.v5D&&(0,q.jsx)(u.Z,{value:Me,style:{width:150},onChange:be,placeholder:e.formatMessage({id:"bi.statistic.level.workgroup"}),allowClear:!0,children:De.map((function(e){return(0,q.jsx)(L,{value:e.uid,children:e.nickname},e.uid)}))}),xe===U.fyH&&(0,q.jsx)(u.Z,{value:Te,style:{width:150},onChange:ke,placeholder:e.formatMessage({id:"bi.statistic.level.agent"}),allowClear:!0,children:We.map((function(e){return(0,q.jsx)(L,{value:e.uid,children:e.nickname},e.uid)}))}),(0,q.jsx)(x.ZP,{type:"primary",icon:(0,q.jsx)(Z.Z,{}),onClick:function(){return Ie()},loading:i,children:e.formatMessage({id:"bi.common.refresh"})}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"ticket.statistic.filter.export"}),children:(0,q.jsx)(x.ZP,{icon:(0,q.jsx)(T.Z,{}),onClick:function(){var e=localStorage.getItem(U.LA8);window.open((0,P.kG)()+"/api/v1/service/statistic/export?"+new URLSearchParams({type:xe,startDate:de[0].format("YYYY-MM-DD 00:00:00"),endDate:de[1].format("YYYY-MM-DD 23:59:59"),workgroupUid:xe===U.v5D?Me:"",agentUid:xe===U.fyH?Te:"",orgUid:(null==o?void 0:o.uid)||"",accessToken:e||""}).toString())},children:e.formatMessage({id:"ticket.statistic.filter.export"})})})]})]})})}),(0,q.jsxs)(p.Z,{spinning:i,children:[(0,q.jsxs)(j.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.totalThreads"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.totalThreads.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.totalThreads,prefix:(0,q.jsx)(R.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.activeThreads"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.activeThreads.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.activeThreads,prefix:(0,q.jsx)(Y.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.acceptRate"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.acceptRate.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.acceptRate,prefix:(0,q.jsx)(D.Z,{}),valueStyle:{color:"#52c41a"},suffix:"%"})})}),(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.avgWaitingTime"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.avgWaitingTime.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.avgWaitingTime,prefix:(0,q.jsx)(S.Z,{}),valueStyle:{color:"#fa8c16"},suffix:e.formatMessage({id:"bi.time.minute"})})})})]}),(0,q.jsxs)(j.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.avgDuration"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.avgDuration.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.avgDuration,prefix:(0,q.jsx)(S.Z,{}),valueStyle:{color:"#722ed1"},suffix:e.formatMessage({id:"bi.time.minute"})})})}),(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.avgFirstResponseTime"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.avgFirstResponseTime.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.avgFirstResponseTime,prefix:(0,q.jsx)(S.Z,{}),valueStyle:{color:"#13c2c2"},suffix:e.formatMessage({id:"bi.time.minute"})})})}),(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.abandonRate"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.abandonRate.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.abandonRate,prefix:(0,q.jsx)(Y.Z,{}),valueStyle:{color:"#ff4d4f"},suffix:"%"})})}),(0,q.jsx)(M.Z,{span:6,children:(0,q.jsx)(f.Z,{children:(0,q.jsx)(b.Z,{title:(0,q.jsxs)(h.Z,{children:[e.formatMessage({id:"bi.thread.card.satisfaction"}),(0,q.jsx)(v.Z,{title:e.formatMessage({id:"bi.thread.card.satisfaction.tooltip"}),children:(0,q.jsx)(k.Z,{style:{color:"#999",fontSize:"14px"}})})]}),value:G.satisfaction,prefix:(0,q.jsx)(D.Z,{}),valueStyle:{color:"#eb2f96"},suffix:"%"})})})]}),(0,q.jsx)(f.Z,{title:e.formatMessage({id:"bi.thread.detailData"}),children:(0,q.jsx)(y.Z,{columns:Ue,dataSource:E,pagination:{current:ge.current,pageSize:ge.pageSize,total:ge.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," of ").concat(e," items")}},onChange:function(e){Ie(e.current,e.pageSize)},size:"middle"})})]})]})}}}]);