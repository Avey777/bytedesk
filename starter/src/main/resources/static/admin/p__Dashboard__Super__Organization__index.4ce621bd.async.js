"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8283],{22014:function(e,r,t){t.d(r,{Z:function(){return l}});var a=t(77260),n=t(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},s=t(5901),i=function(e,r){return n.createElement(s.Z,(0,a.Z)({},e,{ref:r,icon:o}))};var l=n.forwardRef(i)},17115:function(e,r,t){t.d(r,{Z:function(){return Z}});var a=t(39328),n=t(17323),o=t(44194),s=t(17881),i=t(13079),l=t(31549),u=["proFieldProps","fieldProps"],d="date",c=o.forwardRef((function(e,r){var t=e.proFieldProps,c=e.fieldProps,f=(0,n.Z)(e,u),p=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:d,fieldProps:(0,a.Z)({getPopupContainer:p.getPopupContainer},c),proFieldProps:t,filedConfig:{valueType:d,customLightMode:!0}},f))})),f=["proFieldProps","fieldProps"],p="dateMonth",g=o.forwardRef((function(e,r){var t=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,f),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:p,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:t,filedConfig:{valueType:p,customLightMode:!0}},d))})),m=["fieldProps"],h="dateQuarter",v=o.forwardRef((function(e,r){var t=e.fieldProps,u=(0,n.Z)(e,m),d=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:h,fieldProps:(0,a.Z)({getPopupContainer:d.getPopupContainer},t),filedConfig:{valueType:h,customLightMode:!0}},u))})),y=["proFieldProps","fieldProps"],x="dateWeek",M=o.forwardRef((function(e,r){var t=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,y),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:x,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:t,filedConfig:{valueType:x,customLightMode:!0}},d))})),b=["proFieldProps","fieldProps"],w="dateYear",j=o.forwardRef((function(e,r){var t=e.proFieldProps,u=e.fieldProps,d=(0,n.Z)(e,b),c=(0,o.useContext)(s.Z);return(0,l.jsx)(i.Z,(0,a.Z)({ref:r,valueType:w,fieldProps:(0,a.Z)({getPopupContainer:c.getPopupContainer},u),proFieldProps:t,filedConfig:{valueType:w,customLightMode:!0}},d))})),C=c;C.Week=M,C.Month=g,C.Quarter=v,C.Year=j,C.displayName="ProFormComponent";var Z=C},31051:function(e,r,t){var a=t(39328),n=t(17323),o=t(90098),s=t(44194),i=t(17881),l=t(13079),u=t(31549),d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,r){var t=e.fieldProps,c=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,h=e.request,v=e.showSearch,y=e.options,x=(0,n.Z)(e,d),M=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(m),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:y,mode:g,showSearch:v,getPopupContainer:M.getPopupContainer},t),ref:r,proFieldProps:p},x),{},{children:c}))},p=s.forwardRef((function(e,r){var t=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,g=e.mode,m=e.valueEnum,h=e.request,v=e.options,y=(0,n.Z)(e,c),x=(0,a.Z)({options:v,mode:g||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},t),M=(0,s.useContext)(i.Z);return(0,u.jsx)(l.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(m),request:h,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:M.getPopupContainer},x),ref:r,proFieldProps:p},y),{},{children:d}))})),g=s.forwardRef(f);g.SearchSelect=p,g.displayName="ProFormComponent",r.Z=g},3e3:function(e,r,t){var a=t(39328),n=t(17323),o=t(44194),s=t(13079),i=t(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],u=o.forwardRef((function(e,r){var t=e.fieldProps,o=e.unCheckedChildren,u=e.checkedChildren,d=e.proFieldProps,c=(0,n.Z)(e,l);return(0,i.jsx)(s.Z,(0,a.Z)({valueType:"switch",fieldProps:(0,a.Z)({unCheckedChildren:o,checkedChildren:u},t),ref:r,valuePropName:"checked",proFieldProps:d,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));r.Z=u},56734:function(e,r,t){t.d(r,{A8:function(){return c},FR:function(){return b},Kq:function(){return p},RL:function(){return v},c5:function(){return m},jM:function(){return x}});var a=t(90819),n=t.n(a),o=t(73193),s=t.n(o),i=t(89933),l=t.n(i),u=t(25191),d=t(75699);function c(e){return f.apply(this,arguments)}function f(){return(f=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/query",{method:"GET",params:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/create",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/create/by/super",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/update",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return M.apply(this,arguments)}function M(){return(M=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/update/by/super",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=l()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/api/v1/org/delete",{method:"POST",data:s()(s()({},r),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},74625:function(e,r,t){t.d(r,{G:function(){return f}});var a=t(73193),n=t.n(a),o=(t(44194),t(21853)),s=t(25191),i=t(28977),l=t.n(i),u=t(31756),d=t(32597),c=t(31549),f=function(e){var r=e.children,t=e.onSuccess,a=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:s.IrL,categoryUid:"",kbUid:"",channel:s.XtJ},f={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){console.log("beforeUpload",e);var r=l()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=r,i.fileType=e.type,console.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&console.log("not uploading:",e.file),"done"===e.file.status)if(console.log("response: ",e.file.response),200===e.file.response.code){var r=e.file.response.data.fileUrl;t(r),u.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),u.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(u.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,c.jsx)(o.Z,n()(n()({},f),{},{children:r}))}},53128:function(e,r,t){var a=t(52544);r.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},81600:function(e,r,t){t.r(r),t.d(r,{default:function(){return te}});var a=t(53128),n=t(67700),o=t(44194),s=t(73193),i=t.n(s),l=t(84176),u=t.n(l),d=t(90819),c=t.n(d),f=t(89933),p=t.n(f),g=t(45332),m=t.n(g),h=t(31756),v=t(54338),y=t(6992),x=t(79148),M=t(38478),b=t(44532),w=t(77407),j=t(76711),C=t.n(j),Z=t(31881),P=t(6373),S=t(22766),k=t(12581),F=t(3e3),R=t(17115),D=t(31051),T=t(34651),I=t(24418),E=t(43413),Y=t(5858),z=t(9248),U=t(89176),A=t(94407),L=t(75699),q=t(74625),O=t(22014),B=t(25400),N=t(28977),H=t.n(N),J=t(31549),V=function(e){var r,t,a,n=e.isEdit,s=e.org,l=e.open,u=e.onClose,d=e.onSubmit,f=T.Z.useForm(),g=m()(f,1)[0],v=(0,L.useIntl)(),y=(0,Z.u)((function(e){return e.currentOrg})),x=(0,o.useState)(""),M=m()(x,2),b=M[0],j=M[1],N=(0,o.useState)([]),V=m()(N,2),X=V[0],W=V[1];(0,o.useEffect)((function(){if(n){var e;g.setFieldsValue({name:null==s?void 0:s.name,logo:null==s?void 0:s.logo,code:null==s?void 0:s.code,description:null==s?void 0:s.description,verifiedType:null==s?void 0:s.verifiedType,identityType:null==s?void 0:s.identityType,identityImage:null==s?void 0:s.identityImage,identityNumber:null==s?void 0:s.identityNumber,verifyDate:null==s?void 0:s.verifyDate,verifyStatus:null==s?void 0:s.verifyStatus,rejectReason:null==s?void 0:s.rejectReason,vip:null==s?void 0:s.vip,vipExpireDate:null==s?void 0:s.vipExpireDate,userUid:null==s||null===(e=s.user)||void 0===e?void 0:e.uid,enabled:!1!==(null==s?void 0:s.enabled)})}else{g.resetFields();new Date;var r=H()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");g.setFieldsValue({verifyStatus:"未认证",vip:!0,vipExpireDate:r,enabled:!0})}}),[l]),(0,o.useEffect)((function(){null!=s&&s.logo?j(s.logo):j("")}),[null==s?void 0:s.logo]),(0,o.useEffect)((function(){var e=function(){var e=p()(c()().mark((function e(){var r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!l||null==y||!y.uid){e.next=4;break}return e.next=3,Q();case 3:n&&null!=s&&s.user&&(r={label:"".concat(s.user.nickname||s.user.username," (").concat(s.user.mobile||s.user.email,") - 当前管理员"),value:s.user.uid},W((function(e){return e.some((function(e){return e.value===r.value}))?e:[r].concat(C()(e))})));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();e()}),[l,null==y?void 0:y.uid,n,null==s?void 0:s.user]);var G,K,Q=function(){var e=p()(c()().mark((function e(r){var t,a,n,o,s;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,a={pageNumber:0,pageSize:20,searchText:r||"",orgUid:null==y?void 0:y.uid},console.log("Loading users with params:",a),e.next=5,(0,B.pz)(a);case 5:if(n=e.sent,console.log("loadUsers response:",n),200!==n.code||null===(t=n.data)||void 0===t||!t.content){e.next=15;break}return o=n.data.content.filter((function(e){var r=e.currentOrganization&&e.currentOrganization.uid;return r&&console.log("User ".concat(e.nickname||e.username," already has organization:"),e.currentOrganization.name),!r})),s=o.map((function(e){return{label:"".concat(e.nickname||e.username," (").concat(e.mobile||e.email,")"),value:e.uid}})),console.log("Total users:",n.data.content.length),console.log("Available users (no organization):",o.length),console.log("Generated user options:",s),W(s),e.abrupt("return",s);case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),console.error("Load users error:",e.t0);case 20:return e.abrupt("return",[]);case 21:case"end":return e.stop()}}),e,null,[[0,17]])})));return function(r){return e.apply(this,arguments)}}();return(0,J.jsx)(I.Z,{title:n?(0,J.jsx)(L.FormattedMessage,{id:"pages.org.edit",defaultMessage:"编辑组织"}):(0,J.jsx)(L.FormattedMessage,{id:"pages.org.create",defaultMessage:"创建组织"}),onClose:u,open:l,width:600,extra:(0,J.jsxs)(E.Z,{children:[(0,J.jsx)(w.ZP,{onClick:u,children:(0,J.jsx)(L.FormattedMessage,{id:"pages.common.cancel"})}),(0,J.jsx)(w.ZP,{onClick:function(){g.validateFields().then((function(e){d(i()(i()(i()({},s),e),{},{logo:b,orgUid:null==y?void 0:y.uid}))})).catch((function(e){console.log("Form errors:",e),h.yw.error(v.formatMessage({id:"pages.form.error"}))}))},type:"primary",children:(0,J.jsx)(L.FormattedMessage,{id:"pages.common.save"})})]}),children:(0,J.jsxs)(P.A,{form:g,submitter:!1,children:[(0,J.jsx)(S.Z,{name:"name",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.name",defaultMessage:"组织名称"}),rules:[{required:!0,message:v.formatMessage({id:"pages.org.name.required",defaultMessage:"请输入组织名称"})}]}),(0,J.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,J.jsx)("div",{style:{marginBottom:"8px"},children:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.logo",defaultMessage:"Logo"})}),(0,J.jsxs)(Y.Z,{gutter:[16,16],align:"middle",children:[(0,J.jsx)(z.Z,{children:(0,J.jsx)(U.Z,{src:b,size:64,style:{border:"2px solid #d9d9d9",backgroundColor:"#f5f5f5"}})}),(0,J.jsx)(z.Z,{children:(0,J.jsx)(q.G,{onSuccess:function(e){console.log("handleLogoUploadSuccess:",e),j(e),g.setFieldValue("logo",e)},onError:function(e){console.log("handleLogoUploadError:",e)},children:(0,J.jsx)(w.ZP,{type:"primary",icon:(0,J.jsx)(O.Z,{}),size:"small",children:v.formatMessage({id:"pages.org.logo.upload",defaultMessage:"上传Logo"})})})})]})]}),(0,J.jsx)(S.Z,{name:"code",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.code",defaultMessage:"组织代码"}),rules:[{required:!0,message:v.formatMessage({id:"pages.org.code.required",defaultMessage:"请输入组织代码"})}]}),(0,J.jsx)(k.Z,{name:"description",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.description",defaultMessage:"描述"}),placeholder:v.formatMessage({id:"pages.org.description.placeholder",defaultMessage:"请输入组织描述"})}),(0,J.jsx)(F.Z,{name:"vip",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vip",defaultMessage:"会员状态"}),checkedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vip.yes",defaultMessage:"是"}),unCheckedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vip.no",defaultMessage:"否"})}),(0,J.jsx)(R.Z,{name:"vipExpireDate",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.vipExpireDate",defaultMessage:"会员过期时间"}),placeholder:v.formatMessage({id:"pages.org.vipExpireDate.placeholder",defaultMessage:"请选择会员过期时间"}),fieldProps:{showTime:!1,format:"YYYY-MM-DD",showToday:!0},transform:function(e){if(e){var r=new Date(e);return r.setHours(0,0,0,0),r.toISOString()}return e}}),(0,J.jsx)(D.Z,{name:"userUid",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.admin",defaultMessage:"管理员"}),placeholder:v.formatMessage({id:"pages.org.admin.placeholder",defaultMessage:"请选择组织管理员"}),showSearch:!0,allowClear:!0,disabled:!0===(null==s||null===(r=s.user)||void 0===r?void 0:r.superUser),fieldProps:{showSearch:!0,filterOption:!1,onSearch:(K=p()(c()().mark((function e(r){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Searching for:",r),e.next=3,Q(r);case 3:case"end":return e.stop()}}),e)}))),function(e){return K.apply(this,arguments)}),onFocus:(G=p()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("Focus on user select"),e.next=3,Q();case 3:case"end":return e.stop()}}),e)}))),function(){return G.apply(this,arguments)}),options:X}}),(0,J.jsx)("div",{style:{fontSize:"12px",color:"#999",marginTop:"-8px",marginBottom:"16px"},children:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.admin.tip",defaultMessage:"只显示未分配组织的用户，避免覆盖现有组织关系"})}),(0,J.jsx)(F.Z,{name:"enabled",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.enabled",defaultMessage:"状态"}),checkedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.status.enabled",defaultMessage:"启用"}),unCheckedChildren:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.status.disabled",defaultMessage:"禁用"}),disabled:!0===(null==s||null===(t=s.user)||void 0===t?void 0:t.superUser),transform:function(e){return!1!==e},fieldProps:{checked:!1!==(null==s?void 0:s.enabled),title:!0===(null==s||null===(a=s.user)||void 0===a?void 0:a.superUser)?v.formatMessage({id:"pages.org.superUser.disabled",defaultMessage:"超级用户组织不允许禁用"}):void 0}}),(0,J.jsx)(A.Z,{defaultActiveKey:[],items:[{key:"1",label:"认证信息",children:(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(D.Z,{name:"verifiedType",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.verifiedType",defaultMessage:"认证类型"}),options:[{label:"企业认证",value:"企业认证"},{label:"个人认证",value:"个人认证"},{label:"政府事业单位认证",value:"政府事业单位认证"}],placeholder:v.formatMessage({id:"pages.org.verifiedType.placeholder",defaultMessage:"请选择认证类型"})}),(0,J.jsx)(D.Z,{name:"identityType",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.identityType",defaultMessage:"证件类型"}),options:[{label:"营业执照",value:"营业执照"},{label:"身份证",value:"身份证"},{label:"护照",value:"护照"},{label:"其他",value:"其他"}],placeholder:v.formatMessage({id:"pages.org.identityType.placeholder",defaultMessage:"请选择证件类型"})}),(0,J.jsx)(S.Z,{name:"identityImage",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.identityImage",defaultMessage:"证件图片"}),placeholder:v.formatMessage({id:"pages.org.identityImage.placeholder",defaultMessage:"请输入证件图片URL"})}),(0,J.jsx)(S.Z,{name:"identityNumber",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.identityNumber",defaultMessage:"证件号码"}),placeholder:v.formatMessage({id:"pages.org.identityNumber.placeholder",defaultMessage:"请输入证件号码"})}),(0,J.jsx)(S.Z,{name:"verifyDate",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.verifyDate",defaultMessage:"认证时间"}),placeholder:v.formatMessage({id:"pages.org.verifyDate.placeholder",defaultMessage:"请输入认证时间"})}),(0,J.jsx)(D.Z,{name:"verifyStatus",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.verifyStatus",defaultMessage:"认证状态"}),options:[{label:"未认证",value:"未认证"},{label:"已认证",value:"已认证"},{label:"审核中",value:"审核中"},{label:"审核失败",value:"审核失败"}],placeholder:v.formatMessage({id:"pages.org.verifyStatus.placeholder",defaultMessage:"请选择认证状态"})}),(0,J.jsx)(k.Z,{name:"rejectReason",label:(0,J.jsx)(L.FormattedMessage,{id:"pages.org.rejectReason",defaultMessage:"拒绝原因"}),placeholder:v.formatMessage({id:"pages.org.rejectReason.placeholder",defaultMessage:"如果审核失败，请填写拒绝原因"})})]})}]})]})})},X=t(65105),W=t(52795),G=t(30234),K=t(25191),Q=t(56734),_=t(47454),$=["current","pageSize"],ee=function(){var e=(0,L.useIntl)(),r=(0,o.useRef)(),t=(0,G.Z)().translateString,a=(0,o.useState)(!0),n=m()(a,2),s=n[0],l=n[1],d=(0,o.useState)(),f=m()(d,2),g=f[0],j=f[1],C=(0,o.useState)(!1),P=m()(C,2),S=P[0],k=P[1],F=(0,o.useState)(1),R=m()(F,2),D=(R[0],R[1]),T=(0,o.useState)(10),I=m()(T,2),E=I[0],Y=I[1],z=(0,Z.u)((function(e){return e.currentOrg})),U=(0,W.Z)((function(e){return{roleResult:e.roleResult,roleResultPlatform:e.roleResultPlatform,setRoleResult:e.setRoleResult,setRoleResultPlatform:e.setRoleResultPlatform}})),A=U.setRoleResult,q=U.setRoleResultPlatform,O=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:e.formatMessage({id:"pages.org.name"}),dataIndex:"name",copyable:!0,fixed:"left"},{title:e.formatMessage({id:"pages.org.logo"}),dataIndex:"logo",copyable:!0,hideInSearch:!0,render:function(e,r){return r.logo?(0,J.jsx)("img",{src:r.logo,alt:"logo",style:{width:40,height:40}}):null}},{title:e.formatMessage({id:"pages.org.code"}),dataIndex:"code",copyable:!0},{title:e.formatMessage({id:"pages.org.description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0},{title:e.formatMessage({id:"pages.org.verifiedType"}),dataIndex:"verifiedType",hideInSearch:!0,render:function(e,r){return(0,_._i)(r.verifiedType)}},{title:e.formatMessage({id:"pages.org.verifyStatus"}),dataIndex:"verifyStatus",hideInSearch:!0,render:function(e,r){return(0,_.Cy)(r.verifyStatus)}},{title:e.formatMessage({id:"pages.org.verifyDate"}),dataIndex:"verifyDate",hideInSearch:!0,width:180,render:function(e,r){return r.verifyDate?H()(r.verifyDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.vip"}),dataIndex:"vip",hideInSearch:!0,render:function(r,t){return t.vip?e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}):e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.vip.yes",defaultMessage:"是"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.vip.no",defaultMessage:"否"}),status:"Default"}}},{title:e.formatMessage({id:"pages.org.vipExpireDate"}),dataIndex:"vipExpireDate",hideInSearch:!0,width:180,render:function(e,r){return r.vipExpireDate?H()(r.vipExpireDate).format("YYYY-MM-DD"):""}},{title:e.formatMessage({id:"pages.org.enabled"}),dataIndex:"enabled",hideInSearch:!0,render:function(r,t){return!1===t.enabled?e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}):e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"})},valueEnum:{true:{text:e.formatMessage({id:"pages.org.status.enabled",defaultMessage:"启用"}),status:"Success"},false:{text:e.formatMessage({id:"pages.org.status.disabled",defaultMessage:"禁用"}),status:"Error"}}},{title:e.formatMessage({id:"pages.org.admin",defaultMessage:"管理员"}),dataIndex:"user",hideInSearch:!0,render:function(e,r){return r.user?(0,J.jsxs)("div",{children:[(0,J.jsx)("div",{children:r.user.nickname||r.user.username}),(0,J.jsx)("div",{style:{fontSize:"12px",color:"#999"},children:r.user.email})]}):"-"}},{title:e.formatMessage({id:"pages.org.createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.createdAt?H()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):""}},{title:e.formatMessage({id:"pages.org.updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,render:function(e,r){return r.updatedAt?H()(r.updatedAt).format("YYYY-MM-DD HH:mm:ss"):""}}],B=[].concat(O,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:120,fixed:"right",render:function(r,t,a,n){var s,i=!0===(null===(s=t.user)||void 0===s?void 0:s.superUser);return[(0,J.jsx)("a",{onClick:function(){re(t)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),!i&&(0,J.jsxs)(o.Fragment,{children:[(0,J.jsx)(M.Z,{type:"vertical"},"divider"),(0,J.jsx)(b.Z,{title:e.formatMessage({id:"pages.common.deleteConfirm",defaultMessage:"Are you sure to delete {name}?"},{name:t.name||t.code}),onConfirm:function(){return te(t)},okText:e.formatMessage({id:"pages.common.ok",defaultMessage:"OK"}),cancelText:e.formatMessage({id:"pages.common.cancel",defaultMessage:"Cancel"}),children:(0,J.jsx)("a",{children:e.formatMessage({id:"pages.common.delete",defaultMessage:"Delete"})},"delete")},"delete")]},"delete-fragment")].filter(Boolean)}}]),N=(0,X.v)((function(e){return e.currentCategory})),ee=function(){j(void 0),l(!1),k(!0)},re=function(e){j(e),l(!0),k(!0)},te=function(){var a=p()(c()().mark((function a(n){var o,s,i;return c()().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!0!==(null===(o=n.user)||void 0===o?void 0:o.superUser)){a.next=3;break}return h.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDelete",defaultMessage:"超级用户组织不允许删除"})),a.abrupt("return");case 3:return h.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),a.prev=4,a.next=7,(0,Q.FR)({uid:n.uid});case 7:s=a.sent,h.yw.destroy(),200===s.code?(h.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete successful"})),null===(i=r.current)||void 0===i||i.reloadAndRest()):h.yw.error(t(s.message)||e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),a.next=17;break;case 12:a.prev=12,a.t0=a.catch(4),h.yw.destroy(),h.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete failed"})),console.error("Delete org error:",a.t0);case 17:case"end":return a.stop()}}),a,null,[[4,12]])})));return function(e){return a.apply(this,arguments)}}(),ae=function(){var t=p()(c()().mark((function t(a){var n,o,i;return c()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",a),!s||!0!==(null==g||null===(n=g.user)||void 0===n?void 0:n.superUser)||!1!==a.enabled){t.next=4;break}return h.yw.error(e.formatMessage({id:"pages.org.superUser.cannotDisable",defaultMessage:"超级用户组织不允许禁用"})),t.abrupt("return");case 4:if(s?h.yw.loading(e.formatMessage({id:"updating"})):h.yw.loading(e.formatMessage({id:"creating"})),!s){t.next=11;break}return t.next=8,(0,Q.jM)(a);case 8:t.t0=t.sent,t.next=14;break;case 11:return t.next=13,(0,Q.c5)(a);case 13:t.t0=t.sent;case 14:o=t.t0,console.log("createOrg response:",a,o),200===o.code?(h.yw.destroy(),h.yw.success(s?e.formatMessage({id:"update.success",defaultMessage:"Update successful"}):e.formatMessage({id:"create.success",defaultMessage:"Create successful"})),k(!1),null===(i=r.current)||void 0===i||i.reloadAndRest()):(h.yw.destroy(),h.yw.error(o.message));case 17:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ne=function(){var r=p()(c()().mark((function r(){var t,a;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,orgUid:null==z?void 0:z.uid},r.next=4,(0,v.E9)(t);case 4:a=r.sent,console.log("queryRolesByOrg response ",a),200===a.code?(h.yw.destroy(),A(a)):(h.yw.destroy(),h.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}(),oe=function(){var r=p()(c()().mark((function r(){var t,a;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return h.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading..."})),t={pageNumber:0,pageSize:100,level:K.Hxq},r.next=4,(0,v.E9)(t);case 4:a=r.sent,console.log("queryRolesBySuper response ",a),200===a.code?(h.yw.destroy(),q(a)):(h.yw.destroy(),h.yw.error(a.message));case 7:case"end":return r.stop()}}),r)})));return function(){return r.apply(this,arguments)}}();return(0,o.useEffect)((function(){ne(),oe()}),[]),(0,o.useEffect)((function(){var e;console.log("currentCategory:",N),null===(e=r.current)||void 0===e||e.reloadAndRest()}),[N]),(0,J.jsxs)(J.Fragment,{children:[(0,J.jsx)(x.Z,{columns:B,actionRef:r,cardBordered:!0,scroll:{x:"max-content"},request:function(){var r=p()(c()().mark((function r(a,n,o){var s,l,d,f,p;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("request:",a,n,o),h.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,d=u()(a,$),D(s),Y(l),f=i()({pageNumber:s-1,pageSize:l},d),r.next=8,(0,Q.A8)(f);case 8:return p=r.sent,console.log("getAllOrgs response:",f,p),h.yw.destroy(),200===p.code||h.yw.error(t(p.message)),r.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 13:case"end":return r.stop()}}),r)})));return function(e,t,a){return r.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:E,showQuickJumper:!0,showSizeChanger:!0,onChange:function(e,r){console.log("pagination onChange:",e,r),D(e),Y(r)}},dateFormatter:"string",headerTitle:e.formatMessage({id:"pages.org.list",defaultMessage:"组织列表"}),toolBarRender:function(){return[(0,J.jsx)(w.ZP,{icon:(0,J.jsx)(y.Z,{}),type:"primary",onClick:ee,children:e.formatMessage({id:"pages.common.create",defaultMessage:"Create"})},"button")]}}),S&&(0,J.jsx)(V,{isEdit:s,open:S,org:g,onClose:function(){k(!1)},onSubmit:ae})]})},re=n.Z.Content,te=function(){var e=(0,a.Z)().contentStyle;return(0,J.jsx)(n.Z,{children:(0,J.jsx)(n.Z,{children:(0,J.jsx)(re,{style:e,children:(0,J.jsx)(ee,{})})})})}},65105:function(e,r,t){t.d(r,{v:function(){return c}});var a=t(76711),n=t.n(a),o=t(73193),s=t.n(o),i=t(25191),l=t(16894),u=t(45034),d=t(47401);var c=(0,l.Ue)()((0,u.mW)((0,u.tJ)((0,d.n)((function(e,r){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(r){var t=function(e){var r=[];return e.data.content.forEach((function(e){var t={label:e.name,value:e.uid};r.push(t)})),r}(r),a={uid:i.zBg,name:i.zBg},o=s()(s()({},r),{},{data:s()(s()({},r.data),{},{content:[a].concat(n()(r.data.content))})}),l=function(e){var r=[];return e.data.content.forEach((function(e){var t={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(t.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),r.push(t)})),r}(o);e({categoryResult:o,categoryTreeOptions:l,categorySelectOptions:t}),0===r.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(r){e((function(e){e.categoryResult.data.content.unshift(r)}))},upgradeCategory:function(r){e((function(e){var t=e.categoryResult.data.content,a=t.findIndex((function(e){return e.uid===r.uid}));-1!==a?t[a]=r:console.warn("Category with uid ".concat(r.uid," not found."))}))},setCurrentCategory:function(r){e({currentCategory:r})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(t){var a=r().categoryResult.data.content.find((function(e){return e.uid===t}));e({currentCategory:a})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))}}]);