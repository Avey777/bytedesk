(function(L,N){typeof exports=="object"&&typeof module<"u"?module.exports=N():typeof define=="function"&&define.amd?define(N):(L=typeof globalThis<"u"?globalThis:L||self,L.BytedeskWeb=N())})(this,function(){"use strict";var li=Object.defineProperty;var ci=(L,N,F)=>N in L?li(L,N,{enumerable:!0,configurable:!0,writable:!0,value:F}):L[N]=F;var P=(L,N,F)=>ci(L,typeof N!="symbol"?N+"":N,F);const L="ANONYMOUS",N="EVENT_BUS_SERVER_ERROR_500",F="EVENT_BUS_HTTP_ERROR",wt="ACCESS_TOKEN",ie="WEB_FLOAT",yt="CLOSE_CHAT_WINDOW",xt="MAXIMIZE_WINDOW",Et="MINIMIZE_WINDOW",St="RECEIVE_MESSAGE",Ct="INVITE_VISITOR",Tt="INVITE_VISITOR_ACCEPT",Rt="INVITE_VISITOR_REJECT",Ot="LOCALSTORAGE_RESPONSE",V="BYTEDESK_UID",H="BYTEDESK_VISITOR_UID",Y="BYTEDESK_BROWSE_FAILED_TIMESTAMP";class _t{constructor(e){P(this,"config");P(this,"bubble",null);P(this,"window",null);P(this,"inviteDialog",null);P(this,"contextMenu",null);P(this,"hideTimeout",null);P(this,"isVisible",!1);P(this,"isDragging",!1);P(this,"windowState","normal");P(this,"loopCount",0);P(this,"loopTimer",null);P(this,"initVisitorPromise",null);P(this,"getUnreadMessageCountPromise",null);P(this,"clearUnreadMessagesPromise",null);this.config={...this.getDefaultConfig(),...e},this.setupApiUrl()}async setupApiUrl(){try{const{setApiUrl:e}=await Promise.resolve().then(()=>ti),n=this.config.apiUrl||"https://api.weiyuai.cn";e(n),this.config.isDebug&&console.log("API URL 已设置为:",n)}catch(e){console.error("设置API URL时出错:",e)}}getDefaultConfig(){return{isDebug:!1,forceRefresh:!1,htmlUrl:"https://cdn.weiyuai.cn/chat",apiUrl:"https://api.weiyuai.cn",placement:"bottom-right",marginBottom:20,marginSide:20,autoPopup:!1,inviteConfig:{show:!1,text:"邀请您加入对话",acceptText:"开始对话",rejectText:"稍后再说"},tabsConfig:{home:!1,messages:!0,help:!1,news:!1},bubbleConfig:{show:!0,icon:"👋",title:"需要帮助吗？",subtitle:"点击开始对话"},buttonConfig:{show:!0,width:60,height:60,onClick:()=>{this.showChat()}},chatConfig:{org:"df_org_uid",t:"2",sid:"df_rt_uid"},animation:{enabled:!0,duration:300,type:"ease"},theme:{mode:"system",textColor:"#ffffff",backgroundColor:"#0066FF"},window:{width:380,height:640},draggable:!1,locale:"zh-cn"}}async init(){var e;await this._initVisitor(),await this._browseVisitor(),this.createBubble(),this.createInviteDialog(),this.setupMessageListener(),this.setupResizeListener(),this._getUnreadMessageCount(),this.config.autoPopup&&setTimeout(()=>{this.showChat()},this.config.autoPopupDelay||1e3),(e=this.config.inviteConfig)!=null&&e.show&&setTimeout(()=>{this.showInviteDialog()},this.config.inviteConfig.delay||3e3)}async _initVisitor(){var s,r,a,d;if(this.initVisitorPromise)return console.log("访客初始化请求正在进行中，返回现有Promise"),this.initVisitorPromise;const e=localStorage.getItem(V),n=localStorage.getItem(H);console.log("localUid: ",e),console.log("localVisitorUid: ",n);const o=((s=this.config.chatConfig)==null?void 0:s.visitorUid)&&n?((r=this.config.chatConfig)==null?void 0:r.visitorUid)===n:!0;return e&&n&&o?(console.log("访客信息相同，直接返回本地访客信息"),(d=(a=this.config).onVisitorInfo)==null||d.call(a,e||"",n||""),{uid:e,visitorUid:n}):(console.log("开始创建访客初始化Promise"),this.initVisitorPromise=Promise.resolve().then(()=>mt).then(async({initVisitor:u})=>{var c,f,b,w,h,m,p,x,E,S,O,C,_,A,y,D,j,B,I;try{const q={uid:String(((c=this.config.chatConfig)==null?void 0:c.uid)||e||""),visitorUid:String(((f=this.config.chatConfig)==null?void 0:f.visitorUid)||n||""),orgUid:String(((b=this.config.chatConfig)==null?void 0:b.org)||""),nickname:String(((w=this.config.chatConfig)==null?void 0:w.name)||""),avatar:String(((h=this.config.chatConfig)==null?void 0:h.avatar)||""),mobile:String(((m=this.config.chatConfig)==null?void 0:m.mobile)||""),email:String(((p=this.config.chatConfig)==null?void 0:p.email)||""),note:String(((x=this.config.chatConfig)==null?void 0:x.note)||""),extra:typeof((E=this.config.chatConfig)==null?void 0:E.extra)=="string"?this.config.chatConfig.extra:JSON.stringify(((S=this.config.chatConfig)==null?void 0:S.extra)||{})},R=await u(q);return console.log("访客初始化API响应:",R.data,q),((O=R.data)==null?void 0:O.code)===200?((_=(C=R.data)==null?void 0:C.data)!=null&&_.uid&&(localStorage.setItem(V,R.data.data.uid),console.log("已保存uid到localStorage:",R.data.data.uid)),(y=(A=R.data)==null?void 0:A.data)!=null&&y.visitorUid&&(localStorage.setItem(H,R.data.data.visitorUid),console.log("已保存visitorUid到localStorage:",R.data.data.visitorUid)),(D=R.data)!=null&&D.data&&(console.log("触发onVisitorInfo回调"),(B=(j=this.config).onVisitorInfo)==null||B.call(j,R.data.data.uid||"",R.data.data.visitorUid||"")),R.data.data):(console.error("访客初始化失败:",(I=R.data)==null?void 0:I.message),null)}catch(q){return console.error("访客初始化出错:",q),null}finally{console.log("访客初始化Promise完成，清除引用"),this.initVisitorPromise=null}}),this.initVisitorPromise)}async _browseVisitor(){var e,n,i,o;try{const s=localStorage.getItem(Y);if(s){const _=parseInt(s),A=Date.now(),y=60*60*1e3;if(A-_<y){const D=Math.ceil((y-(A-_))/1e3/60);console.log(`浏览记录发送失败后1小时内禁止发送，还需等待 ${D} 分钟`);return}else localStorage.removeItem(Y)}const r=window.location.href,a=document.title,d=document.referrer,u=navigator.userAgent,c=this.getBrowserInfo(u),f=this.getOSInfo(u),b=this.getDeviceInfo(u),w=`${screen.width}x${screen.height}`,h=new URLSearchParams(window.location.search),m=h.get("utm_source")||void 0,p=h.get("utm_medium")||void 0,x=h.get("utm_campaign")||void 0,E=localStorage.getItem(V),S={url:r,title:a,referrer:d,userAgent:u,operatingSystem:f,browser:c,deviceType:b,screenResolution:w,utmSource:m,utmMedium:p,utmCampaign:x,status:"ONLINE",visitorUid:String(((e=this.config.chatConfig)==null?void 0:e.uid)||E||""),orgUid:((n=this.config.chatConfig)==null?void 0:n.org)||""};if(!S.visitorUid){console.log("访客uid为空，跳过browse操作");return}const{browse:O}=await Promise.resolve().then(()=>mt),C=await O(S);((i=C.data)==null?void 0:i.code)===200?localStorage.removeItem(Y):(console.error("浏览记录发送失败:",(o=C.data)==null?void 0:o.message),localStorage.setItem(Y,Date.now().toString()),console.log("已记录浏览记录发送失败时间，1小时内将禁止再次发送"))}catch(s){console.error("发送浏览记录时出错:",s),localStorage.setItem(Y,Date.now().toString()),console.log("已记录浏览记录发送失败时间，1小时内将禁止再次发送")}}getBrowserInfo(e){return e.includes("Chrome")?"Chrome":e.includes("Firefox")?"Firefox":e.includes("Safari")?"Safari":e.includes("Edge")?"Edge":e.includes("Opera")?"Opera":"Unknown"}getOSInfo(e){return e.includes("Windows")?"Windows":e.includes("Mac")?"macOS":e.includes("Linux")?"Linux":e.includes("Android")?"Android":e.includes("iOS")?"iOS":"Unknown"}getDeviceInfo(e){return e.includes("Mobile")?"Mobile":e.includes("Tablet")?"Tablet":"Desktop"}async _getUnreadMessageCount(){return this.getUnreadMessageCountPromise?(this.config.isDebug&&console.log("获取未读消息数请求正在进行中，返回现有Promise"),this.getUnreadMessageCountPromise):(this.getUnreadMessageCountPromise=Promise.resolve().then(()=>gt).then(async({getUnreadMessageCount:e})=>{var n,i,o,s,r;try{const a=String(((n=this.config.chatConfig)==null?void 0:n.visitorUid)||""),d=localStorage.getItem(V),u=localStorage.getItem(H),c={uid:d||"",visitorUid:a||u||"",orgUid:((i=this.config.chatConfig)==null?void 0:i.org)||""};if(c.uid==="")return 0;const f=await e(c);return((o=f.data)==null?void 0:o.code)===200?((s=f==null?void 0:f.data)!=null&&s.data&&((r=f==null?void 0:f.data)==null?void 0:r.data)>0?this.showUnreadBadge(f.data.data):this.clearUnreadBadge(),f.data.data||0):0}catch(a){return console.error("获取未读消息数出错:",a),0}finally{this.getUnreadMessageCountPromise=null}}),this.getUnreadMessageCountPromise)}async getUnreadMessageCount(){return this._getUnreadMessageCount()}async initVisitor(){return this._initVisitor()}async browseVisitor(){return this._browseVisitor()}clearBrowseFailedLimit(){localStorage.removeItem(Y),this.config.isDebug&&console.log("已清除浏览记录发送失败的限制")}clearVisitorInfo(){localStorage.removeItem(V),localStorage.removeItem(H),this.config.isDebug&&console.log("已清除本地访客信息")}async forceInitVisitor(){return this.clearVisitorInfo(),this.initVisitorPromise=null,this._initVisitor()}showUnreadBadge(e){if(console.log("showUnreadBadge() 被调用，count:",e),!this.bubble){console.log("showUnreadBadge: bubble 不存在");return}let n=this.bubble.querySelector(".bytedesk-unread-badge");n?console.log("showUnreadBadge: 更新现有角标"):(console.log("showUnreadBadge: 创建新的角标"),n=document.createElement("div"),n.className="bytedesk-unread-badge",n.style.cssText=`
        position: absolute;
        top: -8px;
        right: -8px;
        min-width: 18px;
        height: 18px;
        padding: 0 4px;
        background: #ff4d4f;
        color: white;
        font-size: 12px;
        font-weight: bold;
        border-radius: 10px;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        border: 2px solid white;
      `,this.bubble.appendChild(n)),n.textContent=e>99?"99+":e.toString(),console.log("showUnreadBadge: 角标数字已更新为",n.textContent)}clearUnreadBadge(){if(!this.bubble){console.log("clearUnreadBadge: bubble 不存在");return}const e=this.bubble.querySelector(".bytedesk-unread-badge");e?e.remove():console.log("clearUnreadBadge: 未找到角标")}async clearUnreadMessages(){return this.clearUnreadMessagesPromise?(this.config.isDebug&&console.log("清空未读消息请求正在进行中，返回现有Promise"),this.clearUnreadMessagesPromise):(this.clearUnreadMessagesPromise=Promise.resolve().then(()=>gt).then(async({clearUnreadMessages:e})=>{var n,i;try{const o=String(((n=this.config.chatConfig)==null?void 0:n.visitorUid)||""),s=localStorage.getItem(V),r=localStorage.getItem(H),a={uid:s||"",visitorUid:o||r||"",orgUid:((i=this.config.chatConfig)==null?void 0:i.org)||""},d=await e(a);return console.log("清空未读消息数:",d.data,a),d.data.code===200?(console.log("清空未读消息数成功:",d.data),this.clearUnreadBadge(),d.data.data||0):(console.error("清空未读消息数失败:",d.data.message),0)}catch(o){return console.error("清空未读消息数出错:",o),0}finally{this.clearUnreadMessagesPromise=null}}),this.clearUnreadMessagesPromise)}createBubble(){var f,b,w,h,m,p,x,E,S,O,C,_,A;if(this.bubble&&document.body.contains(this.bubble)){console.log("气泡已存在，不重复创建");return}const e=document.createElement("div");e.style.cssText=`
      position: fixed;
      ${this.config.placement==="bottom-left"?"left":"right"}: ${this.config.marginSide}px;
      bottom: ${this.config.marginBottom}px;
      display: flex;
      flex-direction: column;
      align-items: ${this.config.placement==="bottom-left"?"flex-start":"flex-end"};
      gap: 10px;
      z-index: 9999;
    `;let n=null;if((f=this.config.bubbleConfig)!=null&&f.show){n=document.createElement("div"),n.style.cssText=`
        background: ${((b=this.config.theme)==null?void 0:b.mode)==="dark"?"#1f2937":"white"};
        color: ${((w=this.config.theme)==null?void 0:w.mode)==="dark"?"#e5e7eb":"#1f2937"};
        padding: 12px 16px;
        border-radius: 8px;
        box-shadow: 0 2px 12px rgba(0, 0, 0, 0.1);
        max-width: 220px;
        margin-bottom: 8px;
        opacity: 0;
        transform: translateY(10px);
        transition: all 0.3s ease;
        position: relative;
      `;const y=document.createElement("div");y.style.cssText=`
        display: flex;
        align-items: center;
        gap: 8px;
        flex-direction: ${this.config.placement==="bottom-left"?"row":"row-reverse"};
      `,y.setAttribute("data-placement",this.config.placement||"bottom-right");const D=document.createElement("span");D.textContent=((h=this.config.bubbleConfig)==null?void 0:h.icon)||"",D.style.fontSize="20px",y.appendChild(D);const j=document.createElement("div"),B=document.createElement("div");B.textContent=((m=this.config.bubbleConfig)==null?void 0:m.title)||"",B.style.fontWeight="bold",B.style.color=((p=this.config.theme)==null?void 0:p.mode)==="dark"?"#e5e7eb":"#1f2937",B.style.marginBottom="4px",B.style.textAlign=this.config.placement==="bottom-left"?"left":"right",j.appendChild(B);const I=document.createElement("div");I.textContent=((x=this.config.bubbleConfig)==null?void 0:x.subtitle)||"",I.style.fontSize="0.9em",I.style.color=((E=this.config.theme)==null?void 0:E.mode)==="dark"?"#9ca3af":"#4b5563",I.style.textAlign=this.config.placement==="bottom-left"?"left":"right",j.appendChild(I),y.appendChild(j),n.appendChild(y);const q=document.createElement("div");q.style.cssText=`
        position: absolute;
        bottom: -6px;
        ${this.config.placement==="bottom-left"?"left: 24px":"right: 24px"};
        width: 12px;
        height: 12px;
        background: ${((S=this.config.theme)==null?void 0:S.mode)==="dark"?"#1f2937":"white"};
        transform: rotate(45deg);
        box-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
      `;const R=document.createElement("div");R.style.cssText=`
        position: absolute;
        bottom: 0;
        ${this.config.placement==="bottom-left"?"left: 18px":"right: 18px"};
        width: 24px;
        height: 12px;
        background: ${((O=this.config.theme)==null?void 0:O.mode)==="dark"?"#1f2937":"white"};
      `,n.appendChild(q),n.appendChild(R),e.appendChild(n),setTimeout(()=>{n&&(n.style.opacity="1",n.style.transform="translateY(0)")},500)}this.bubble=document.createElement("button");const i=this.config.buttonConfig||{},o=i.width||60,s=i.height||60,r=Math.min(o,s)/2,a=((C=this.config.theme)==null?void 0:C.mode)==="dark",d=a?"#3B82F6":"#0066FF",u=((_=this.config.theme)==null?void 0:_.backgroundColor)||d;this.bubble.style.cssText=`
      background-color: ${u};
      width: ${o}px;
      height: ${s}px;
      border-radius: ${r}px;
      border: none;
      cursor: ${this.config.draggable?"move":"pointer"};
      display: ${i.show===!1?"none":"flex"};
      align-items: center;
      justify-content: center;
      box-shadow: 0 4px 16px rgba(0, 0, 0, ${a?"0.3":"0.12"});
      transition: all 0.3s ease;
      outline: none;
      position: relative;
      user-select: none;
    `;const c=document.createElement("div");if(c.style.cssText=`
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    `,i.icon){const y=document.createElement("span");y.textContent=i.icon,y.style.fontSize=`${s*.4}px`,c.appendChild(y)}else{const y=document.createElement("div");y.innerHTML=`
        <svg width="28" height="28" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M12 22C17.5228 22 22 17.5228 22 12C22 6.47715 17.5228 2 12 2C6.47715 2 2 6.47715 2 12C2 14.663 3.04094 17.0829 4.73812 18.875L2.72681 21.1705C2.44361 21.4937 2.67314 22 3.10288 22H12Z" 
                fill="white"/>
        </svg>
      `,c.appendChild(y)}if(i.text){const y=document.createElement("span");y.textContent=i.text,y.style.cssText=`
        color: ${((A=this.config.theme)==null?void 0:A.textColor)||"#ffffff"};
        font-size: ${s*.25}px;
        white-space: nowrap;
      `,c.appendChild(y)}if(this.bubble.appendChild(c),this.bubble.addEventListener("mouseenter",()=>{this.bubble.style.transform="scale(1.1)"}),this.bubble.addEventListener("mouseleave",()=>{this.bubble.style.transform="scale(1)"}),e.appendChild(this.bubble),this.config.draggable){let y=0,D=0,j=0,B=0;this.bubble.addEventListener("mousedown",I=>{I.button===0&&(this.isDragging=!0,y=I.clientX,D=I.clientY,j=e.offsetLeft,B=e.offsetTop,e.style.transition="none")}),document.addEventListener("mousemove",I=>{if(!this.isDragging)return;I.preventDefault();const q=I.clientX-y,R=I.clientY-D,Pe=j+q,ri=B+R,ai=window.innerHeight-e.offsetHeight;Pe<=window.innerWidth/2?(e.style.left=`${Math.max(0,Pe)}px`,e.style.right="auto",e.style.alignItems="flex-start",this.config.placement="bottom-left"):(e.style.right=`${Math.max(0,window.innerWidth-Pe-e.offsetWidth)}px`,e.style.left="auto",e.style.alignItems="flex-end",this.config.placement="bottom-right"),e.style.bottom=`${Math.min(Math.max(0,window.innerHeight-ri-e.offsetHeight),ai)}px`}),document.addEventListener("mouseup",()=>{this.isDragging&&(this.isDragging=!1,e.style.transition="all 0.3s ease",this.config.marginSide=parseInt(this.config.placement==="bottom-left"?e.style.left:e.style.right)||20,this.config.marginBottom=parseInt(e.style.bottom||"20"))})}this.bubble.addEventListener("click",()=>{if(!this.isDragging){console.log("bubble click");const y=this.bubble.messageElement;y instanceof HTMLElement&&(y.style.display="none"),this.showChat()}}),this.bubble.messageElement=n,document.body.appendChild(e),this.bubble.addEventListener("contextmenu",y=>{this.showContextMenu(y)}),document.addEventListener("click",()=>{this.hideContextMenu()})}createChatWindow(){var a,d,u,c,f,b;this.window=document.createElement("div");const e=window.innerWidth<=768,n=window.innerWidth,i=window.innerHeight,o=Math.min(((a=this.config.window)==null?void 0:a.width)||n*.9,n*.9),s=Math.min(((d=this.config.window)==null?void 0:d.height)||i*.9,i*.9);e?this.window.style.cssText=`
        position: fixed;
        left: 0;
        bottom: 0;
        width: 100%;
        height: 90vh;
        display: none;
        z-index: 10000;
        border-top-left-radius: 12px;
        border-top-right-radius: 12px;
        overflow: hidden;
        transition: all ${(u=this.config.animation)==null?void 0:u.duration}ms ${(c=this.config.animation)==null?void 0:c.type};
      `:this.window.style.cssText=`
        position: fixed;
        ${this.config.placement==="bottom-right"?"right":"left"}: ${this.config.marginSide}px;
        bottom: ${this.config.marginBottom}px;
        width: ${o}px;
        height: ${s}px;
        border-radius: 12px;
        box-shadow: 0 4px 24px rgba(0, 0, 0, 0.15);
        display: none;
        overflow: hidden;
        z-index: 10000;
        transition: all ${(f=this.config.animation)==null?void 0:f.duration}ms ${(b=this.config.animation)==null?void 0:b.type};
      `;const r=document.createElement("iframe");r.style.cssText=`
      width: 100%;
      height: 100%;
      border: none;
      display: block; // 添加这一行
      vertical-align: bottom; // 添加这一行
    `,r.src=this.generateChatUrl(),console.log("iframe.src: ",r.src),this.window.appendChild(r),document.body.appendChild(this.window)}generateChatUrl(e="messages"){console.log("this.config: ",this.config,e);const n=new URLSearchParams,i=localStorage.getItem(V),o=localStorage.getItem(H);i&&i.trim()!==""&&n.append("uid",i),o&&o.trim()!==""&&n.append("visitorUid",o),Object.entries(this.config.chatConfig||{}).forEach(([r,a])=>{if(r==="goodsInfo"||r==="orderInfo")try{typeof a=="string"?n.append(r,a):n.append(r,JSON.stringify(a))}catch(d){console.error(`Error processing ${r}:`,d)}else if(r==="extra")try{let d=typeof a=="string"?JSON.parse(a):a;d.goodsInfo&&delete d.goodsInfo,d.orderInfo&&delete d.orderInfo,Object.keys(d).length>0&&n.append(r,JSON.stringify(d))}catch(d){console.error("Error processing extra parameter:",d)}else n.append(r,String(a))}),Object.entries(this.config.browseConfig||{}).forEach(([r,a])=>{n.append(r,String(a))}),Object.entries(this.config.theme||{}).forEach(([r,a])=>{n.append(r,String(a))}),n.append("lang",this.config.locale||"zh-cn");const s=`${this.config.htmlUrl}?${n.toString()}`;return console.log("chat url: ",s),s}setupMessageListener(){window.addEventListener("message",e=>{switch(e.data.type){case yt:this.hideChat();break;case xt:this.toggleMaximize();break;case Et:this.minimizeWindow();break;case St:console.log("RECEIVE_MESSAGE");break;case Ct:console.log("INVITE_VISITOR");break;case Tt:console.log("INVITE_VISITOR_ACCEPT");break;case Rt:console.log("INVITE_VISITOR_REJECT");break;case Ot:this.handleLocalStorageData(e);break}})}handleLocalStorageData(e){var r,a;const{uid:n,visitorUid:i}=e.data;console.log("handleLocalStorageData 被调用",n,i,e.data);const o=localStorage.getItem(V),s=localStorage.getItem(H);if(o===n&&s===i){console.log("handleLocalStorageData: 值相同，跳过设置");return}localStorage.setItem(V,n),localStorage.setItem(H,i),console.log("handleLocalStorageData: 已更新localStorage",{uid:n,visitorUid:i}),(a=(r=this.config).onVisitorInfo)==null||a.call(r,n,i)}sendMessageToIframe(e){var i;const n=(i=this.window)==null?void 0:i.querySelector("iframe");n&&n.contentWindow&&n.contentWindow.postMessage(e,"*")}showChat(e){var n,i;if(e&&(this.config={...this.config,...e},this.window&&(document.body.removeChild(this.window),this.window=null)),this.window||this.createChatWindow(),this.window){const o=window.innerWidth<=768;if(this.window.style.display="block",this.config.forceRefresh){const s=this.window.querySelector("iframe");s&&(s.src=this.generateChatUrl())}if(this.setupResizeListener(),o&&this.window&&(this.window.style.transform="translateY(100%)",requestAnimationFrame(()=>{this.window&&(this.window.style.transform="translateY(0)")})),this.isVisible=!0,this.bubble){this.bubble.style.display="none";const s=this.bubble.messageElement;s instanceof HTMLElement&&(s.style.display="none")}}this.hideInviteDialog(),(i=(n=this.config).onShowChat)==null||i.call(n)}hideChat(){var e,n,i,o,s;if(this.window){if(window.innerWidth<=768?(this.window.style.transform="translateY(100%)",setTimeout(()=>{this.window&&(this.window.style.display="none")},((e=this.config.animation)==null?void 0:e.duration)||300)):this.window.style.display="none",this.isVisible=!1,this.bubble){this.bubble.style.display=((n=this.config.buttonConfig)==null?void 0:n.show)===!1?"none":"inline-flex";const a=this.bubble.messageElement;a instanceof HTMLElement&&(a.style.display=((i=this.config.bubbleConfig)==null?void 0:i.show)===!1?"none":"block")}(s=(o=this.config).onHideChat)==null||s.call(o)}}minimizeWindow(){this.window&&(this.windowState="minimized",this.window.style.display="none",this.hideChat())}toggleMaximize(){this.window&&window.open(this.generateChatUrl(),"_blank")}setupResizeListener(){const e=()=>{var r,a;if(!this.window||!this.isVisible)return;const i=window.innerWidth<=768,o=window.innerWidth,s=window.innerHeight;if(i)Object.assign(this.window.style,{left:"0",bottom:"0",width:"100%",height:"90vh",borderTopLeftRadius:"12px",borderTopRightRadius:"12px",borderBottomLeftRadius:"0",borderBottomRightRadius:"0"});else{let d=this.windowState==="maximized"?o:Math.min(((r=this.config.window)==null?void 0:r.width)||o*.9,o*.9),u=this.windowState==="maximized"?s:Math.min(((a=this.config.window)==null?void 0:a.height)||s*.9,s*.9);const c=this.config.placement==="bottom-right"?this.config.marginSide:void 0,f=this.config.placement==="bottom-left"?this.config.marginSide:void 0;Object.assign(this.window.style,{width:`${d}px`,height:`${u}px`,right:c?`${c}px`:"auto",left:f?`${f}px`:"auto",bottom:`${this.config.marginBottom}px`,borderRadius:this.windowState==="maximized"?"0":"12px"})}};let n;window.addEventListener("resize",()=>{clearTimeout(n),n=window.setTimeout(e,100)}),e()}destroy(){var n;const e=(n=this.bubble)==null?void 0:n.parentElement;e&&document.body.contains(e)&&(document.body.removeChild(e),this.bubble=null),this.window&&document.body.contains(this.window)&&(document.body.removeChild(this.window),this.window=null),window.removeEventListener("resize",this.setupResizeListener.bind(this)),this.loopTimer&&(window.clearTimeout(this.loopTimer),this.loopTimer=null),this.inviteDialog&&document.body.contains(this.inviteDialog)&&(document.body.removeChild(this.inviteDialog),this.inviteDialog=null),this.contextMenu&&document.body.contains(this.contextMenu)&&(document.body.removeChild(this.contextMenu),this.contextMenu=null),this.hideTimeout&&(clearTimeout(this.hideTimeout),this.hideTimeout=null)}createInviteDialog(){var a,d,u,c,f,b;if(this.inviteDialog&&document.body.contains(this.inviteDialog)){console.log("邀请框已存在，不重复创建");return}const e=((a=this.config.theme)==null?void 0:a.mode)==="dark";if(this.inviteDialog=document.createElement("div"),this.inviteDialog.style.cssText=`
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: ${e?"#1f2937":"white"};
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 24px rgba(0, 0, 0, ${e?"0.3":"0.15"});
      z-index: 10001;
      display: none;
      max-width: 300px;
      text-align: center;
    `,(d=this.config.inviteConfig)!=null&&d.icon){const w=document.createElement("div");w.style.cssText=`
        font-size: 32px;
        margin-bottom: 12px;
        color: ${e?"#e5e7eb":"#333"};
      `,w.textContent=this.config.inviteConfig.icon,this.inviteDialog.appendChild(w)}const n=document.createElement("div");n.style.cssText=`
      margin-bottom: 16px;
      color: ${e?"#e5e7eb":"#333"};
    `,n.textContent=((u=this.config.inviteConfig)==null?void 0:u.text)||"需要帮助吗？点击开始对话",this.inviteDialog.appendChild(n);const i=document.createElement("div");i.style.cssText=`
      display: flex;
      gap: 10px;
      justify-content: center;
    `;const o=document.createElement("button");o.textContent=((c=this.config.inviteConfig)==null?void 0:c.acceptText)||"开始对话";const s=((f=this.config.theme)==null?void 0:f.backgroundColor)||(e?"#3B82F6":"#0066FF");o.style.cssText=`
      padding: 8px 16px;
      background: ${s};
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    `,o.onclick=()=>{var w,h;this.hideInviteDialog(),this.showChat(),(h=(w=this.config.inviteConfig)==null?void 0:w.onAccept)==null||h.call(w)};const r=document.createElement("button");r.textContent=((b=this.config.inviteConfig)==null?void 0:b.rejectText)||"稍后再说",r.style.cssText=`
      padding: 8px 16px;
      background: ${e?"#374151":"#f5f5f5"};
      color: ${e?"#d1d5db":"#666"};
      border: none;
      border-radius: 4px;
      cursor: pointer;
    `,r.onclick=()=>{var w,h;this.hideInviteDialog(),(h=(w=this.config.inviteConfig)==null?void 0:w.onReject)==null||h.call(w),this.handleInviteLoop()},i.appendChild(o),i.appendChild(r),this.inviteDialog.appendChild(i),document.body.appendChild(this.inviteDialog)}showInviteDialog(){var e,n;this.inviteDialog&&(this.inviteDialog.style.display="block",(n=(e=this.config.inviteConfig)==null?void 0:e.onOpen)==null||n.call(e))}hideInviteDialog(){var e,n;console.log("hideInviteDialog before"),this.inviteDialog&&(this.inviteDialog.style.display="none",(n=(e=this.config.inviteConfig)==null?void 0:e.onClose)==null||n.call(e),console.log("hideInviteDialog after"))}handleInviteLoop(){const{loop:e,loopDelay:n=3e3,loopCount:i=1/0}=this.config.inviteConfig||{};!e||this.loopCount>=i-1||(this.loopTimer&&window.clearTimeout(this.loopTimer),this.loopTimer=window.setTimeout(()=>{this.loopCount++,this.showInviteDialog()},n))}showButton(){this.bubble&&(this.bubble.style.display="inline-flex")}hideButton(){this.bubble&&(this.bubble.style.display="none")}showBubble(){if(this.bubble){const e=this.bubble.messageElement;e instanceof HTMLElement&&(e.style.display="block",setTimeout(()=>{e.style.opacity="1",e.style.transform="translateY(0)"},100))}}hideBubble(){if(this.bubble){const e=this.bubble.messageElement;e instanceof HTMLElement&&(e.style.opacity="0",e.style.transform="translateY(10px)",setTimeout(()=>{e.style.display="none"},300))}}createContextMenu(){this.contextMenu=document.createElement("div"),this.contextMenu.style.cssText=`
      position: fixed;
      background: white;
      border-radius: 4px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      padding: 4px 0;
      display: none;
      z-index: 10000;
      min-width: 150px;
    `;const e=[{text:"隐藏按钮和气泡",onClick:()=>{this.hideButton(),this.hideBubble()}},{text:"切换位置",onClick:()=>{this.togglePlacement()}}];e.forEach((n,i)=>{const o=document.createElement("div");if(o.style.cssText=`
        padding: 8px 16px;
        cursor: pointer;
        color: #333;
        font-size: 14px;
        
        &:hover {
          background: #f5f5f5;
        }
      `,o.textContent=n.text,o.onclick=()=>{n.onClick(),this.hideContextMenu()},this.contextMenu&&this.contextMenu.appendChild(o),i<e.length-1){const s=document.createElement("div");s.style.cssText=`
          height: 1px;
          background: #eee;
          margin: 4px 0;
        `,this.contextMenu&&this.contextMenu.appendChild(s)}}),document.body.appendChild(this.contextMenu)}showContextMenu(e){if(e.preventDefault(),this.contextMenu||this.createContextMenu(),this.contextMenu){this.contextMenu.style.visibility="hidden",this.contextMenu.style.display="block";const n=this.contextMenu.offsetWidth,i=this.contextMenu.offsetHeight;let o=e.clientX,s=e.clientY;o+n>window.innerWidth&&(o=o-n),s+i>window.innerHeight&&(s=s-i),o=Math.max(0,o),s=Math.max(0,s),this.contextMenu.style.left=`${o}px`,this.contextMenu.style.top=`${s}px`,this.contextMenu.style.visibility="visible"}}hideContextMenu(){this.contextMenu&&(this.contextMenu.style.display="none")}togglePlacement(){var n,i;if(!this.bubble)return;this.config.placement=this.config.placement==="bottom-left"?"bottom-right":"bottom-left";const e=this.bubble.parentElement;e&&(e.style.left=this.config.placement==="bottom-left"?`${this.config.marginSide}px`:"auto",e.style.right=this.config.placement==="bottom-right"?`${this.config.marginSide}px`:"auto",e.style.alignItems=this.config.placement==="bottom-left"?"flex-start":"flex-end",this.window&&this.isVisible&&(this.window.style.left=this.config.placement==="bottom-left"?`${this.config.marginSide}px`:"auto",this.window.style.right=this.config.placement==="bottom-right"?`${this.config.marginSide}px`:"auto"),(i=(n=this.config).onConfigChange)==null||i.call(n,{placement:this.config.placement}))}}function ve(t,e){return function(){return t.apply(e,arguments)}}const{toString:Ut}=Object.prototype,{getPrototypeOf:be}=Object,{iterator:oe,toStringTag:Me}=Symbol,se=(t=>e=>{const n=Ut.call(e);return t[n]||(t[n]=n.slice(8,-1).toLowerCase())})(Object.create(null)),k=t=>(t=t.toLowerCase(),e=>se(e)===t),re=t=>e=>typeof e===t,{isArray:G}=Array,Q=re("undefined");function At(t){return t!==null&&!Q(t)&&t.constructor!==null&&!Q(t.constructor)&&v(t.constructor.isBuffer)&&t.constructor.isBuffer(t)}const De=k("ArrayBuffer");function It(t){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(t):e=t&&t.buffer&&De(t.buffer),e}const Pt=re("string"),v=re("function"),Ne=re("number"),ae=t=>t!==null&&typeof t=="object",vt=t=>t===!0||t===!1,le=t=>{if(se(t)!=="object")return!1;const e=be(t);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Me in t)&&!(oe in t)},Mt=k("Date"),Dt=k("File"),Nt=k("Blob"),Lt=k("FileList"),Bt=t=>ae(t)&&v(t.pipe),kt=t=>{let e;return t&&(typeof FormData=="function"&&t instanceof FormData||v(t.append)&&((e=se(t))==="formdata"||e==="object"&&v(t.toString)&&t.toString()==="[object FormData]"))},Ft=k("URLSearchParams"),[$t,Vt,jt,qt]=["ReadableStream","Request","Response","Headers"].map(k),Ht=t=>t.trim?t.trim():t.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function ee(t,e,{allOwnKeys:n=!1}={}){if(t===null||typeof t>"u")return;let i,o;if(typeof t!="object"&&(t=[t]),G(t))for(i=0,o=t.length;i<o;i++)e.call(null,t[i],i,t);else{const s=n?Object.getOwnPropertyNames(t):Object.keys(t),r=s.length;let a;for(i=0;i<r;i++)a=s[i],e.call(null,t[a],a,t)}}function Le(t,e){e=e.toLowerCase();const n=Object.keys(t);let i=n.length,o;for(;i-- >0;)if(o=n[i],e===o.toLowerCase())return o;return null}const z=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,Be=t=>!Q(t)&&t!==z;function we(){const{caseless:t}=Be(this)&&this||{},e={},n=(i,o)=>{const s=t&&Le(e,o)||o;le(e[s])&&le(i)?e[s]=we(e[s],i):le(i)?e[s]=we({},i):G(i)?e[s]=i.slice():e[s]=i};for(let i=0,o=arguments.length;i<o;i++)arguments[i]&&ee(arguments[i],n);return e}const zt=(t,e,n,{allOwnKeys:i}={})=>(ee(e,(o,s)=>{n&&v(o)?t[s]=ve(o,n):t[s]=o},{allOwnKeys:i}),t),Wt=t=>(t.charCodeAt(0)===65279&&(t=t.slice(1)),t),Jt=(t,e,n,i)=>{t.prototype=Object.create(e.prototype,i),t.prototype.constructor=t,Object.defineProperty(t,"super",{value:e.prototype}),n&&Object.assign(t.prototype,n)},Kt=(t,e,n,i)=>{let o,s,r;const a={};if(e=e||{},t==null)return e;do{for(o=Object.getOwnPropertyNames(t),s=o.length;s-- >0;)r=o[s],(!i||i(r,t,e))&&!a[r]&&(e[r]=t[r],a[r]=!0);t=n!==!1&&be(t)}while(t&&(!n||n(t,e))&&t!==Object.prototype);return e},Yt=(t,e,n)=>{t=String(t),(n===void 0||n>t.length)&&(n=t.length),n-=e.length;const i=t.indexOf(e,n);return i!==-1&&i===n},Gt=t=>{if(!t)return null;if(G(t))return t;let e=t.length;if(!Ne(e))return null;const n=new Array(e);for(;e-- >0;)n[e]=t[e];return n},Xt=(t=>e=>t&&e instanceof t)(typeof Uint8Array<"u"&&be(Uint8Array)),Zt=(t,e)=>{const i=(t&&t[oe]).call(t);let o;for(;(o=i.next())&&!o.done;){const s=o.value;e.call(t,s[0],s[1])}},Qt=(t,e)=>{let n;const i=[];for(;(n=t.exec(e))!==null;)i.push(n);return i},en=k("HTMLFormElement"),tn=t=>t.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(n,i,o){return i.toUpperCase()+o}),ke=(({hasOwnProperty:t})=>(e,n)=>t.call(e,n))(Object.prototype),nn=k("RegExp"),Fe=(t,e)=>{const n=Object.getOwnPropertyDescriptors(t),i={};ee(n,(o,s)=>{let r;(r=e(o,s,t))!==!1&&(i[s]=r||o)}),Object.defineProperties(t,i)},on=t=>{Fe(t,(e,n)=>{if(v(t)&&["arguments","caller","callee"].indexOf(n)!==-1)return!1;const i=t[n];if(v(i)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+n+"'")})}})},sn=(t,e)=>{const n={},i=o=>{o.forEach(s=>{n[s]=!0})};return G(t)?i(t):i(String(t).split(e)),n},rn=()=>{},an=(t,e)=>t!=null&&Number.isFinite(t=+t)?t:e;function ln(t){return!!(t&&v(t.append)&&t[Me]==="FormData"&&t[oe])}const cn=t=>{const e=new Array(10),n=(i,o)=>{if(ae(i)){if(e.indexOf(i)>=0)return;if(!("toJSON"in i)){e[o]=i;const s=G(i)?[]:{};return ee(i,(r,a)=>{const d=n(r,o+1);!Q(d)&&(s[a]=d)}),e[o]=void 0,s}}return i};return n(t,0)},un=k("AsyncFunction"),dn=t=>t&&(ae(t)||v(t))&&v(t.then)&&v(t.catch),$e=((t,e)=>t?setImmediate:e?((n,i)=>(z.addEventListener("message",({source:o,data:s})=>{o===z&&s===n&&i.length&&i.shift()()},!1),o=>{i.push(o),z.postMessage(n,"*")}))(`axios@${Math.random()}`,[]):n=>setTimeout(n))(typeof setImmediate=="function",v(z.postMessage)),fn=typeof queueMicrotask<"u"?queueMicrotask.bind(z):typeof process<"u"&&process.nextTick||$e,l={isArray:G,isArrayBuffer:De,isBuffer:At,isFormData:kt,isArrayBufferView:It,isString:Pt,isNumber:Ne,isBoolean:vt,isObject:ae,isPlainObject:le,isReadableStream:$t,isRequest:Vt,isResponse:jt,isHeaders:qt,isUndefined:Q,isDate:Mt,isFile:Dt,isBlob:Nt,isRegExp:nn,isFunction:v,isStream:Bt,isURLSearchParams:Ft,isTypedArray:Xt,isFileList:Lt,forEach:ee,merge:we,extend:zt,trim:Ht,stripBOM:Wt,inherits:Jt,toFlatObject:Kt,kindOf:se,kindOfTest:k,endsWith:Yt,toArray:Gt,forEachEntry:Zt,matchAll:Qt,isHTMLForm:en,hasOwnProperty:ke,hasOwnProp:ke,reduceDescriptors:Fe,freezeMethods:on,toObjectSet:sn,toCamelCase:tn,noop:rn,toFiniteNumber:an,findKey:Le,global:z,isContextDefined:Be,isSpecCompliantForm:ln,toJSONObject:cn,isAsyncFn:un,isThenable:dn,setImmediate:$e,asap:fn,isIterable:t=>t!=null&&v(t[oe])};function g(t,e,n,i,o){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=t,this.name="AxiosError",e&&(this.code=e),n&&(this.config=n),i&&(this.request=i),o&&(this.response=o,this.status=o.status?o.status:null)}l.inherits(g,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:l.toJSONObject(this.config),code:this.code,status:this.status}}});const Ve=g.prototype,je={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(t=>{je[t]={value:t}}),Object.defineProperties(g,je),Object.defineProperty(Ve,"isAxiosError",{value:!0}),g.from=(t,e,n,i,o,s)=>{const r=Object.create(Ve);return l.toFlatObject(t,r,function(d){return d!==Error.prototype},a=>a!=="isAxiosError"),g.call(r,t.message,e,n,i,o),r.cause=t,r.name=t.name,s&&Object.assign(r,s),r};const hn=null;function ye(t){return l.isPlainObject(t)||l.isArray(t)}function qe(t){return l.endsWith(t,"[]")?t.slice(0,-2):t}function He(t,e,n){return t?t.concat(e).map(function(o,s){return o=qe(o),!n&&s?"["+o+"]":o}).join(n?".":""):e}function pn(t){return l.isArray(t)&&!t.some(ye)}const mn=l.toFlatObject(l,{},null,function(e){return/^is[A-Z]/.test(e)});function ce(t,e,n){if(!l.isObject(t))throw new TypeError("target must be an object");e=e||new FormData,n=l.toFlatObject(n,{metaTokens:!0,dots:!1,indexes:!1},!1,function(m,p){return!l.isUndefined(p[m])});const i=n.metaTokens,o=n.visitor||c,s=n.dots,r=n.indexes,d=(n.Blob||typeof Blob<"u"&&Blob)&&l.isSpecCompliantForm(e);if(!l.isFunction(o))throw new TypeError("visitor must be a function");function u(h){if(h===null)return"";if(l.isDate(h))return h.toISOString();if(l.isBoolean(h))return h.toString();if(!d&&l.isBlob(h))throw new g("Blob is not supported. Use a Buffer instead.");return l.isArrayBuffer(h)||l.isTypedArray(h)?d&&typeof Blob=="function"?new Blob([h]):Buffer.from(h):h}function c(h,m,p){let x=h;if(h&&!p&&typeof h=="object"){if(l.endsWith(m,"{}"))m=i?m:m.slice(0,-2),h=JSON.stringify(h);else if(l.isArray(h)&&pn(h)||(l.isFileList(h)||l.endsWith(m,"[]"))&&(x=l.toArray(h)))return m=qe(m),x.forEach(function(S,O){!(l.isUndefined(S)||S===null)&&e.append(r===!0?He([m],O,s):r===null?m:m+"[]",u(S))}),!1}return ye(h)?!0:(e.append(He(p,m,s),u(h)),!1)}const f=[],b=Object.assign(mn,{defaultVisitor:c,convertValue:u,isVisitable:ye});function w(h,m){if(!l.isUndefined(h)){if(f.indexOf(h)!==-1)throw Error("Circular reference detected in "+m.join("."));f.push(h),l.forEach(h,function(x,E){(!(l.isUndefined(x)||x===null)&&o.call(e,x,l.isString(E)?E.trim():E,m,b))===!0&&w(x,m?m.concat(E):[E])}),f.pop()}}if(!l.isObject(t))throw new TypeError("data must be an object");return w(t),e}function ze(t){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(t).replace(/[!'()~]|%20|%00/g,function(i){return e[i]})}function xe(t,e){this._pairs=[],t&&ce(t,this,e)}const We=xe.prototype;We.append=function(e,n){this._pairs.push([e,n])},We.toString=function(e){const n=e?function(i){return e.call(this,i,ze)}:ze;return this._pairs.map(function(o){return n(o[0])+"="+n(o[1])},"").join("&")};function gn(t){return encodeURIComponent(t).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Je(t,e,n){if(!e)return t;const i=n&&n.encode||gn;l.isFunction(n)&&(n={serialize:n});const o=n&&n.serialize;let s;if(o?s=o(e,n):s=l.isURLSearchParams(e)?e.toString():new xe(e,n).toString(i),s){const r=t.indexOf("#");r!==-1&&(t=t.slice(0,r)),t+=(t.indexOf("?")===-1?"?":"&")+s}return t}class Ke{constructor(){this.handlers=[]}use(e,n,i){return this.handlers.push({fulfilled:e,rejected:n,synchronous:i?i.synchronous:!1,runWhen:i?i.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){l.forEach(this.handlers,function(i){i!==null&&e(i)})}}const Ye={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},bn={isBrowser:!0,classes:{URLSearchParams:typeof URLSearchParams<"u"?URLSearchParams:xe,FormData:typeof FormData<"u"?FormData:null,Blob:typeof Blob<"u"?Blob:null},protocols:["http","https","file","blob","url","data"]},Ee=typeof window<"u"&&typeof document<"u",Se=typeof navigator=="object"&&navigator||void 0,wn=Ee&&(!Se||["ReactNative","NativeScript","NS"].indexOf(Se.product)<0),yn=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",xn=Ee&&window.location.href||"http://localhost",U={...Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:Ee,hasStandardBrowserEnv:wn,hasStandardBrowserWebWorkerEnv:yn,navigator:Se,origin:xn},Symbol.toStringTag,{value:"Module"})),...bn};function En(t,e){return ce(t,new U.classes.URLSearchParams,Object.assign({visitor:function(n,i,o,s){return U.isNode&&l.isBuffer(n)?(this.append(i,n.toString("base64")),!1):s.defaultVisitor.apply(this,arguments)}},e))}function Sn(t){return l.matchAll(/\w+|\[(\w*)]/g,t).map(e=>e[0]==="[]"?"":e[1]||e[0])}function Cn(t){const e={},n=Object.keys(t);let i;const o=n.length;let s;for(i=0;i<o;i++)s=n[i],e[s]=t[s];return e}function Ge(t){function e(n,i,o,s){let r=n[s++];if(r==="__proto__")return!0;const a=Number.isFinite(+r),d=s>=n.length;return r=!r&&l.isArray(o)?o.length:r,d?(l.hasOwnProp(o,r)?o[r]=[o[r],i]:o[r]=i,!a):((!o[r]||!l.isObject(o[r]))&&(o[r]=[]),e(n,i,o[r],s)&&l.isArray(o[r])&&(o[r]=Cn(o[r])),!a)}if(l.isFormData(t)&&l.isFunction(t.entries)){const n={};return l.forEachEntry(t,(i,o)=>{e(Sn(i),o,n,0)}),n}return null}function Tn(t,e,n){if(l.isString(t))try{return(e||JSON.parse)(t),l.trim(t)}catch(i){if(i.name!=="SyntaxError")throw i}return(n||JSON.stringify)(t)}const te={transitional:Ye,adapter:["xhr","http","fetch"],transformRequest:[function(e,n){const i=n.getContentType()||"",o=i.indexOf("application/json")>-1,s=l.isObject(e);if(s&&l.isHTMLForm(e)&&(e=new FormData(e)),l.isFormData(e))return o?JSON.stringify(Ge(e)):e;if(l.isArrayBuffer(e)||l.isBuffer(e)||l.isStream(e)||l.isFile(e)||l.isBlob(e)||l.isReadableStream(e))return e;if(l.isArrayBufferView(e))return e.buffer;if(l.isURLSearchParams(e))return n.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let a;if(s){if(i.indexOf("application/x-www-form-urlencoded")>-1)return En(e,this.formSerializer).toString();if((a=l.isFileList(e))||i.indexOf("multipart/form-data")>-1){const d=this.env&&this.env.FormData;return ce(a?{"files[]":e}:e,d&&new d,this.formSerializer)}}return s||o?(n.setContentType("application/json",!1),Tn(e)):e}],transformResponse:[function(e){const n=this.transitional||te.transitional,i=n&&n.forcedJSONParsing,o=this.responseType==="json";if(l.isResponse(e)||l.isReadableStream(e))return e;if(e&&l.isString(e)&&(i&&!this.responseType||o)){const r=!(n&&n.silentJSONParsing)&&o;try{return JSON.parse(e)}catch(a){if(r)throw a.name==="SyntaxError"?g.from(a,g.ERR_BAD_RESPONSE,this,null,this.response):a}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:U.classes.FormData,Blob:U.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};l.forEach(["delete","get","head","post","put","patch"],t=>{te.headers[t]={}});const Rn=l.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),On=t=>{const e={};let n,i,o;return t&&t.split(`
`).forEach(function(r){o=r.indexOf(":"),n=r.substring(0,o).trim().toLowerCase(),i=r.substring(o+1).trim(),!(!n||e[n]&&Rn[n])&&(n==="set-cookie"?e[n]?e[n].push(i):e[n]=[i]:e[n]=e[n]?e[n]+", "+i:i)}),e},Xe=Symbol("internals");function ne(t){return t&&String(t).trim().toLowerCase()}function ue(t){return t===!1||t==null?t:l.isArray(t)?t.map(ue):String(t)}function _n(t){const e=Object.create(null),n=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let i;for(;i=n.exec(t);)e[i[1]]=i[2];return e}const Un=t=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(t.trim());function Ce(t,e,n,i,o){if(l.isFunction(i))return i.call(this,e,n);if(o&&(e=n),!!l.isString(e)){if(l.isString(i))return e.indexOf(i)!==-1;if(l.isRegExp(i))return i.test(e)}}function An(t){return t.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,n,i)=>n.toUpperCase()+i)}function In(t,e){const n=l.toCamelCase(" "+e);["get","set","has"].forEach(i=>{Object.defineProperty(t,i+n,{value:function(o,s,r){return this[i].call(this,e,o,s,r)},configurable:!0})})}let M=class{constructor(e){e&&this.set(e)}set(e,n,i){const o=this;function s(a,d,u){const c=ne(d);if(!c)throw new Error("header name must be a non-empty string");const f=l.findKey(o,c);(!f||o[f]===void 0||u===!0||u===void 0&&o[f]!==!1)&&(o[f||d]=ue(a))}const r=(a,d)=>l.forEach(a,(u,c)=>s(u,c,d));if(l.isPlainObject(e)||e instanceof this.constructor)r(e,n);else if(l.isString(e)&&(e=e.trim())&&!Un(e))r(On(e),n);else if(l.isObject(e)&&l.isIterable(e)){let a={},d,u;for(const c of e){if(!l.isArray(c))throw TypeError("Object iterator must return a key-value pair");a[u=c[0]]=(d=a[u])?l.isArray(d)?[...d,c[1]]:[d,c[1]]:c[1]}r(a,n)}else e!=null&&s(n,e,i);return this}get(e,n){if(e=ne(e),e){const i=l.findKey(this,e);if(i){const o=this[i];if(!n)return o;if(n===!0)return _n(o);if(l.isFunction(n))return n.call(this,o,i);if(l.isRegExp(n))return n.exec(o);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,n){if(e=ne(e),e){const i=l.findKey(this,e);return!!(i&&this[i]!==void 0&&(!n||Ce(this,this[i],i,n)))}return!1}delete(e,n){const i=this;let o=!1;function s(r){if(r=ne(r),r){const a=l.findKey(i,r);a&&(!n||Ce(i,i[a],a,n))&&(delete i[a],o=!0)}}return l.isArray(e)?e.forEach(s):s(e),o}clear(e){const n=Object.keys(this);let i=n.length,o=!1;for(;i--;){const s=n[i];(!e||Ce(this,this[s],s,e,!0))&&(delete this[s],o=!0)}return o}normalize(e){const n=this,i={};return l.forEach(this,(o,s)=>{const r=l.findKey(i,s);if(r){n[r]=ue(o),delete n[s];return}const a=e?An(s):String(s).trim();a!==s&&delete n[s],n[a]=ue(o),i[a]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const n=Object.create(null);return l.forEach(this,(i,o)=>{i!=null&&i!==!1&&(n[o]=e&&l.isArray(i)?i.join(", "):i)}),n}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,n])=>e+": "+n).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...n){const i=new this(e);return n.forEach(o=>i.set(o)),i}static accessor(e){const i=(this[Xe]=this[Xe]={accessors:{}}).accessors,o=this.prototype;function s(r){const a=ne(r);i[a]||(In(o,r),i[a]=!0)}return l.isArray(e)?e.forEach(s):s(e),this}};M.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]),l.reduceDescriptors(M.prototype,({value:t},e)=>{let n=e[0].toUpperCase()+e.slice(1);return{get:()=>t,set(i){this[n]=i}}}),l.freezeMethods(M);function Te(t,e){const n=this||te,i=e||n,o=M.from(i.headers);let s=i.data;return l.forEach(t,function(a){s=a.call(n,s,o.normalize(),e?e.status:void 0)}),o.normalize(),s}function Ze(t){return!!(t&&t.__CANCEL__)}function X(t,e,n){g.call(this,t??"canceled",g.ERR_CANCELED,e,n),this.name="CanceledError"}l.inherits(X,g,{__CANCEL__:!0});function Qe(t,e,n){const i=n.config.validateStatus;!n.status||!i||i(n.status)?t(n):e(new g("Request failed with status code "+n.status,[g.ERR_BAD_REQUEST,g.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n))}function Pn(t){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(t);return e&&e[1]||""}function vn(t,e){t=t||10;const n=new Array(t),i=new Array(t);let o=0,s=0,r;return e=e!==void 0?e:1e3,function(d){const u=Date.now(),c=i[s];r||(r=u),n[o]=d,i[o]=u;let f=s,b=0;for(;f!==o;)b+=n[f++],f=f%t;if(o=(o+1)%t,o===s&&(s=(s+1)%t),u-r<e)return;const w=c&&u-c;return w?Math.round(b*1e3/w):void 0}}function Mn(t,e){let n=0,i=1e3/e,o,s;const r=(u,c=Date.now())=>{n=c,o=null,s&&(clearTimeout(s),s=null),t.apply(null,u)};return[(...u)=>{const c=Date.now(),f=c-n;f>=i?r(u,c):(o=u,s||(s=setTimeout(()=>{s=null,r(o)},i-f)))},()=>o&&r(o)]}const de=(t,e,n=3)=>{let i=0;const o=vn(50,250);return Mn(s=>{const r=s.loaded,a=s.lengthComputable?s.total:void 0,d=r-i,u=o(d),c=r<=a;i=r;const f={loaded:r,total:a,progress:a?r/a:void 0,bytes:d,rate:u||void 0,estimated:u&&a&&c?(a-r)/u:void 0,event:s,lengthComputable:a!=null,[e?"download":"upload"]:!0};t(f)},n)},et=(t,e)=>{const n=t!=null;return[i=>e[0]({lengthComputable:n,total:t,loaded:i}),e[1]]},tt=t=>(...e)=>l.asap(()=>t(...e)),Dn=U.hasStandardBrowserEnv?((t,e)=>n=>(n=new URL(n,U.origin),t.protocol===n.protocol&&t.host===n.host&&(e||t.port===n.port)))(new URL(U.origin),U.navigator&&/(msie|trident)/i.test(U.navigator.userAgent)):()=>!0,Nn=U.hasStandardBrowserEnv?{write(t,e,n,i,o,s){const r=[t+"="+encodeURIComponent(e)];l.isNumber(n)&&r.push("expires="+new Date(n).toGMTString()),l.isString(i)&&r.push("path="+i),l.isString(o)&&r.push("domain="+o),s===!0&&r.push("secure"),document.cookie=r.join("; ")},read(t){const e=document.cookie.match(new RegExp("(^|;\\s*)("+t+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(t){this.write(t,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function Ln(t){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(t)}function Bn(t,e){return e?t.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):t}function nt(t,e,n){let i=!Ln(e);return t&&(i||n==!1)?Bn(t,e):e}const it=t=>t instanceof M?{...t}:t;function W(t,e){e=e||{};const n={};function i(u,c,f,b){return l.isPlainObject(u)&&l.isPlainObject(c)?l.merge.call({caseless:b},u,c):l.isPlainObject(c)?l.merge({},c):l.isArray(c)?c.slice():c}function o(u,c,f,b){if(l.isUndefined(c)){if(!l.isUndefined(u))return i(void 0,u,f,b)}else return i(u,c,f,b)}function s(u,c){if(!l.isUndefined(c))return i(void 0,c)}function r(u,c){if(l.isUndefined(c)){if(!l.isUndefined(u))return i(void 0,u)}else return i(void 0,c)}function a(u,c,f){if(f in e)return i(u,c);if(f in t)return i(void 0,u)}const d={url:s,method:s,data:s,baseURL:r,transformRequest:r,transformResponse:r,paramsSerializer:r,timeout:r,timeoutMessage:r,withCredentials:r,withXSRFToken:r,adapter:r,responseType:r,xsrfCookieName:r,xsrfHeaderName:r,onUploadProgress:r,onDownloadProgress:r,decompress:r,maxContentLength:r,maxBodyLength:r,beforeRedirect:r,transport:r,httpAgent:r,httpsAgent:r,cancelToken:r,socketPath:r,responseEncoding:r,validateStatus:a,headers:(u,c,f)=>o(it(u),it(c),f,!0)};return l.forEach(Object.keys(Object.assign({},t,e)),function(c){const f=d[c]||o,b=f(t[c],e[c],c);l.isUndefined(b)&&f!==a||(n[c]=b)}),n}const ot=t=>{const e=W({},t);let{data:n,withXSRFToken:i,xsrfHeaderName:o,xsrfCookieName:s,headers:r,auth:a}=e;e.headers=r=M.from(r),e.url=Je(nt(e.baseURL,e.url,e.allowAbsoluteUrls),t.params,t.paramsSerializer),a&&r.set("Authorization","Basic "+btoa((a.username||"")+":"+(a.password?unescape(encodeURIComponent(a.password)):"")));let d;if(l.isFormData(n)){if(U.hasStandardBrowserEnv||U.hasStandardBrowserWebWorkerEnv)r.setContentType(void 0);else if((d=r.getContentType())!==!1){const[u,...c]=d?d.split(";").map(f=>f.trim()).filter(Boolean):[];r.setContentType([u||"multipart/form-data",...c].join("; "))}}if(U.hasStandardBrowserEnv&&(i&&l.isFunction(i)&&(i=i(e)),i||i!==!1&&Dn(e.url))){const u=o&&s&&Nn.read(s);u&&r.set(o,u)}return e},kn=typeof XMLHttpRequest<"u"&&function(t){return new Promise(function(n,i){const o=ot(t);let s=o.data;const r=M.from(o.headers).normalize();let{responseType:a,onUploadProgress:d,onDownloadProgress:u}=o,c,f,b,w,h;function m(){w&&w(),h&&h(),o.cancelToken&&o.cancelToken.unsubscribe(c),o.signal&&o.signal.removeEventListener("abort",c)}let p=new XMLHttpRequest;p.open(o.method.toUpperCase(),o.url,!0),p.timeout=o.timeout;function x(){if(!p)return;const S=M.from("getAllResponseHeaders"in p&&p.getAllResponseHeaders()),C={data:!a||a==="text"||a==="json"?p.responseText:p.response,status:p.status,statusText:p.statusText,headers:S,config:t,request:p};Qe(function(A){n(A),m()},function(A){i(A),m()},C),p=null}"onloadend"in p?p.onloadend=x:p.onreadystatechange=function(){!p||p.readyState!==4||p.status===0&&!(p.responseURL&&p.responseURL.indexOf("file:")===0)||setTimeout(x)},p.onabort=function(){p&&(i(new g("Request aborted",g.ECONNABORTED,t,p)),p=null)},p.onerror=function(){i(new g("Network Error",g.ERR_NETWORK,t,p)),p=null},p.ontimeout=function(){let O=o.timeout?"timeout of "+o.timeout+"ms exceeded":"timeout exceeded";const C=o.transitional||Ye;o.timeoutErrorMessage&&(O=o.timeoutErrorMessage),i(new g(O,C.clarifyTimeoutError?g.ETIMEDOUT:g.ECONNABORTED,t,p)),p=null},s===void 0&&r.setContentType(null),"setRequestHeader"in p&&l.forEach(r.toJSON(),function(O,C){p.setRequestHeader(C,O)}),l.isUndefined(o.withCredentials)||(p.withCredentials=!!o.withCredentials),a&&a!=="json"&&(p.responseType=o.responseType),u&&([b,h]=de(u,!0),p.addEventListener("progress",b)),d&&p.upload&&([f,w]=de(d),p.upload.addEventListener("progress",f),p.upload.addEventListener("loadend",w)),(o.cancelToken||o.signal)&&(c=S=>{p&&(i(!S||S.type?new X(null,t,p):S),p.abort(),p=null)},o.cancelToken&&o.cancelToken.subscribe(c),o.signal&&(o.signal.aborted?c():o.signal.addEventListener("abort",c)));const E=Pn(o.url);if(E&&U.protocols.indexOf(E)===-1){i(new g("Unsupported protocol "+E+":",g.ERR_BAD_REQUEST,t));return}p.send(s||null)})},Fn=(t,e)=>{const{length:n}=t=t?t.filter(Boolean):[];if(e||n){let i=new AbortController,o;const s=function(u){if(!o){o=!0,a();const c=u instanceof Error?u:this.reason;i.abort(c instanceof g?c:new X(c instanceof Error?c.message:c))}};let r=e&&setTimeout(()=>{r=null,s(new g(`timeout ${e} of ms exceeded`,g.ETIMEDOUT))},e);const a=()=>{t&&(r&&clearTimeout(r),r=null,t.forEach(u=>{u.unsubscribe?u.unsubscribe(s):u.removeEventListener("abort",s)}),t=null)};t.forEach(u=>u.addEventListener("abort",s));const{signal:d}=i;return d.unsubscribe=()=>l.asap(a),d}},$n=function*(t,e){let n=t.byteLength;if(n<e){yield t;return}let i=0,o;for(;i<n;)o=i+e,yield t.slice(i,o),i=o},Vn=async function*(t,e){for await(const n of jn(t))yield*$n(n,e)},jn=async function*(t){if(t[Symbol.asyncIterator]){yield*t;return}const e=t.getReader();try{for(;;){const{done:n,value:i}=await e.read();if(n)break;yield i}}finally{await e.cancel()}},st=(t,e,n,i)=>{const o=Vn(t,e);let s=0,r,a=d=>{r||(r=!0,i&&i(d))};return new ReadableStream({async pull(d){try{const{done:u,value:c}=await o.next();if(u){a(),d.close();return}let f=c.byteLength;if(n){let b=s+=f;n(b)}d.enqueue(new Uint8Array(c))}catch(u){throw a(u),u}},cancel(d){return a(d),o.return()}},{highWaterMark:2})},fe=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",rt=fe&&typeof ReadableStream=="function",qn=fe&&(typeof TextEncoder=="function"?(t=>e=>t.encode(e))(new TextEncoder):async t=>new Uint8Array(await new Response(t).arrayBuffer())),at=(t,...e)=>{try{return!!t(...e)}catch{return!1}},Hn=rt&&at(()=>{let t=!1;const e=new Request(U.origin,{body:new ReadableStream,method:"POST",get duplex(){return t=!0,"half"}}).headers.has("Content-Type");return t&&!e}),lt=64*1024,Re=rt&&at(()=>l.isReadableStream(new Response("").body)),he={stream:Re&&(t=>t.body)};fe&&(t=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!he[e]&&(he[e]=l.isFunction(t[e])?n=>n[e]():(n,i)=>{throw new g(`Response type '${e}' is not supported`,g.ERR_NOT_SUPPORT,i)})})})(new Response);const zn=async t=>{if(t==null)return 0;if(l.isBlob(t))return t.size;if(l.isSpecCompliantForm(t))return(await new Request(U.origin,{method:"POST",body:t}).arrayBuffer()).byteLength;if(l.isArrayBufferView(t)||l.isArrayBuffer(t))return t.byteLength;if(l.isURLSearchParams(t)&&(t=t+""),l.isString(t))return(await qn(t)).byteLength},Wn=async(t,e)=>{const n=l.toFiniteNumber(t.getContentLength());return n??zn(e)},Oe={http:hn,xhr:kn,fetch:fe&&(async t=>{let{url:e,method:n,data:i,signal:o,cancelToken:s,timeout:r,onDownloadProgress:a,onUploadProgress:d,responseType:u,headers:c,withCredentials:f="same-origin",fetchOptions:b}=ot(t);u=u?(u+"").toLowerCase():"text";let w=Fn([o,s&&s.toAbortSignal()],r),h;const m=w&&w.unsubscribe&&(()=>{w.unsubscribe()});let p;try{if(d&&Hn&&n!=="get"&&n!=="head"&&(p=await Wn(c,i))!==0){let C=new Request(e,{method:"POST",body:i,duplex:"half"}),_;if(l.isFormData(i)&&(_=C.headers.get("content-type"))&&c.setContentType(_),C.body){const[A,y]=et(p,de(tt(d)));i=st(C.body,lt,A,y)}}l.isString(f)||(f=f?"include":"omit");const x="credentials"in Request.prototype;h=new Request(e,{...b,signal:w,method:n.toUpperCase(),headers:c.normalize().toJSON(),body:i,duplex:"half",credentials:x?f:void 0});let E=await fetch(h,b);const S=Re&&(u==="stream"||u==="response");if(Re&&(a||S&&m)){const C={};["status","statusText","headers"].forEach(D=>{C[D]=E[D]});const _=l.toFiniteNumber(E.headers.get("content-length")),[A,y]=a&&et(_,de(tt(a),!0))||[];E=new Response(st(E.body,lt,A,()=>{y&&y(),m&&m()}),C)}u=u||"text";let O=await he[l.findKey(he,u)||"text"](E,t);return!S&&m&&m(),await new Promise((C,_)=>{Qe(C,_,{data:O,headers:M.from(E.headers),status:E.status,statusText:E.statusText,config:t,request:h})})}catch(x){throw m&&m(),x&&x.name==="TypeError"&&/Load failed|fetch/i.test(x.message)?Object.assign(new g("Network Error",g.ERR_NETWORK,t,h),{cause:x.cause||x}):g.from(x,x&&x.code,t,h)}})};l.forEach(Oe,(t,e)=>{if(t){try{Object.defineProperty(t,"name",{value:e})}catch{}Object.defineProperty(t,"adapterName",{value:e})}});const ct=t=>`- ${t}`,Jn=t=>l.isFunction(t)||t===null||t===!1,ut={getAdapter:t=>{t=l.isArray(t)?t:[t];const{length:e}=t;let n,i;const o={};for(let s=0;s<e;s++){n=t[s];let r;if(i=n,!Jn(n)&&(i=Oe[(r=String(n)).toLowerCase()],i===void 0))throw new g(`Unknown adapter '${r}'`);if(i)break;o[r||"#"+s]=i}if(!i){const s=Object.entries(o).map(([a,d])=>`adapter ${a} `+(d===!1?"is not supported by the environment":"is not available in the build"));let r=e?s.length>1?`since :
`+s.map(ct).join(`
`):" "+ct(s[0]):"as no adapter specified";throw new g("There is no suitable adapter to dispatch the request "+r,"ERR_NOT_SUPPORT")}return i},adapters:Oe};function _e(t){if(t.cancelToken&&t.cancelToken.throwIfRequested(),t.signal&&t.signal.aborted)throw new X(null,t)}function dt(t){return _e(t),t.headers=M.from(t.headers),t.data=Te.call(t,t.transformRequest),["post","put","patch"].indexOf(t.method)!==-1&&t.headers.setContentType("application/x-www-form-urlencoded",!1),ut.getAdapter(t.adapter||te.adapter)(t).then(function(i){return _e(t),i.data=Te.call(t,t.transformResponse,i),i.headers=M.from(i.headers),i},function(i){return Ze(i)||(_e(t),i&&i.response&&(i.response.data=Te.call(t,t.transformResponse,i.response),i.response.headers=M.from(i.response.headers))),Promise.reject(i)})}const ft="1.10.0",pe={};["object","boolean","number","function","string","symbol"].forEach((t,e)=>{pe[t]=function(i){return typeof i===t||"a"+(e<1?"n ":" ")+t}});const ht={};pe.transitional=function(e,n,i){function o(s,r){return"[Axios v"+ft+"] Transitional option '"+s+"'"+r+(i?". "+i:"")}return(s,r,a)=>{if(e===!1)throw new g(o(r," has been removed"+(n?" in "+n:"")),g.ERR_DEPRECATED);return n&&!ht[r]&&(ht[r]=!0,console.warn(o(r," has been deprecated since v"+n+" and will be removed in the near future"))),e?e(s,r,a):!0}},pe.spelling=function(e){return(n,i)=>(console.warn(`${i} is likely a misspelling of ${e}`),!0)};function Kn(t,e,n){if(typeof t!="object")throw new g("options must be an object",g.ERR_BAD_OPTION_VALUE);const i=Object.keys(t);let o=i.length;for(;o-- >0;){const s=i[o],r=e[s];if(r){const a=t[s],d=a===void 0||r(a,s,t);if(d!==!0)throw new g("option "+s+" must be "+d,g.ERR_BAD_OPTION_VALUE);continue}if(n!==!0)throw new g("Unknown option "+s,g.ERR_BAD_OPTION)}}const me={assertOptions:Kn,validators:pe},$=me.validators;let J=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Ke,response:new Ke}}async request(e,n){try{return await this._request(e,n)}catch(i){if(i instanceof Error){let o={};Error.captureStackTrace?Error.captureStackTrace(o):o=new Error;const s=o.stack?o.stack.replace(/^.+\n/,""):"";try{i.stack?s&&!String(i.stack).endsWith(s.replace(/^.+\n.+\n/,""))&&(i.stack+=`
`+s):i.stack=s}catch{}}throw i}}_request(e,n){typeof e=="string"?(n=n||{},n.url=e):n=e||{},n=W(this.defaults,n);const{transitional:i,paramsSerializer:o,headers:s}=n;i!==void 0&&me.assertOptions(i,{silentJSONParsing:$.transitional($.boolean),forcedJSONParsing:$.transitional($.boolean),clarifyTimeoutError:$.transitional($.boolean)},!1),o!=null&&(l.isFunction(o)?n.paramsSerializer={serialize:o}:me.assertOptions(o,{encode:$.function,serialize:$.function},!0)),n.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?n.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:n.allowAbsoluteUrls=!0),me.assertOptions(n,{baseUrl:$.spelling("baseURL"),withXsrfToken:$.spelling("withXSRFToken")},!0),n.method=(n.method||this.defaults.method||"get").toLowerCase();let r=s&&l.merge(s.common,s[n.method]);s&&l.forEach(["delete","get","head","post","put","patch","common"],h=>{delete s[h]}),n.headers=M.concat(r,s);const a=[];let d=!0;this.interceptors.request.forEach(function(m){typeof m.runWhen=="function"&&m.runWhen(n)===!1||(d=d&&m.synchronous,a.unshift(m.fulfilled,m.rejected))});const u=[];this.interceptors.response.forEach(function(m){u.push(m.fulfilled,m.rejected)});let c,f=0,b;if(!d){const h=[dt.bind(this),void 0];for(h.unshift.apply(h,a),h.push.apply(h,u),b=h.length,c=Promise.resolve(n);f<b;)c=c.then(h[f++],h[f++]);return c}b=a.length;let w=n;for(f=0;f<b;){const h=a[f++],m=a[f++];try{w=h(w)}catch(p){m.call(this,p);break}}try{c=dt.call(this,w)}catch(h){return Promise.reject(h)}for(f=0,b=u.length;f<b;)c=c.then(u[f++],u[f++]);return c}getUri(e){e=W(this.defaults,e);const n=nt(e.baseURL,e.url,e.allowAbsoluteUrls);return Je(n,e.params,e.paramsSerializer)}};l.forEach(["delete","get","head","options"],function(e){J.prototype[e]=function(n,i){return this.request(W(i||{},{method:e,url:n,data:(i||{}).data}))}}),l.forEach(["post","put","patch"],function(e){function n(i){return function(s,r,a){return this.request(W(a||{},{method:e,headers:i?{"Content-Type":"multipart/form-data"}:{},url:s,data:r}))}}J.prototype[e]=n(),J.prototype[e+"Form"]=n(!0)});let Yn=class bt{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let n;this.promise=new Promise(function(s){n=s});const i=this;this.promise.then(o=>{if(!i._listeners)return;let s=i._listeners.length;for(;s-- >0;)i._listeners[s](o);i._listeners=null}),this.promise.then=o=>{let s;const r=new Promise(a=>{i.subscribe(a),s=a}).then(o);return r.cancel=function(){i.unsubscribe(s)},r},e(function(s,r,a){i.reason||(i.reason=new X(s,r,a),n(i.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const n=this._listeners.indexOf(e);n!==-1&&this._listeners.splice(n,1)}toAbortSignal(){const e=new AbortController,n=i=>{e.abort(i)};return this.subscribe(n),e.signal.unsubscribe=()=>this.unsubscribe(n),e.signal}static source(){let e;return{token:new bt(function(o){e=o}),cancel:e}}};function Gn(t){return function(n){return t.apply(null,n)}}function Xn(t){return l.isObject(t)&&t.isAxiosError===!0}const Ue={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(Ue).forEach(([t,e])=>{Ue[e]=t});function pt(t){const e=new J(t),n=ve(J.prototype.request,e);return l.extend(n,J.prototype,e,{allOwnKeys:!0}),l.extend(n,e,null,{allOwnKeys:!0}),n.create=function(o){return pt(W(t,o))},n}const T=pt(te);T.Axios=J,T.CanceledError=X,T.CancelToken=Yn,T.isCancel=Ze,T.VERSION=ft,T.toFormData=ce,T.AxiosError=g,T.Cancel=T.CanceledError,T.all=function(e){return Promise.all(e)},T.spread=Gn,T.isAxiosError=Xn,T.mergeConfig=W,T.AxiosHeaders=M,T.formToJSON=t=>Ge(l.isHTMLForm(t)?new FormData(t):t),T.getAdapter=ut.getAdapter,T.HttpStatusCode=Ue,T.default=T;const{Axios:bi,AxiosError:wi,CanceledError:yi,isCancel:xi,CancelToken:Ei,VERSION:Si,all:Ci,Cancel:Ti,isAxiosError:Ri,spread:Oi,toFormData:_i,AxiosHeaders:Ui,HttpStatusCode:Ai,formToJSON:Ii,getAdapter:Pi,mergeConfig:vi}=T;function Zn(t){return{all:t=t||new Map,on:function(e,n){var i=t.get(e);i?i.push(n):t.set(e,[n])},off:function(e,n){var i=t.get(e);i&&(n?i.splice(i.indexOf(n)>>>0,1):t.set(e,[]))},emit:function(e,n){var i=t.get(e);i&&i.slice().map(function(o){o(n)}),(i=t.get("*"))&&i.slice().map(function(o){o(e,n)})}}}const Z=Zn();let ge="";function Ae(){return ge||"https://api.weiyuai.cn"}function Qn(t){return t&&t.trim()!==""?(ge=t,console.log("API URL已设置为:",ge)):console.warn("尝试设置无效的API URL"),ge}const K=T.create({timeout:2e4,baseURL:Ae()});K.interceptors.request.use(t=>{t.baseURL=Ae();const e=localStorage.getItem(wt);return e&&e.length>10&&t.url&&t.url.startsWith("/api")&&(t.headers.Authorization=`Bearer ${e}`),!e&&t.url&&t.url.startsWith("/api")?Promise.reject(ei):t},t=>(console.log("request error",t),t.response.status===403&&Z.emit(F,"403"),t.response.status===401&&Z.emit(F,"401"),Promise.reject(t))),K.interceptors.response.use(t=>t,t=>{if(console.log("response error",t),t.response)switch(t.response.status){case 400:console.log("axios interception error 400"),Z.emit(F,"400");break;case 401:console.log("axios interception error 401"),Z.emit(F,"401");break;case 403:console.log("axios interception error 403"),Z.emit(F,"403");break;case 500:console.log("axios interception error 500"),Z.emit(N,"500");break}return"return axios interception error"});const Ie={data:null,status:601,statusText:L,headers:{},config:{headers:{}},request:null},ei={message:"匿名用户，无需访问服务器接口",name:L,code:"601",config:Ie.config,request:Ie.request,response:Ie,isAxiosError:!0,toJSON:function(){return{message:this.message,name:this.name,code:this.code,config:this.config,request:this.request,response:this.response}}},ti=Object.freeze(Object.defineProperty({__proto__:null,default:K,getApiUrl:Ae,setApiUrl:Qn},Symbol.toStringTag,{value:"Module"}));async function ni(t){return K("/visitor/api/v1/init",{method:"POST",data:{...t,client:ie}})}async function ii(t){return K("/visitor/api/v1/browse",{method:"POST",data:{...t,client:ie}})}const mt=Object.freeze(Object.defineProperty({__proto__:null,browse:ii,initVisitor:ni},Symbol.toStringTag,{value:"Module"}));async function oi(t){return K("/visitor/api/v1/message/unread/count",{method:"GET",params:{...t,client:ie}})}async function si(t){return K("/visitor/api/v1/message/unread/clear",{method:"POST",data:{...t,client:ie}})}const gt=Object.freeze(Object.defineProperty({__proto__:null,clearUnreadMessages:si,getUnreadMessageCount:oi},Symbol.toStringTag,{value:"Module"}));return _t});
