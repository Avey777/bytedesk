import{getApiUrl as m}from"./index-C3nupFff.js";import"./index-DKwo37b6.js";async function f(t,l,o,a){try{const i=new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14),s=l||`${i}_${t.name}`,d=o||t.type||"image/jpeg",e=new FormData;e.append("file",t),e.append("fileName",s),e.append("fileType",d),e.append("isAvatar",(a==null?void 0:a.isAvatar)||"false"),e.append("kbType",(a==null?void 0:a.kbType)||"feedback");const p=(a==null?void 0:a.visitorUid)||localStorage.getItem("bytedesk_uid")||localStorage.getItem("bytedesk_visitor_uid")||"",c=(a==null?void 0:a.visitorNickname)||localStorage.getItem("bytedesk_nickname")||"",g=(a==null?void 0:a.visitorAvatar)||localStorage.getItem("bytedesk_avatar")||"",u=(a==null?void 0:a.orgUid)||"";e.append("visitorUid",p),e.append("visitorNickname",c),e.append("visitorAvatar",g),e.append("orgUid",u),e.append("client",(a==null?void 0:a.client)||"web"),a!=null&&a.isDebug&&console.log("handleUpload formData",e);const v=`${m()}/visitor/api/upload/file`,n=await fetch(v,{method:"POST",headers:{},body:e});if(!n.ok)throw new Error(`上传失败: ${n.status} ${n.statusText}`);const r=await n.json();return a!=null&&a.isDebug&&console.log("upload data:",r),r}catch(i){throw console.error("文件上传失败:",i),i}}async function b(t,l){var o;const a=`screenshot_${new Date().toISOString().replace(/[-:T.]/g,"").slice(0,14)}.jpg`;return((o=(await f(t,a,"image/jpeg",{...l,kbType:"feedback"})).data)==null?void 0:o.fileUrl)||""}export{f as handleUpload,b as uploadScreenshot};
