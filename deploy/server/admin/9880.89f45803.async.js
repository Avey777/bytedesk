"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9880],{69880:function(e,t,a){a.d(t,{Z:function(){return _}});var s=a(84176),o=a.n(s),r=a(73193),n=a.n(r),i=a(86222),d=a.n(i),l=a(90819),c=a.n(l),u=a(89933),g=a.n(u),p=a(45332),m=a.n(p),f=a(55567),h=a(28619),x=a(9942),M=a(18232),w=a(81343),k=a(54881),b=a(11090),j=a(2484),v=a(46336),y=a(43906),T=a(68060),S=a(34353),F=a(86675),I=a(41313),A=a(30915),Z=a(39686),E=a(41994),C=a(44194);function R(e){return D.apply(this,arguments)}function D(){return(D=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.request)("/api/v1/robot/message/query/org",{method:"GET",params:n()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var P=a(10266),N=a(31549),U=["current","pageSize"],q={RATE_PENDING:{text:"待评价",color:"default"},RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},_=function(e){var t=e.isSuperUser,a=(0,y.useIntl)(),s=(0,C.useRef)(),r=(0,h.Z)().translateString,i=(0,x.u)((function(e){return e.currentOrg})),l=(0,C.useState)(1),u=m()(l,2),p=u[0],D=u[1],_=(0,C.useState)(10),z=m()(_,2),L=z[0],B=z[1],O=(0,C.useState)([]),G=m()(O,2),K=G[0],W=G[1],H=(0,C.useState)([]),Q=m()(H,2),V=Q[0],J=Q[1],Y=(0,C.useState)(0),X=m()(Y,2),$=X[0],ee=X[1],te=(0,C.useState)({}),ae=m()(te,2),se=ae[0],oe=ae[1],re=(0,C.useState)(!1),ne=m()(re,2),ie=ne[0],de=ne[1],le=(0,C.useState)(""),ce=m()(le,2),ue=ce[0],ge=ce[1],pe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,N.jsx)(y.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,N.jsx)(y.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:200,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.userNickname.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:r(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,N.jsx)(y.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.robotNickname.tooltip"}),render:function(e,t){var a;return(0,N.jsx)(N.Fragment,{children:r(null==t||null===(a=t.robot)||void 0===a?void 0:a.nickname)})}},{title:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.prompt",defaultMessage:"Prompt"}),dataIndex:"prompt",hideInSearch:!0,width:250,ellipsis:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.prompt.tooltip"}),render:function(e,t){var s=t.prompt;return s?s.length>50?(0,N.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return fe(s)},children:[(0,N.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[s.substring(0,50),"..."]}),(0,N.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),fe(s)},children:a.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,N.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:s}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0,copyable:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.question.tooltip"})},{title:(0,N.jsx)(y.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.answer.tooltip"})},{title:(0,N.jsx)(y.FormattedMessage,{id:"message.status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.status.tooltip"}),render:function(e,t){return(0,P.ng)(null==t?void 0:t.status)}},{title:(0,N.jsx)(y.FormattedMessage,{id:"message.channel",defaultMessage:"Channel"}),dataIndex:"channel",width:100,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.channel.tooltip"}),render:function(e,t){return(0,P.YG)(t.channel)}},{title:(0,N.jsx)(y.FormattedMessage,{id:"ai.unanswered",defaultMessage:"未回答"}),dataIndex:"isUnAnswered",width:120,hideInSearch:!0,valueType:"select",valueEnum:{true:{text:"未回答",status:"Error"},false:{text:"已回答",status:"Success"}},tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.isUnAnswered.tooltip"}),render:function(e,t){var a=t.isUnAnswered;return null==a?"-":(0,N.jsx)(F.Z,{status:a?"error":"success",text:a?"未回答":"已回答"})}},{title:(0,N.jsx)(y.FormattedMessage,{id:"ai.tokens.prompt",defaultMessage:"Prompt Tokens"}),dataIndex:"promptTokens",width:160,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.promptTokens.tooltip"}),render:function(e,t){var a=t.promptTokens;return a?(0,N.jsx)(I.Z,{color:"blue",children:a}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"ai.tokens.completion",defaultMessage:"Completion Tokens"}),dataIndex:"completionTokens",width:160,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.completionTokens.tooltip"}),render:function(e,t){var a=t.completionTokens;return a?(0,N.jsx)(I.Z,{color:"green",children:a}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"ai.tokens.total",defaultMessage:"Total Tokens"}),dataIndex:"totalTokens",width:140,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.totalTokens.tooltip"}),render:function(e,t){var a=t.totalTokens;return a?(0,N.jsx)(I.Z,{color:"orange",children:a}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"ai.provider",defaultMessage:"AI Provider"}),dataIndex:"aiProvider",width:120,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.aiProvider.tooltip"}),render:function(e,t){var a=t.aiProvider;return a?(0,N.jsx)(I.Z,{color:"purple",children:a}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"ai.model",defaultMessage:"AI Model"}),dataIndex:"aiModel",width:120,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.aiModel.tooltip"}),render:function(e,t){var a=t.aiModel;return a?(0,N.jsx)(I.Z,{color:"cyan",children:a}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,valueType:"select",valueEnum:{RATE_PENDING:{text:"待评价",status:"Default"},RATE_UP:{text:"点赞",status:"Success"},RATE_DOWN:{text:"点踩",status:"Error"},RATE_FEEDBACK:{text:"反馈意见",status:"Warning"},RATE_TRANSFER:{text:"转人工",status:"Processing"}},tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=q[a]||{text:a,color:"default"};return(0,N.jsx)(I.Z,{color:s.color,children:s.text||a})}},{title:(0,N.jsx)(y.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.rateDownTags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,N.jsx)(N.Fragment,{children:t.rateDownTagList.map((function(e){return(0,N.jsx)(I.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,N.jsx)(y.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.rateDownReason.tooltip"})},{title:(0,N.jsx)(y.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,N.jsx)(y.FormattedMessage,{id:"robot.message.createdAt.tooltip"})},{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,o){return[(0,N.jsx)("a",{onClick:function(){me(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,N.jsx)(A.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return he(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,N.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],me=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==i?void 0:i.uid,t:M.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},fe=function(e){ge(e),de(!0)},he=function(){var e=g()(c()().mark((function e(t){var o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),f.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{f.yw.destroy(),f.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(o=s.current)||void 0===o||o.reload()}catch(e){f.yw.destroy(),f.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=g()(c()().mark((function e(){var t,o,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==V.length){e.next=3;break}return f.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:f.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,o=0,r=d()(V);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}f.yw.destroy(),0===o?f.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):f.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:o})),W([]),J([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=g()(c()().mark((function e(t,a,s){var o,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),o=localStorage.getItem(M.LA8),r=n()({orgUid:(null==i?void 0:i.uid)||"",accessToken:o||"",exportType:t},se),"current"===t?(r.pageNumber=String(p-1),r.pageSize=String(L)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,w.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams(r).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),we=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),o=function(){var s=r,o=r*a+1,n=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(o,"-").concat(n," (").concat(n-o+1,"条)"),onClick:function(){return Me("range",s,a)}})},r=0;r<s;r++)o();return t},ke={selectedRowKeys:K,onChange:function(e,t){W(e),J(t)}};return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(v.Z,{columns:pe,actionRef:s,cardBordered:!0,rowSelection:ke,scroll:{x:3e3},request:function(){var e=g()(c()().mark((function e(a,s,r){var n,d,l,u,g,p,m,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",a,s,r),n=a.current,d=a.pageSize,l=o()(a,U),D(n),B(d),oe(l),u=void 0,g=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],u=p,g="ascend"===s[p]?"ascend":"descend"),m={pageNumber:n-1,pageSize:d,orgUid:null==i?void 0:i.uid,isSuperUser:t,topic:l.topic,threadUid:l.threadUid,userNickname:l.userNickname,robotNickname:l.robotNickname,status:l.status,answer:l.answer,user:l.user,robot:l.robot,isUnAnswered:l.isUnAnswered,promptTokens:l.promptTokens,completionTokens:l.completionTokens,totalTokens:l.totalTokens,aiProvider:l.aiProvider,aiModel:l.aiModel,threads:l.threads,componentType:l.componentType,sortBy:u,sortDirection:g},e.next=11,R(m);case 11:return h=e.sent,console.log("getAllRobotMessages response:",m,h),200===h.code?ee(h.data.totalElements):f.yw.error(h.message),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"机器人消息",toolBarRender:function(){return function(){var e=[],t=[];K.length>0&&t.push({key:"batchDelete",icon:(0,N.jsx)(k.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(K.length,")"),onClick:function(){Z.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(K.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:xe,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Me("current")}}];return $>0&&($<=1e3?s.push({key:"export-all",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat($,"条)"),onClick:function(){return Me("all")}}):s.push({key:"export-range",icon:(0,N.jsx)(b.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat($,"条)"),children:we($)})),e.push((0,N.jsx)(E.Z,{menu:{items:s},placement:"bottom",children:(0,N.jsxs)(S.ZP,{icon:(0,N.jsx)(b.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,N.jsx)(j.Z,{})]},"button")},"export")),t.length>0&&e.push((0,N.jsx)(E.Z,{menu:{items:t},placement:"bottom",children:(0,N.jsxs)(S.ZP,{type:K.length>0?"primary":"default",danger:K.length>0,children:[K.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(K.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,N.jsx)(j.Z,{})]})},"batchOperations")),e}()}}),(0,N.jsx)(Z.Z,{title:a.formatMessage({id:"prompt.detail",defaultMessage:"Prompt Details"}),open:ie,onCancel:function(){return de(!1)},footer:[(0,N.jsx)(S.ZP,{onClick:function(){navigator.clipboard.writeText(ue),f.yw.success(a.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"}))},children:a.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,N.jsx)(S.ZP,{onClick:function(){return de(!1)},children:a.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,N.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,N.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:"#f5f5f5",padding:"12px",borderRadius:"4px",border:"1px solid #d9d9d9"},children:ue})})})]})}}}]);