"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1730],{86985:function(e,t,a){a.d(t,{Z:function(){return M}});var r=a(90819),s=a.n(r),n=a(89933),o=a.n(n),i=a(45332),c=a.n(i),u=a(5025),l=a(5488),d=a(14870);function g(){return p.apply(this,arguments)}function p(){return(p=o()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t){return h.apply(this,arguments)}function h(){return(h=o()(s()().mark((function e(t,a){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:t,captchaCode:a,channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=a(58087),x=a(27259),v=a(44194),w=a(31549),M=function(e){var t=e.onKaptchaChange,a=e.onKaptchaCheck,r=(0,d.useIntl)(),n=(0,v.useState)(),i=c()(n,2),l=i[0],p=i[1],h=(0,v.useState)(),M=c()(h,2),y=M[0],k=M[1],j=(0,v.useState)(!1),b=c()(j,2),C=b[0],Z=b[1],S=function(){var e=o()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!C){e.next=2;break}return e.abrupt("return");case 2:return Z(!0),e.prev=3,e.next=6,g();case 6:200===(t=e.sent).code?(p(t.data.captchaUid),k(t.data.captchaImage)):u.yw.error(r.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"})),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),u.yw.error(r.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 13:return e.prev=13,Z(!1),e.finish(13);case 16:case"end":return e.stop()}}),e,null,[[3,10,13,16]])})));return function(){return e.apply(this,arguments)}}(),q=function(){var e=o()(s()().mark((function e(t,r){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,r);case 2:n=e.sent,console.log("checkCaptcha response",n),200===n.code?a&&a(!0):a&&a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){S()}),[]);return(0,w.jsx)(w.Fragment,{children:y&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.Z,{onChange:function(e){t&&(t(l,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?q(l,e.target.value):a&&a(!1))},prefix:(0,w.jsx)(m.Z,{}),placeholder:r.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,w.jsx)("img",{src:y,alt:"captcha",onClick:S})]})})}},92540:function(e,t,a){a.r(t);var r=a(73193),s=a.n(r),n=a(90819),o=a.n(n),i=a(89933),c=a.n(i),u=a(45332),l=a.n(u),d=a(16843),g=a(51925),p=a(10022),f=a(26978),h=a(40795),m=a(32394),x=a(76527),v=a(55757),w=a(48821),M=a(71017),y=a(4610),k=a(14870),j=a(12667),b=a(93892),C=a(62399),Z=a(5780),S=a(54436),q=a(82908),T=a(44194),A=a(24522),F=a(5025),z=a(5488),P=a(92729),I=a(56321),L=a(90033),R=a(33363),U=a(86985),B=a(18580),N=a(95660),E=a(31549),K=j.Z.defaultAlgorithm,V=j.Z.darkAlgorithm,$=function(){var e=(0,y.l)((function(e){var t=e.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:t.borderRadius,":hover":{backgroundColor:t.colorBgTextHover}}}));return(0,E.jsx)("div",{className:e,"data-lang":!0,children:k.SelectLang&&(0,E.jsx)(k.SelectLang,{})})},_=function(e){var t=e.content;return(0,E.jsx)(b.Z,{style:{marginBottom:24},message:t,type:"error",showIcon:!0})},D=function(){var e=m.A.useForm(),t=l()(e,1)[0],a=j.Z.useToken().token,r=(0,A.Z)().isDarkMode,n=(0,T.useRef)(),i=(0,T.useState)(!1),u=l()(i,2),y=u[0],b=u[1],S=(0,k.useModel)("@@initialState"),q=(S.initialState,S.loading,S.refresh,S.setInitialState),K=(0,T.useState)(!1),V=l()(K,2),D=V[0],G=V[1],H=(0,P.t)((function(e){return e.setAccessToken})),J=(0,L.L)((function(e){return e.setUserInfo})),W=(0,k.getLocale)();console.log("register page locale:",W);var X=(0,k.useIntl)(),Y=(0,T.useState)(""),O=l()(Y,2),Q=O[0],ee=O[1],te=(0,T.useState)(""),ae=l()(te,2),re=ae[0],se=ae[1],ne=function(){var e=c()(o()().mark((function e(a,r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ee(a),se(r),t.setFieldValue("captchaCode",r);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),oe=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,T.useEffect)((function(){(0,B.ME)(),(0,R.Bc)()&&G(!0),(0,R.pr)()}),[]);var ie=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(0,I.flushSync)((function(){q((function(e){return s()(s()({},e),{},{userInfo:t})}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=c()(o()().mark((function e(t){var a,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("values:",t),F.yw.loading(X.formatMessage({id:"registering",defaultMessage:"registering..."})),e.next=5,(0,d.z2)(s()({},t));case 5:if(a=e.sent,console.log("registerResult:",a),200!==a.code){e.next=15;break}return F.yw.destroy(),F.yw.success(a.message),r={username:t.email,password:t.password,captchaUid:Q,captchaCode:t.captchaCode,platform:z.iw8},ue(r),e.abrupt("return");case 15:F.yw.destroy(),F.yw.error(a.message);case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.log(e.t0),F.yw.error(X.formatMessage({id:"register.error",defaultMessage:"register failed"}));case 23:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),ue=function(){var e=c()(o()().mark((function e(t){var a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("handleSubmit values: ",t),F.yw.loading(X.formatMessage({id:"logging",defaultMessage:"logging..."})),e.next=5,(0,d.x4)(s()({},t));case 5:a=e.sent,console.log("LoginResult:",a),200===a.code?(F.yw.destroy(),F.yw.success(X.formatMessage({id:"login.success",defaultMessage:"login success"})),ie(a.data.user),J(a.data.user),H(a.data.accessToken),k.history.push("/")):(F.yw.destroy(),F.yw.error(a.message)),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),F.yw.error(X.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();return(0,E.jsxs)(x._Y,{hashed:!1,dark:r,children:[(0,E.jsx)($,{}),(0,E.jsx)("div",{style:{backgroundColor:a.colorBgContainer,textAlign:"center",height:"100vh",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:D?(0,E.jsxs)(v.U,{form:t,contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,E.jsx)("img",{alt:"logo",src:"/admin/logo.png"}),title:(0,E.jsx)(k.FormattedMessage,{id:"app.title"}),subTitle:X.formatMessage({id:"pages.login.registerAccount"}),initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:X.formatMessage({id:"pages.login.register"})}},onFinish:function(){var e=c()(o()().mark((function e(t){var a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return N.Z.debug("login values:",t),a={email:t.username,password:t.password,mobile:t.mobile,code:t.code,captchaUid:Q,captchaCode:t.captchaCode,platform:z.iw8},console.log("register info:",a),e.next=5,ce(a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:["error"===status&&(0,E.jsx)(_,{content:X.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"账户或密码错误"})}),(0,E.jsx)(w.Z,{name:"username",fieldProps:{size:"large",prefix:(0,E.jsx)(p.Z,{})},placeholder:X.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,E.jsx)(k.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"请输入邮箱!"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,E.jsx)(w.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,E.jsx)(f.Z,{})},placeholder:X.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"密码"}),rules:[{required:!0,message:(0,E.jsx)(k.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"请输入密码！"})}]}),(0,E.jsx)(w.Z,{fieldProps:{size:"large",prefix:(0,E.jsx)(h.Z,{})},name:"mobile",placeholder:X.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,E.jsx)(k.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,E.jsx)(k.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,E.jsx)(m.A.Item,{name:"captchaCode",rules:[{required:!0,message:X.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,E.jsx)(U.Z,{onKaptchaChange:ne,onKaptchaCheck:oe})}),(0,E.jsx)(M.Z,{fieldProps:{size:"large",prefix:(0,E.jsx)(f.Z,{})},captchaProps:{size:"large",disabled:!y},placeholder:X.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,t){return e?"".concat(t," ").concat(X.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):X.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,E.jsx)(k.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:n,onGetCaptcha:function(){var e=c()(o()().mark((function e(t){var a,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||11!==t.length){e.next=13;break}return a={mobile:t,type:z.zgb,captchaUid:Q,captchaCode:re,platform:z.iw8},e.next=4,(0,d.Y7)(a);case 4:if(r=e.sent,console.log("sendMobileCodeResult:",r),200===r.code){e.next=10;break}return F.yw.error(r.message),setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=n.current)||void 0===e||e.endTiming()}),2),e.abrupt("return");case 10:F.yw.success(r.message),e.next=14;break;case 13:F.yw.error("手机号格式错误");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),"error"===status&&(0,E.jsx)(_,{content:"验证码错误"}),(0,E.jsx)("div",{style:{marginBottom:64},children:(0,E.jsx)("div",{style:{float:"right"},children:(0,E.jsx)(k.Link,{to:"/auth/login",children:(0,E.jsx)(k.FormattedMessage,{id:"pages.login.submit",defaultMessage:"登录 "})})})})]}):(0,E.jsx)("div",{style:{textAlign:"center",margin:"0 auto"},children:(0,E.jsx)(C.Z,{description:"only for vip users, please contact: 270580156@qq.com",children:(0,E.jsx)(Z.ZP,{type:"primary",onClick:function(){window.open("https://www.weiyuai.cn")},children:"open weiyuai.cn"})})})}),(0,E.jsx)(g.$_,{})]})};t.default=function(){var e=(0,A.Z)().isDarkMode;return(0,E.jsx)(S.ZP,{theme:{algorithm:e?V:K},children:(0,E.jsxs)(q.Z,{children:[(0,E.jsx)(F.ZP,{}),(0,E.jsx)(D,{})]})})}}}]);