"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[950],{41282:function(e,r,t){t.d(r,{Jr:function(){return f},LF:function(){return u},Oh:function(){return h},WS:function(){return g}});var n=t(90819),a=t.n(n),o=t(73193),i=t.n(o),l=t(89933),s=t.n(l),d=t(5488),c=t(14870);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},52202:function(e,r,t){t.d(r,{G9:function(){return b},J$:function(){return Z},N6:function(){return w},VM:function(){return u},c8:function(){return f},gF:function(){return h},rg:function(){return g},sF:function(){return y}});var n=t(90819),a=t.n(n),o=t(73193),i=t.n(o),l=t(89933),s=t.n(l),d=t(5488),c=t(14870);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return j.apply(this,arguments)}function j(){return(j=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return P.apply(this,arguments)}function P(){return(P=s()(a()().mark((function e(r){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:i()(i()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92023:function(e,r,t){t.d(r,{G:function(){return f}});var n=t(73193),a=t.n(n),o=(t(44194),t(15435)),i=t(5488),l=t(28977),s=t.n(l),d=t(95660),c=t(5025),u=t(18580),m=t(31549),f=function(e){var r=e.children,t=e.onSuccess,n=e.onError,l={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},f={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:l,showUploadList:!1,beforeUpload:function(e){d.Z.log("beforeUpload",e);var r=s()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return l.file=e,l.fileName=r,l.fileType=e.type,d.Z.log("beforeUpload",l),!0},onChange:function(e){if("uploading"!==e.file.status&&d.Z.log("not uploading:",e.file),"done"===e.file.status)if(d.Z.log("response: ",e.file.response),200===e.file.response.code){var r=e.file.response.data.fileUrl;t(r),c.yw.success("".concat(e.file.name," 上传成功"))}else n(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),n(e.file))}};return(0,m.jsx)(o.Z,a()(a()({},f),{},{children:r}))}},74424:function(e,r,t){var n=t(24522);r.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},2813:function(e,r,t){t.r(r),t.d(r,{default:function(){return Fe}});var n=t(44194),a=t(74424),o=t(93322),i=t(73193),l=t.n(i),s=t(90819),d=t.n(s),c=t(89933),u=t.n(c),m=t(45332),f=t.n(m),p=t(91221),g=t(5025),v=t(24522),h=t(18751),x=t(14870),y=t(68349),M=t(90317),w=t(5780),j=t(96501),b=t(45681),k=t(88344),Z=t(34599),P=t(5488),C=t(15722),S=t(10162),L=t(46747),D=t(32394),U=t(48821),z=t(16331),I=t(47783),T=t(11137),E=t(20903),N=t(68724),q=t(92023),F=t(59908),R=t(31549),O=function(e){var r=e.open,t=e.isEdit,a=e.llmProvider,o=e.level,i=e.onCancel,l=e.onSubmit,s=(0,x.useIntl)(),c=E.Z.useForm(),m=f()(c,1)[0],p=(0,Z.u)((function(e){return e.currentOrg})),v=(0,n.useState)(),h=f()(v,2),y=h[0],M=h[1],j=(0,n.useState)(""),k=f()(j,2),C=k[0],S=k[1],L=t&&["ollama","zhipuai","deepseek","dashscope","silicon","gitee","tencent","baidu","volcengine","minimax","xinghuo","moonshot","baichuan","yi","stepfun","openrouter","groq","anthropic","openai","gemini","aihubmix"].includes((null==a?void 0:a.name)||"");(0,n.useEffect)((function(){var e;t?(M(a),S((null==a?void 0:a.logo)||""),m.setFieldsValue({logo:null==a?void 0:a.logo,name:null==a?void 0:a.name,nickname:null==a?void 0:a.nickname,description:null==a?void 0:a.description,webUrl:null==a?void 0:a.webUrl,status:null==a?void 0:a.status,apiUrl:null==a?void 0:a.apiUrl,apiKey:null==a?void 0:a.apiKey,enabled:null===(e=null==a?void 0:a.enabled)||void 0===e||e})):(m.resetFields(),S(""),m.setFieldsValue({enabled:!0}))}),[t,a]);return(0,R.jsx)("div",{children:(0,R.jsx)(N.Z,{title:t?s.formatMessage({id:"ai.provider.edit"}):s.formatMessage({id:"ai.provider.create"}),open:r,onClose:i,width:500,extra:(0,R.jsx)(w.ZP,{type:"primary",onClick:function(){m.validateFields().then(function(){var e=u()(d()().mark((function e(r){var n,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={uid:t?null==a?void 0:a.uid:"",name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname,logo:C||(null==y?void 0:y.logo),description:null==r?void 0:r.description,webUrl:null==r?void 0:r.webUrl,status:(null==r?void 0:r.status)||P.L2A,apiUrl:null==r?void 0:r.apiUrl,apiKey:null==r?void 0:r.apiKey,enabled:null===(n=null==r?void 0:r.enabled)||void 0===n||n,level:o,orgUid:null==p?void 0:p.uid},console.log("handleSaveLlmProvider:",r,i),l(i);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),g.yw.error(t?s.formatMessage({id:"ai.provider.update.failed"}):s.formatMessage({id:"ai.provider.create.failed"}))}))},children:t?s.formatMessage({id:"ai.provider.update"}):s.formatMessage({id:"ai.provider.confirm"})}),children:(0,R.jsxs)(D.A,{form:m,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,R.jsx)(D.A.Item,{name:"logo",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:s.formatMessage({id:"ai.provider.logo"}),children:(0,R.jsxs)(q.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),S(e)},onError:function(e){console.log("handleUploadError:",e),g.yw.error(s.formatMessage({id:"ai.provider.upload.failed"}))},children:[(0,R.jsx)(b.Z,{src:C,size:64}),(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(F.Z,{}),style:{marginLeft:8},children:s.formatMessage({id:"ai.provider.uploadLogo"})})]})}),(0,R.jsx)(U.Z,{width:"md",name:"name",label:s.formatMessage({id:"ai.provider.uniqueId"}),placeholder:s.formatMessage({id:"ai.provider.uniqueId.placeholder"}),disabled:L,rules:[{required:!0,message:s.formatMessage({id:"ai.provider.uniqueId.required"})},{pattern:/^[a-zA-Z0-9]+$/,message:s.formatMessage({id:"ai.provider.uniqueId.pattern"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}},tooltip:L?s.formatMessage({id:"ai.provider.uniqueId.system.tooltip"}):void 0}),(0,R.jsx)(U.Z,{label:s.formatMessage({id:"ai.provider.nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"ai.provider.nickname.required"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,R.jsx)(z.Z,{label:s.formatMessage({id:"ai.provider.description"}),name:"description",fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,R.jsx)(U.Z,{label:s.formatMessage({id:"ai.provider.webUrl"}),name:"webUrl",placeholder:s.formatMessage({id:"ai.provider.webUrl.placeholder"}),rules:[{type:"url",message:s.formatMessage({id:"ai.provider.webUrl.invalid"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,R.jsx)(I.Z,{label:s.formatMessage({id:"ai.provider.status"}),name:"status",options:[{label:s.formatMessage({id:"ai.provider.status.development"}),value:P.L2A},{label:s.formatMessage({id:"ai.provider.status.production"}),value:P.KY}],rules:[{required:!0,message:s.formatMessage({id:"ai.provider.status.required"})}],fieldProps:{placeholder:s.formatMessage({id:"ai.provider.status.placeholder"})}}),(0,R.jsx)(U.Z,{label:s.formatMessage({id:"ai.provider.apiUrl"}),name:"apiUrl",placeholder:s.formatMessage({id:"ai.provider.apiUrl.placeholder"}),rules:[{required:!0,message:s.formatMessage({id:"ai.provider.apiUrl.required"})},{validator:function(e,r){return r&&r.endsWith("/")?Promise.reject(new Error(s.formatMessage({id:"ai.provider.apiUrl.noTrailingSlash"}))):Promise.resolve()}}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}},extra:s.formatMessage({id:"ai.provider.apiUrl.extra"})}),"ollama"!==(null==y?void 0:y.name)&&(0,R.jsx)(U.Z.Password,{label:s.formatMessage({id:"ai.provider.apiKey"}),name:"apiKey",fieldProps:{placeholder:s.formatMessage({id:"ai.provider.apiKey.placeholder"}),allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,R.jsx)(T.Z,{label:s.formatMessage({id:"ai.provider.enabled"}),name:"enabled",tooltip:s.formatMessage({id:"ai.provider.enabled.tooltip"}),checkedChildren:s.formatMessage({id:"ai.provider.enabled.checked"}),unCheckedChildren:s.formatMessage({id:"ai.provider.enabled.unchecked"})})]})})})},A=t(76711),K=t.n(A),J=t(16894),B=t(45034),V=t(47401),_=(0,J.Ue)()((0,B.mW)((0,B.tJ)((0,V.n)((function(e,r){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(r){e((function(e){e.llmproviderResultPlatform.data.content.unshift(r)}))},upgradeLlmProviderPlatform:function(r){e((function(e){var t=e.llmproviderResultPlatform.data.content,n=t.findIndex((function(e){return e.uid===r.uid}));-1!==n?t[n]=r:console.warn("LlmProvider with uid ".concat(r.uid," not found."))}))},setLlmProviderResultPlatform:function(t){e({llmproviderResultPlatform:t});var n,a=r().currentLlmProviderPlatform;""!==a.uid&&void 0!==a||(null===(n=t.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentLlmProviderPlatform:t.data.content[0]})},setCurrentLlmProviderPlatform:function(t){var n=r().llmproviderResultPlatform.data.content,a=n.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var o=[].concat(K()(n.slice(0,a)),[t],K()(n.slice(a+1))),i=l()(l()({},r().llmproviderResultPlatform),{},{data:{content:o}});e({llmproviderResultPlatform:i,currentLlmProviderPlatform:t})}else e({currentLlmProviderPlatform:t})},deleteCurrentLlmProviderPlatform:function(t){var n=r().llmproviderResultPlatform.data.content,a=n.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResultPlatform:l()(l()({},r().llmproviderResultPlatform),{},{data:{content:[].concat(K()(n.slice(0,a)),K()(n.slice(a+1)))}})}):console.warn("LlmProvider not found in cache:",t),r().currentLlmProviderPlatform.uid===t&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:P.dNm}))),G=["coze","dify","n8n","maxkb","ragflow"],H=function(e){var r,t,a=e.level,o=e.superUser,i=(0,v.Z)().isDarkMode,s=(0,x.useIntl)(),c=(0,h.Z)(),m=c.translateString,D=c.translateStringTranct,U=(0,Z.u)((function(e){return e.currentOrg})),z=(0,n.useState)(!1),I=f()(z,2),T=I[0],E=I[1],N=(0,n.useState)(!1),q=f()(N,2),F=q[0],A=q[1],K=(0,L.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}})),J=K.llmproviderResult,B=K.currentLlmProvider,V=K.setLlmProviderResult,H=K.insertLlmProvider,W=K.setCurrentLlmProvider,X=K.upgradeLlmProvider,Y=K.deleteCurrentLlmProvider,Q=_((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),$=Q.llmproviderResultPlatform,ee=Q.currentLlmProviderPlatform,re=Q.setLlmProviderResultPlatform,te=Q.insertLlmProviderPlatform,ne=Q.setCurrentLlmProviderPlatform,ae=Q.upgradeLlmProviderPlatform,oe=Q.deleteCurrentLlmProviderPlatform,ie=(0,n.useState)(a===P.Hxq),le=f()(ie,1)[0],se=le?ee:B,de=y.Z.useModal(),ce=f()(de,2),ue=ce[0],me=ce[1],fe=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),g.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,p.HH)(r);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(g.yw.destroy(),g.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),le?oe(r.uid):Y(r.uid)):(g.yw.destroy(),g.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),pe=function(){var e=u()(d()().mark((function e(){var r,t,n,o,i,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),r={pageNumber:0,pageSize:50,sortBy:"createdAt",sortDirection:"ascend",status:a===P.Hxq?"":P.KY,orgUid:a===P.Hxq?"":null==U?void 0:U.uid,level:a},e.next=4,(0,p.mK)(r);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t),200===t.code?le?(re(t),(null==t||null===(n=t.data)||void 0===n?void 0:n.content.length)>0&&ne(null==t||null===(o=t.data)||void 0===o?void 0:o.content[0])):(V(t),(null==t||null===(i=t.data)||void 0===i?void 0:i.content.length)>0&&W(null==t||null===(l=t.data)||void 0===l?void 0:l.content[0])):g.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){pe()}),[]);var ge=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",r),g.yw.loading(s.formatMessage({id:"creating"})),e.next=4,(0,p.T)(r);case 4:t=e.sent,console.log("createLlmProvider:",t),200===t.code?(g.yw.destroy(),g.yw.success(s.formatMessage({id:"create.success",defaultMessage:"create success"})),le?te(t.data):H(t.data),E(!1)):(g.yw.destroy(),g.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ve=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(s.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(g.yw.destroy(),g.yw.success(s.formatMessage({id:"update.success",defaultMessage:"update success"})),le?ae(t.data):X(t.data),E(!1)):(g.yw.destroy(),g.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)("div",{style:{margin:10},children:(0,R.jsxs)(M.Z,{gap:"small",align:"flex-start",children:[(0,R.jsx)(w.ZP,{size:"small",type:"primary",icon:(0,R.jsx)(S.Z,{}),onClick:function(){console.log("new llmProvider"),A(!1),E(!0)},children:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,R.jsx)(w.ZP,{size:"small",onClick:function(){console.log("edit llmProvider"),A(!0),E(!0)},disabled:""===(null==se?void 0:se.uid),children:s.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,R.jsx)(w.ZP,{onClick:function(){return function(e){ue.confirm({title:s.formatMessage({id:"deleteTip"}),icon:(0,R.jsx)(C.Z,{}),content:"".concat(s.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(m(e.nickname),"】？"),onOk:function(){fe(e)},onCancel:function(){},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}(se)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==se?void 0:se.uid),children:s.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,R.jsx)(j.Z,{itemLayout:"horizontal",dataSource:(le?(null==$||null===(r=$.data)||void 0===r?void 0:r.content)||[]:(null==J||null===(t=J.data)||void 0===t?void 0:t.content)||[]).filter((function(e){return!G.includes(e.name)})),renderItem:function(e,r){return(0,R.jsx)(j.Z.Item,{style:l()(l()({},(null==se?void 0:se.uid)===e.uid?{backgroundColor:i?"#333333":"#dddddd"}:{}),{},{cursor:"pointer"}),onClick:function(){return r=e,void(le?ne(r):W(r));var r},children:(0,R.jsx)(j.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,R.jsx)(b.Z,{src:e.logo}),title:(0,R.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,R.jsx)("span",{children:D(null==e?void 0:e.nickname)}),(0,R.jsx)(k.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?s.formatMessage({id:"ai.provider.status.enabled"}):s.formatMessage({id:"ai.provider.status.disabled"})})]}),description:(0,R.jsxs)("div",{children:[o&&(0,R.jsx)("div",{children:(null==e?void 0:e.status)===P.KY?s.formatMessage({id:"ai.provider.status.production"}):s.formatMessage({id:"ai.provider.status.development"})}),(null==e?void 0:e.description)&&(0,R.jsx)("div",{style:{marginTop:o?"4px":"0",color:"#666"},children:e.description})]})})})}}),T&&(0,R.jsx)(O,{open:T,isEdit:F,level:a,llmProvider:se,onCancel:function(){E(!1)},onSubmit:function(e){F?ve(e):ge(e)}}),me]})},W=t(37963),X=t(86222),Y=t.n(X),Q=t(41282),$=t(13775),ee=t(8340),re=t(93892),te=t(49616),ne=t(82373),ae=t(85817),oe=function(e){var r=e.isEdit,t=e.llmmodel,a=e.provider,o=e.open,i=e.level,l=e.onClose,s=e.onSubmit,d=D.A.useForm(),c=f()(d,1)[0],u=(0,x.useIntl)(),m=(0,Z.u)((function(e){return e.currentOrg})),p=[{label:u.formatMessage({id:"model.type.text"}),value:P.l55},{label:u.formatMessage({id:"model.type.embedding"}),value:P.xTq},{label:u.formatMessage({id:"model.type.rerank"}),value:P.SeQ},{label:u.formatMessage({id:"model.type.vision"}),value:P.xZ8},{label:u.formatMessage({id:"model.type.code"}),value:P.rrk},{label:u.formatMessage({id:"model.type.reasoning"}),value:P.GNM},{label:u.formatMessage({id:"model.type.text2image"}),value:P.eQL},{label:u.formatMessage({id:"model.type.image2text"}),value:P.ztv},{label:u.formatMessage({id:"model.type.audio2text"}),value:P._D8},{label:u.formatMessage({id:"model.type.text2audio"}),value:P.YNO},{label:u.formatMessage({id:"model.type.text2video"}),value:P.GZK},{label:u.formatMessage({id:"model.type.video2text"}),value:P.B6M}];(0,n.useEffect)((function(){var e;r&&t&&c?c.setFieldsValue({uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,description:null==t?void 0:t.description,type:null==t?void 0:t.type,enabled:null!==(e=null==t?void 0:t.enabled)&&void 0!==e&&e}):(console.log("form resetFields"),c.resetFields(),c.setFieldValue("type",P.l55),c.setFieldValue("enabled",!0))}),[t]);return(0,n.useEffect)((function(){}),[t]),(0,R.jsx)("div",{children:(0,R.jsx)(N.Z,{title:r?u.formatMessage({id:"model.edit"}):u.formatMessage({id:"model.create"}),width:600,onClose:l,open:o,extra:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{onClick:l,children:u.formatMessage({id:"cancel"})}),(0,R.jsx)(w.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var n;console.log("Form values:",e);var o={uid:r?null==t?void 0:t.uid:"",name:e.name,nickname:e.nickname,description:e.description,type:e.type,enabled:null===(n=e.enabled)||void 0===n||n,providerUid:null==a?void 0:a.uid,providerName:null==a?void 0:a.name,level:i,orgUid:null==m?void 0:m.uid};console.log("llmmodelObject:",o),s(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:u.formatMessage({id:"ok"})})]}),children:(0,R.jsxs)(D.A,{form:c,name:"model",submitter:!1,children:[(0,R.jsx)(U.Z,{label:u.formatMessage({id:"model.name"}),name:"name"}),(0,R.jsx)(U.Z,{label:u.formatMessage({id:"model.nickname"}),name:"nickname"}),(0,R.jsx)(z.Z,{label:u.formatMessage({id:"model.description"}),name:"description",placeholder:u.formatMessage({id:"model.description.placeholder"}),fieldProps:{rows:3,maxLength:500,showCount:!0}}),(0,R.jsx)(I.Z,{label:u.formatMessage({id:"model.type"}),name:"type",options:p,placeholder:u.formatMessage({id:"model.type.placeholder"}),rules:[{required:!0,message:u.formatMessage({id:"model.type.required"})}]}),(0,R.jsx)(T.Z,{label:u.formatMessage({id:"model.enabled",defaultMessage:"启用状态"}),name:"enabled",tooltip:u.formatMessage({id:"model.enabled.tooltip",defaultMessage:"是否启用该大模型"}),checkedChildren:u.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:u.formatMessage({id:"disabled",defaultMessage:"禁用"})})]})})})},ie=t(11090),le=t(59304),se=t(80556),de=t(30617),ce=t(53504),ue=t(61155),me=ae.Z.Text,fe=function(e){var r=e.provider,t=e.open,a=(e.level,e.onClose),o=e.onSubmit,i=e.existingModels,l=void 0===i?[]:i,s=(0,x.useIntl)(),c=(0,n.useState)(!1),m=f()(c,2),p=m[0],v=m[1],h=(0,n.useState)([]),y=f()(h,2),M=y[0],j=y[1],b=(0,n.useState)([]),Z=f()(b,2),C=Z[0],S=Z[1],L=function(e){return l.some((function(r){return r.name===e.name}))},D=function(){var e=u()(d()().mark((function e(){var t,n,a,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,t={pageNumber:0,pageSize:100,level:P.Hxq,providerName:r.name},e.next=5,(0,Q.LF)(t);case 5:n=e.sent,console.log("获取平台模型列表:",n),200===n.code?(a=n.data.content||[],j(a),o=a.filter((function(e){return L(e)})).map((function(e){return e.uid})),S(o)):g.yw.error(n.message||s.formatMessage({id:"ai.model.import.fetchFailed"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),g.yw.error(s.formatMessage({id:"ai.model.import.fetchError"}));case 14:return e.prev=14,v(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){t&&D()}),[t]);var U=[{title:s.formatMessage({id:"ai.model.import.modelName"}),dataIndex:"name",key:"name",render:function(e,r){return(0,R.jsxs)(te.Z,{children:[e,L(r)&&(0,R.jsx)(k.Z,{color:"green",children:s.formatMessage({id:"ai.model.import.alreadyExists"})})]})}},{title:s.formatMessage({id:"ai.model.import.modelNickname"}),dataIndex:"nickname",key:"nickname"},{title:s.formatMessage({id:"ai.model.import.modelDescription"}),dataIndex:"description",key:"description",ellipsis:!0}],z={selectedRowKeys:C,onChange:function(e){S(e)}};return(0,R.jsxs)(N.Z,{title:s.formatMessage({id:"ai.model.import.title"},{provider:r.nickname}),width:700,open:t,onClose:a,destroyOnClose:!0,footer:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{onClick:a,children:s.formatMessage({id:"ai.model.import.cancel"})}),(0,R.jsx)(w.ZP,{type:"primary",onClick:function(){if(0!==C.length){var e=M.filter((function(e){return C.includes(e.uid)}));o(e)}else g.yw.warning(s.formatMessage({id:"ai.model.import.noSelection"}))},disabled:0===C.length,children:s.formatMessage({id:"ai.model.import.importSelected"},{count:C.length})})]}),children:[(0,R.jsxs)(me,{type:"secondary",children:[s.formatMessage({id:"ai.model.import.description"},{provider:r.nickname}),l.length>0&&(0,R.jsx)(me,{type:"secondary",style:{marginLeft:8},children:s.formatMessage({id:"ai.model.import.existingTip"})})]}),(0,R.jsx)("div",{style:{marginTop:16},children:(0,R.jsx)(ce.Z,{spinning:p,children:(0,R.jsx)(ue.Z,{rowKey:"uid",columns:U,dataSource:M,pagination:{pageSize:10},rowSelection:z,size:"small"})})}),0===M.length&&!p&&(0,R.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,R.jsx)(me,{type:"secondary",children:s.formatMessage({id:"ai.model.import.noPlatformModels"})})})]})},pe=function(e){var r=e.provider,t=e.level,a=(0,x.useIntl)(),o=(0,v.Z)().isDarkMode,i=(0,n.useState)(!0),s=f()(i,2),c=s[0],m=s[1],M=(0,n.useState)(!0),k=f()(M,2),D=k[0],U=k[1],z=(0,h.Z)(),I=z.translateString,T=(z.translateStringTranct,(0,n.useState)()),E=f()(T,2),N=E[0],q=E[1],F=(0,n.useState)(!1),A=f()(F,2),K=A[0],J=A[1],B=(0,n.useState)(!1),V=f()(B,2),_=V[0],G=V[1],H=(0,Z.u)((function(e){return e.currentOrg})),W=(0,n.useState)([]),X=f()(W,2),ce=X[0],ue=X[1],me=(0,L.A)((function(e){return e.upgradeLlmProvider})),pe=y.Z.useModal(),ge=f()(pe,2),ve=ge[0],he=ge[1],xe=(0,n.useState)(!1),ye=f()(xe,2),Me=ye[0],we=ye[1],je=(0,n.useState)(!1),be=f()(je,2),ke=be[0],Ze=be[1],Pe=(0,n.useState)({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,r){return"".concat(r[0],"-").concat(r[1]," / ").concat(e)},pageSizeOptions:["10","20","50","100"]}),Ce=f()(Pe,2),Se=Ce[0],Le=Ce[1],De=(0,L.A)((function(e){var r;return(null===(r=e.llmproviderResult)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.content)||[]})).find((function(e){return e.uid===(null==r?void 0:r.uid)}))||r,Ue=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),g.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,Q.Oh)(r);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ze(Se.current,Se.pageSize)):(g.yw.destroy(),g.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),ze=function(){var e=u()(d()().mark((function e(){var r,n,a,o,i=arguments;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:1,n=i.length>1&&void 0!==i[1]?i[1]:10,console.log("requestModels",{page:r,size:n}),Ze(!0),a={pageNumber:r-1,pageSize:n,providerUid:null==De?void 0:De.uid,orgUid:null==H?void 0:H.uid,level:t},e.next=7,(0,Q.LF)(a);case 7:o=e.sent,console.log("queryLlmModelsByOrg: ",o,a),200===o.code?(ue(o.data.content),Le((function(e){return l()(l()({},e),{},{current:r,pageSize:n,total:o.data.totalElements||0})})),Ze(!1)):(Ze(!1),g.yw.error(o.message));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ie=function(){var e=u()(d()().mark((function e(){var r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("refreshProvider"),null!=De&&De.uid){e.next=4;break}return g.yw.error(a.formatMessage({id:"provider.uid.notexist"})),e.abrupt("return");case 4:return g.yw.loading(a.formatMessage({id:"loading",defaultMessage:"Loading"})),r={uid:De.uid,orgUid:null==H?void 0:H.uid,level:t},e.prev=6,e.next=9,(0,p.N0)(r);case 9:n=e.sent,console.log("queryLlmProviderByUid: ",n,r),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"provider.refresh.success"})),me(n.data)):(g.yw.destroy(),g.yw.error(n.message)),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(6),g.yw.destroy(),g.yw.error(a.formatMessage({id:"provider.refresh.failed"})),console.error("refreshProvider error:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[6,14]])})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){ze(1,10)}),[]);var Te=function(){J(!1)},Ee=function(){G(!1)},Ne=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",r),!c){e.next=9;break}return e.next=4,(0,Q.WS)(r);case 4:t=e.sent,console.log("updateLlmModel:",t.data),200===t.code?(g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),ze(Se.current,Se.pageSize),Te()):g.yw.error(t.message),e.next=14;break;case 9:return e.next=11,(0,Q.Jr)(r);case 11:n=e.sent,console.log("createLlmModel:",n.data),200===n.code?(g.yw.success(a.formatMessage({id:"create.success",defaultMessage:"create success"})),ze(1,Se.pageSize),Te()):g.yw.error(n.message);case 14:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),qe=function(){var e=u()(d()().mark((function e(r){var n,o,i,l,s,c,u,m;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",r),r&&0!==r.length){e.next=5;break}return g.yw.warning(a.formatMessage({id:"model.import.none.selected"})),Ee(),e.abrupt("return");case 5:if(n=ce.map((function(e){return e.name})),o=r.filter((function(e){return!n.includes(e.name)})),0!==o.length){e.next=11;break}return g.yw.info(a.formatMessage({id:"model.import.already.exist"})),Ee(),e.abrupt("return");case 11:g.yw.loading("".concat(a.formatMessage({id:"loading"})).concat(o.length).concat(a.formatMessage({id:"model.add"}),"...")),e.prev=12,i=0,l=Y()(o),e.prev=15,l.s();case 17:if((s=l.n()).done){e.next=27;break}return c=s.value,u={name:c.name,nickname:c.nickname,description:c.description,type:c.type,enabled:!0,providerUid:De.uid,providerName:De.name,orgUid:null==H?void 0:H.uid,level:t},e.next=22,(0,Q.Jr)(u);case 22:m=e.sent,console.log("createLlmModel:",m,u),200===m.code&&i++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),l.e(e.t0);case 32:return e.prev=32,l.f(),e.finish(32);case 35:g.yw.destroy(),i>0?(g.yw.success(a.formatMessage({id:"model.import.success"},{count:i})),ze(1,Se.pageSize)):g.yw.warning(a.formatMessage({id:"model.import.none.success"})),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),g.yw.destroy(),g.yw.error(a.formatMessage({id:"model.import.failed"}));case 44:Ee();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(r){return e.apply(this,arguments)}}(),Fe=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",De),t=l()(l()({},De),{},{status:r?P.KY:P.L2A}),e.next=4,(0,p.fx)(t);case 4:n=e.sent,console.log("updateLlmProvider:",t,n),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),me(n.data)):(g.yw.destroy(),g.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Re=function(e){var r;console.log("list on delete",e),r=e,ve.confirm({title:a.formatMessage({id:"deleteTip"}),icon:(0,R.jsx)(C.Z,{}),content:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(I(r.nickname),"】？"),onOk:function(){Ue(r)},onCancel:function(){},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})},Oe=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch enabled to ".concat(r)),t=l()(l()({},De),{},{enabled:r}),g.yw.loading(a.formatMessage({id:"updating"})),e.next=5,(0,p.fx)(t);case 5:n=e.sent,console.log("updateLlmProvider enabled:",t,n),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),me(n.data)):(g.yw.destroy(),g.yw.error(n.message));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ae=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(a.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),me(t.data),we(!1)):(g.yw.destroy(),g.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ke=function(){var e=u()(d()().mark((function e(r,n){var o,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch model enabled to ".concat(r),n),o=l()(l()({},n),{},{enabled:r,providerUid:null==De?void 0:De.uid,orgUid:null==H?void 0:H.uid,level:t}),g.yw.loading(a.formatMessage({id:"updating"})),e.next=5,(0,Q.WS)(o);case 5:i=e.sent,console.log("updateLlmModel enabled:",o,i),200===i.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),ue((function(e){return e.map((function(e){return e.uid===n.uid?l()(l()({},e),{},{enabled:r}):e}))}))):(g.yw.destroy(),g.yw.error(i.message));case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("h1",{children:[(0,R.jsx)(b.Z,{src:null==De?void 0:De.logo}),(0,R.jsx)("span",{style:{marginLeft:"12px"},children:null==De?void 0:De.nickname}),(0,R.jsx)(ee.Z,{checked:null==De?void 0:De.enabled,onChange:Oe,checkedChildren:a.formatMessage({id:"provider.enabled"}),unCheckedChildren:a.formatMessage({id:"provider.disabled"}),style:{marginLeft:"8px"}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(ie.Z,{}),onClick:function(){window.open(null==De?void 0:De.webUrl,"_blank")}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(le.Z,{}),onClick:function(){U(!0),we(!0)}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(se.Z,{}),onClick:Ie})]}),(null==De?void 0:De.description)&&(0,R.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:De.description}),(0,R.jsx)(re.Z,{message:a.formatMessage({id:"provider.config.alert"}),type:null!=De&&De.enabled?"success":"warning",showIcon:!0,style:{marginBottom:"16px"}}),(0,R.jsx)("div",{style:{marginBottom:"16px"},children:(0,R.jsxs)(te.Z,{direction:"vertical",style:{width:"100%"},children:[(0,R.jsxs)("div",{children:[(0,R.jsxs)("span",{children:["apiUrl: ",null==De?void 0:De.apiUrl]}),(0,R.jsx)(w.ZP,{type:"link",size:"small",icon:(0,R.jsx)(le.Z,{}),onClick:function(){U(!0),we(!0)},children:a.formatMessage({id:"provider.edit"})})]}),(0,R.jsxs)("div",{children:[(0,R.jsxs)("span",{children:["apiKey: ",null!=De&&De.apiKey?"".concat(De.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),(0,R.jsx)(w.ZP,{type:"link",size:"small",icon:(0,R.jsx)(le.Z,{}),onClick:function(){U(!0),we(!0)},children:a.formatMessage({id:"provider.edit"})})]})]})}),t===P.Hxq&&(0,R.jsx)(ee.Z,{checkedChildren:a.formatMessage({id:"provider.online"}),unCheckedChildren:a.formatMessage({id:"provider.offline"}),defaultChecked:(null==De?void 0:De.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),Fe(e)}}),(0,R.jsx)(ne.Z,{orientation:"left",children:a.formatMessage({id:"model.list"})}),(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(S.Z,{}),type:"primary",onClick:function(){m(!1),J(!0)},children:a.formatMessage({id:"model.add"})}),"ollama"!==De.name&&t===P.whQ&&(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(de.Z,{}),onClick:function(){return G(!0)},children:a.formatMessage({id:"model.import"})}),(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(se.Z,{}),onClick:function(){return ze(Se.current,Se.pageSize)},children:a.formatMessage({id:"model.refresh"})})]}),(0,R.jsx)(j.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:ke,dataSource:ce,pagination:l()(l()({},Se),{},{onChange:function(e,r){console.log("Pagination onChange:",{page:e,pageSize:r}),ze(e,r)},onShowSizeChange:function(e,r){console.log("Pagination onShowSizeChange:",{current:e,size:r}),ze(1,r)}}),renderItem:function(e,r){return(0,R.jsx)(j.Z.Item,{style:(null==N?void 0:N.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},actions:[(0,R.jsx)(w.ZP,{type:"link",onClick:function(){return r=e,console.log("list on edit",r),q(r),m(!0),void J(!0);var r},children:a.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,R.jsx)(w.ZP,{type:"link",onClick:function(){return Re(e)},children:a.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,R.jsx)(j.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,R.jsxs)(te.Z,{children:[(0,R.jsxs)("span",{style:{color:"#999",fontWeight:"normal",minWidth:"30px",fontSize:"14px"},children:[(Se.current-1)*Se.pageSize+r+1,"."]}),(0,R.jsx)("span",{children:e.nickname}),(0,$.Rb)(e.type),(0,R.jsx)(ee.Z,{size:"small",checked:e.enabled,onChange:function(r){return Ke(r,e)},checkedChildren:a.formatMessage({id:"model.enabled"}),unCheckedChildren:a.formatMessage({id:"model.disabled"})},"enabled")]}),description:(0,R.jsxs)("div",{children:[(0,R.jsx)(ae.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,R.jsx)("div",{style:{marginTop:"4px"},children:(0,R.jsx)(ae.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}}),K&&(0,R.jsx)(oe,{isEdit:c,llmmodel:N,provider:De,open:K,level:t,onClose:Te,onSubmit:Ne}),_&&(0,R.jsx)(fe,{provider:De,open:_,level:t,onClose:Ee,onSubmit:qe,existingModels:ce}),Me&&(0,R.jsx)(O,{open:Me,isEdit:D,level:t,llmProvider:De,onCancel:function(){return we(!1)},onSubmit:Ae}),he]})},ge=t(52202),ve=t(77274),he=t(82690),xe=t(54881),ye=t(67652),Me=t(27473),we=t(33363),je=t(34042),be=t(27259),ke=t(90727),Ze=t(93689),Pe=t(54495),Ce=function(e,r,t){var n=function(e,r,t){var n=e.toLowerCase(),a=(null==r?void 0:r.toLowerCase())||"",o=(null==t?void 0:t.toLowerCase())||"";return n.includes("llama")||n.includes("mistral")||n.includes("gemma")||n.includes("phi")?"chat":n.includes("embedding")||n.includes("embed")||n.includes("instructor")?"embedding":n.includes("vision")||n.includes("llava")||n.includes("bakllava")||n.includes("qwen-vl")?"vision":n.includes("code")||n.includes("codellama")||n.includes("wizardcoder")?"code":n.includes("rerank")||n.includes("bge-rerank")?"rerank":n.includes("audio")||n.includes("whisper")?"audio2text":n.includes("text2image")||n.includes("stable-diffusion")?"text2image":a.includes("llama")||a.includes("mistral")||a.includes("gemma")?"chat":a.includes("embedding")?"embedding":a.includes("vision")||a.includes("multimodal")?"vision":a.includes("code")?"code":(o.includes("gguf")||o.includes("ggml"),"chat")}(e,r,t),a="default",o=n;switch(n){case"chat":a="blue",o="对话";break;case"embedding":a="purple",o="向量嵌入";break;case"vision":a="green",o="视觉";break;case"code":a="cyan",o="代码";break;case"rerank":a="cyan",o="排序";break;case"audio2text":a="volcano",o="语音转文本";break;case"text2image":a="magenta",o="文本生成图像";break;default:a="default",o=n}return(0,R.jsx)(k.Z,{color:a,children:o})},Se=function(e){var r,t,a,o,i,l,s,d,c,u,m,p,g,v=e.visible,h=e.onClose,y=e.modelName,M=e.modelDetails,b=e.loading,Z=e.onRefresh,P=e.onPull,C=e.onDelete,S=(e.isRemoteModel,e.isLocalModel),L=e.pullingModelName,D=e.localModelNames,U=void 0===D?[]:D,z=(0,x.useIntl)(),I=(0,n.useState)(""),T=f()(I,2),E=T[0],q=T[1],F=M&&"model"in M&&"tags"in M,O=M&&"license"in M&&"modelfile"in M,A=U.includes(y);return(0,R.jsxs)(N.Z,{title:z.formatMessage({id:"ai.ollama.modelDetails.title"},{modelName:y}),width:600,placement:"right",onClose:h,open:v,zIndex:1002,children:[b?(0,R.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:(0,R.jsx)(ce.Z,{tip:z.formatMessage({id:"ai.ollama.modelDetails.loading"}),spinning:!0,children:(0,R.jsx)("div",{style:{padding:"50px",backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"4px",minHeight:"200px"}})})}):M?(0,R.jsxs)(R.Fragment,{children:[F&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)(je.Z,{bordered:!0,column:1,title:z.formatMessage({id:"ai.ollama.modelDetails.basicInfo"}),styles:{label:{width:"120px"}},children:[(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.name"}),children:(0,R.jsxs)(te.Z,{children:[(null===(r=M.model)||void 0===r?void 0:r.name)||y,A&&(0,R.jsx)(k.Z,{color:"success",children:z.formatMessage({id:"ai.ollama.modelDetails.installed"})})]})}),(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Ce(y)}),(null===(t=M.model)||void 0===t?void 0:t.description)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.description"}),children:M.model.description}),(null===(a=M.model)||void 0===a?void 0:a.lastUpdated)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),children:M.model.lastUpdated}),(null===(o=M.model)||void 0===o?void 0:o.pullCount)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.pullCount"}),children:M.model.pullCount}),(null===(i=M.model)||void 0===i?void 0:i.totalTags)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.totalTags"}),children:M.model.totalTags}),(null===(l=M.model)||void 0===l?void 0:l.popularTags)&&M.model.popularTags.length>0&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.popularTags"}),children:(0,R.jsx)(te.Z,{wrap:!0,children:M.model.popularTags.map((function(e,r){return(0,R.jsx)(k.Z,{color:"blue",children:e},r)}))})}),(null===(s=M.model)||void 0===s?void 0:s.modified_at)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modifiedAt"}),children:(0,we.mr)(M.model.modified_at.toString())})]}),M.tags&&M.tags.length>0&&(0,R.jsxs)(R.Fragment,{children:[(0,R.jsx)(ne.Z,{orientation:"left",children:z.formatMessage({id:"ai.ollama.modelDetails.availableVersions"})}),(0,R.jsx)(be.Z,{placeholder:z.formatMessage({id:"ai.ollama.modelDetails.searchVersions"}),prefix:(0,R.jsx)(ke.Z,{}),value:E,onChange:function(e){return q(e.target.value)},style:{marginBottom:16},allowClear:!0}),(0,R.jsx)(j.Z,{itemLayout:"horizontal",dataSource:function(){if(!F||!M.tags)return[];var e=M.tags;if(!E)return e;var r=E.toLowerCase();return e.filter((function(e){return e.tag.toLowerCase().includes(r)||e.name.toLowerCase().includes(r)}))}(),renderItem:function(e){var r=function(e,r){var t="".concat(e,":").concat(r);return U.includes(t)}(y,e.tag),t="".concat(y,":").concat(e.tag);return(0,R.jsxs)(j.Z.Item,{children:[(0,R.jsx)(j.Z.Item.Meta,{title:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)("span",{children:e.name}),(0,R.jsx)(k.Z,{color:"green",children:e.tag}),Ce(y),e.size&&(0,R.jsx)(k.Z,{color:"orange",children:e.size}),r&&(0,R.jsx)(k.Z,{color:"success",children:z.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,R.jsxs)("span",{children:[z.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),": ",e.lastUpdated]})}),(0,R.jsx)(te.Z,{children:(0,R.jsx)(Me.Z,{title:r?z.formatMessage({id:"ai.ollama.modelDetails.versionExists"}):z.formatMessage({id:"ai.ollama.modelDetails.pullThisVersion"}),children:(0,R.jsx)(w.ZP,{type:"primary",size:"small",icon:r?(0,R.jsx)(Ze.Z,{}):(0,R.jsx)(Pe.Z,{}),loading:L===t,onClick:function(){P(t)},disabled:r,children:r?z.formatMessage({id:"ai.ollama.modelDetails.installed"}):z.formatMessage({id:"ai.ollama.modelDetails.pullVersion"})})})})]})}})]})]}),O&&(0,R.jsxs)(je.Z,{bordered:!0,column:1,title:z.formatMessage({id:"ai.ollama.modelDetails.localModel"}),styles:{label:{width:"120px"}},children:[(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Ce(y,null===(d=M.details)||void 0===d?void 0:d.family,null===(c=M.details)||void 0===c?void 0:c.format)}),(null===(u=M.details)||void 0===u?void 0:u.format)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modelFormat"}),children:M.details.format}),(null===(m=M.details)||void 0===m?void 0:m.family)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modelFamily"}),children:M.details.family}),(null===(p=M.details)||void 0===p?void 0:p.parameter_size)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.parameterSize"}),children:M.details.parameter_size}),(null===(g=M.details)||void 0===g?void 0:g.quantization_level)&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.quantizationLevel"}),children:M.details.quantization_level}),M.system&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.systemInfo"}),children:M.system}),M.template&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.template"}),children:(0,R.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:M.template})}),M.modelfile&&(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.modelfile"}),children:(0,R.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:M.modelfile})}),(0,R.jsx)(je.Z.Item,{label:z.formatMessage({id:"ai.ollama.modelDetails.license"}),children:M.license})]})]}):(0,R.jsx)(re.Z,{message:z.formatMessage({id:"ai.ollama.modelDetails.error"}),type:"warning"}),(0,R.jsx)(ne.Z,{}),(0,R.jsxs)(te.Z,{children:[!b&&(0,R.jsx)(w.ZP,{type:"primary",onClick:function(){return Z(y)},icon:(0,R.jsx)(se.Z,{}),children:z.formatMessage({id:"ai.ollama.modelDetails.refresh"})}),S&&(0,R.jsx)(ye.Z,{title:z.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:z.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:y}),onConfirm:function(){C(y),h()},okText:z.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:z.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),children:(0,R.jsx)(w.ZP,{type:"primary",danger:!0,icon:(0,R.jsx)(xe.Z,{}),children:z.formatMessage({id:"ai.ollama.modelDetails.delete"})})})]})]})},Le=function(e){var r=e.visible,t=e.onClose,a=e.models,o=e.loading,i=e.onRefresh,l=e.onModelDetails,s=e.onPull,d=e.pullingModelName,c=e.localModelNames,u=void 0===c?[]:c,m=(0,x.useIntl)(),p=(0,n.useState)(""),g=f()(p,2),v=g[0],h=g[1],y=a.filter((function(e){var r=v.toLowerCase();return e.name.toLowerCase().includes(r)||e.description&&e.description.toLowerCase().includes(r)||e.popularTags&&e.popularTags.some((function(e){return e.toLowerCase().includes(r)}))}));return(0,R.jsxs)(N.Z,{title:m.formatMessage({id:"ai.ollama.title"}),width:600,placement:"right",onClose:t,open:r,zIndex:1001,children:[(0,R.jsxs)(te.Z,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[(0,R.jsxs)(te.Z,{style:{width:"100%",justifyContent:"space-between"},children:[(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(se.Z,{}),loading:o,onClick:i,children:m.formatMessage({id:"ai.ollama.refreshRemote"})}),(0,R.jsx)("span",{style:{color:"#999",fontSize:"14px"},children:m.formatMessage({id:"ai.ollama.modelDetails.modelCount"},{filteredCount:y.length,totalCount:a.length})})]}),(0,R.jsx)(be.Z,{placeholder:m.formatMessage({id:"ai.ollama.modelDetails.searchModels"}),prefix:(0,R.jsx)(ke.Z,{}),onChange:function(e){return h(e.target.value)},allowClear:!0})]}),(0,R.jsx)(j.Z,{itemLayout:"vertical",loading:o,dataSource:y,renderItem:function(e){var r,t,n=(t=e.name,u.includes(t));return(0,R.jsx)(j.Z.Item,{extra:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{type:"default",icon:(0,R.jsx)(he.Z,{}),onClick:function(){return l(e.name)},style:{marginRight:8},children:m.formatMessage({id:"ai.ollama.modelDetails.details"})}),(0,R.jsx)(Me.Z,{title:n?m.formatMessage({id:"ai.ollama.modelDetails.modelExistsTooltip"}):m.formatMessage({id:"ai.ollama.modelDetails.modelNotExistsTooltip"}),children:(0,R.jsx)(w.ZP,{type:"primary",icon:n?(0,R.jsx)(Ze.Z,{}):(0,R.jsx)(Pe.Z,{}),loading:d===e.name,onClick:function(){return s(e.name)},disabled:n,children:n?m.formatMessage({id:"ai.ollama.modelDetails.installed"}):m.formatMessage({id:"ai.ollama.modelDetails.pullModel"})})})]}),children:(0,R.jsx)(j.Z.Item.Meta,{title:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)("strong",{children:e.name}),Ce(e.name),n&&(0,R.jsx)(k.Z,{color:"success",children:m.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,R.jsxs)(te.Z,{direction:"vertical",style:{width:"100%"},children:[(0,R.jsxs)(te.Z,{children:[e.pullCount&&(0,R.jsx)(k.Z,{color:"cyan",children:m.formatMessage({id:"ai.ollama.modelDetails.downloads"},{count:e.pullCount})}),e.lastUpdated&&(0,R.jsx)(k.Z,{color:"orange",children:m.formatMessage({id:"ai.ollama.modelDetails.updated"},{time:e.lastUpdated})})]}),(0,R.jsx)("div",{children:e.description||m.formatMessage({id:"ai.ollama.modelDetails.noDescription"})}),(0,R.jsx)(te.Z,{style:{marginTop:8},children:null===(r=e.popularTags)||void 0===r?void 0:r.map((function(e,r){return(0,R.jsx)(k.Z,{color:"blue",children:e},r)}))})]})})})}})]})},De=function(e){var r=e.provider,t=e.level,a=(0,x.useIntl)(),o=(0,v.Z)().isDarkMode,i=(0,n.useState)(!1),s=f()(i,2),c=s[0],m=s[1],h=(0,n.useState)(!1),y=f()(h,2),M=y[0],Z=y[1],P=(0,n.useState)([]),C=f()(P,2),S=C[0],D=C[1],U=(0,n.useState)(!1),z=f()(U,2),I=z[0],T=z[1],E=(0,L.A)((function(e){return e.upgradeLlmProvider})),N=(0,n.useState)(),q=f()(N,2),F=q[0],A=q[1],K=(0,L.A)((function(e){var r;return(null===(r=e.llmproviderResult)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.content)||[]})).find((function(e){return e.uid===(null==r?void 0:r.uid)}))||r,J=(0,n.useState)(!1),B=f()(J,2),V=B[0],_=B[1],G=(0,n.useState)([]),H=f()(G,2),W=H[0],X=H[1],Y=(0,n.useState)(!1),Q=f()(Y,2),$=Q[0],ae=Q[1],oe=(0,n.useState)(""),de=f()(oe,2),ce=de[0],ue=de[1],me=(0,n.useState)(""),fe=f()(me,2),pe=fe[0],je=fe[1],be=(0,n.useState)(!1),ke=f()(be,2),Ze=ke[0],Pe=ke[1],De=(0,n.useState)(!1),Ue=f()(De,2),ze=Ue[0],Ie=Ue[1],Te=(0,n.useState)(null),Ee=f()(Te,2),Ne=Ee[0],qe=Ee[1],Fe=(0,n.useState)(""),Re=f()(Fe,2),Oe=Re[0],Ae=Re[1],Ke=function(){var e=u()(d()().mark((function e(){var r,t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=K&&K.apiUrl){e.next=5;break}return g.yw.error(a.formatMessage({id:"ai.ollama.apiUrlNotConfigured"})),Z(!1),m(!1),e.abrupt("return");case 5:return m(!0),console.log("pingOllama",null==K?void 0:K.apiUrl),r={apiUrl:null==K?void 0:K.apiUrl},e.next=10,(0,ge.VM)(r);case 10:t=e.sent,console.log("getOllamaServerStatus: ",t,r),200===t.code?(Z(t.data),m(!1)):(Z(!1),m(!1));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Je=function(){var e=u()(d()().mark((function e(){var r,t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),m(!0),r={apiUrl:null==K?void 0:K.apiUrl},e.next=5,(0,ge.c8)(r);case 5:t=e.sent,console.log("getOllamaLocalModels: ",t,r),200===t.code&&(n=t.data.map((function(e){var r=e.name.split(":"),t=r[0]||e.name,n=r.length>1?r[1]:"default";return l()(l()({},e),{},{modelName:t,modelVersion:n})})),D(n)),m(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Be=function(){var e=u()(d()().mark((function e(){var r,t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ae(!0),r={apiUrl:null==K?void 0:K.apiUrl},e.next=4,(0,ge.rg)(r);case 4:t=e.sent,console.log("getOllamaLibraryModels: ",t,r),200===t.code?X(t.data):g.yw.error(t.message||a.formatMessage({id:"ai.ollama.remoteModels.fetchFailed"})),ae(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ve=function(){Ke(),Je()};(0,n.useEffect)((function(){Ve()}),[]);var _e=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(a.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),E(t.data),T(!1)):(g.yw.destroy(),g.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ge=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("switch enabled to ".concat(r)),!r||M){e.next=4;break}return g.yw.error(a.formatMessage({id:"ai.ollama.startFirst"})),e.abrupt("return");case 4:return t=l()(l()({},K),{},{enabled:r}),g.yw.loading(a.formatMessage({id:"updating"})),e.next=8,(0,p.fx)(t);case 8:n=e.sent,console.log("updateLlmProvider enabled:",t,n),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),E(n.data)):(g.yw.destroy(),g.yw.error(n.message));case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),He=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M){e.next=3;break}return g.yw.error(a.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return ue(r),g.yw.loading(a.formatMessage({id:"ai.ollama.modelDetails.deleteModel.loading"},{modelName:r})),e.prev=5,t={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=9,(0,ge.G9)(t);case 9:n=e.sent,console.log("deleteOllamaModel:",n.data,r),200===n.code&&n.data?(g.yw.success(a.formatMessage({id:"ai.ollama.modelDetails.deleteModel.success"},{modelName:r})),Je()):g.yw.error(n.message||a.formatMessage({id:"ai.ollama.modelDetails.deleteModel.failed"},{modelName:r})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),console.error("删除模型出错:",e.t0),g.yw.error(a.formatMessage({id:"ai.ollama.modelDetails.deleteModel.error"},{error:e.t0}));case 18:return e.prev=18,ue(""),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[5,14,18,21]])})));return function(r){return e.apply(this,arguments)}}(),We=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(M){e.next=3;break}return g.yw.error(a.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return je(r),g.yw.loading(a.formatMessage({id:"ai.ollama.modelDetails.pulling"},{modelName:r})),e.prev=5,t={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=9,(0,ge.N6)(t);case 9:200===(n=e.sent).code&&n.data?(g.yw.success(a.formatMessage({id:"ai.ollama.modelDetails.pullSuccess"},{modelName:r})),_(!1),Je()):g.yw.error(n.message||a.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:r})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error("拉取模型出错:",e.t0),g.yw.error(a.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:r}));case 17:return e.prev=17,je(""),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})));return function(r){return e.apply(this,arguments)}}(),Xe=function(){var e=u()(d()().mark((function e(r){var t,n,o,i,l,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Ie(!0),Ae(r),Pe(!0),e.prev=3,t=S.some((function(e){return e.name===r})),n=W.some((function(e){return e.name===r})),!t){e.next=14;break}return i={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=10,(0,ge.sF)(i);case 10:o=e.sent,console.log("getOllamaModelDetails (local):",o),e.next=27;break;case 14:if(!n){e.next=22;break}return l={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=18,(0,ge.gF)(l);case 18:o=e.sent,console.log("getOllamaLibraryModelDetails (remote):",o),e.next=27;break;case 22:return s={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=25,(0,ge.gF)(s);case 25:o=e.sent,console.log("getOllamaLibraryModelDetails (default):",o);case 27:200===o.code?qe(o.data):(g.yw.error(o.message||a.formatMessage({id:"ai.ollama.modelDetails.fetchFailed"},{modelName:r})),qe(null)),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(3),console.error("获取模型详情出错:",e.t0),g.yw.error(a.formatMessage({id:"ai.ollama.modelDetails.fetchError"},{error:e.t0})),qe(null);case 35:return e.prev=35,Ie(!1),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[3,30,35,38]])})));return function(r){return e.apply(this,arguments)}}();return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("h1",{children:[(0,R.jsx)(b.Z,{src:null==K?void 0:K.logo}),(0,R.jsx)("span",{style:{marginLeft:"12px"},children:null==K?void 0:K.nickname}),(0,R.jsx)(ee.Z,{checked:null==K?void 0:K.enabled,onChange:Ge,checkedChildren:a.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.checked"}),unCheckedChildren:a.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.unchecked"}),style:{marginLeft:"8px"}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(ie.Z,{}),onClick:function(){window.open(null==K?void 0:K.webUrl,"_blank")}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(le.Z,{}),onClick:function(){return T(!0)}})]}),(null==K?void 0:K.description)&&(0,R.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:K.description}),(0,R.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,R.jsxs)("span",{children:["apiUrl: ",null==K?void 0:K.apiUrl]}),(0,R.jsx)(w.ZP,{type:"link",size:"small",icon:(0,R.jsx)(le.Z,{}),onClick:function(){return T(!0)},children:a.formatMessage({id:"ai.ollama.modelDetails.edit"})})]}),(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(se.Z,{}),loading:c,type:"primary",onClick:Ve,children:a.formatMessage({id:"ai.ollama.refresh"})}),(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(ve.Z,{}),type:"primary",onClick:function(){_(!0),Be()},children:a.formatMessage({id:"ai.ollama.remoteModels"})})]}),(0,R.jsx)("br",{}),(0,R.jsx)("br",{}),M?(0,R.jsx)(re.Z,{message:a.formatMessage({id:"ai.ollama.running"}),type:"success"}):(0,R.jsx)(re.Z,{message:a.formatMessage({id:"ai.ollama.notRunning"}),type:"error"}),(0,R.jsx)(ne.Z,{orientation:"left",children:a.formatMessage({id:"ai.ollama.localModels"})}),(0,R.jsx)(j.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:c,dataSource:S,renderItem:function(e,r){return(0,R.jsx)(j.Z.Item,{style:(null==F?void 0:F.name)===(null==e?void 0:e.name)?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){A(e)},actions:[(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(he.Z,{}),onClick:function(r){r.stopPropagation(),Xe(null==e?void 0:e.name)},children:a.formatMessage({id:"ai.ollama.modelDetails.details"})},"details"),(0,R.jsx)(ye.Z,{title:a.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:a.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:null==e?void 0:e.name}),onConfirm:function(r){null==r||r.stopPropagation(),He(null==e?void 0:e.modelName)},okText:a.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:a.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),onCancel:function(e){return null==e?void 0:e.stopPropagation()},children:(0,R.jsx)(w.ZP,{type:"text",danger:!0,icon:(0,R.jsx)(xe.Z,{}),loading:ce===(null==e?void 0:e.modelName),onClick:function(e){return e.stopPropagation()},children:a.formatMessage({id:"ai.ollama.modelDetails.deleteModel"})})},"delete")],children:(0,R.jsx)(j.Z.Item.Meta,{title:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)("span",{children:null==e?void 0:e.modelName}),(0,R.jsx)(k.Z,{color:"blue",children:null==e?void 0:e.modelVersion}),Ce(null==e?void 0:e.modelName,null==e?void 0:e.family,null==e?void 0:e.format),(null==e?void 0:e.size)&&(0,R.jsx)(k.Z,{color:"green",children:(0,we.sS)(null==e?void 0:e.size)}),(null==e?void 0:e.parameter_size)&&(0,R.jsx)(Me.Z,{title:"参数大小",children:(0,R.jsx)(k.Z,{color:"purple",children:null==e?void 0:e.parameter_size})})]}),description:(0,R.jsxs)(te.Z,{direction:"vertical",children:[(0,R.jsx)("div",{children:a.formatMessage({id:"ai.ollama.modelDetails.fullName"},{name:null==e?void 0:e.name})}),(0,R.jsx)("div",{children:a.formatMessage({id:"ai.ollama.modelDetails.digest"},{digest:null==e?void 0:e.digest})}),(null==e?void 0:e.family)&&(0,R.jsx)("div",{children:a.formatMessage({id:"ai.ollama.modelDetails.family"},{family:null==e?void 0:e.family})}),(null==e?void 0:e.quantization_level)&&(0,R.jsx)("div",{children:a.formatMessage({id:"ai.ollama.modelDetails.quantization"},{level:null==e?void 0:e.quantization_level})}),(0,R.jsx)("div",{children:a.formatMessage({id:"ai.ollama.modelDetails.updateTime"},{time:(0,we.mr)(null==e?void 0:e.modified_at.toString())})})]}),style:{marginLeft:"15px"}})})}}),(0,R.jsx)(Le,{visible:V,onClose:function(){return _(!1)},models:W,loading:$,onRefresh:Be,onModelDetails:Xe,onPull:We,pullingModelName:pe,localModelNames:S.map((function(e){return e.modelName}))}),(0,R.jsx)(Se,{visible:Ze,onClose:function(){return Pe(!1)},modelName:Oe,modelDetails:Ne,loading:ze,onRefresh:Xe,onPull:We,onDelete:He,isRemoteModel:W.some((function(e){return e.name===Oe})),isLocalModel:S.some((function(e){return e.name===Oe})),pullingModelName:pe,localModelNames:S.map((function(e){return e.name}))}),I&&(0,R.jsx)(O,{open:I,isEdit:!0,level:t,llmProvider:K,onCancel:function(){return T(!1)},onSubmit:_e})]})},Ue=function(e){var r=e.isEdit,t=e.llmmodel,a=e.provider,o=e.open,i=e.level,l=e.onClose,s=e.onSubmit,d=D.A.useForm(),c=f()(d,1)[0],u=(0,x.useIntl)(),m=(0,Z.u)((function(e){return e.currentOrg})),p=[{label:u.formatMessage({id:"model.type.text"}),value:P.l55},{label:u.formatMessage({id:"model.type.embedding"}),value:P.xTq},{label:u.formatMessage({id:"model.type.rerank"}),value:P.SeQ},{label:u.formatMessage({id:"model.type.vision"}),value:P.xZ8},{label:u.formatMessage({id:"model.type.code"}),value:P.rrk},{label:u.formatMessage({id:"model.type.reasoning"}),value:P.GNM},{label:u.formatMessage({id:"model.type.text2image"}),value:P.eQL},{label:u.formatMessage({id:"model.type.image2text"}),value:P.ztv},{label:u.formatMessage({id:"model.type.audio2text"}),value:P._D8},{label:u.formatMessage({id:"model.type.text2audio"}),value:P.YNO},{label:u.formatMessage({id:"model.type.text2video"}),value:P.GZK},{label:u.formatMessage({id:"model.type.video2text"}),value:P.B6M}];(0,n.useEffect)((function(){var e;r&&t&&c?c.setFieldsValue({uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,description:null==t?void 0:t.description,type:null==t?void 0:t.type,enabled:null!==(e=null==t?void 0:t.enabled)&&void 0!==e&&e}):(console.log("form resetFields"),c.resetFields(),c.setFieldValue("type",P.l55),c.setFieldValue("enabled",!0))}),[t]);return(0,n.useEffect)((function(){}),[t]),(0,R.jsx)("div",{children:(0,R.jsx)(N.Z,{title:r?u.formatMessage({id:"model.edit"}):u.formatMessage({id:"model.create"}),width:600,onClose:l,open:o,extra:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{onClick:l,children:u.formatMessage({id:"cancel"})}),(0,R.jsx)(w.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var n;console.log("Form values:",e);var o={uid:r?null==t?void 0:t.uid:"",name:e.name,nickname:e.nickname,description:e.description,type:e.type,enabled:null===(n=e.enabled)||void 0===n||n,providerUid:null==a?void 0:a.uid,providerName:null==a?void 0:a.name,level:i,orgUid:null==m?void 0:m.uid};console.log("llmmodelObject:",o),s(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:u.formatMessage({id:"ok"})})]}),children:(0,R.jsxs)(D.A,{form:c,name:"model",submitter:!1,children:[(0,R.jsx)(U.Z,{label:u.formatMessage({id:"model.name"}),name:"name"}),(0,R.jsx)(U.Z,{label:u.formatMessage({id:"model.nickname"}),name:"nickname"}),(0,R.jsx)(z.Z,{label:u.formatMessage({id:"model.description"}),name:"description",placeholder:u.formatMessage({id:"model.description.placeholder"}),fieldProps:{rows:3,maxLength:500,showCount:!0}}),(0,R.jsx)(I.Z,{label:u.formatMessage({id:"model.type"}),name:"type",options:p,placeholder:u.formatMessage({id:"model.type.placeholder"}),rules:[{required:!0,message:u.formatMessage({id:"model.type.required"})}]}),(0,R.jsx)(T.Z,{label:u.formatMessage({id:"model.enabled",defaultMessage:"启用状态"}),name:"enabled",tooltip:u.formatMessage({id:"model.enabled.tooltip",defaultMessage:"是否启用该大模型"}),checkedChildren:u.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:u.formatMessage({id:"disabled",defaultMessage:"禁用"})})]})})})},ze=ae.Z.Text,Ie=function(e){var r=e.provider,t=e.open,a=(e.level,e.onClose),o=e.onSubmit,i=e.existingModels,l=void 0===i?[]:i,s=(0,x.useIntl)(),c=(0,n.useState)(!1),m=f()(c,2),p=m[0],v=m[1],h=(0,n.useState)([]),y=f()(h,2),M=y[0],j=y[1],b=(0,n.useState)([]),Z=f()(b,2),C=Z[0],S=Z[1],L=function(e){return l.some((function(r){return r.name===e.name}))},D=function(){var e=u()(d()().mark((function e(){var t,n,a,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,t={pageNumber:0,pageSize:100,level:P.Hxq,providerName:r.name},e.next=5,(0,Q.LF)(t);case 5:n=e.sent,console.log("获取平台模型列表:",n),200===n.code?(a=n.data.content||[],j(a),o=a.filter((function(e){return L(e)})).map((function(e){return e.uid})),S(o)):g.yw.error(n.message||s.formatMessage({id:"ai.model.import.fetchFailed"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),g.yw.error(s.formatMessage({id:"ai.model.import.fetchError"}));case 14:return e.prev=14,v(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){t&&D()}),[t]);var U=[{title:s.formatMessage({id:"ai.model.import.modelName"}),dataIndex:"name",key:"name",render:function(e,r){return(0,R.jsxs)(te.Z,{children:[e,L(r)&&(0,R.jsx)(k.Z,{color:"green",children:s.formatMessage({id:"ai.model.import.alreadyExists"})})]})}},{title:s.formatMessage({id:"ai.model.import.modelNickname"}),dataIndex:"nickname",key:"nickname"},{title:s.formatMessage({id:"ai.model.import.modelDescription"}),dataIndex:"description",key:"description",ellipsis:!0}],z={selectedRowKeys:C,onChange:function(e){S(e)}};return(0,R.jsxs)(N.Z,{title:s.formatMessage({id:"ai.model.import.title"},{provider:r.nickname}),width:700,open:t,onClose:a,destroyOnClose:!0,footer:(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{onClick:a,children:s.formatMessage({id:"ai.model.import.cancel"})}),(0,R.jsx)(w.ZP,{type:"primary",onClick:function(){if(0!==C.length){var e=M.filter((function(e){return C.includes(e.uid)}));o(e)}else g.yw.warning(s.formatMessage({id:"ai.model.import.noSelection"}))},disabled:0===C.length,children:s.formatMessage({id:"ai.model.import.importSelected"},{count:C.length})})]}),children:[(0,R.jsxs)(ze,{type:"secondary",children:[s.formatMessage({id:"ai.model.import.description"},{provider:r.nickname}),l.length>0&&(0,R.jsx)(ze,{type:"secondary",style:{marginLeft:8},children:s.formatMessage({id:"ai.model.import.existingTip"})})]}),(0,R.jsx)("div",{style:{marginTop:16},children:(0,R.jsx)(ce.Z,{spinning:p,children:(0,R.jsx)(ue.Z,{rowKey:"uid",columns:U,dataSource:M,pagination:{pageSize:10},rowSelection:z,size:"small"})})}),0===M.length&&!p&&(0,R.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,R.jsx)(ze,{type:"secondary",children:s.formatMessage({id:"ai.model.import.noPlatformModels"})})})]})},Te=function(e){var r=e.provider,t=e.level,a=(0,x.useIntl)(),o=(0,v.Z)().isDarkMode,i=(0,n.useState)(!0),s=f()(i,2),c=s[0],m=s[1],M=(0,n.useState)(!0),k=f()(M,2),D=k[0],U=k[1],z=(0,h.Z)().translateString,I=(0,n.useState)(),T=f()(I,2),E=T[0],N=T[1],q=(0,n.useState)(!1),F=f()(q,2),A=F[0],K=F[1],J=(0,n.useState)(!1),B=f()(J,2),V=B[0],_=B[1],G=(0,Z.u)((function(e){return e.currentOrg})),H=(0,n.useState)([]),W=f()(H,2),X=W[0],oe=W[1],ce=(0,L.A)((function(e){return e.upgradeLlmProvider})),ue=y.Z.useModal(),me=f()(ue,2),fe=me[0],pe=me[1],ge=(0,n.useState)(!1),ve=f()(ge,2),he=ve[0],xe=ve[1],ye=(0,n.useState)(!1),Me=f()(ye,2),we=Me[0],je=Me[1],be=(0,n.useState)({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,r){return"".concat(r[0],"-").concat(r[1]," / ").concat(e)},pageSizeOptions:["10","20","50","100"]}),ke=f()(be,2),Ze=ke[0],Pe=ke[1],Ce=(0,L.A)((function(e){var r;return(null===(r=e.llmproviderResult)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.content)||[]})).find((function(e){return e.uid===(null==r?void 0:r.uid)}))||r,Se=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),g.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,Q.Oh)(r);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),Le(Ze.current,Ze.pageSize)):(g.yw.destroy(),g.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Le=function(){var e=u()(d()().mark((function e(){var r,n,a,o,i=arguments;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=i.length>0&&void 0!==i[0]?i[0]:1,n=i.length>1&&void 0!==i[1]?i[1]:10,console.log("requestModels",{page:r,size:n}),je(!0),a={pageNumber:r-1,pageSize:n,providerUid:null==Ce?void 0:Ce.uid,orgUid:null==G?void 0:G.uid,level:t},e.next=7,(0,Q.LF)(a);case 7:o=e.sent,console.log("queryLlmModelsByOrg: ",o,a),200===o.code?(oe(o.data.content),Pe((function(e){return l()(l()({},e),{},{current:r,pageSize:n,total:o.data.totalElements||0})})),je(!1)):(je(!1),g.yw.error(o.message));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=u()(d()().mark((function e(){var r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("refreshProvider"),null!=Ce&&Ce.uid){e.next=4;break}return g.yw.error(a.formatMessage({id:"provider.uid.notexist"})),e.abrupt("return");case 4:return g.yw.loading(a.formatMessage({id:"loading",defaultMessage:"Loading"})),r={uid:Ce.uid,orgUid:null==G?void 0:G.uid,level:t},e.prev=6,e.next=9,(0,p.N0)(r);case 9:n=e.sent,console.log("queryLlmProviderByUid: ",n,r),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"provider.refresh.success"})),ce(n.data)):(g.yw.destroy(),g.yw.error(n.message)),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(6),g.yw.destroy(),g.yw.error(a.formatMessage({id:"provider.refresh.failed"})),console.error("refreshProvider error:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[6,14]])})));return function(){return e.apply(this,arguments)}}();(0,n.useEffect)((function(){Le(1,10)}),[]);var ze=function(){K(!1)},Te=function(){_(!1)},Ee=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",r),!c){e.next=9;break}return e.next=4,(0,Q.WS)(r);case 4:t=e.sent,console.log("updateLlmModel:",t.data),200===t.code?(g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),Le(Ze.current,Ze.pageSize),ze()):g.yw.error(t.message),e.next=14;break;case 9:return e.next=11,(0,Q.Jr)(r);case 11:n=e.sent,console.log("createLlmModel:",n.data),200===n.code?(g.yw.success(a.formatMessage({id:"create.success",defaultMessage:"create success"})),Le(1,Ze.pageSize),ze()):g.yw.error(n.message);case 14:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ne=function(){var e=u()(d()().mark((function e(r){var n,o,i,l,s,c,u,m;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",r),r&&0!==r.length){e.next=5;break}return g.yw.warning(a.formatMessage({id:"model.import.none.selected"})),Te(),e.abrupt("return");case 5:if(n=X.map((function(e){return e.name})),o=r.filter((function(e){return!n.includes(e.name)})),0!==o.length){e.next=11;break}return g.yw.info(a.formatMessage({id:"model.import.already.exist"})),Te(),e.abrupt("return");case 11:g.yw.loading("".concat(a.formatMessage({id:"loading"})).concat(o.length).concat(a.formatMessage({id:"model.add"}),"...")),e.prev=12,i=0,l=Y()(o),e.prev=15,l.s();case 17:if((s=l.n()).done){e.next=27;break}return c=s.value,u={name:c.name,nickname:c.nickname,description:c.description,type:c.type,enabled:!0,providerUid:Ce.uid,providerName:Ce.name,orgUid:null==G?void 0:G.uid,level:t},e.next=22,(0,Q.Jr)(u);case 22:m=e.sent,console.log("createLlmModel:",m,u),200===m.code&&i++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),l.e(e.t0);case 32:return e.prev=32,l.f(),e.finish(32);case 35:g.yw.destroy(),i>0?(g.yw.success(a.formatMessage({id:"model.import.success"},{count:i})),Le(1,Ze.pageSize)):g.yw.warning(a.formatMessage({id:"model.import.none.success"})),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),g.yw.destroy(),g.yw.error(a.formatMessage({id:"model.import.failed"}));case 44:Te();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(r){return e.apply(this,arguments)}}(),qe=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",Ce),t=l()(l()({},Ce),{},{status:r?P.KY:P.L2A}),e.next=4,(0,p.fx)(t);case 4:n=e.sent,console.log("updateLlmProvider:",t,n),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),ce(n.data)):(g.yw.destroy(),g.yw.error(n.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Fe=function(e){var r;console.log("list on delete",e),r=e,fe.confirm({title:a.formatMessage({id:"deleteTip"}),icon:(0,R.jsx)(C.Z,{}),content:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(z(r.nickname),"】？"),onOk:function(){Se(r)},onCancel:function(){},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})},Re=function(){var e=u()(d()().mark((function e(r){var t,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch enabled to ".concat(r)),t=l()(l()({},Ce),{},{enabled:r}),g.yw.loading(a.formatMessage({id:"updating"})),e.next=5,(0,p.fx)(t);case 5:n=e.sent,console.log("updateLlmProvider enabled:",t,n),200===n.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),ce(n.data)):(g.yw.destroy(),g.yw.error(n.message));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Oe=function(){var e=u()(d()().mark((function e(r){var t;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(a.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),ce(t.data),xe(!1)):(g.yw.destroy(),g.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ae=function(){var e=u()(d()().mark((function e(r,n){var o,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch model enabled to ".concat(r),n),o=l()(l()({},n),{},{enabled:r,providerUid:null==Ce?void 0:Ce.uid,orgUid:null==G?void 0:G.uid,level:t}),g.yw.loading(a.formatMessage({id:"updating"})),e.next=5,(0,Q.WS)(o);case 5:i=e.sent,console.log("updateLlmModel enabled:",o,i),200===i.code?(g.yw.destroy(),g.yw.success(a.formatMessage({id:"update.success",defaultMessage:"update success"})),oe((function(e){return e.map((function(e){return e.uid===n.uid?l()(l()({},e),{},{enabled:r}):e}))}))):(g.yw.destroy(),g.yw.error(i.message));case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();return(0,R.jsxs)(R.Fragment,{children:[(0,R.jsxs)("h1",{children:[(0,R.jsx)(b.Z,{src:null==Ce?void 0:Ce.logo}),(0,R.jsx)("span",{style:{marginLeft:"12px"},children:null==Ce?void 0:Ce.nickname}),(0,R.jsx)(ee.Z,{checked:null==Ce?void 0:Ce.enabled,onChange:Re,checkedChildren:a.formatMessage({id:"provider.enabled"}),unCheckedChildren:a.formatMessage({id:"provider.disabled"}),style:{marginLeft:"8px"}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(ie.Z,{}),onClick:function(){window.open(null==Ce?void 0:Ce.webUrl,"_blank")}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(le.Z,{}),onClick:function(){U(!0),xe(!0)}}),(0,R.jsx)(w.ZP,{type:"text",icon:(0,R.jsx)(se.Z,{}),onClick:De})]}),(null==Ce?void 0:Ce.description)&&(0,R.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:Ce.description}),(0,R.jsx)(re.Z,{message:a.formatMessage({id:"provider.config.alert"}),type:null!=Ce&&Ce.enabled?"success":"warning",showIcon:!0,style:{marginBottom:"16px"}}),(0,R.jsx)("div",{style:{marginBottom:"16px"},children:(0,R.jsxs)(te.Z,{direction:"vertical",style:{width:"100%"},children:[(0,R.jsxs)("div",{children:[(0,R.jsxs)("span",{children:["apiUrl: ",null==Ce?void 0:Ce.apiUrl]}),(0,R.jsx)(w.ZP,{type:"link",size:"small",icon:(0,R.jsx)(le.Z,{}),onClick:function(){U(!0),xe(!0)},children:a.formatMessage({id:"provider.edit"})})]}),(0,R.jsxs)("div",{children:[(0,R.jsxs)("span",{children:["apiKey: ",null!=Ce&&Ce.apiKey?"".concat(Ce.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),(0,R.jsx)(w.ZP,{type:"link",size:"small",icon:(0,R.jsx)(le.Z,{}),onClick:function(){U(!0),xe(!0)},children:a.formatMessage({id:"provider.edit"})})]})]})}),t===P.Hxq&&(0,R.jsx)(ee.Z,{checkedChildren:a.formatMessage({id:"provider.online"}),unCheckedChildren:a.formatMessage({id:"provider.offline"}),defaultChecked:(null==Ce?void 0:Ce.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),qe(e)}}),(0,R.jsx)(ne.Z,{orientation:"left",children:a.formatMessage({id:"model.list"})}),(0,R.jsxs)(te.Z,{children:[(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(S.Z,{}),type:"primary",onClick:function(){m(!1),K(!0)},children:a.formatMessage({id:"model.add"})}),"ollama"!==Ce.name&&t===P.whQ&&(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(de.Z,{}),onClick:function(){return _(!0)},children:a.formatMessage({id:"model.import"})}),(0,R.jsx)(w.ZP,{icon:(0,R.jsx)(se.Z,{}),onClick:function(){return Le(Ze.current,Ze.pageSize)},children:a.formatMessage({id:"model.refresh"})})]}),(0,R.jsx)(j.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:we,dataSource:X,pagination:l()(l()({},Ze),{},{onChange:function(e,r){console.log("Pagination onChange:",{page:e,pageSize:r}),Le(e,r)},onShowSizeChange:function(e,r){console.log("Pagination onShowSizeChange:",{current:e,size:r}),Le(1,r)}}),renderItem:function(e,r){return(0,R.jsx)(j.Z.Item,{style:(null==E?void 0:E.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){N(e)},actions:[(0,R.jsx)(w.ZP,{type:"link",onClick:function(){return r=e,console.log("list on edit",r),N(r),m(!0),void K(!0);var r},children:a.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,R.jsx)(w.ZP,{type:"link",onClick:function(){return Fe(e)},children:a.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,R.jsx)(j.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,R.jsxs)(te.Z,{children:[(0,R.jsxs)("span",{style:{color:"#999",fontWeight:"normal",minWidth:"30px",fontSize:"14px"},children:[(Ze.current-1)*Ze.pageSize+r+1,"."]}),(0,R.jsx)("span",{children:e.nickname}),(0,$.Rb)(e.type),(0,R.jsx)(ee.Z,{size:"small",checked:e.enabled,onChange:function(r){return Ae(r,e)},checkedChildren:a.formatMessage({id:"model.enabled"}),unCheckedChildren:a.formatMessage({id:"model.disabled"})},"enabled")]}),description:(0,R.jsxs)("div",{children:[(0,R.jsx)(ae.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,R.jsx)("div",{style:{marginTop:"4px"},children:(0,R.jsx)(ae.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}}),A&&(0,R.jsx)(Ue,{isEdit:c,llmmodel:E,provider:Ce,open:A,level:t,onClose:ze,onSubmit:Ee}),V&&(0,R.jsx)(Ie,{provider:Ce,open:V,level:t,onClose:Te,onSubmit:Ne,existingModels:X}),he&&(0,R.jsx)(O,{open:he,isEdit:D,level:t,llmProvider:Ce,onCancel:function(){return xe(!1)},onSubmit:Oe}),pe]})},Ee=function(e){var r=e.level,t=(0,n.useState)(""),a=f()(t,2),o=a[0],i=a[1],l=(0,n.useState)([]),s=f()(l,2),d=s[0],c=s[1],u=(0,L.A)((function(e){return{currentLlmProvider:e.currentLlmProvider,llmproviderResult:e.llmproviderResult,setCurrentLlmProvider:e.setCurrentLlmProvider}})),m=u.currentLlmProvider,p=u.llmproviderResult,g=u.setCurrentLlmProvider,v=_((function(e){return{currentLlmProviderPlatform:e.currentLlmProviderPlatform,llmproviderResultPlatform:e.llmproviderResultPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform}})),h=v.currentLlmProviderPlatform,x=v.llmproviderResultPlatform,y=v.setCurrentLlmProviderPlatform,M=(0,n.useState)(r===P.Hxq),w=f()(M,1)[0],j=w?h:m;(0,n.useEffect)((function(){if(j&&j.name)if(console.log("llmProvider: ",j),d.find((function(e){return e.key===j.name})))i(j.name);else{var e=K()(d);j.name===P.j9I?e.push({label:j.nickname||j.name,children:(0,R.jsx)(De,{provider:j,level:r}),key:j.name,closable:!0}):j.name===P.rZG?e.push({label:j.nickname||j.name,children:(0,R.jsx)(Te,{provider:j,level:r}),key:j.name,closable:!0}):e.push({label:j.nickname||j.name,children:(0,R.jsx)(pe,{provider:j,level:r}),key:j.name,closable:!0}),c(e),i(j.name)}}),[j,d]);return 0===d.length?null:(0,R.jsx)(W.Z,{type:"editable-card",onChange:function(e){var r,t;i(e);var n=(w?(null==x||null===(r=x.data)||void 0===r?void 0:r.content)||[]:(null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[]).find((function(r){return r.name===e}));n&&(w?y(n):g(n))},activeKey:o,onEdit:function(e,r){"remove"===r&&function(e){var r=o,t=-1;d.forEach((function(r,n){r.key===e&&(t=n-1)}));var n=d.filter((function(r){return r.key!==e}));if(n.length&&r===e){var a,l;r=t>=0?n[t].key:n[0].key;var s=(w?(null==x||null===(a=x.data)||void 0===a?void 0:a.content)||[]:(null==p||null===(l=p.data)||void 0===l?void 0:l.content)||[]).find((function(e){return e.name===r}));s&&(w?y(s):g(s))}c(n),i(r)}(e)},items:d})},Ne=o.Z.Sider,qe=o.Z.Content,Fe=function(){var e=(0,a.Z)(),r=e.leftSiderStyle,t=e.leftSiderWidth,n=e.contentStyle;return(0,R.jsx)(R.Fragment,{children:(0,R.jsxs)(o.Z,{children:[(0,R.jsx)(Ne,{style:r,width:t,children:(0,R.jsx)(H,{level:P.whQ,superUser:!1})}),(0,R.jsx)(o.Z,{children:(0,R.jsx)(qe,{style:n,children:(0,R.jsx)(Ee,{level:P.whQ,superUser:!1})})})]})})}}}]);