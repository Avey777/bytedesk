"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3956],{41282:function(e,n,t){t.d(n,{Jr:function(){return f},LF:function(){return d},Oh:function(){return v},WS:function(){return h}});var r=t(90819),i=t.n(r),a=t(73193),o=t.n(a),l=t(89933),s=t.n(l),u=t(5488),c=t(14870);function d(e){return p.apply(this,arguments)}function p(){return(p=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},52202:function(e,n,t){t.d(n,{G9:function(){return j},J$:function(){return S},N6:function(){return w},VM:function(){return d},c8:function(){return f},gF:function(){return v},rg:function(){return h},sF:function(){return x}});var r=t(90819),i=t.n(r),a=t(73193),o=t.n(a),l=t(89933),s=t.n(l),u=t(5488),c=t(14870);function d(e){return p.apply(this,arguments)}function p(){return(p=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return m.apply(this,arguments)}function m(){return(m=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return y.apply(this,arguments)}function y(){return(y=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return g.apply(this,arguments)}function g(){return(g=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return b.apply(this,arguments)}function b(){return(b=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return M.apply(this,arguments)}function M(){return(M=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return C.apply(this,arguments)}function C(){return(C=s()(i()().mark((function e(n){return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},n),{},{channel:u.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},21463:function(e,n,t){var r=t(10154),i=t.n(r),a=t(73193),o=t.n(a),l=t(90819),s=t.n(l),u=t(89933),c=t.n(u),d=t(45332),p=t.n(d),f=t(5025),m=t(41282),h=t(52202),y=t(18751),v=t(5488),g=t(13775),x=t(85817),b=t(79401),w=t(31261),k=t(49616),j=t(93892),M=t(5780),S=t(68724),C=t(37963),T=t(14870),Z=t(44194),U=t(24522),L=t(33363),P=t(31549),q=x.Z.Text,J=Z.memo((function(e){var n,t=e.visible,r=e.onCancel,a=e.onOk,l=e.initialProvider,u=e.initialModel,d=e.initialModelLabel,J=e.providers,O=e.currentOrgUid,X=e.existingProviderModels,E=void 0===X?{}:X,F=e.onModelsLoaded,G=e.allowedModelTypes,I=void 0===G?[]:G,z=(0,T.useIntl)(),B=(0,U.Z)().isDarkMode,A=(0,y.Z)().translateString,D=(0,Z.useState)(l||""),N=p()(D,2),H=N[0],R=N[1],Y=(0,Z.useState)(E),V=p()(Y,2),$=V[0],K=V[1],Q=(0,Z.useState)(l||""),W=p()(Q,2),_=W[0],ee=W[1],ne=(0,Z.useState)(u||""),te=p()(ne,2),re=te[0],ie=te[1],ae=(0,Z.useState)(d||""),oe=p()(ae,2),le=oe[0],se=oe[1],ue=(0,Z.useState)(!1),ce=p()(ue,2),de=ce[0],pe=ce[1],fe=(0,Z.useState)(!1),me=p()(fe,2),he=me[0],ye=me[1];(0,Z.useEffect)((function(){ee(l),ie(u),se(d);var e=l;if(l){var n=J.find((function(e){return e.type===l})),t=J.find((function(e){return e.uid===l}));n&&!t&&(e=n.uid)}R(e),ye(!1)}),[l,u,d,t,J]),(0,Z.useEffect)((function(){if(t&&H&&!$[H]&&!de){pe(!0),f.yw.loading({content:z.formatMessage({id:"loading"}),key:"modelLoading"});var e=J.find((function(e){return e.uid===H}));e&&(e.type===v.CZ7?we(e):je(e))}}),[t,H,J]);var ve=(0,Z.useCallback)((function(){_&&re&&a(_,re,le)}),[_,re,le,a]),ge=(0,Z.useCallback)((function(){r(),T.history.push("/ai/model")}),[r]),xe=(0,Z.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(n){return e.toLowerCase().includes(n.toLowerCase())}))}),[]),be=(0,Z.useCallback)((function(e){return e?e.filter((function(e){return!xe(e.value)&&(!I||0===I.length||(!e.type||I.includes(e.type)))})):[]}),[I,xe]),we=function(){var e=c()(s()().mark((function e(n){var t,r;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={baseUrl:null==n?void 0:n.baseUrl},e.next=4,(0,h.VM)(t);case 4:r=e.sent,console.log("getOllamaServerStatus:",r,t),200===r.code&&r.data?(ye(!0),ke(n)):(ye(!1),f.yw.destroy("modelLoading"),pe(!1)),e.next=15;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),ye(!1),f.yw.destroy("modelLoading"),pe(!1);case 15:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(n){return e.apply(this,arguments)}}(),ke=function(){var e=c()(s()().mark((function e(n){var t,r,a,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={baseUrl:null==n?void 0:n.baseUrl},e.next=4,(0,h.c8)(t);case 4:r=e.sent,console.log("getOllamaLocalModels:",r.data,t),200===r.code?(a=r.data.map((function(e){return{value:e.name,label:e.name,providerName:n.uid}})),l=be(a),K((function(e){return o()(o()({},e),{},i()({},n.uid,l))})),F&&F(n.uid,l)):f.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),f.yw.error(z.formatMessage({id:"error"}));case 13:return e.prev=13,f.yw.destroy("modelLoading"),pe(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(n){return e.apply(this,arguments)}}(),je=function(){var e=c()(s()().mark((function e(n){var t,r,a,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={pageNumber:0,pageSize:50,sortBy:"createdAt",sortDirection:"ascend",enabled:!0,providerUid:null==n?void 0:n.uid,orgUid:O,level:v.whQ},e.next=4,(0,m.LF)(t);case 4:r=e.sent,console.log("queryLlmModelsByOrg:",r.data,t),200===r.code?(a=r.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:n.uid}})),l=be(a),K((function(e){return o()(o()({},e),{},i()({},n.uid,l))})),F&&F(n.uid,l)):f.yw.error(r.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),f.yw.error(z.formatMessage({id:"error"}));case 13:return e.prev=13,f.yw.destroy("modelLoading"),pe(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(n){return e.apply(this,arguments)}}(),Me=(0,Z.useCallback)((function(e,n){ee(e),ie(n.value),se(n.label)}),[]),Se=(0,Z.useCallback)((function(e){if(R(e),!$[e]&&!de){pe(!0),f.yw.loading({content:z.formatMessage({id:"loading"}),key:"modelLoading"});var n=J.find((function(n){return n.uid===e}));n&&("ollama"===n.type?we(n):je(n))}}),[J,$,de]),Ce=Z.memo((function(e){var n=e.model,t=e.providerUid;return(0,P.jsxs)(b.Z,{hoverable:!0,style:{cursor:"pointer",border:re===n.value&&_===t?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return Me(t,n)},children:[(0,P.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,P.jsx)(x.Z.Title,{level:5,style:{margin:0},children:n.label}),(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[n.type&&(0,P.jsx)("div",{style:{marginBottom:8},children:(0,g.Rb)(n.type)}),re===n.value&&_===t&&(0,P.jsx)(w.Z,{status:"processing",text:z.formatMessage({id:"ai.modelSelection.selected"})})]})]}),n.description&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(x.Z.Text,{type:"secondary",children:null==n?void 0:n.value}),(0,P.jsx)(x.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:n.description})]})]},n.value)}),(function(e,n){return e.model.value===n.model.value&&e.providerUid===n.providerUid&&(re===e.model.value&&_===e.providerUid)===(re===n.model.value&&_===n.providerUid)})),Te=(0,Z.useMemo)((function(){return J.filter((function(e){return!L.ju.includes(e.type)})).map((function(e){var n,t;return{key:e.uid,label:A(e.nickname),children:(0,P.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,P.jsxs)(k.Z,{direction:"vertical",style:{width:"100%"},children:["ollama"===e.type&&!he&&(0,P.jsx)(j.Z,{message:z.formatMessage({id:"ai.ollama.notRunning"}),type:"error",showIcon:!0,style:{marginBottom:"16px"}}),de&&H===e.uid&&!$[e.uid]?(0,P.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,P.jsx)(q,{type:"secondary",children:z.formatMessage({id:"ai.modelSelection.loading"})})}):$[e.uid]&&0!==(null===(n=$[e.uid])||void 0===n?void 0:n.length)?null:(0,P.jsxs)("div",{style:{textAlign:"center",padding:"20px"},children:[(0,P.jsx)(q,{type:"secondary",style:{display:"block",marginBottom:"16px"},children:z.formatMessage({id:"ai.modelSelection.noModels"})}),(0,P.jsx)(M.ZP,{type:"link",onClick:ge,style:{padding:0,height:"auto",fontSize:"14px",color:"#1890ff"},children:z.formatMessage({id:"ai.modelSelection.addModelTip"})})]}),(0,P.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(t=$[e.uid])||void 0===t?void 0:t.map((function(n){return(0,P.jsx)(Ce,{model:n,providerUid:e.uid},n.value)}))})]})})}}))}),[J,$,H,de,re,_,A,he]);return(0,P.jsx)(S.Z,{title:z.formatMessage({id:"ai.modelSelection.title"}),open:t,onClose:r,width:700,destroyOnHidden:!1,footer:(0,P.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",backgroundColor:B?"#262626":"#f6f8fa",borderRadius:"6px",border:B?"1px solid #434343":"1px solid #e1e4e8"},children:[(0,P.jsx)(q,{type:"secondary",style:{fontSize:"14px",marginRight:"8px"},children:z.formatMessage({id:"ai.modelSelection.cannotFindModel"})}),(0,P.jsx)(M.ZP,{type:"link",onClick:ge,style:{padding:0,height:"auto",fontSize:"14px"},children:z.formatMessage({id:"ai.modelSelection.addNewModel"})})]}),(0,P.jsxs)("div",{children:[(0,P.jsx)(M.ZP,{onClick:r,style:{marginRight:8},children:z.formatMessage({id:"ai.modelSelection.cancel"})}),(0,P.jsx)(M.ZP,{onClick:ve,type:"primary",children:z.formatMessage({id:"ai.modelSelection.confirm"})})]})]}),children:J.length>0?(0,P.jsx)(C.Z,{activeKey:H||(null===(n=J.filter((function(e){return!L.ju.includes(e.type)}))[0])||void 0===n?void 0:n.uid),onChange:Se,items:Te,destroyOnHidden:!1}):(0,P.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",minHeight:"400px",textAlign:"center"},children:[(0,P.jsx)(q,{type:"secondary",style:{fontSize:"16px",marginBottom:"16px"},children:z.formatMessage({id:"ai.modelSelection.noProviders"})}),(0,P.jsx)(q,{type:"secondary",style:{fontSize:"14px",marginBottom:"24px"},children:z.formatMessage({id:"ai.modelSelection.noProvidersTip"})}),(0,P.jsx)(M.ZP,{type:"primary",onClick:ge,style:{fontSize:"14px"},children:z.formatMessage({id:"ai.modelSelection.goToProviders"})})]})})}),(function(e,n){return e.visible===n.visible&&e.initialProvider===n.initialProvider&&e.initialModel===n.initialModel&&e.initialModelLabel===n.initialModelLabel}));n.Z=J},92023:function(e,n,t){t.d(n,{G:function(){return f}});var r=t(73193),i=t.n(r),a=(t(44194),t(15435)),o=t(5488),l=t(28977),s=t.n(l),u=t(95660),c=t(5025),d=t(18580),p=t(31549),f=function(e){var n=e.children,t=e.onSuccess,r=e.onError,l={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},f={name:"file",accept:"image/*",action:(0,d.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:l,showUploadList:!1,beforeUpload:function(e){u.Z.log("beforeUpload",e);var n=s()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return l.file=e,l.fileName=n,l.fileType=e.type,u.Z.log("beforeUpload",l),!0},onChange:function(e){if("uploading"!==e.file.status&&u.Z.log("not uploading:",e.file),"done"===e.file.status)if(u.Z.log("response: ",e.file.response),200===e.file.response.code){var n=e.file.response.data.fileUrl;t(n),c.yw.success("".concat(e.file.name," 上传成功"))}else r(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),r(e.file))}};return(0,p.jsx)(a.Z,i()(i()({},f),{},{children:n}))}}}]);