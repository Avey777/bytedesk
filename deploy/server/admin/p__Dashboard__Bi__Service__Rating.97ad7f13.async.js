"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8544],{94011:function(t,e,a){a.d(e,{Z:function(){return l}});var i=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},r=a(5901),o=function(t,e){return n.createElement(r.Z,(0,i.Z)({},t,{ref:e,icon:s}))};var l=n.forwardRef(o)},35911:function(t,e,a){a.d(e,{Z:function(){return l}});var i=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},r=a(5901),o=function(t,e){return n.createElement(r.Z,(0,i.Z)({},t,{ref:e,icon:s}))};var l=n.forwardRef(o)},12201:function(t,e,a){a.d(e,{Z:function(){return l}});var i=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 533h-48.1c-4.2 0-7.8 3.2-8.1 7.4C604 589.9 562.5 629 512 629s-92.1-39.1-95.8-88.6c-.3-4.2-3.9-7.4-8.1-7.4H360a8 8 0 00-8 8.4c4.4 84.3 74.5 151.6 160 151.6s155.6-67.3 160-151.6a8 8 0 00-8-8.4z"}}]},name:"smile",theme:"outlined"},r=a(5901),o=function(t,e){return n.createElement(r.Z,(0,i.Z)({},t,{ref:e,icon:s}))};var l=n.forwardRef(o)},47192:function(t,e,a){a.d(e,{Z:function(){return l}});var i=a(77260),n=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M908.1 353.1l-253.9-36.9L540.7 86.1c-3.1-6.3-8.2-11.4-14.5-14.5-15.8-7.8-35-1.3-42.9 14.5L369.8 316.2l-253.9 36.9c-7 1-13.4 4.3-18.3 9.3a32.05 32.05 0 00.6 45.3l183.7 179.1-43.4 252.9a31.95 31.95 0 0046.4 33.7L512 754l227.1 119.4c6.2 3.3 13.4 4.4 20.3 3.2 17.4-3 29.1-19.5 26.1-36.9l-43.4-252.9 183.7-179.1c5-4.9 8.3-11.3 9.3-18.3 2.7-17.5-9.5-33.7-27-36.3zM664.8 561.6l36.1 210.3L512 672.7 323.1 772l36.1-210.3-152.8-149L417.6 382 512 190.7 606.4 382l211.2 30.7-152.8 148.9z"}}]},name:"star",theme:"outlined"},r=a(5901),o=function(t,e){return n.createElement(r.Z,(0,i.Z)({},t,{ref:e,icon:s}))};var l=n.forwardRef(o)},3174:function(t,e,a){a.r(e),a.d(e,{default:function(){return Q}});var i=a(90819),n=a.n(i),s=a(89933),r=a.n(s),o=a(45332),l=a.n(o),c=a(44194),d=a(70877),u=a(69466),f=a(13252),g=a(31218),h=a(55599),v=a(12722),m=a(29507),x=a(20374),p=a(4959),y=a(34640),j=a(89323),M=a(23377),R=a(8421),b=a(48430),Z=a(47192),C=a(35911),w=a(94011),k=a(12201),Y=a(77260),S={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M288 421a48 48 0 1096 0 48 48 0 10-96 0zm352 0a48 48 0 1096 0 48 48 0 10-96 0zM512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm263 711c-34.2 34.2-74 61-118.3 79.8C611 874.2 562.3 884 512 884c-50.3 0-99-9.8-144.8-29.2A370.4 370.4 0 01248.9 775c-34.2-34.2-61-74-79.8-118.3C149.8 611 140 562.3 140 512s9.8-99 29.2-144.8A370.4 370.4 0 01249 248.9c34.2-34.2 74-61 118.3-79.8C413 149.8 461.7 140 512 140c50.3 0 99 9.8 144.8 29.2A370.4 370.4 0 01775.1 249c34.2 34.2 61 74 79.8 118.3C874.2 413 884 461.7 884 512s-9.8 99-29.2 144.8A368.89 368.89 0 01775 775zM664 565H360c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h304c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8z"}}]},name:"meh",theme:"outlined"},D=a(5901),z=function(t,e){return c.createElement(D.Z,(0,Y.Z)({},t,{ref:e,icon:S}))};var O=c.forwardRef(z),U=a(90216),B=a(88633),A=a(97043),I=a(28977),L=a.n(I),E=a(89520),H=a(59318),P=a(2622),F=a(32157),W=a(31549),T=d.default.RangePicker,N=u.Z.Option,Q=function(){var t=(0,H.useIntl)(),e=(0,c.useState)(!1),a=l()(e,2),i=a[0],s=a[1],o=(0,E.u)((function(t){return t.currentOrg})),d=(0,c.useState)([]),Y=l()(d,2),S=Y[0],D=Y[1],z=(0,c.useState)({totalRatings:0,avgRating:0,satisfactionRate:0,ratingRate:0,totalRatingCount:0,satisfiedRatingCount:0,verySatisfied:0,satisfied:0,neutral:0,dissatisfied:0}),I=l()(z,2),Q=I[0],V=I[1],q=(0,c.useState)(L()().startOf("day")),G=l()(q,2),J=G[0],_=G[1],K=(0,c.useState)(L()().endOf("day")),X=l()(K,2),$=X[0],tt=X[1],et=(0,c.useState)("today"),at=l()(et,2),it=at[0],nt=at[1],st=(0,c.useState)([L()().startOf("day"),L()().endOf("day")]),rt=l()(st,2),ot=rt[0],lt=rt[1],ct=(0,c.useState)({current:1,pageSize:20,total:0}),dt=l()(ct,2),ut=dt[0],ft=dt[1],gt=(0,c.useState)(P.whQ),ht=l()(gt,2),vt=ht[0],mt=ht[1],xt=(0,c.useState)(),pt=l()(xt,2),yt=pt[0],jt=pt[1],Mt=(0,c.useState)(),Rt=l()(Mt,2),bt=Rt[0],Zt=Rt[1],Ct=(0,c.useState)([]),wt=l()(Ct,2),kt=wt[0],Yt=wt[1],St=(0,c.useState)([]),Dt=l()(St,2),zt=Dt[0],Ot=Dt[1],Ut=[{label:(0,W.jsx)(H.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,W.jsx)(H.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,W.jsx)(H.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,W.jsx)(H.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,W.jsx)(H.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,W.jsx)(H.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,c.useEffect)((function(){null!=o&&o.uid&&((0,B.LE)({orgUid:o.uid,pageNumber:0,pageSize:100}).then((function(t){var e;200===t.code&&Yt((null===(e=t.data)||void 0===e?void 0:e.content)||[])})),(0,A._t)({orgUid:o.uid,pageNumber:0,pageSize:100}).then((function(t){var e;200===t.code&&Ot((null===(e=t.data)||void 0===e?void 0:e.content)||[])})))}),[o]);var Bt=function(){var t=r()(n()().mark((function t(){var e,a,i,r,l,c,d=arguments;return n()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=d.length>0&&void 0!==d[0]?d[0]:1,a=d.length>1&&void 0!==d[1]?d[1]:20,s(!0),t.prev=3,i={pageNumber:e-1,pageSize:a,orgUid:null==o?void 0:o.uid,startDate:ot[0].format("YYYY-MM-DD"),endDate:ot[1].format("YYYY-MM-DD"),type:vt,workgroupUid:vt===P.v5D?yt:void 0,agentUid:vt===P.fyH?bt:void 0},t.next=7,(0,U.RU)(i);case 7:r=t.sent,console.log("queryStatisticServiceByDate response:",r.data,i),200===r.code&&r.data&&(l=r.data,ft({current:e,pageSize:a,total:1}),c=[{key:l.date||L()().format("YYYY-MM-DD"),date:l.date||L()().format("YYYY-MM-DD"),totalRatingCount:l.totalRatingCount||0,satisfiedRatingCount:l.satisfiedRatingCount||0,satisfactionRate:l.satisfactionRate||0,ratingRate:l.ratingRate||0,acceptedThreadCount:l.acceptedThreadCount||0}],D(c)),t.next=16;break;case 12:t.prev=12,t.t0=t.catch(3),f.ZP.error("获取评价数据失败"),console.error("获取评价数据失败:",t.t0);case 16:return t.prev=16,s(!1),t.finish(16);case 19:case"end":return t.stop()}}),t,null,[[3,12,16,19]])})));return function(){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){if("custom"===it)_(J),tt($);else{var t=L()();"today"===it?(_(t.startOf("day")),tt(t.endOf("day"))):"yesterday"===it?(_(t.subtract(1,"day").startOf("day")),tt(t.subtract(1,"day").endOf("day"))):"week"===it?(_(t.startOf("week")),tt(t.endOf("week"))):"lastWeek"===it?(_(t.subtract(1,"week").startOf("week")),tt(t.subtract(1,"week").endOf("week"))):"month"===it&&(_(t.startOf("month")),tt(t.endOf("month")))}}),[it]),(0,c.useEffect)((function(){lt([J,$])}),[J,$]);var At=function(){var t=r()(n()().mark((function t(){var e,a,i;return n()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e={orgUid:null==o?void 0:o.uid,startDate:ot[0].format("YYYY-MM-DD"),endDate:ot[1].format("YYYY-MM-DD"),type:vt,workgroupUid:vt===P.v5D?yt:void 0,agentUid:vt===P.fyH?bt:void 0},t.next=4,(0,U.RU)(e);case 4:a=t.sent,console.log("queryStatisticServiceByDate response:",a.data,e),200===a.code&&a.data&&(i=a.data,V({totalRatings:i.totalRatingCount||0,avgRating:i.satisfactionRate||0,satisfactionRate:i.satisfactionRate||0,ratingRate:i.ratingRate||0,totalRatingCount:i.totalRatingCount||0,satisfiedRatingCount:i.satisfiedRatingCount||0,verySatisfied:Math.round(.4*(i.satisfiedRatingCount||0)),satisfied:Math.round(.6*(i.satisfiedRatingCount||0)),neutral:Math.round(.2*(i.totalRatingCount||0)),dissatisfied:Math.round(.1*(i.totalRatingCount||0))})),t.next=12;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("获取统计数据失败:",t.t0);case 12:case"end":return t.stop()}}),t,null,[[0,9]])})));return function(){return t.apply(this,arguments)}}();(0,c.useEffect)((function(){At(),Bt()}),[ot,vt,yt,bt]);var It=[{title:t.formatMessage({id:"bi.rating.table.date"}),dataIndex:"date",key:"date"},{title:t.formatMessage({id:"bi.rating.table.totalRatings"}),dataIndex:"totalRatingCount",key:"totalRatingCount"},{title:t.formatMessage({id:"bi.rating.table.satisfiedRatings"}),dataIndex:"satisfiedRatingCount",key:"satisfiedRatingCount",render:function(t,e){return(0,W.jsxs)("div",{children:[(0,W.jsx)("span",{children:t}),(0,W.jsx)(g.Z,{percent:e.totalRatingCount>0?Math.round(t/e.totalRatingCount*100):0,size:"small",showInfo:!1,strokeColor:"#52c41a"})]})}},{title:t.formatMessage({id:"bi.rating.table.ratingRate"}),dataIndex:"ratingRate",key:"ratingRate",render:function(t){return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("span",{style:{marginRight:4},children:t}),(0,W.jsx)(Z.Z,{style:{color:"#faad14"}})]})}}],Lt=[{type:t.formatMessage({id:"bi.rating.table.verySatisfied"}),value:Q.verySatisfied,color:"#52c41a"},{type:t.formatMessage({id:"bi.rating.table.satisfied"}),value:Q.satisfied,color:"#1890ff"},{type:t.formatMessage({id:"bi.rating.table.neutral"}),value:Q.neutral,color:"#faad14"},{type:t.formatMessage({id:"bi.rating.table.dissatisfied"}),value:Q.dissatisfied,color:"#ff4d4f"}];return(0,W.jsxs)("div",{style:{padding:"24px"},children:[(0,W.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,W.jsx)("h2",{children:t.formatMessage({id:"bi.rating.title"})}),(0,W.jsxs)("p",{children:[t.formatMessage({id:"bi.rating.description"}),"today"===it&&(0,W.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",J.format("YYYY-MM-DD"),")"]}),"yesterday"===it&&(0,W.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",J.format("YYYY-MM-DD"),")"]}),("week"===it||"lastWeek"===it||"month"===it||"custom"===it)&&(0,W.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",J.format("YYYY-MM-DD")," ~ ",$.format("YYYY-MM-DD"),")"]})]})]}),(0,W.jsx)(h.Z,{style:{marginBottom:"24px"},children:(0,W.jsx)(v.Z,{direction:"vertical",style:{width:"100%"},children:(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsxs)(v.Z,{wrap:!0,children:[(0,W.jsx)(m.ZP.Group,{value:it,onChange:function(t){return nt(t.target.value)},children:Ut.map((function(t){return(0,W.jsx)(m.ZP.Button,{value:t.value,children:t.label},t.value)}))}),"custom"===it&&(0,W.jsx)(T,{value:[J,$],onChange:function(t){_(t[0]),tt(t[1])}})]}),(0,W.jsxs)(v.Z,{wrap:!0,children:[(0,W.jsxs)(u.Z,{value:vt,style:{width:120},onChange:function(t){mt(t),jt(void 0),Zt(void 0)},children:[(0,W.jsx)(N,{value:P.whQ,children:t.formatMessage({id:"bi.statistic.level.organization"})}),(0,W.jsx)(N,{value:P.v5D,children:t.formatMessage({id:"bi.statistic.level.workgroup"})}),(0,W.jsx)(N,{value:P.fyH,children:t.formatMessage({id:"bi.statistic.level.agent"})})]}),vt===P.v5D&&(0,W.jsx)(u.Z,{value:yt,style:{width:150},onChange:jt,placeholder:t.formatMessage({id:"bi.statistic.level.workgroup"}),allowClear:!0,children:kt.map((function(t){return(0,W.jsx)(N,{value:t.uid,children:t.nickname},t.uid)}))}),vt===P.fyH&&(0,W.jsx)(u.Z,{value:bt,style:{width:150},onChange:Zt,placeholder:t.formatMessage({id:"bi.statistic.level.agent"}),allowClear:!0,children:zt.map((function(t){return(0,W.jsx)(N,{value:t.uid,children:t.nickname},t.uid)}))}),(0,W.jsx)(x.ZP,{type:"primary",icon:(0,W.jsx)(C.Z,{}),onClick:function(){return Bt()},loading:i,children:t.formatMessage({id:"bi.common.refresh"})}),(0,W.jsx)(p.Z,{title:t.formatMessage({id:"ticket.statistic.filter.export"}),children:(0,W.jsx)(x.ZP,{icon:(0,W.jsx)(w.Z,{}),onClick:function(){var t=localStorage.getItem(P.LA8);window.open((0,F.kG)()+"/api/v1/service/statistic/export?"+new URLSearchParams({type:vt,startDate:ot[0].format("YYYY-MM-DD"),endDate:ot[1].format("YYYY-MM-DD"),workgroupUid:vt===P.v5D?yt:"",agentUid:vt===P.fyH?bt:"",orgUid:(null==o?void 0:o.uid)||"",accessToken:t||""}).toString())},children:t.formatMessage({id:"ticket.statistic.filter.export"})})})]})]})})}),(0,W.jsxs)(y.Z,{spinning:i,children:[(0,W.jsxs)(j.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,W.jsx)(M.Z,{span:6,children:(0,W.jsx)(h.Z,{children:(0,W.jsx)(R.Z,{title:t.formatMessage({id:"bi.rating.card.totalRatings"}),value:Q.totalRatings,prefix:(0,W.jsx)(k.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,W.jsx)(M.Z,{span:6,children:(0,W.jsx)(h.Z,{children:(0,W.jsx)(R.Z,{title:t.formatMessage({id:"bi.rating.card.avgRating"}),value:Q.avgRating,prefix:(0,W.jsx)(Z.Z,{}),valueStyle:{color:"#1890ff"},suffix:"/5"})})}),(0,W.jsx)(M.Z,{span:6,children:(0,W.jsx)(h.Z,{children:(0,W.jsx)(R.Z,{title:t.formatMessage({id:"bi.rating.card.satisfactionRate"}),value:Q.satisfactionRate,prefix:(0,W.jsx)(O,{}),valueStyle:{color:"#722ed1"},suffix:"%"})})}),(0,W.jsx)(M.Z,{span:6,children:(0,W.jsx)(h.Z,{children:(0,W.jsx)(R.Z,{title:t.formatMessage({id:"bi.rating.card.ratingRate"}),value:Q.ratingRate,prefix:(0,W.jsx)(Z.Z,{}),valueStyle:{color:"#13c2c2"},suffix:"%"})})})]}),(0,W.jsxs)(j.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,W.jsx)(M.Z,{span:12,children:(0,W.jsx)(h.Z,{title:t.formatMessage({id:"bi.rating.distribution"}),children:(0,W.jsx)("div",{style:{height:300,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,W.jsxs)("div",{style:{textAlign:"center"},children:[(0,W.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[Q.satisfactionRate,"%"]}),(0,W.jsx)("div",{style:{color:"#666"},children:t.formatMessage({id:"bi.rating.overallSatisfaction"})})]})})})}),(0,W.jsx)(M.Z,{span:12,children:(0,W.jsx)(h.Z,{title:t.formatMessage({id:"bi.rating.ratingDistribution"}),children:(0,W.jsx)("div",{style:{height:300},children:Lt.map((function(t,e){return(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:8},children:[(0,W.jsx)("span",{children:t.type}),(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)("div",{style:{width:12,height:12,backgroundColor:t.color,marginRight:8,borderRadius:2}}),(0,W.jsx)("span",{children:t.value})]})]},e)}))})})})]}),(0,W.jsx)(h.Z,{title:t.formatMessage({id:"bi.rating.detailData"}),children:(0,W.jsx)(b.Z,{columns:It,dataSource:S,pagination:{current:ut.current,pageSize:ut.pageSize,total:ut.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(t,e){return"".concat(e[0],"-").concat(e[1]," of ").concat(t," items")}},onChange:function(t){Bt(t.current,t.pageSize)},size:"middle"})})]})]})}}}]);