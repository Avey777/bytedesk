"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[950],{93689:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(77260),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},i=r(54183),l=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var s=a.forwardRef(l)},77274:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(77260),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 418.7C765.6 297.9 648.9 212 512.2 212S258.8 297.8 213 418.6C127.3 441.1 64 519.1 64 612c0 110.5 89.5 200 199.9 200h496.2C870.5 812 960 722.5 960 612c0-92.7-63.1-170.7-148.6-193.3zm36.3 281a123.07 123.07 0 01-87.6 36.3H263.9c-33.1 0-64.2-12.9-87.6-36.3A123.3 123.3 0 01140 612c0-28 9.1-54.3 26.2-76.3a125.7 125.7 0 0166.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10c54.3 14.5 92.1 63.8 92.1 120 0 33.1-12.9 64.3-36.3 87.7z"}}]},name:"cloud",theme:"outlined"},i=r(54183),l=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var s=a.forwardRef(l)},11090:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(77260),a=r(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},i=r(54183),l=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var s=a.forwardRef(l)},30617:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(77260),a=r(44194),o={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},i=r(54183),l=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var s=a.forwardRef(l)},80556:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(77260),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},i=r(54183),l=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var s=a.forwardRef(l)},59908:function(e,t,r){r.d(t,{Z:function(){return s}});var n=r(77260),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M400 317.7h73.9V656c0 4.4 3.6 8 8 8h60c4.4 0 8-3.6 8-8V317.7H624c6.7 0 10.4-7.7 6.3-12.9L518.3 163a8 8 0 00-12.6 0l-112 141.7c-4.1 5.3-.4 13 6.3 13zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"upload",theme:"outlined"},i=r(54183),l=function(e,t){return a.createElement(i.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var s=a.forwardRef(l)},11137:function(e,t,r){var n=r(39328),a=r(17323),o=r(44194),i=r(64665),l=r(31549),s=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],d=o.forwardRef((function(e,t){var r=e.fieldProps,o=e.unCheckedChildren,d=e.checkedChildren,c=e.proFieldProps,u=(0,a.Z)(e,s);return(0,l.jsx)(i.Z,(0,n.Z)({valueType:"switch",fieldProps:(0,n.Z)({unCheckedChildren:o,checkedChildren:d},r),ref:t,valuePropName:"checked",proFieldProps:c,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},u))}));t.Z=d},41282:function(e,t,r){r.d(t,{Jr:function(){return f},LF:function(){return u},Oh:function(){return h},WS:function(){return g}});var n=r(90819),a=r.n(n),o=r(73193),i=r.n(o),l=r(89933),s=r.n(l),d=r(5488),c=r(14870);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},52202:function(e,t,r){r.d(t,{G9:function(){return j},J$:function(){return Z},N6:function(){return w},VM:function(){return u},c8:function(){return f},gF:function(){return h},rg:function(){return g},sF:function(){return y}});var n=r(90819),a=r.n(n),o=r(73193),i=r.n(o),l=r(89933),s=r.n(l),d=r(5488),c=r(14870);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return k.apply(this,arguments)}function k(){return(k=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return P.apply(this,arguments)}function P(){return(P=s()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:i()(i()({},t),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92023:function(e,t,r){r.d(t,{G:function(){return f}});var n=r(73193),a=r.n(n),o=(r(44194),r(15435)),i=r(5488),l=r(28977),s=r.n(l),d=r(95660),c=r(5025),u=r(18580),m=r(31549),f=function(e){var t=e.children,r=e.onSuccess,n=e.onError,l={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:i.IrL,categoryUid:"",kbUid:"",channel:i.XtJ},f={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(i.LA8)},data:l,showUploadList:!1,beforeUpload:function(e){d.Z.log("beforeUpload",e);var t=s()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return l.file=e,l.fileName=t,l.fileType=e.type,d.Z.log("beforeUpload",l),!0},onChange:function(e){if("uploading"!==e.file.status&&d.Z.log("not uploading:",e.file),"done"===e.file.status)if(d.Z.log("response: ",e.file.response),200===e.file.response.code){var t=e.file.response.data.fileUrl;r(t),c.yw.success("".concat(e.file.name," 上传成功"))}else n(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),n(e.file))}};return(0,m.jsx)(o.Z,a()(a()({},f),{},{children:t}))}},74424:function(e,t,r){var n=r(24522);t.Z=function(){var e=(0,n.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},44745:function(e,t,r){r.r(t),r.d(t,{default:function(){return Ke}});var n=r(73193),a=r.n(n),o=r(44194),i=r(74424),l=r(93322),s=r(90819),d=r.n(s),c=r(89933),u=r.n(c),m=r(45332),f=r.n(m),p=r(91221),g=r(5025),v=r(24522),h=r(18751),x=r(14870),y=r(68349),M=r(90317),w=r(5780),b=r(96501),j=r(45681),k=r(88344),Z=r(34599),P=r(5488),C=r(15722),S=r(10162),L=r(46747),z=r(32394),D=r(48821),E=r(16331),U=r(47783),N=r(11137),I=r(20903),T=r(68724),O=r(92023),R=r(59908),q=r(31549),F=function(e){var t=e.open,r=e.isEdit,n=e.llmProvider,a=e.level,i=e.onCancel,l=e.onSubmit,s=(0,x.useIntl)(),c=I.Z.useForm(),m=f()(c,1)[0],p=(0,Z.u)((function(e){return e.currentOrg})),v=(0,o.useState)(),h=f()(v,2),y=h[0],M=h[1],b=(0,o.useState)(""),k=f()(b,2),C=k[0],S=k[1],L=r&&["ollama","zhipuai","deepseek","dashscope","silicon","gitee","tencent","baidu","volcengine","minimax","xinghuo","moonshot","baichuan","yi","stepfun","openrouter","groq","anthropic","openai","gemini","aihubmix"].includes((null==n?void 0:n.name)||"");(0,o.useEffect)((function(){var e;r?(M(n),S((null==n?void 0:n.logo)||""),m.setFieldsValue({logo:null==n?void 0:n.logo,name:null==n?void 0:n.name,nickname:null==n?void 0:n.nickname,description:null==n?void 0:n.description,webUrl:null==n?void 0:n.webUrl,status:null==n?void 0:n.status,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey,enabled:null===(e=null==n?void 0:n.enabled)||void 0===e||e})):(m.resetFields(),S(""),m.setFieldsValue({enabled:!0}))}),[r,n]);return(0,q.jsx)("div",{children:(0,q.jsx)(T.Z,{title:r?s.formatMessage({id:"ai.provider.edit"}):s.formatMessage({id:"ai.provider.create"}),open:t,onClose:i,width:500,extra:(0,q.jsx)(w.ZP,{type:"primary",onClick:function(){m.validateFields().then(function(){var e=u()(d()().mark((function e(t){var o,i;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:i={uid:r?null==n?void 0:n.uid:"",name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,logo:C||(null==y?void 0:y.logo),description:null==t?void 0:t.description,webUrl:null==t?void 0:t.webUrl,status:(null==t?void 0:t.status)||P.L2A,apiUrl:null==t?void 0:t.apiUrl,apiKey:null==t?void 0:t.apiKey,enabled:null===(o=null==t?void 0:t.enabled)||void 0===o||o,level:a,orgUid:null==p?void 0:p.uid},console.log("handleSaveLlmProvider:",t,i),l(i);case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),g.yw.error(r?s.formatMessage({id:"ai.provider.update.failed"}):s.formatMessage({id:"ai.provider.create.failed"}))}))},children:r?s.formatMessage({id:"ai.provider.update"}):s.formatMessage({id:"ai.provider.confirm"})}),children:(0,q.jsxs)(z.A,{form:m,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,q.jsx)(z.A.Item,{name:"logo",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:s.formatMessage({id:"ai.provider.logo"}),children:(0,q.jsxs)(O.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),S(e)},onError:function(e){console.log("handleUploadError:",e),g.yw.error(s.formatMessage({id:"ai.provider.upload.failed"}))},children:[(0,q.jsx)(j.Z,{src:C,size:64}),(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(R.Z,{}),style:{marginLeft:8},children:s.formatMessage({id:"ai.provider.uploadLogo"})})]})}),(0,q.jsx)(D.Z,{width:"md",name:"name",label:s.formatMessage({id:"ai.provider.uniqueId"}),placeholder:s.formatMessage({id:"ai.provider.uniqueId.placeholder"}),disabled:L,rules:[{required:!0,message:s.formatMessage({id:"ai.provider.uniqueId.required"})},{pattern:/^[a-zA-Z0-9]+$/,message:s.formatMessage({id:"ai.provider.uniqueId.pattern"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}},tooltip:L?s.formatMessage({id:"ai.provider.uniqueId.system.tooltip"}):void 0}),(0,q.jsx)(D.Z,{label:s.formatMessage({id:"ai.provider.nickname"}),name:"nickname",rules:[{required:!0,message:s.formatMessage({id:"ai.provider.nickname.required"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,q.jsx)(E.Z,{label:s.formatMessage({id:"ai.provider.description"}),name:"description",fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,q.jsx)(D.Z,{label:s.formatMessage({id:"ai.provider.webUrl"}),name:"webUrl",placeholder:s.formatMessage({id:"ai.provider.webUrl.placeholder"}),rules:[{type:"url",message:s.formatMessage({id:"ai.provider.webUrl.invalid"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,q.jsx)(U.Z,{label:s.formatMessage({id:"ai.provider.status"}),name:"status",options:[{label:s.formatMessage({id:"ai.provider.status.development"}),value:P.L2A},{label:s.formatMessage({id:"ai.provider.status.production"}),value:P.KY}],rules:[{required:!0,message:s.formatMessage({id:"ai.provider.status.required"})}],fieldProps:{placeholder:s.formatMessage({id:"ai.provider.status.placeholder"})}}),(0,q.jsx)(D.Z,{label:s.formatMessage({id:"ai.provider.apiUrl"}),name:"apiUrl",placeholder:s.formatMessage({id:"ai.provider.apiUrl.placeholder"}),rules:[{required:!0,message:s.formatMessage({id:"ai.provider.apiUrl.required"})},{validator:function(e,t){return t&&t.endsWith("/")?Promise.reject(new Error(s.formatMessage({id:"ai.provider.apiUrl.noTrailingSlash"}))):Promise.resolve()}}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}},extra:s.formatMessage({id:"ai.provider.apiUrl.extra"})}),"ollama"!==(null==y?void 0:y.name)&&(0,q.jsx)(D.Z.Password,{label:s.formatMessage({id:"ai.provider.apiKey"}),name:"apiKey",fieldProps:{placeholder:s.formatMessage({id:"ai.provider.apiKey.placeholder"}),allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,q.jsx)(N.Z,{label:s.formatMessage({id:"ai.provider.enabled"}),name:"enabled",tooltip:s.formatMessage({id:"ai.provider.enabled.tooltip"}),checkedChildren:s.formatMessage({id:"ai.provider.enabled.checked"}),unCheckedChildren:s.formatMessage({id:"ai.provider.enabled.unchecked"})})]})})})},A=r(76711),B=r.n(A),K=r(16894),V=r(45034),H=r(47401),J=(0,K.Ue)()((0,V.mW)((0,V.tJ)((0,H.n)((function(e,t){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(t){e((function(e){e.llmproviderResultPlatform.data.content.unshift(t)}))},upgradeLlmProviderPlatform:function(t){e((function(e){var r=e.llmproviderResultPlatform.data.content,n=r.findIndex((function(e){return e.uid===t.uid}));-1!==n?r[n]=t:console.warn("LlmProvider with uid ".concat(t.uid," not found."))}))},setLlmProviderResultPlatform:function(r){e({llmproviderResultPlatform:r});var n,a=t().currentLlmProviderPlatform;""!==a.uid&&void 0!==a||(null===(n=r.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.length)>0&&e({currentLlmProviderPlatform:r.data.content[0]})},setCurrentLlmProviderPlatform:function(r){var n=t().llmproviderResultPlatform.data.content,o=n.findIndex((function(e){return e.uid===r.uid}));if(-1!==o){var i=[].concat(B()(n.slice(0,o)),[r],B()(n.slice(o+1))),l=a()(a()({},t().llmproviderResultPlatform),{},{data:{content:i}});e({llmproviderResultPlatform:l,currentLlmProviderPlatform:r})}else e({currentLlmProviderPlatform:r})},deleteCurrentLlmProviderPlatform:function(r){var n=t().llmproviderResultPlatform.data.content,o=n.findIndex((function(e){return e.uid===r}));-1!==o?e({llmproviderResultPlatform:a()(a()({},t().llmproviderResultPlatform),{},{data:{content:[].concat(B()(n.slice(0,o)),B()(n.slice(o+1)))}})}):console.warn("LlmProvider not found in cache:",r),t().currentLlmProviderPlatform.uid===r&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:P.dNm}))),W=["coze","dify","n8n","maxkb","ragflow"],_=function(e){var t,r,n=e.level,i=e.superUser,l=(0,v.Z)().isDarkMode,s=(0,x.useIntl)(),c=(0,h.Z)(),m=c.translateString,z=c.translateStringTranct,D=(0,Z.u)((function(e){return e.currentOrg})),E=(0,o.useState)(!1),U=f()(E,2),N=U[0],I=U[1],T=(0,o.useState)(!1),O=f()(T,2),R=O[0],A=O[1],B=(0,L.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}})),K=B.llmproviderResult,V=B.currentLlmProvider,H=B.setLlmProviderResult,_=B.insertLlmProvider,X=B.setCurrentLlmProvider,$=B.upgradeLlmProvider,Y=B.deleteCurrentLlmProvider,G=J((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),Q=G.llmproviderResultPlatform,ee=G.currentLlmProviderPlatform,te=G.setLlmProviderResultPlatform,re=G.insertLlmProviderPlatform,ne=G.setCurrentLlmProviderPlatform,ae=G.upgradeLlmProviderPlatform,oe=G.deleteCurrentLlmProviderPlatform,ie=(0,o.useState)(n===P.Hxq),le=f()(ie,1)[0],se=le?ee:V,de=y.Z.useModal(),ce=f()(de,2),ue=ce[0],me=ce[1],fe=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",t),g.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,p.HH)(t);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(g.yw.destroy(),g.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),le?oe(t.uid):Y(t.uid)):(g.yw.destroy(),g.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),pe=function(){var e=u()(d()().mark((function e(){var t,r,a,o,i,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),t={pageNumber:0,pageSize:50,sortBy:"createdAt",sortDirection:"ascend",status:n===P.Hxq?"":P.KY,orgUid:n===P.Hxq?"":null==D?void 0:D.uid,level:n},e.next=4,(0,p.mK)(t);case 4:r=e.sent,console.log("queryLlmProvidersByOrg: ",r),200===r.code?le?(te(r),(null==r||null===(a=r.data)||void 0===a?void 0:a.content.length)>0&&ne(null==r||null===(o=r.data)||void 0===o?void 0:o.content[0])):(H(r),(null==r||null===(i=r.data)||void 0===i?void 0:i.content.length)>0&&X(null==r||null===(l=r.data)||void 0===l?void 0:l.content[0])):g.yw.error(r.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){pe()}),[]);var ge=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",t),g.yw.loading(s.formatMessage({id:"creating"})),e.next=4,(0,p.T)(t);case 4:r=e.sent,console.log("createLlmProvider:",r),200===r.code?(g.yw.destroy(),g.yw.success(s.formatMessage({id:"create.success",defaultMessage:"create success"})),le?re(r.data):_(r.data),I(!1)):(g.yw.destroy(),g.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(s.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(t);case 3:r=e.sent,console.log("updateLlmProvider:",t,r),200===r.code?(g.yw.destroy(),g.yw.success(s.formatMessage({id:"update.success",defaultMessage:"update success"})),le?ae(r.data):$(r.data),I(!1)):(g.yw.destroy(),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)("div",{style:{margin:10},children:(0,q.jsxs)(M.Z,{gap:"small",align:"flex-start",children:[(0,q.jsx)(w.ZP,{size:"small",type:"primary",icon:(0,q.jsx)(S.Z,{}),onClick:function(){console.log("new llmProvider"),A(!1),I(!0)},children:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,q.jsx)(w.ZP,{size:"small",onClick:function(){console.log("edit llmProvider"),A(!0),I(!0)},disabled:""===(null==se?void 0:se.uid),children:s.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,q.jsx)(w.ZP,{onClick:function(){return function(e){ue.confirm({title:s.formatMessage({id:"deleteTip"}),icon:(0,q.jsx)(C.Z,{}),content:"".concat(s.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(m(e.nickname),"】？"),onOk:function(){fe(e)},onCancel:function(){},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}(se)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==se?void 0:se.uid),children:s.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,q.jsx)(b.Z,{itemLayout:"horizontal",dataSource:(le?(null==Q||null===(t=Q.data)||void 0===t?void 0:t.content)||[]:(null==K||null===(r=K.data)||void 0===r?void 0:r.content)||[]).filter((function(e){return!W.includes(e.name)})),renderItem:function(e,t){return(0,q.jsx)(b.Z.Item,{style:a()(a()({},(null==se?void 0:se.uid)===e.uid?{backgroundColor:l?"#333333":"#dddddd"}:{}),{},{cursor:"pointer"}),onClick:function(){return t=e,void(le?ne(t):X(t));var t},children:(0,q.jsx)(b.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,q.jsx)(j.Z,{src:e.logo}),title:(0,q.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,q.jsx)("span",{children:z(null==e?void 0:e.nickname)}),(0,q.jsx)(k.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?s.formatMessage({id:"ai.provider.status.enabled"}):s.formatMessage({id:"ai.provider.status.disabled"})})]}),description:(0,q.jsxs)("div",{children:[i&&(0,q.jsx)("div",{children:(null==e?void 0:e.status)===P.KY?s.formatMessage({id:"ai.provider.status.production"}):s.formatMessage({id:"ai.provider.status.development"})}),(null==e?void 0:e.description)&&(0,q.jsx)("div",{style:{marginTop:i?"4px":"0",color:"#666"},children:e.description})]})})})}}),N&&(0,q.jsx)(F,{open:N,isEdit:R,level:n,llmProvider:se,onCancel:function(){I(!1)},onSubmit:function(e){R?ve(e):ge(e)}}),me]})},X=r(37963),$=r(86222),Y=r.n($),G=r(41282),Q=r(13775),ee=r(8340),te=r(93892),re=r(49616),ne=r(82373),ae=r(27473),oe=r(27259),ie=r(85817),le=r(38166),se=function(e){var t=e.isEdit,r=e.llmmodel,n=e.provider,a=e.open,i=e.level,l=e.onClose,s=e.onSubmit,d=z.A.useForm(),c=f()(d,1)[0],u=(0,x.useIntl)(),m=(0,Z.u)((function(e){return e.currentOrg})),p=[{label:u.formatMessage({id:"model.type.text"}),value:P.l55},{label:u.formatMessage({id:"model.type.embedding"}),value:P.xTq},{label:u.formatMessage({id:"model.type.rerank"}),value:P.SeQ},{label:u.formatMessage({id:"model.type.vision"}),value:P.xZ8},{label:u.formatMessage({id:"model.type.code"}),value:P.rrk},{label:u.formatMessage({id:"model.type.reasoning"}),value:P.GNM},{label:u.formatMessage({id:"model.type.text2image"}),value:P.eQL},{label:u.formatMessage({id:"model.type.image2text"}),value:P.ztv},{label:u.formatMessage({id:"model.type.audio2text"}),value:P._D8},{label:u.formatMessage({id:"model.type.text2audio"}),value:P.YNO},{label:u.formatMessage({id:"model.type.text2video"}),value:P.GZK},{label:u.formatMessage({id:"model.type.video2text"}),value:P.B6M}];(0,o.useEffect)((function(){var e;t&&r&&c?c.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname,description:null==r?void 0:r.description,type:null==r?void 0:r.type,enabled:null!==(e=null==r?void 0:r.enabled)&&void 0!==e&&e}):(console.log("form resetFields"),c.resetFields(),c.setFieldValue("type",P.l55),c.setFieldValue("enabled",!0))}),[r]);return(0,o.useEffect)((function(){}),[r]),(0,q.jsx)("div",{children:(0,q.jsx)(T.Z,{title:t?u.formatMessage({id:"model.edit"}):u.formatMessage({id:"model.create"}),width:600,onClose:l,open:a,extra:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(w.ZP,{onClick:l,children:u.formatMessage({id:"cancel"})}),(0,q.jsx)(w.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var a;console.log("Form values:",e);var o={uid:t?null==r?void 0:r.uid:"",name:e.name,nickname:e.nickname,description:e.description,type:e.type,enabled:null===(a=e.enabled)||void 0===a||a,providerUid:null==n?void 0:n.uid,providerName:null==n?void 0:n.name,level:i,orgUid:null==m?void 0:m.uid};console.log("llmmodelObject:",o),s(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:u.formatMessage({id:"ok"})})]}),children:(0,q.jsxs)(z.A,{form:c,name:"model",submitter:!1,children:[(0,q.jsx)(D.Z,{label:u.formatMessage({id:"model.name"}),name:"name"}),(0,q.jsx)(D.Z,{label:u.formatMessage({id:"model.nickname"}),name:"nickname"}),(0,q.jsx)(E.Z,{label:u.formatMessage({id:"model.description"}),name:"description",placeholder:u.formatMessage({id:"model.description.placeholder"}),fieldProps:{rows:3,maxLength:500,showCount:!0}}),(0,q.jsx)(U.Z,{label:u.formatMessage({id:"model.type"}),name:"type",options:p,placeholder:u.formatMessage({id:"model.type.placeholder"}),rules:[{required:!0,message:u.formatMessage({id:"model.type.required"})}]}),(0,q.jsx)(N.Z,{label:u.formatMessage({id:"model.enabled",defaultMessage:"启用状态"}),name:"enabled",tooltip:u.formatMessage({id:"model.enabled.tooltip",defaultMessage:"是否启用该大模型"}),checkedChildren:u.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:u.formatMessage({id:"disabled",defaultMessage:"禁用"})})]})})})},de=r(11090),ce=r(59304),ue=r(80556),me=r(30617),fe=r(90727),pe=r(53504),ge=r(61155),ve=ie.Z.Text,he=function(e){var t=e.provider,r=e.open,n=(e.level,e.onClose),a=e.onSubmit,i=e.existingModels,l=void 0===i?[]:i,s=(0,x.useIntl)(),c=(0,o.useState)(!1),m=f()(c,2),p=m[0],v=m[1],h=(0,o.useState)([]),y=f()(h,2),M=y[0],b=y[1],j=(0,o.useState)([]),Z=f()(j,2),C=Z[0],S=Z[1],L=function(e){return l.some((function(t){return t.name===e.name}))},z=function(){var e=u()(d()().mark((function e(){var r,n,a,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,r={pageNumber:0,pageSize:100,level:P.Hxq,providerName:t.name},e.next=5,(0,G.LF)(r);case 5:n=e.sent,console.log("获取平台模型列表:",n),200===n.code?(a=n.data.content||[],b(a),o=a.filter((function(e){return L(e)})).map((function(e){return e.uid})),S(o)):g.yw.error(n.message||s.formatMessage({id:"ai.model.import.fetchFailed"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),g.yw.error(s.formatMessage({id:"ai.model.import.fetchError"}));case 14:return e.prev=14,v(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){r&&z()}),[r]);var D=[{title:s.formatMessage({id:"ai.model.import.modelName"}),dataIndex:"name",key:"name",render:function(e,t){return(0,q.jsxs)(re.Z,{children:[e,L(t)&&(0,q.jsx)(k.Z,{color:"green",children:s.formatMessage({id:"ai.model.import.alreadyExists"})})]})}},{title:s.formatMessage({id:"ai.model.import.modelNickname"}),dataIndex:"nickname",key:"nickname"},{title:s.formatMessage({id:"ai.model.import.modelDescription"}),dataIndex:"description",key:"description",ellipsis:!0}],E={selectedRowKeys:C,onChange:function(e){S(e)}};return(0,q.jsxs)(T.Z,{title:s.formatMessage({id:"ai.model.import.title"},{provider:t.nickname}),width:700,open:r,onClose:n,destroyOnClose:!0,footer:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(w.ZP,{onClick:n,children:s.formatMessage({id:"ai.model.import.cancel"})}),(0,q.jsx)(w.ZP,{type:"primary",onClick:function(){if(0!==C.length){var e=M.filter((function(e){return C.includes(e.uid)}));a(e)}else g.yw.warning(s.formatMessage({id:"ai.model.import.noSelection"}))},disabled:0===C.length,children:s.formatMessage({id:"ai.model.import.importSelected"},{count:C.length})})]}),children:[(0,q.jsxs)(ve,{type:"secondary",children:[s.formatMessage({id:"ai.model.import.description"},{provider:t.nickname}),l.length>0&&(0,q.jsx)(ve,{type:"secondary",style:{marginLeft:8},children:s.formatMessage({id:"ai.model.import.existingTip"})})]}),(0,q.jsx)("div",{style:{marginTop:16},children:(0,q.jsx)(pe.Z,{spinning:p,children:(0,q.jsx)(ge.Z,{rowKey:"uid",columns:D,dataSource:M,pagination:{pageSize:10},rowSelection:E,size:"small"})})}),0===M.length&&!p&&(0,q.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,q.jsx)(ve,{type:"secondary",children:s.formatMessage({id:"ai.model.import.noPlatformModels"})})})]})},xe=function(e){var t=e.provider,r=e.level,n=(0,x.useIntl)(),i=(0,v.Z)().isDarkMode,l=(0,o.useState)(!0),s=f()(l,2),c=s[0],m=s[1],M=(0,o.useState)(!0),k=f()(M,2),z=k[0],D=k[1],E=(0,h.Z)().translateString,U=(0,o.useState)(),N=f()(U,2),I=N[0],T=N[1],O=(0,o.useState)(!1),R=f()(O,2),A=R[0],B=R[1],K=(0,o.useState)(!1),V=f()(K,2),H=V[0],J=V[1],W=(0,Z.u)((function(e){return e.currentOrg})),_=(0,o.useState)([]),X=f()(_,2),$=X[0],pe=X[1],ge=(0,L.A)((function(e){return e.upgradeLlmProvider})),ve=y.Z.useModal(),xe=f()(ve,2),ye=xe[0],Me=xe[1],we=(0,o.useState)(!1),be=f()(we,2),je=be[0],ke=be[1],Ze=(0,o.useState)(""),Pe=f()(Ze,2),Ce=Pe[0],Se=Pe[1],Le=(0,o.useState)(!1),ze=f()(Le,2),De=ze[0],Ee=ze[1],Ue=(0,o.useState)(!1),Ne=f()(Ue,2),Ie=Ne[0],Te=Ne[1],Oe=(0,o.useState)(!1),Re=f()(Oe,2),qe=Re[0],Fe=Re[1],Ae=(0,o.useState)({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," / ").concat(e)},pageSizeOptions:["10","20","50","100"]}),Be=f()(Ae,2),Ke=Be[0],Ve=Be[1],He=(0,o.useState)(window.innerHeight),Je=f()(He,2),We=(Je[0],Je[1]);(0,o.useEffect)((function(){var e=function(){We(window.innerHeight)};return window.addEventListener("resize",e),function(){return window.removeEventListener("resize",e)}}),[]);var _e=(0,L.A)((function(e){var t;return(null===(t=e.llmproviderResult)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.content)||[]})).find((function(e){return e.uid===(null==t?void 0:t.uid)}))||t,Xe=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",t),g.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,G.Oh)(t);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),$e(Ke.current,Ke.pageSize,Ce)):(g.yw.destroy(),g.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$e=function(){var e=u()(d()().mark((function e(){var t,n,o,i,l,s=arguments;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=s.length>0&&void 0!==s[0]?s[0]:1,n=s.length>1&&void 0!==s[1]?s[1]:10,o=s.length>2&&void 0!==s[2]?s[2]:Ce,console.log("requestModels",{page:t,size:n,search:o}),Ee(!0),i={pageNumber:t-1,pageSize:n,providerUid:null==_e?void 0:_e.uid,orgUid:null==W?void 0:W.uid,level:r,searchText:o},e.next=8,(0,G.LF)(i);case 8:l=e.sent,console.log("queryLlmModelsByOrg: ",l,i),200===l.code?(pe(l.data.content),Ve((function(e){return a()(a()({},e),{},{current:t,pageSize:n,total:l.data.totalElements||0})})),Ee(!1)):(Ee(!1),g.yw.error(l.message));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ye=function(){var e=u()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Fe(!0),e.prev=1,e.next=4,$e(Ke.current,Ke.pageSize,Ce);case 4:return e.prev=4,Fe(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(){return e.apply(this,arguments)}}(),Ge=function(){var e=u()(d()().mark((function e(){var t,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("refreshProvider"),null!=_e&&_e.uid){e.next=4;break}return g.yw.error(n.formatMessage({id:"provider.uid.notexist"})),e.abrupt("return");case 4:return Te(!0),g.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),t={uid:_e.uid,orgUid:null==W?void 0:W.uid,level:r},e.prev=7,e.next=10,(0,p.N0)(t);case 10:a=e.sent,console.log("queryLlmProviderByUid: ",a,t),200===a.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"provider.refresh.success"})),ge(a.data)):(g.yw.destroy(),g.yw.error(a.message)),e.next=20;break;case 15:e.prev=15,e.t0=e.catch(7),g.yw.destroy(),g.yw.error(n.formatMessage({id:"provider.refresh.failed"})),console.error("refreshProvider error:",e.t0);case 20:return e.prev=20,Te(!1),e.finish(20);case 23:case"end":return e.stop()}}),e,null,[[7,15,20,23]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){$e(1,10)}),[]),(0,o.useEffect)((function(){var e=function(e){if(!(A||H||je)&&(e.ctrlKey||e.metaKey))switch(e.key){case"r":e.preventDefault(),Ye();break;case"n":e.preventDefault(),m(!1),B(!0)}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[Ke.current,Ke.pageSize,A,H,je]);var Qe=function(){B(!1)},et=function(){J(!1)},tt=function(){var e=u()(d()().mark((function e(t){var r,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",t),!c){e.next=9;break}return e.next=4,(0,G.WS)(t);case 4:r=e.sent,console.log("updateLlmModel:",r.data),200===r.code?(g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),$e(Ke.current,Ke.pageSize,Ce),Qe()):g.yw.error(r.message),e.next=14;break;case 9:return e.next=11,(0,G.Jr)(t);case 11:a=e.sent,console.log("createLlmModel:",a.data),200===a.code?(g.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),$e(1,Ke.pageSize,Ce),Qe()):g.yw.error(a.message);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),rt=function(){var e=u()(d()().mark((function e(t){var a,o,i,l,s,c,u,m;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",t),t&&0!==t.length){e.next=5;break}return g.yw.warning(n.formatMessage({id:"model.import.none.selected"})),et(),e.abrupt("return");case 5:if(a=$.map((function(e){return e.name})),o=t.filter((function(e){return!a.includes(e.name)})),0!==o.length){e.next=11;break}return g.yw.info(n.formatMessage({id:"model.import.already.exist"})),et(),e.abrupt("return");case 11:g.yw.loading("".concat(n.formatMessage({id:"loading"})).concat(o.length).concat(n.formatMessage({id:"model.add"}),"...")),e.prev=12,i=0,l=Y()(o),e.prev=15,l.s();case 17:if((s=l.n()).done){e.next=27;break}return c=s.value,u={name:c.name,nickname:c.nickname,description:c.description,type:c.type,enabled:!0,providerUid:_e.uid,providerName:_e.name,orgUid:null==W?void 0:W.uid,level:r},e.next=22,(0,G.Jr)(u);case 22:m=e.sent,console.log("createLlmModel:",m,u),200===m.code&&i++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),l.e(e.t0);case 32:return e.prev=32,l.f(),e.finish(32);case 35:g.yw.destroy(),i>0?(g.yw.success(n.formatMessage({id:"model.import.success"},{count:i})),$e(1,Ke.pageSize,Ce)):g.yw.warning(n.formatMessage({id:"model.import.none.success"})),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),g.yw.destroy(),g.yw.error(n.formatMessage({id:"model.import.failed"}));case 44:et();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(t){return e.apply(this,arguments)}}(),nt=function(){var e=u()(d()().mark((function e(t){var r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",_e),r=a()(a()({},_e),{},{status:t?P.KY:P.L2A}),e.next=4,(0,p.fx)(r);case 4:o=e.sent,console.log("updateLlmProvider:",r,o),200===o.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),ge(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),at=function(e){var t;console.log("list on delete",e),t=e,ye.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,q.jsx)(C.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(E(t.nickname),"】？"),onOk:function(){Xe(t)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})},ot=function(){var e=u()(d()().mark((function e(t){var r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch enabled to ".concat(t)),r=a()(a()({},_e),{},{enabled:t}),g.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,p.fx)(r);case 5:o=e.sent,console.log("updateLlmProvider enabled:",r,o),200===o.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),ge(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),it=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(n.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(t);case 3:r=e.sent,console.log("updateLlmProvider:",t,r),200===r.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),ge(r.data),ke(!1)):(g.yw.destroy(),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),lt=function(){var e=u()(d()().mark((function e(t,o){var i,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch model enabled to ".concat(t),o),i=a()(a()({},o),{},{enabled:t,providerUid:null==_e?void 0:_e.uid,orgUid:null==W?void 0:W.uid,level:r}),g.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,G.WS)(i);case 5:l=e.sent,console.log("updateLlmModel enabled:",i,l),200===l.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),pe((function(e){return e.map((function(e){return e.uid===o.uid?a()(a()({},e),{},{enabled:t}):e}))}))):(g.yw.destroy(),g.yw.error(l.message));case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return(0,q.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,q.jsxs)("div",{style:{flexShrink:0,padding:"16px 24px",borderBottom:"1px solid #f0f0f0"},children:[(0,q.jsxs)("h1",{children:[(0,q.jsx)(j.Z,{src:null==_e?void 0:_e.logo}),(0,q.jsx)("span",{style:{marginLeft:"12px"},children:null==_e?void 0:_e.nickname}),(0,q.jsx)(ee.Z,{checked:null==_e?void 0:_e.enabled,onChange:ot,checkedChildren:n.formatMessage({id:"provider.enabled"}),unCheckedChildren:n.formatMessage({id:"provider.disabled"}),style:{marginLeft:"8px"}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(de.Z,{}),onClick:function(){window.open(null==_e?void 0:_e.webUrl,"_blank")}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){D(!0),ke(!0)}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(ue.Z,{}),loading:Ie,onClick:Ge})]}),(null==_e?void 0:_e.description)&&(0,q.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:_e.description}),(0,q.jsx)(te.Z,{message:n.formatMessage({id:"provider.config.alert"}),type:null!=_e&&_e.enabled?"success":"warning",showIcon:!0,style:{marginBottom:"16px"}}),(0,q.jsx)("div",{style:{marginBottom:"16px"},children:(0,q.jsxs)(re.Z,{direction:"vertical",style:{width:"100%"},children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("span",{children:["apiUrl: ",null==_e?void 0:_e.apiUrl]}),(0,q.jsx)(w.ZP,{type:"link",size:"small",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){D(!0),ke(!0)},children:n.formatMessage({id:"provider.edit"})})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("span",{children:["apiKey: ",null!=_e&&_e.apiKey?"".concat(_e.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),(0,q.jsx)(w.ZP,{type:"link",size:"small",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){D(!0),ke(!0)},children:n.formatMessage({id:"provider.edit"})})]})]})}),!(null!=_e&&_e.apiKey)&&(0,q.jsx)(te.Z,{message:n.formatMessage({id:"provider.apikey.empty.warning",defaultMessage:"API Key未配置"}),description:n.formatMessage({id:"provider.apikey.empty.description",defaultMessage:"请配置API Key以正常使用AI服务"}),type:"warning",showIcon:!0,style:{marginBottom:"16px"},action:(0,q.jsx)(w.ZP,{size:"small",type:"primary",onClick:function(){D(!0),ke(!0)},children:n.formatMessage({id:"provider.config.now",defaultMessage:"立即配置"})})}),r===P.Hxq&&(0,q.jsx)(ee.Z,{checkedChildren:n.formatMessage({id:"provider.online"}),unCheckedChildren:n.formatMessage({id:"provider.offline"}),defaultChecked:(null==_e?void 0:_e.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),nt(e)}}),(0,q.jsx)(ne.Z,{orientation:"left",children:n.formatMessage({id:"model.list"})}),(0,q.jsxs)(re.Z,{wrap:!0,children:[(0,q.jsx)(ae.Z,{title:"".concat(n.formatMessage({id:"model.add"})," (Ctrl/Cmd + N)"),children:(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(S.Z,{}),type:"primary",onClick:function(){m(!1),B(!0)},children:n.formatMessage({id:"model.add"})})}),"ollama"!==_e.name&&r===P.whQ&&(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(me.Z,{}),onClick:function(){return J(!0)},children:n.formatMessage({id:"model.import"})}),(0,q.jsx)(ae.Z,{title:"".concat(n.formatMessage({id:"model.refresh"})," (Ctrl/Cmd + R)"),children:(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(ue.Z,{}),loading:qe,onClick:Ye,children:n.formatMessage({id:"model.refresh"})})}),(0,q.jsx)(oe.Z.Search,{placeholder:n.formatMessage({id:"model.search.placeholder",defaultMessage:"搜索模型名称或描述..."}),allowClear:!0,enterButton:(0,q.jsx)(fe.Z,{}),value:Ce,onChange:function(e){return Se(e.target.value)},onSearch:function(e){Se(e),$e(1,Ke.pageSize,e)},onClear:function(){Se(""),$e(1,Ke.pageSize,"")},style:{maxWidth:300}})]})]}),(0,q.jsx)("div",{className:"llm-model-list-container",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px 24px 0 24px",display:"flex",flexDirection:"column"},children:(0,q.jsx)(b.Z,{itemLayout:"horizontal",className:"llm-model-list",loading:De,dataSource:$,pagination:!1,renderItem:function(e,t){return(0,q.jsx)(b.Z.Item,{style:(null==I?void 0:I.uid)===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(e)},actions:[(0,q.jsx)(w.ZP,{type:"link",onClick:function(){return t=e,console.log("list on edit",t),T(t),m(!0),void B(!0);var t},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,q.jsx)(w.ZP,{type:"link",onClick:function(){return at(e)},children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,q.jsx)(b.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,q.jsxs)(re.Z,{children:[(0,q.jsxs)("span",{style:{color:"#999",fontWeight:"normal",minWidth:"30px",fontSize:"14px"},children:[(Ke.current-1)*Ke.pageSize+t+1,"."]}),(0,q.jsx)("span",{children:e.nickname}),(0,Q.Rb)(e.type),(0,q.jsx)(ee.Z,{size:"small",checked:e.enabled,onChange:function(t){return lt(t,e)},checkedChildren:n.formatMessage({id:"model.enabled"}),unCheckedChildren:n.formatMessage({id:"model.disabled"})},"enabled")]}),description:(0,q.jsxs)("div",{children:[(0,q.jsx)(ie.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,q.jsx)("div",{style:{marginTop:"4px"},children:(0,q.jsx)(ie.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}})}),(0,q.jsx)("div",{style:{flexShrink:0,padding:"16px 24px 26px 24px",borderTop:i?"1px solid #333":"1px solid #f0f0f0",backgroundColor:i?"#141414":"#f5f5f5",display:"flex",justifyContent:"center"},children:$.length>0&&(0,q.jsx)(le.Z,{current:Ke.current,pageSize:Ke.pageSize,total:Ke.total,showSizeChanger:Ke.showSizeChanger,showQuickJumper:Ke.showQuickJumper,showTotal:Ke.showTotal,pageSizeOptions:Ke.pageSizeOptions,onChange:function(e,t){console.log("Pagination onChange:",{page:e,pageSize:t}),$e(e,t,Ce)},onShowSizeChange:function(e,t){console.log("Pagination onShowSizeChange:",{current:e,size:t}),$e(1,t,Ce)}})}),A&&(0,q.jsx)(se,{isEdit:c,llmmodel:I,provider:_e,open:A,level:r,onClose:Qe,onSubmit:tt}),H&&(0,q.jsx)(he,{provider:_e,open:H,level:r,onClose:et,onSubmit:rt,existingModels:$}),je&&(0,q.jsx)(F,{open:je,isEdit:z,level:r,llmProvider:_e,onCancel:function(){return ke(!1)},onSubmit:it}),Me]})},ye=r(52202),Me=r(77274),we=r(82690),be=r(54881),je=r(67652),ke=r(33363),Ze=r(34042),Pe=r(93689),Ce=r(77260),Se={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M624 706.3h-74.1V464c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v242.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.7a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9z"}},{tag:"path",attrs:{d:"M811.4 366.7C765.6 245.9 648.9 160 512.2 160S258.8 245.8 213 366.6C127.3 389.1 64 467.2 64 560c0 110.5 89.5 200 199.9 200H304c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8h-40.1c-33.7 0-65.4-13.4-89-37.7-23.5-24.2-36-56.8-34.9-90.6.9-26.4 9.9-51.2 26.2-72.1 16.7-21.3 40.1-36.8 66.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10C846.1 454.5 884 503.8 884 560c0 33.1-12.9 64.3-36.3 87.7a123.07 123.07 0 01-87.6 36.3H720c-4.4 0-8 3.6-8 8v60c0 4.4 3.6 8 8 8h40.1C870.5 760 960 670.5 960 560c0-92.7-63.1-170.7-148.6-193.3z"}}]},name:"cloud-download",theme:"outlined"},Le=r(54183),ze=function(e,t){return o.createElement(Le.Z,(0,Ce.Z)({},e,{ref:t,icon:Se}))};var De=o.forwardRef(ze),Ee=function(e,t,r){var n=function(e,t,r){var n=e.toLowerCase(),a=(null==t?void 0:t.toLowerCase())||"",o=(null==r?void 0:r.toLowerCase())||"";return n.includes("llama")||n.includes("mistral")||n.includes("gemma")||n.includes("phi")?"chat":n.includes("embedding")||n.includes("embed")||n.includes("instructor")?"embedding":n.includes("vision")||n.includes("llava")||n.includes("bakllava")||n.includes("qwen-vl")?"vision":n.includes("code")||n.includes("codellama")||n.includes("wizardcoder")?"code":n.includes("rerank")||n.includes("bge-rerank")?"rerank":n.includes("audio")||n.includes("whisper")?"audio2text":n.includes("text2image")||n.includes("stable-diffusion")?"text2image":a.includes("llama")||a.includes("mistral")||a.includes("gemma")?"chat":a.includes("embedding")?"embedding":a.includes("vision")||a.includes("multimodal")?"vision":a.includes("code")?"code":(o.includes("gguf")||o.includes("ggml"),"chat")}(e,t,r),a="default",o=n;switch(n){case"chat":a="blue",o="对话";break;case"embedding":a="purple",o="向量嵌入";break;case"vision":a="green",o="视觉";break;case"code":a="cyan",o="代码";break;case"rerank":a="cyan",o="排序";break;case"audio2text":a="volcano",o="语音转文本";break;case"text2image":a="magenta",o="文本生成图像";break;default:a="default",o=n}return(0,q.jsx)(k.Z,{color:a,children:o})},Ue=function(e){var t,r,n,a,i,l,s,d,c,u,m,p,g,v=e.visible,h=e.onClose,y=e.modelName,M=e.modelDetails,j=e.loading,Z=e.onRefresh,P=e.onPull,C=e.onDelete,S=(e.isRemoteModel,e.isLocalModel),L=e.pullingModelName,z=e.localModelNames,D=void 0===z?[]:z,E=(0,x.useIntl)(),U=(0,o.useState)(""),N=f()(U,2),I=N[0],O=N[1],R=M&&"model"in M&&"tags"in M,F=M&&"license"in M&&"modelfile"in M,A=D.includes(y);return(0,q.jsxs)(T.Z,{title:E.formatMessage({id:"ai.ollama.modelDetails.title"},{modelName:y}),width:600,placement:"right",onClose:h,open:v,zIndex:1002,children:[j?(0,q.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:(0,q.jsx)(pe.Z,{tip:E.formatMessage({id:"ai.ollama.modelDetails.loading"}),spinning:!0,children:(0,q.jsx)("div",{style:{padding:"50px",backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"4px",minHeight:"200px"}})})}):M?(0,q.jsxs)(q.Fragment,{children:[R&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsxs)(Ze.Z,{bordered:!0,column:1,title:E.formatMessage({id:"ai.ollama.modelDetails.basicInfo"}),styles:{label:{width:"120px"}},children:[(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.name"}),children:(0,q.jsxs)(re.Z,{children:[(null===(t=M.model)||void 0===t?void 0:t.name)||y,A&&(0,q.jsx)(k.Z,{color:"success",children:E.formatMessage({id:"ai.ollama.modelDetails.installed"})})]})}),(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Ee(y)}),(null===(r=M.model)||void 0===r?void 0:r.description)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.description"}),children:M.model.description}),(null===(n=M.model)||void 0===n?void 0:n.lastUpdated)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),children:M.model.lastUpdated}),(null===(a=M.model)||void 0===a?void 0:a.pullCount)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.pullCount"}),children:M.model.pullCount}),(null===(i=M.model)||void 0===i?void 0:i.totalTags)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.totalTags"}),children:M.model.totalTags}),(null===(l=M.model)||void 0===l?void 0:l.popularTags)&&M.model.popularTags.length>0&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.popularTags"}),children:(0,q.jsx)(re.Z,{wrap:!0,children:M.model.popularTags.map((function(e,t){return(0,q.jsx)(k.Z,{color:"blue",children:e},t)}))})}),(null===(s=M.model)||void 0===s?void 0:s.modified_at)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.modifiedAt"}),children:(0,ke.mr)(M.model.modified_at.toString())})]}),M.tags&&M.tags.length>0&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(ne.Z,{orientation:"left",children:E.formatMessage({id:"ai.ollama.modelDetails.availableVersions"})}),(0,q.jsx)(oe.Z,{placeholder:E.formatMessage({id:"ai.ollama.modelDetails.searchVersions"}),prefix:(0,q.jsx)(fe.Z,{}),value:I,onChange:function(e){return O(e.target.value)},style:{marginBottom:16},allowClear:!0}),(0,q.jsx)(b.Z,{itemLayout:"horizontal",dataSource:function(){if(!R||!M.tags)return[];var e=M.tags;if(!I)return e;var t=I.toLowerCase();return e.filter((function(e){return e.tag.toLowerCase().includes(t)||e.name.toLowerCase().includes(t)}))}(),renderItem:function(e){var t=function(e,t){var r="".concat(e,":").concat(t);return D.includes(r)}(y,e.tag),r="".concat(y,":").concat(e.tag);return(0,q.jsxs)(b.Z.Item,{children:[(0,q.jsx)(b.Z.Item.Meta,{title:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)("span",{children:e.name}),(0,q.jsx)(k.Z,{color:"green",children:e.tag}),Ee(y),e.size&&(0,q.jsx)(k.Z,{color:"orange",children:e.size}),t&&(0,q.jsx)(k.Z,{color:"success",children:E.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,q.jsxs)("span",{children:[E.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),": ",e.lastUpdated]})}),(0,q.jsx)(re.Z,{children:(0,q.jsx)(ae.Z,{title:t?E.formatMessage({id:"ai.ollama.modelDetails.versionExists"}):E.formatMessage({id:"ai.ollama.modelDetails.pullThisVersion"}),children:(0,q.jsx)(w.ZP,{type:"primary",size:"small",icon:t?(0,q.jsx)(Pe.Z,{}):(0,q.jsx)(De,{}),loading:L===r,onClick:function(){P(r)},disabled:t,children:t?E.formatMessage({id:"ai.ollama.modelDetails.installed"}):E.formatMessage({id:"ai.ollama.modelDetails.pullVersion"})})})})]})}})]})]}),F&&(0,q.jsxs)(Ze.Z,{bordered:!0,column:1,title:E.formatMessage({id:"ai.ollama.modelDetails.localModel"}),styles:{label:{width:"120px"}},children:[(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Ee(y,null===(d=M.details)||void 0===d?void 0:d.family,null===(c=M.details)||void 0===c?void 0:c.format)}),(null===(u=M.details)||void 0===u?void 0:u.format)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.modelFormat"}),children:M.details.format}),(null===(m=M.details)||void 0===m?void 0:m.family)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.modelFamily"}),children:M.details.family}),(null===(p=M.details)||void 0===p?void 0:p.parameter_size)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.parameterSize"}),children:M.details.parameter_size}),(null===(g=M.details)||void 0===g?void 0:g.quantization_level)&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.quantizationLevel"}),children:M.details.quantization_level}),M.system&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.systemInfo"}),children:M.system}),M.template&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.template"}),children:(0,q.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:M.template})}),M.modelfile&&(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.modelfile"}),children:(0,q.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:M.modelfile})}),(0,q.jsx)(Ze.Z.Item,{label:E.formatMessage({id:"ai.ollama.modelDetails.license"}),children:M.license})]})]}):(0,q.jsx)(te.Z,{message:E.formatMessage({id:"ai.ollama.modelDetails.error"}),type:"warning"}),(0,q.jsx)(ne.Z,{}),(0,q.jsxs)(re.Z,{children:[!j&&(0,q.jsx)(w.ZP,{type:"primary",onClick:function(){return Z(y)},icon:(0,q.jsx)(ue.Z,{}),children:E.formatMessage({id:"ai.ollama.modelDetails.refresh"})}),S&&(0,q.jsx)(je.Z,{title:E.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:E.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:y}),onConfirm:function(){C(y),h()},okText:E.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:E.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),children:(0,q.jsx)(w.ZP,{type:"primary",danger:!0,icon:(0,q.jsx)(be.Z,{}),children:E.formatMessage({id:"ai.ollama.modelDetails.delete"})})})]})]})},Ne=function(e){var t=e.visible,r=e.onClose,n=e.models,a=e.loading,i=e.onRefresh,l=e.onModelDetails,s=e.onPull,d=e.pullingModelName,c=e.localModelNames,u=void 0===c?[]:c,m=(0,x.useIntl)(),p=(0,o.useState)(""),g=f()(p,2),v=g[0],h=g[1],y=n.filter((function(e){var t=v.toLowerCase();return e.name.toLowerCase().includes(t)||e.description&&e.description.toLowerCase().includes(t)||e.popularTags&&e.popularTags.some((function(e){return e.toLowerCase().includes(t)}))}));return(0,q.jsxs)(T.Z,{title:m.formatMessage({id:"ai.ollama.title"}),width:600,placement:"right",onClose:r,open:t,zIndex:1001,children:[(0,q.jsxs)(re.Z,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[(0,q.jsxs)(re.Z,{style:{width:"100%",justifyContent:"space-between"},children:[(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(ue.Z,{}),loading:a,onClick:i,children:m.formatMessage({id:"ai.ollama.refreshRemote"})}),(0,q.jsx)("span",{style:{color:"#999",fontSize:"14px"},children:m.formatMessage({id:"ai.ollama.modelDetails.modelCount"},{filteredCount:y.length,totalCount:n.length})})]}),(0,q.jsx)(oe.Z,{placeholder:m.formatMessage({id:"ai.ollama.modelDetails.searchModels"}),prefix:(0,q.jsx)(fe.Z,{}),onChange:function(e){return h(e.target.value)},allowClear:!0})]}),(0,q.jsx)(b.Z,{itemLayout:"vertical",loading:a,dataSource:y,renderItem:function(e){var t,r,n=(r=e.name,u.includes(r));return(0,q.jsx)(b.Z.Item,{extra:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(w.ZP,{type:"default",icon:(0,q.jsx)(we.Z,{}),onClick:function(){return l(e.name)},style:{marginRight:8},children:m.formatMessage({id:"ai.ollama.modelDetails.details"})}),(0,q.jsx)(ae.Z,{title:n?m.formatMessage({id:"ai.ollama.modelDetails.modelExistsTooltip"}):m.formatMessage({id:"ai.ollama.modelDetails.modelNotExistsTooltip"}),children:(0,q.jsx)(w.ZP,{type:"primary",icon:n?(0,q.jsx)(Pe.Z,{}):(0,q.jsx)(De,{}),loading:d===e.name,onClick:function(){return s(e.name)},disabled:n,children:n?m.formatMessage({id:"ai.ollama.modelDetails.installed"}):m.formatMessage({id:"ai.ollama.modelDetails.pullModel"})})})]}),children:(0,q.jsx)(b.Z.Item.Meta,{title:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)("strong",{children:e.name}),Ee(e.name),n&&(0,q.jsx)(k.Z,{color:"success",children:m.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,q.jsxs)(re.Z,{direction:"vertical",style:{width:"100%"},children:[(0,q.jsxs)(re.Z,{children:[e.pullCount&&(0,q.jsx)(k.Z,{color:"cyan",children:m.formatMessage({id:"ai.ollama.modelDetails.downloads"},{count:e.pullCount})}),e.lastUpdated&&(0,q.jsx)(k.Z,{color:"orange",children:m.formatMessage({id:"ai.ollama.modelDetails.updated"},{time:e.lastUpdated})})]}),(0,q.jsx)("div",{children:e.description||m.formatMessage({id:"ai.ollama.modelDetails.noDescription"})}),(0,q.jsx)(re.Z,{style:{marginTop:8},children:null===(t=e.popularTags)||void 0===t?void 0:t.map((function(e,t){return(0,q.jsx)(k.Z,{color:"blue",children:e},t)}))})]})})})}})]})},Ie=function(e){var t=e.provider,r=e.level,n=(0,x.useIntl)(),i=(0,v.Z)().isDarkMode,l=(0,o.useState)(!1),s=f()(l,2),c=s[0],m=s[1],h=(0,o.useState)(!1),y=f()(h,2),M=y[0],Z=y[1],P=(0,o.useState)(!1),C=f()(P,2),S=C[0],z=C[1],D=(0,o.useState)([]),E=f()(D,2),U=E[0],N=E[1],I=(0,o.useState)(!1),T=f()(I,2),O=T[0],R=T[1],A=(0,L.A)((function(e){return e.upgradeLlmProvider})),B=(0,o.useState)(),K=f()(B,2),V=K[0],H=K[1],J=(0,L.A)((function(e){var t;return(null===(t=e.llmproviderResult)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.content)||[]})).find((function(e){return e.uid===(null==t?void 0:t.uid)}))||t,W=(0,o.useState)(!1),_=f()(W,2),X=_[0],$=_[1],Y=(0,o.useState)([]),G=f()(Y,2),Q=G[0],oe=G[1],ie=(0,o.useState)(!1),le=f()(ie,2),se=le[0],me=le[1],fe=(0,o.useState)(""),pe=f()(fe,2),ge=pe[0],ve=pe[1],he=(0,o.useState)(""),xe=f()(he,2),Ze=xe[0],Pe=xe[1],Ce=(0,o.useState)(!1),Se=f()(Ce,2),Le=Se[0],ze=Se[1],De=(0,o.useState)(!1),Ie=f()(De,2),Te=Ie[0],Oe=Ie[1],Re=(0,o.useState)(null),qe=f()(Re,2),Fe=qe[0],Ae=qe[1],Be=(0,o.useState)(""),Ke=f()(Be,2),Ve=Ke[0],He=Ke[1],Je=function(){var e=u()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=J&&J.apiUrl){e.next=4;break}return g.yw.error(n.formatMessage({id:"ai.ollama.apiUrlNotConfigured"})),z(!1),e.abrupt("return");case 4:return console.log("pingOllama",null==J?void 0:J.apiUrl),t={apiUrl:null==J?void 0:J.apiUrl},e.next=8,(0,ye.VM)(t);case 8:r=e.sent,console.log("getOllamaServerStatus: ",r,t),200===r.code?z(r.data):z(!1);case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),We=function(){var e=u()(d()().mark((function e(){var t,r,n;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),Z(!0),t={apiUrl:null==J?void 0:J.apiUrl},e.next=5,(0,ye.c8)(t);case 5:r=e.sent,console.log("getOllamaLocalModels: ",r,t),200===r.code&&(n=r.data.map((function(e){var t=e.name.split(":"),r=t[0]||e.name,n=t.length>1?t[1]:"default";return a()(a()({},e),{},{modelName:r,modelVersion:n})})),N(n)),Z(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_e=function(){var e=u()(d()().mark((function e(){var t,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return me(!0),t={apiUrl:null==J?void 0:J.apiUrl},e.next=4,(0,ye.rg)(t);case 4:r=e.sent,console.log("getOllamaLibraryModels: ",r,t),200===r.code?oe(r.data):g.yw.error(r.message||n.formatMessage({id:"ai.ollama.remoteModels.fetchFailed"})),me(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Xe=function(){var e=u()(d()().mark((function e(){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return m(!0),e.prev=1,e.next=4,Promise.all([Je(),We()]);case 4:return e.prev=4,m(!1),e.finish(4);case 7:case"end":return e.stop()}}),e,null,[[1,,4,7]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){Xe()}),[]),(0,o.useEffect)((function(){var e=function(e){if(!(O||X||Le)&&(e.ctrlKey||e.metaKey))switch(e.key){case"r":e.preventDefault(),Xe();break;case"m":e.preventDefault(),$e()}};return document.addEventListener("keydown",e),function(){return document.removeEventListener("keydown",e)}}),[O,X,Le]);var $e=function(){$(!0),_e()},Ye=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(n.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(t);case 3:r=e.sent,console.log("updateLlmProvider:",t,r),200===r.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),A(r.data),R(!1)):(g.yw.destroy(),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ge=function(){var e=u()(d()().mark((function e(t){var r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("switch enabled to ".concat(t)),!t||S){e.next=4;break}return g.yw.error(n.formatMessage({id:"ai.ollama.startFirst"})),e.abrupt("return");case 4:return r=a()(a()({},J),{},{enabled:t}),g.yw.loading(n.formatMessage({id:"updating"})),e.next=8,(0,p.fx)(r);case 8:o=e.sent,console.log("updateLlmProvider enabled:",r,o),200===o.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),A(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 11:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Qe=function(){var e=u()(d()().mark((function e(t){var r,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S){e.next=3;break}return g.yw.error(n.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return ve(t),g.yw.loading(n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.loading"},{modelName:t})),e.prev=5,r={apiUrl:null==J?void 0:J.apiUrl,model:t},e.next=9,(0,ye.G9)(r);case 9:a=e.sent,console.log("deleteOllamaModel:",a.data,t),200===a.code&&a.data?(g.yw.success(n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.success"},{modelName:t})),We()):g.yw.error(a.message||n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.failed"},{modelName:t})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),console.error("删除模型出错:",e.t0),g.yw.error(n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.error"},{error:e.t0}));case 18:return e.prev=18,ve(""),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[5,14,18,21]])})));return function(t){return e.apply(this,arguments)}}(),et=function(){var e=u()(d()().mark((function e(t){var r,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S){e.next=3;break}return g.yw.error(n.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return Pe(t),g.yw.loading(n.formatMessage({id:"ai.ollama.modelDetails.pulling"},{modelName:t})),e.prev=5,r={apiUrl:null==J?void 0:J.apiUrl,model:t},e.next=9,(0,ye.N6)(r);case 9:200===(a=e.sent).code&&a.data?(g.yw.success(n.formatMessage({id:"ai.ollama.modelDetails.pullSuccess"},{modelName:t})),$(!1),We()):g.yw.error(a.message||n.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:t})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error("拉取模型出错:",e.t0),g.yw.error(n.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:t}));case 17:return e.prev=17,Pe(""),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})));return function(t){return e.apply(this,arguments)}}(),tt=function(){var e=u()(d()().mark((function e(t){var r,a,o,i,l,s;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Oe(!0),He(t),ze(!0),e.prev=3,r=U.some((function(e){return e.name===t})),a=Q.some((function(e){return e.name===t})),!r){e.next=14;break}return i={apiUrl:null==J?void 0:J.apiUrl,model:t},e.next=10,(0,ye.sF)(i);case 10:o=e.sent,console.log("getOllamaModelDetails (local):",o),e.next=27;break;case 14:if(!a){e.next=22;break}return l={apiUrl:null==J?void 0:J.apiUrl,model:t},e.next=18,(0,ye.gF)(l);case 18:o=e.sent,console.log("getOllamaLibraryModelDetails (remote):",o),e.next=27;break;case 22:return s={apiUrl:null==J?void 0:J.apiUrl,model:t},e.next=25,(0,ye.gF)(s);case 25:o=e.sent,console.log("getOllamaLibraryModelDetails (default):",o);case 27:200===o.code?Ae(o.data):(g.yw.error(o.message||n.formatMessage({id:"ai.ollama.modelDetails.fetchFailed"},{modelName:t})),Ae(null)),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(3),console.error("获取模型详情出错:",e.t0),g.yw.error(n.formatMessage({id:"ai.ollama.modelDetails.fetchError"},{error:e.t0})),Ae(null);case 35:return e.prev=35,Oe(!1),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[3,30,35,38]])})));return function(t){return e.apply(this,arguments)}}();return(0,q.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,q.jsxs)("div",{style:{flexShrink:0,padding:"16px 24px",borderBottom:"1px solid #f0f0f0"},children:[(0,q.jsxs)("h1",{children:[(0,q.jsx)(j.Z,{src:null==J?void 0:J.logo}),(0,q.jsx)("span",{style:{marginLeft:"12px"},children:null==J?void 0:J.nickname}),(0,q.jsx)(ee.Z,{checked:null==J?void 0:J.enabled,onChange:Ge,checkedChildren:n.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.checked"}),unCheckedChildren:n.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.unchecked"}),style:{marginLeft:"8px"}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(de.Z,{}),onClick:function(){window.open(null==J?void 0:J.webUrl,"_blank")}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){return R(!0)}})]}),(null==J?void 0:J.description)&&(0,q.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:J.description}),(0,q.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,q.jsxs)("span",{children:["apiUrl: ",null==J?void 0:J.apiUrl]}),(0,q.jsx)(w.ZP,{type:"link",size:"small",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){return R(!0)},children:n.formatMessage({id:"ai.ollama.modelDetails.edit"})})]}),(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(ae.Z,{title:"".concat(n.formatMessage({id:"ai.ollama.refresh"})," (Ctrl/Cmd + R)"),children:(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(ue.Z,{}),loading:c,type:"primary",onClick:Xe,children:n.formatMessage({id:"ai.ollama.refresh"})})}),(0,q.jsx)(ae.Z,{title:"".concat(n.formatMessage({id:"ai.ollama.remoteModels"})," (Ctrl/Cmd + M)"),children:(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(Me.Z,{}),type:"primary",onClick:$e,children:n.formatMessage({id:"ai.ollama.remoteModels"})})})]}),(0,q.jsx)("br",{}),(0,q.jsx)("br",{}),S?(0,q.jsx)(te.Z,{message:n.formatMessage({id:"ai.ollama.running"}),type:"success"}):(0,q.jsx)(te.Z,{message:n.formatMessage({id:"ai.ollama.notRunning"}),type:"error"}),(0,q.jsx)(ne.Z,{orientation:"left",children:n.formatMessage({id:"ai.ollama.localModels"})})]}),(0,q.jsx)("div",{className:"llm-model-list-container",style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px 24px"},children:(0,q.jsx)(b.Z,{itemLayout:"horizontal",className:"llm-model-list",loading:M,dataSource:U,renderItem:function(e,t){return(0,q.jsx)(b.Z.Item,{style:(null==V?void 0:V.name)===(null==e?void 0:e.name)?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){H(e)},actions:[(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(we.Z,{}),onClick:function(t){t.stopPropagation(),tt(null==e?void 0:e.name)},children:n.formatMessage({id:"ai.ollama.modelDetails.details"})},"details"),(0,q.jsx)(je.Z,{title:n.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:n.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:null==e?void 0:e.name}),onConfirm:function(t){null==t||t.stopPropagation(),Qe(null==e?void 0:e.modelName)},okText:n.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:n.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),onCancel:function(e){return null==e?void 0:e.stopPropagation()},children:(0,q.jsx)(w.ZP,{type:"text",danger:!0,icon:(0,q.jsx)(be.Z,{}),loading:ge===(null==e?void 0:e.modelName),onClick:function(e){return e.stopPropagation()},children:n.formatMessage({id:"ai.ollama.modelDetails.deleteModel"})})},"delete")],children:(0,q.jsx)(b.Z.Item.Meta,{title:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)("span",{children:null==e?void 0:e.modelName}),(0,q.jsx)(k.Z,{color:"blue",children:null==e?void 0:e.modelVersion}),Ee(null==e?void 0:e.modelName,null==e?void 0:e.family,null==e?void 0:e.format),(null==e?void 0:e.size)&&(0,q.jsx)(k.Z,{color:"green",children:(0,ke.sS)(null==e?void 0:e.size)}),(null==e?void 0:e.parameter_size)&&(0,q.jsx)(ae.Z,{title:"参数大小",children:(0,q.jsx)(k.Z,{color:"purple",children:null==e?void 0:e.parameter_size})})]}),description:(0,q.jsxs)(re.Z,{direction:"vertical",children:[(0,q.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.fullName"},{name:null==e?void 0:e.name})}),(0,q.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.digest"},{digest:null==e?void 0:e.digest})}),(null==e?void 0:e.family)&&(0,q.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.family"},{family:null==e?void 0:e.family})}),(null==e?void 0:e.quantization_level)&&(0,q.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.quantization"},{level:null==e?void 0:e.quantization_level})}),(0,q.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.updateTime"},{time:(0,ke.mr)(null==e?void 0:e.modified_at.toString())})})]}),style:{marginLeft:"15px"}})})}})}),(0,q.jsx)(Ne,{visible:X,onClose:function(){return $(!1)},models:Q,loading:se,onRefresh:_e,onModelDetails:tt,onPull:et,pullingModelName:Ze,localModelNames:U.map((function(e){return e.modelName}))}),(0,q.jsx)(Ue,{visible:Le,onClose:function(){return ze(!1)},modelName:Ve,modelDetails:Fe,loading:Te,onRefresh:tt,onPull:et,onDelete:Qe,isRemoteModel:Q.some((function(e){return e.name===Ve})),isLocalModel:U.some((function(e){return e.name===Ve})),pullingModelName:Ze,localModelNames:U.map((function(e){return e.name}))}),O&&(0,q.jsx)(F,{open:O,isEdit:!0,level:r,llmProvider:J,onCancel:function(){return R(!1)},onSubmit:Ye})]})},Te=function(e){var t=e.isEdit,r=e.llmmodel,n=e.provider,a=e.open,i=e.level,l=e.onClose,s=e.onSubmit,d=z.A.useForm(),c=f()(d,1)[0],u=(0,x.useIntl)(),m=(0,Z.u)((function(e){return e.currentOrg})),p=[{label:u.formatMessage({id:"model.type.text"}),value:P.l55},{label:u.formatMessage({id:"model.type.embedding"}),value:P.xTq},{label:u.formatMessage({id:"model.type.rerank"}),value:P.SeQ},{label:u.formatMessage({id:"model.type.vision"}),value:P.xZ8},{label:u.formatMessage({id:"model.type.code"}),value:P.rrk},{label:u.formatMessage({id:"model.type.reasoning"}),value:P.GNM},{label:u.formatMessage({id:"model.type.text2image"}),value:P.eQL},{label:u.formatMessage({id:"model.type.image2text"}),value:P.ztv},{label:u.formatMessage({id:"model.type.audio2text"}),value:P._D8},{label:u.formatMessage({id:"model.type.text2audio"}),value:P.YNO},{label:u.formatMessage({id:"model.type.text2video"}),value:P.GZK},{label:u.formatMessage({id:"model.type.video2text"}),value:P.B6M}];(0,o.useEffect)((function(){var e;t&&r&&c?c.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname,description:null==r?void 0:r.description,type:null==r?void 0:r.type,enabled:null!==(e=null==r?void 0:r.enabled)&&void 0!==e&&e}):(console.log("form resetFields"),c.resetFields(),c.setFieldValue("type",P.l55),c.setFieldValue("enabled",!0))}),[r]);return(0,o.useEffect)((function(){}),[r]),(0,q.jsx)("div",{children:(0,q.jsx)(T.Z,{title:t?u.formatMessage({id:"model.edit"}):u.formatMessage({id:"model.create"}),width:600,onClose:l,open:a,extra:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(w.ZP,{onClick:l,children:u.formatMessage({id:"cancel"})}),(0,q.jsx)(w.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var a;console.log("Form values:",e);var o={uid:t?null==r?void 0:r.uid:"",name:e.name,nickname:e.nickname,description:e.description,type:e.type,enabled:null===(a=e.enabled)||void 0===a||a,providerUid:null==n?void 0:n.uid,providerName:null==n?void 0:n.name,level:i,orgUid:null==m?void 0:m.uid};console.log("llmmodelObject:",o),s(o)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:u.formatMessage({id:"ok"})})]}),children:(0,q.jsxs)(z.A,{form:c,name:"model",submitter:!1,children:[(0,q.jsx)(D.Z,{label:u.formatMessage({id:"model.name"}),name:"name"}),(0,q.jsx)(D.Z,{label:u.formatMessage({id:"model.nickname"}),name:"nickname"}),(0,q.jsx)(E.Z,{label:u.formatMessage({id:"model.description"}),name:"description",placeholder:u.formatMessage({id:"model.description.placeholder"}),fieldProps:{rows:3,maxLength:500,showCount:!0}}),(0,q.jsx)(U.Z,{label:u.formatMessage({id:"model.type"}),name:"type",options:p,placeholder:u.formatMessage({id:"model.type.placeholder"}),rules:[{required:!0,message:u.formatMessage({id:"model.type.required"})}]}),(0,q.jsx)(N.Z,{label:u.formatMessage({id:"model.enabled",defaultMessage:"启用状态"}),name:"enabled",tooltip:u.formatMessage({id:"model.enabled.tooltip",defaultMessage:"是否启用该大模型"}),checkedChildren:u.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:u.formatMessage({id:"disabled",defaultMessage:"禁用"})})]})})})},Oe=ie.Z.Text,Re=function(e){var t=e.provider,r=e.open,n=(e.level,e.onClose),a=e.onSubmit,i=e.existingModels,l=void 0===i?[]:i,s=(0,x.useIntl)(),c=(0,o.useState)(!1),m=f()(c,2),p=m[0],v=m[1],h=(0,o.useState)([]),y=f()(h,2),M=y[0],b=y[1],j=(0,o.useState)([]),Z=f()(j,2),C=Z[0],S=Z[1],L=function(e){return l.some((function(t){return t.name===e.name}))},z=function(){var e=u()(d()().mark((function e(){var r,n,a,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return v(!0),e.prev=1,r={pageNumber:0,pageSize:100,level:P.Hxq,providerName:t.name},e.next=5,(0,G.LF)(r);case 5:n=e.sent,console.log("获取平台模型列表:",n),200===n.code?(a=n.data.content||[],b(a),o=a.filter((function(e){return L(e)})).map((function(e){return e.uid})),S(o)):g.yw.error(n.message||s.formatMessage({id:"ai.model.import.fetchFailed"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),g.yw.error(s.formatMessage({id:"ai.model.import.fetchError"}));case 14:return e.prev=14,v(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){r&&z()}),[r]);var D=[{title:s.formatMessage({id:"ai.model.import.modelName"}),dataIndex:"name",key:"name",render:function(e,t){return(0,q.jsxs)(re.Z,{children:[e,L(t)&&(0,q.jsx)(k.Z,{color:"green",children:s.formatMessage({id:"ai.model.import.alreadyExists"})})]})}},{title:s.formatMessage({id:"ai.model.import.modelNickname"}),dataIndex:"nickname",key:"nickname"},{title:s.formatMessage({id:"ai.model.import.modelDescription"}),dataIndex:"description",key:"description",ellipsis:!0}],E={selectedRowKeys:C,onChange:function(e){S(e)}};return(0,q.jsxs)(T.Z,{title:s.formatMessage({id:"ai.model.import.title"},{provider:t.nickname}),width:700,open:r,onClose:n,destroyOnClose:!0,footer:(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(w.ZP,{onClick:n,children:s.formatMessage({id:"ai.model.import.cancel"})}),(0,q.jsx)(w.ZP,{type:"primary",onClick:function(){if(0!==C.length){var e=M.filter((function(e){return C.includes(e.uid)}));a(e)}else g.yw.warning(s.formatMessage({id:"ai.model.import.noSelection"}))},disabled:0===C.length,children:s.formatMessage({id:"ai.model.import.importSelected"},{count:C.length})})]}),children:[(0,q.jsxs)(Oe,{type:"secondary",children:[s.formatMessage({id:"ai.model.import.description"},{provider:t.nickname}),l.length>0&&(0,q.jsx)(Oe,{type:"secondary",style:{marginLeft:8},children:s.formatMessage({id:"ai.model.import.existingTip"})})]}),(0,q.jsx)("div",{style:{marginTop:16},children:(0,q.jsx)(pe.Z,{spinning:p,children:(0,q.jsx)(ge.Z,{rowKey:"uid",columns:D,dataSource:M,pagination:{pageSize:10},rowSelection:E,size:"small"})})}),0===M.length&&!p&&(0,q.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,q.jsx)(Oe,{type:"secondary",children:s.formatMessage({id:"ai.model.import.noPlatformModels"})})})]})},qe=function(e){var t=e.provider,r=e.level,n=(0,x.useIntl)(),i=(0,v.Z)().isDarkMode,l=(0,o.useState)(!0),s=f()(l,2),c=s[0],m=s[1],M=(0,o.useState)(!0),k=f()(M,2),z=k[0],D=k[1],E=(0,h.Z)().translateString,U=(0,o.useState)(),N=f()(U,2),I=N[0],T=N[1],O=(0,o.useState)(!1),R=f()(O,2),A=R[0],B=R[1],K=(0,o.useState)(!1),V=f()(K,2),H=V[0],J=V[1],W=(0,Z.u)((function(e){return e.currentOrg})),_=(0,o.useState)([]),X=f()(_,2),$=X[0],ae=X[1],oe=(0,L.A)((function(e){return e.upgradeLlmProvider})),se=y.Z.useModal(),fe=f()(se,2),pe=fe[0],ge=fe[1],ve=(0,o.useState)(!1),he=f()(ve,2),xe=he[0],ye=he[1],Me=(0,o.useState)(!1),we=f()(Me,2),be=we[0],je=we[1],ke=(0,o.useState)({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," / ").concat(e)},pageSizeOptions:["10","20","50","100"]}),Ze=f()(ke,2),Pe=Ze[0],Ce=Ze[1],Se=(0,L.A)((function(e){var t;return(null===(t=e.llmproviderResult)||void 0===t||null===(t=t.data)||void 0===t?void 0:t.content)||[]})).find((function(e){return e.uid===(null==t?void 0:t.uid)}))||t,Le=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",t),g.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,G.Oh)(t);case 4:r=e.sent,console.log("delete robot response",r),200===r.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),ze(Pe.current,Pe.pageSize)):(g.yw.destroy(),g.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ze=function(){var e=u()(d()().mark((function e(){var t,n,o,i,l=arguments;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=l.length>0&&void 0!==l[0]?l[0]:1,n=l.length>1&&void 0!==l[1]?l[1]:10,console.log("requestModels",{page:t,size:n}),je(!0),o={pageNumber:t-1,pageSize:n,providerUid:null==Se?void 0:Se.uid,orgUid:null==W?void 0:W.uid,level:r},e.next=7,(0,G.LF)(o);case 7:i=e.sent,console.log("queryLlmModelsByOrg: ",i,o),200===i.code?(ae(i.data.content),Ce((function(e){return a()(a()({},e),{},{current:t,pageSize:n,total:i.data.totalElements||0})})),je(!1)):(je(!1),g.yw.error(i.message));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),De=function(){var e=u()(d()().mark((function e(){var t,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("refreshProvider"),null!=Se&&Se.uid){e.next=4;break}return g.yw.error(n.formatMessage({id:"provider.uid.notexist"})),e.abrupt("return");case 4:return g.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),t={uid:Se.uid,orgUid:null==W?void 0:W.uid,level:r},e.prev=6,e.next=9,(0,p.N0)(t);case 9:a=e.sent,console.log("queryLlmProviderByUid: ",a,t),200===a.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"provider.refresh.success"})),oe(a.data)):(g.yw.destroy(),g.yw.error(a.message)),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(6),g.yw.destroy(),g.yw.error(n.formatMessage({id:"provider.refresh.failed"})),console.error("refreshProvider error:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[6,14]])})));return function(){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){ze(1,10)}),[]);var Ee=function(){B(!1)},Ue=function(){J(!1)},Ne=function(){var e=u()(d()().mark((function e(t){var r,a;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",t),!c){e.next=9;break}return e.next=4,(0,G.WS)(t);case 4:r=e.sent,console.log("updateLlmModel:",r.data),200===r.code?(g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),ze(Pe.current,Pe.pageSize),Ee()):g.yw.error(r.message),e.next=14;break;case 9:return e.next=11,(0,G.Jr)(t);case 11:a=e.sent,console.log("createLlmModel:",a.data),200===a.code?(g.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),ze(1,Pe.pageSize),Ee()):g.yw.error(a.message);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=u()(d()().mark((function e(t){var a,o,i,l,s,c,u,m;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",t),t&&0!==t.length){e.next=5;break}return g.yw.warning(n.formatMessage({id:"model.import.none.selected"})),Ue(),e.abrupt("return");case 5:if(a=$.map((function(e){return e.name})),o=t.filter((function(e){return!a.includes(e.name)})),0!==o.length){e.next=11;break}return g.yw.info(n.formatMessage({id:"model.import.already.exist"})),Ue(),e.abrupt("return");case 11:g.yw.loading("".concat(n.formatMessage({id:"loading"})).concat(o.length).concat(n.formatMessage({id:"model.add"}),"...")),e.prev=12,i=0,l=Y()(o),e.prev=15,l.s();case 17:if((s=l.n()).done){e.next=27;break}return c=s.value,u={name:c.name,nickname:c.nickname,description:c.description,type:c.type,enabled:!0,providerUid:Se.uid,providerName:Se.name,orgUid:null==W?void 0:W.uid,level:r},e.next=22,(0,G.Jr)(u);case 22:m=e.sent,console.log("createLlmModel:",m,u),200===m.code&&i++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),l.e(e.t0);case 32:return e.prev=32,l.f(),e.finish(32);case 35:g.yw.destroy(),i>0?(g.yw.success(n.formatMessage({id:"model.import.success"},{count:i})),ze(1,Pe.pageSize)):g.yw.warning(n.formatMessage({id:"model.import.none.success"})),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),g.yw.destroy(),g.yw.error(n.formatMessage({id:"model.import.failed"}));case 44:Ue();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(t){return e.apply(this,arguments)}}(),Oe=function(){var e=u()(d()().mark((function e(t){var r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",Se),r=a()(a()({},Se),{},{status:t?P.KY:P.L2A}),e.next=4,(0,p.fx)(r);case 4:o=e.sent,console.log("updateLlmProvider:",r,o),200===o.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),oe(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),qe=function(e){var t;console.log("list on delete",e),t=e,pe.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,q.jsx)(C.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(E(t.nickname),"】？"),onOk:function(){Le(t)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})},Fe=function(){var e=u()(d()().mark((function e(t){var r,o;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch enabled to ".concat(t)),r=a()(a()({},Se),{},{enabled:t}),g.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,p.fx)(r);case 5:o=e.sent,console.log("updateLlmProvider enabled:",r,o),200===o.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),oe(o.data)):(g.yw.destroy(),g.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ae=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return g.yw.loading(n.formatMessage({id:"updating"})),e.next=3,(0,p.fx)(t);case 3:r=e.sent,console.log("updateLlmProvider:",t,r),200===r.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),oe(r.data),ye(!1)):(g.yw.destroy(),g.yw.error(r.message));case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Be=function(){var e=u()(d()().mark((function e(t,o){var i,l;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch model enabled to ".concat(t),o),i=a()(a()({},o),{},{enabled:t,providerUid:null==Se?void 0:Se.uid,orgUid:null==W?void 0:W.uid,level:r}),g.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,G.WS)(i);case 5:l=e.sent,console.log("updateLlmModel enabled:",i,l),200===l.code?(g.yw.destroy(),g.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),ae((function(e){return e.map((function(e){return e.uid===o.uid?a()(a()({},e),{},{enabled:t}):e}))}))):(g.yw.destroy(),g.yw.error(l.message));case 8:case"end":return e.stop()}}),e)})));return function(t,r){return e.apply(this,arguments)}}();return(0,q.jsxs)("div",{style:{height:"100%",display:"flex",flexDirection:"column",overflow:"hidden"},children:[(0,q.jsxs)("div",{style:{flexShrink:0,padding:"16px 24px",borderBottom:"1px solid #f0f0f0"},children:[(0,q.jsxs)("h1",{children:[(0,q.jsx)(j.Z,{src:null==Se?void 0:Se.logo}),(0,q.jsx)("span",{style:{marginLeft:"12px"},children:null==Se?void 0:Se.nickname}),(0,q.jsx)(ee.Z,{checked:null==Se?void 0:Se.enabled,onChange:Fe,checkedChildren:n.formatMessage({id:"provider.enabled"}),unCheckedChildren:n.formatMessage({id:"provider.disabled"}),style:{marginLeft:"8px"}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(de.Z,{}),onClick:function(){window.open(null==Se?void 0:Se.webUrl,"_blank")}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){D(!0),ye(!0)}}),(0,q.jsx)(w.ZP,{type:"text",icon:(0,q.jsx)(ue.Z,{}),onClick:De})]}),(null==Se?void 0:Se.description)&&(0,q.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:Se.description}),(0,q.jsx)(te.Z,{message:n.formatMessage({id:"provider.config.alert"}),type:null!=Se&&Se.enabled?"success":"warning",showIcon:!0,style:{marginBottom:"16px"}}),(0,q.jsx)("div",{style:{marginBottom:"16px"},children:(0,q.jsxs)(re.Z,{direction:"vertical",style:{width:"100%"},children:[(0,q.jsxs)("div",{children:[(0,q.jsxs)("span",{children:["apiUrl: ",null==Se?void 0:Se.apiUrl]}),(0,q.jsx)(w.ZP,{type:"link",size:"small",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){D(!0),ye(!0)},children:n.formatMessage({id:"provider.edit"})})]}),(0,q.jsxs)("div",{children:[(0,q.jsxs)("span",{children:["apiKey: ",null!=Se&&Se.apiKey?"".concat(Se.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),(0,q.jsx)(w.ZP,{type:"link",size:"small",icon:(0,q.jsx)(ce.Z,{}),onClick:function(){D(!0),ye(!0)},children:n.formatMessage({id:"provider.edit"})})]})]})}),r===P.Hxq&&(0,q.jsx)(ee.Z,{checkedChildren:n.formatMessage({id:"provider.online"}),unCheckedChildren:n.formatMessage({id:"provider.offline"}),defaultChecked:(null==Se?void 0:Se.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),Oe(e)}})]}),(0,q.jsxs)("div",{style:{flex:1,overflowY:"auto",overflowX:"hidden",padding:"16px 24px 0 24px",display:"flex",flexDirection:"column"},children:[(0,q.jsx)(ne.Z,{orientation:"left",children:n.formatMessage({id:"model.list"})}),(0,q.jsxs)(re.Z,{children:[(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(S.Z,{}),type:"primary",onClick:function(){m(!1),B(!0)},children:n.formatMessage({id:"model.add"})}),"ollama"!==Se.name&&r===P.whQ&&(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(me.Z,{}),onClick:function(){return J(!0)},children:n.formatMessage({id:"model.import"})}),(0,q.jsx)(w.ZP,{icon:(0,q.jsx)(ue.Z,{}),onClick:function(){return ze(Pe.current,Pe.pageSize)},children:n.formatMessage({id:"model.refresh"})})]}),(0,q.jsx)(b.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:be,dataSource:$,pagination:!1,renderItem:function(e,t){return(0,q.jsx)(b.Z.Item,{style:(null==I?void 0:I.uid)===e.uid?{backgroundColor:i?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(e)},actions:[(0,q.jsx)(w.ZP,{type:"link",onClick:function(){return t=e,console.log("list on edit",t),T(t),m(!0),void B(!0);var t},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,q.jsx)(w.ZP,{type:"link",onClick:function(){return qe(e)},children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,q.jsx)(b.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,q.jsxs)(re.Z,{children:[(0,q.jsxs)("span",{style:{color:"#999",fontWeight:"normal",minWidth:"30px",fontSize:"14px"},children:[(Pe.current-1)*Pe.pageSize+t+1,"."]}),(0,q.jsx)("span",{children:e.nickname}),(0,Q.Rb)(e.type),(0,q.jsx)(ee.Z,{size:"small",checked:e.enabled,onChange:function(t){return Be(t,e)},checkedChildren:n.formatMessage({id:"model.enabled"}),unCheckedChildren:n.formatMessage({id:"model.disabled"})},"enabled")]}),description:(0,q.jsxs)("div",{children:[(0,q.jsx)(ie.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,q.jsx)("div",{style:{marginTop:"4px"},children:(0,q.jsx)(ie.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}})]}),(0,q.jsx)("div",{style:{flexShrink:0,padding:"16px 24px",borderTop:i?"1px solid #333":"1px solid #f0f0f0",backgroundColor:i?"#141414":"#f5f5f5",display:"flex",justifyContent:"center"},children:$.length>0&&(0,q.jsx)(le.Z,{current:Pe.current,pageSize:Pe.pageSize,total:Pe.total,showSizeChanger:Pe.showSizeChanger,showQuickJumper:Pe.showQuickJumper,showTotal:Pe.showTotal,pageSizeOptions:Pe.pageSizeOptions,onChange:function(e,t){console.log("Pagination onChange:",{page:e,pageSize:t}),ze(e,t)},onShowSizeChange:function(e,t){console.log("Pagination onShowSizeChange:",{current:e,size:t}),ze(1,t)}})}),A&&(0,q.jsx)(Te,{isEdit:c,llmmodel:I,provider:Se,open:A,level:r,onClose:Ee,onSubmit:Ne}),H&&(0,q.jsx)(Re,{provider:Se,open:H,level:r,onClose:Ue,onSubmit:Ie,existingModels:$}),xe&&(0,q.jsx)(F,{open:xe,isEdit:z,level:r,llmProvider:Se,onCancel:function(){return ye(!1)},onSubmit:Ae}),ge]})},Fe=function(e){var t=e.level,r=(0,o.useState)(""),n=f()(r,2),a=n[0],i=n[1],l=(0,o.useState)([]),s=f()(l,2),d=s[0],c=s[1];(0,o.useEffect)((function(){return document.body.classList.add("no-scroll"),function(){document.body.classList.remove("no-scroll")}}),[]);var u=(0,L.A)((function(e){return{currentLlmProvider:e.currentLlmProvider,llmproviderResult:e.llmproviderResult,setCurrentLlmProvider:e.setCurrentLlmProvider}})),m=u.currentLlmProvider,p=u.llmproviderResult,g=u.setCurrentLlmProvider,v=J((function(e){return{currentLlmProviderPlatform:e.currentLlmProviderPlatform,llmproviderResultPlatform:e.llmproviderResultPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform}})),h=v.currentLlmProviderPlatform,x=v.llmproviderResultPlatform,y=v.setCurrentLlmProviderPlatform,M=(0,o.useState)(t===P.Hxq),w=f()(M,1)[0],b=w?h:m;(0,o.useEffect)((function(){if(b&&b.name)if(console.log("llmProvider: ",b),d.find((function(e){return e.key===b.name})))i(b.name);else{var e=B()(d);b.name===P.j9I?e.push({label:b.nickname||b.name,children:(0,q.jsx)("div",{className:"llm-provider-tab-pane-content",children:(0,q.jsx)(Ie,{provider:b,level:t})}),key:b.name,closable:!0}):b.name===P.rZG?e.push({label:b.nickname||b.name,children:(0,q.jsx)("div",{className:"llm-provider-tab-pane-content",children:(0,q.jsx)(qe,{provider:b,level:t})}),key:b.name,closable:!0}):e.push({label:b.nickname||b.name,children:(0,q.jsx)("div",{className:"llm-provider-tab-pane-content",children:(0,q.jsx)(xe,{provider:b,level:t})}),key:b.name,closable:!0}),c(e),i(b.name)}}),[b,d]);return 0===d.length?null:(0,q.jsx)("div",{className:"llm-provider-tab-container",children:(0,q.jsx)(X.Z,{type:"editable-card",onChange:function(e){var t,r;i(e);var n=(w?(null==x||null===(t=x.data)||void 0===t?void 0:t.content)||[]:(null==p||null===(r=p.data)||void 0===r?void 0:r.content)||[]).find((function(t){return t.name===e}));n&&(w?y(n):g(n))},activeKey:a,onEdit:function(e,t){"remove"===t&&function(e){var t=a,r=-1;d.forEach((function(t,n){t.key===e&&(r=n-1)}));var n=d.filter((function(t){return t.key!==e}));if(n.length&&t===e){var o,l;t=r>=0?n[r].key:n[0].key;var s=(w?(null==x||null===(o=x.data)||void 0===o?void 0:o.content)||[]:(null==p||null===(l=p.data)||void 0===l?void 0:l.content)||[]).find((function(e){return e.name===t}));s&&(w?y(s):g(s))}c(n),i(t)}(e)},items:d,className:"llm-provider-tabs",hideAdd:!0})})},Ae=l.Z.Sider,Be=l.Z.Content,Ke=function(){var e=(0,i.Z)(),t=e.leftSiderStyle,r=e.leftSiderWidth,n=e.contentStyle,o=a()(a()({},n),{},{overflow:"hidden",height:"calc(100vh - 100px)",maxHeight:"calc(100vh - 100px)",paddingBottom:"100px"});return(0,q.jsx)(q.Fragment,{children:(0,q.jsxs)(l.Z,{children:[(0,q.jsx)(Ae,{style:t,width:r,children:(0,q.jsx)(_,{level:P.whQ,superUser:!1})}),(0,q.jsx)(l.Z,{children:(0,q.jsx)(Be,{style:o,children:(0,q.jsx)(Fe,{level:P.whQ,superUser:!1})})})]})})}},67652:function(e,t,r){r.d(t,{Z:function(){return Z}});var n=r(44194),a=r(64985),o=r(51865),i=r.n(o),l=r(81424),s=r(34573),d=r(35779),c=r(26411),u=r(92114),m=r(58065),f=r(5780),p=r(55308),g=r(90972),v=r(54444),h=r(96047),x=r(79255);var y=(0,x.I$)("Popconfirm",(e=>(e=>{const{componentCls:t,iconCls:r,antCls:n,zIndexPopup:a,colorText:o,colorWarning:i,marginXXS:l,marginXS:s,fontSize:d,fontWeightStrong:c,colorTextHeading:u}=e;return{[t]:{zIndex:a,[`&${n}-popover`]:{fontSize:d},[`${t}-message`]:{marginBottom:s,display:"flex",flexWrap:"nowrap",alignItems:"start",[`> ${t}-message-icon ${r}`]:{color:i,fontSize:d,lineHeight:1,marginInlineEnd:s},[`${t}-title`]:{fontWeight:c,color:u,"&:only-child":{fontWeight:"normal"}},[`${t}-description`]:{marginTop:l,color:o}},[`${t}-buttons`]:{textAlign:"end",whiteSpace:"nowrap",button:{marginInlineStart:s}}}}})(e)),(e=>{const{zIndexPopupBase:t}=e;return{zIndexPopup:t+60}}),{resetStyle:!1}),M=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};const w=e=>{const{prefixCls:t,okButtonProps:r,cancelButtonProps:o,title:i,description:l,cancelText:s,okText:c,okType:h="primary",icon:x=n.createElement(a.Z,null),showCancel:y=!0,close:M,onConfirm:w,onCancel:b,onPopupClick:j}=e,{getPrefixCls:k}=n.useContext(d.E_),[Z]=(0,g.Z)("Popconfirm",v.Z.Popconfirm),P=(0,m.Z)(i),C=(0,m.Z)(l);return n.createElement("div",{className:`${t}-inner-content`,onClick:j},n.createElement("div",{className:`${t}-message`},x&&n.createElement("span",{className:`${t}-message-icon`},x),n.createElement("div",{className:`${t}-message-text`},P&&n.createElement("div",{className:`${t}-title`},P),C&&n.createElement("div",{className:`${t}-description`},C))),n.createElement("div",{className:`${t}-buttons`},y&&n.createElement(f.ZP,Object.assign({onClick:b,size:"small"},o),s||(null==Z?void 0:Z.cancelText)),n.createElement(u.Z,{buttonProps:Object.assign(Object.assign({size:"small"},(0,p.nx)(h)),r),actionFn:w,close:M,prefixCls:k("btn"),quitOnNullishReturnValue:!0,emitEvent:!0},c||(null==Z?void 0:Z.okText))))};var b=e=>{const{prefixCls:t,placement:r,className:a,style:o}=e,l=M(e,["prefixCls","placement","className","style"]),{getPrefixCls:s}=n.useContext(d.E_),c=s("popconfirm",t),[u]=y(c);return u(n.createElement(h.ZP,{placement:r,className:i()(c,a),style:o,content:n.createElement(w,Object.assign({prefixCls:c},l))}))},j=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(n=Object.getOwnPropertySymbols(e);a<n.length;a++)t.indexOf(n[a])<0&&Object.prototype.propertyIsEnumerable.call(e,n[a])&&(r[n[a]]=e[n[a]])}return r};const k=n.forwardRef(((e,t)=>{var r,o;const{prefixCls:u,placement:m="top",trigger:f="click",okType:p="primary",icon:g=n.createElement(a.Z,null),children:v,overlayClassName:h,onOpenChange:x,onVisibleChange:M,overlayStyle:b,styles:k,classNames:Z}=e,P=j(e,["prefixCls","placement","trigger","okType","icon","children","overlayClassName","onOpenChange","onVisibleChange","overlayStyle","styles","classNames"]),{getPrefixCls:C,className:S,style:L,classNames:z,styles:D}=(0,d.dj)("popconfirm"),[E,U]=(0,l.Z)(!1,{value:null!==(r=e.open)&&void 0!==r?r:e.visible,defaultValue:null!==(o=e.defaultOpen)&&void 0!==o?o:e.defaultVisible}),N=(e,t)=>{U(e,!0),null==M||M(e),null==x||x(e,t)},I=C("popconfirm",u),T=i()(I,S,h,z.root,null==Z?void 0:Z.root),O=i()(z.body,null==Z?void 0:Z.body),[R]=y(I);return R(n.createElement(c.Z,Object.assign({},(0,s.Z)(P,["title"]),{trigger:f,placement:m,onOpenChange:(t,r)=>{const{disabled:n=!1}=e;n||N(t,r)},open:E,ref:t,classNames:{root:T,body:O},styles:{root:Object.assign(Object.assign(Object.assign(Object.assign({},D.root),L),b),null==k?void 0:k.root),body:Object.assign(Object.assign({},D.body),null==k?void 0:k.body)},content:n.createElement(w,Object.assign({okType:p,icon:g},e,{prefixCls:I,close:e=>{N(!1,e)},onConfirm:t=>{var r;return null===(r=e.onConfirm)||void 0===r?void 0:r.call(void 0,t)},onCancel:t=>{var r;N(!1,t),null===(r=e.onCancel)||void 0===r||r.call(void 0,t)}})),"data-popover-inject":!0}),v))}));k._InternalPanelDoNotUseOrYouWillBeFired=b;var Z=k}}]);