"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2949],{35206:function(e,t,a){a.r(t),a.d(t,{default:function(){return ke}});var s=a(93123),r=a(37963),n=a(5488),o=a(62319),i=a(14870),l=a(84176),d=a.n(l),c=a(73193),u=a.n(c),g=a(86222),f=a.n(g),p=a(90819),m=a.n(p),x=a(89933),h=a.n(x),M=a(45332),y=a.n(M),v=a(10154),j=a.n(v),w=a(5025);function b(e){return k.apply(this,arguments)}function k(){return(k=h()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/message/leave/query/org",{method:"GET",params:u()(u()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return F.apply(this,arguments)}function F(){return(F=h()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/message/leave/reply",{method:"POST",data:u()(u()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I,C=a(34599),T=a(18580),Z=a(54881),A=a(11090),D=a(2484),U=a(19975),R=a(88344),E=a(67652),O=a(68349),B=a(78359),N=a(5780),q=a(28977),z=a.n(q),L=a(44194),P=a(13775),Y=a(76711),H=a.n(Y),_=a(10162),K=a(36693),G=a(32394),W=a(16331),J=a(85817),Q=a(20903),V=a(68724),X=a(49616),$=a(79401),ee=a(93892),te=a(15435),ae=a(90251),se=a(31549),re=J.Z.Title,ne=J.Z.Paragraph,oe=J.Z.Text,ie=function(e){var t,a=e.visible,s=e.onClose,r=e.messageLeave,o=e.onSuccess,l=(0,i.useIntl)(),d=Q.Z.useForm(),c=y()(d,1)[0],g=(0,L.useState)(!1),f=y()(g,2),p=f[0],x=f[1],M=(0,L.useState)(!1),v=y()(M,2),j=v[0],b=v[1],k=(0,L.useState)([]),F=y()(k,2),I=F[0],C=F[1],Z=(0,L.useState)([]),A=y()(Z,2),D=A[0],U=A[1],R=(0,L.useState)(!1),E=y()(R,2),B=E[0],q=E[1],Y=(0,L.useState)(""),J=y()(Y,2),ie=J[0],le=J[1],de=(0,L.useState)(""),ce=y()(de,2),ue=ce[0],ge=ce[1];(0,L.useEffect)((function(){if(r&&r.replyContent)if(c.setFieldsValue({replyContent:r.replyContent}),b(!0),r.replyImages&&r.replyImages.length>0){var e=r.replyImages.filter((function(e){return""!==e}));U(e),C(e.map((function(e,t){return{uid:"-".concat(t),name:"image-".concat(t,".png"),status:"done",url:e,thumbUrl:e}})))}else U([]),C([]);else c.resetFields(),b(!1),U([]),C([])}),[r,c]);var fe=function(){var e=h()(m()().mark((function e(t){var a,n;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,x(!0),a={uid:r.uid,replyContent:t.replyContent,replyImages:D,orgUid:r.orgUid},e.next=7,S(a);case 7:n=e.sent,console.log("回复留言:",n.data),200===n.code?(w.yw.success(l.formatMessage({id:"replyContent.success",defaultMessage:"回复成功"})),c.resetFields(),U([]),C([]),o(),s()):w.yw.error(n.message||l.formatMessage({id:"replyContent.failed",defaultMessage:"回复失败"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("回复留言出错:",e.t0),w.yw.error(l.formatMessage({id:"replyContent.error",defaultMessage:"回复出错"}));case 16:return e.prev=16,x(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(e){return!e||0===e.length||1===e.length&&""===e[0]?null:(0,se.jsxs)("div",{style:{marginTop:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"images",defaultMessage:"图片"}),":"]}),(0,se.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:e.map((function(e,t){return e?(0,se.jsx)("img",{src:e,alt:"留言图片",style:{width:"100px",height:"100px",objectFit:"cover",cursor:"pointer"},onClick:function(){return me({url:e,uid:"img-".concat(t),name:"图片 ".concat(t+1)})}},t):null}))})]})},me=function(){var e=h()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:le(t.url||t.thumbUrl),q(!0),ge(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=(0,se.jsx)(N.ZP,{icon:(0,se.jsx)(_.Z,{}),children:(0,se.jsx)(i.FormattedMessage,{id:"upload",defaultMessage:"上传"})}),he={name:"file",accept:"image/*",action:(0,T.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(n.LA8)},listType:"picture-card",fileList:I,onPreview:me,onChange:function(e){var t=H()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var a=e.file.response.data.fileUrl;D.includes(a)||U((function(e){return[].concat(H()(e),[a])})),w.yw.success(l.formatMessage({id:"upload.success",defaultMessage:"上传 {filename} 成功"},{filename:e.file.name}))}else w.yw.error(l.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name})+": ".concat(e.file.response.message));else"error"===e.file.status&&w.yw.error(l.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name}));t=t.map((function(e){return e.response&&200===e.response.code?u()(u()({},e),{},{url:e.response.data.fileUrl,thumbUrl:e.response.data.fileUrl}):e})),C(t)},data:function(e){var t=z()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return console.log("uploadProps",t),{file:e,fileName:t,fileType:e.type,isAvatar:"false",kbType:n.IrL,categoryUid:"",kbUid:"",channel:n.XtJ}},onRemove:function(e){if(console.log("onRemove",e),"done"===e.status&&e.response&&e.response.data){var t=e.response.data.fileUrl;U((function(e){return e.filter((function(e){return e!==t}))}))}return e.url&&U((function(t){return t.filter((function(t){return t!==e.url}))})),!0}};return(0,se.jsx)(V.Z,{title:l.formatMessage({id:"leave.message.replyContent",defaultMessage:"回复留言"}),width:600,placement:"right",onClose:s,open:a,styles:{body:{paddingBottom:80}},extra:(0,se.jsx)(X.Z,{children:(0,se.jsx)(N.ZP,{onClick:s,children:(0,se.jsx)(i.FormattedMessage,{id:"cancel",defaultMessage:"取消"})})}),children:r&&(0,se.jsxs)(se.Fragment,{children:[(0,se.jsxs)($.Z,{variant:"borderless",style:{marginBottom:"20px"},children:[(0,se.jsx)(re,{level:5,children:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.details",defaultMessage:"留言详情"})}),(0,se.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",r.nickname||(null===(t=r.user)||void 0===t?void 0:t.nickname)||"-"]}),(0,se.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"contact",defaultMessage:"联系方式"}),":"]})," ",r.contact||"-"]}),(0,se.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"leave.message.type",defaultMessage:"留言类型"}),":"]})," ",(0,P.aC)(r.type)]}),(0,se.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"content",defaultMessage:"内容"}),":"]}),(0,se.jsx)(ne,{style:{marginTop:"8px"},children:r.content})]}),pe(r.images||[]),r.replyContent&&(0,se.jsxs)("div",{style:{marginTop:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"replied.content",defaultMessage:"回复内容"}),":"]}),(0,se.jsx)(ne,{style:{marginTop:"8px"},children:r.replyContent})]}),r.replyImages&&r.replyImages.length>0&&(0,se.jsxs)("div",{style:{marginTop:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"replyContent.images",defaultMessage:"回复图片"}),":"]}),pe(r.replyImages||[])]}),(0,se.jsxs)("div",{style:{marginTop:"10px"},children:[(0,se.jsxs)(oe,{strong:!0,children:[(0,se.jsx)(i.FormattedMessage,{id:"status",defaultMessage:"状态"}),":"]})," ",(0,P.It)(r.status)]})]}),j&&(0,se.jsx)(ee.Z,{type:"warning",showIcon:!0,message:l.formatMessage({id:"replyContent.exists.warning",defaultMessage:"已回复，继续回复仅更新已有回复"}),style:{marginBottom:"16px"}}),(0,se.jsxs)(G.A,{form:c,onFinish:fe,submitter:{render:function(e,t){return(0,se.jsx)("div",{style:{textAlign:"right",marginTop:"24px"},children:(0,se.jsx)(N.ZP,{type:"primary",icon:(0,se.jsx)(K.Z,{}),loading:p,onClick:function(){return c.submit()},children:(0,se.jsx)(i.FormattedMessage,{id:"replyContent",defaultMessage:"回复"})})})}},children:[(0,se.jsx)(W.Z,{name:"replyContent",label:l.formatMessage({id:"replyContent.content",defaultMessage:"回复内容"}),placeholder:l.formatMessage({id:"please.enter.replyContent",defaultMessage:"请输入回复内容"}),rules:[{required:!0,message:l.formatMessage({id:"replyContent.content.required",defaultMessage:"请输入回复内容"})}],fieldProps:{rows:6}}),(0,se.jsxs)(Q.Z.Item,{label:l.formatMessage({id:"replyContent.images",defaultMessage:"回复图片"}),children:[(0,se.jsx)(te.Z,u()(u()({},he),{},{children:xe})),(0,se.jsx)(O.Z,{open:B,title:ue,footer:null,onCancel:function(){return q(!1)},children:(0,se.jsx)(ae.Z,{alt:"预览图片",style:{width:"100%"},src:ie})})]})]})]})})},le=["current","pageSize"],de=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,se.jsx)(i.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,se.jsx)(i.FormattedMessage,{id:"nickname",defaultMessage:"称呼"}),dataIndex:"nickname",copyable:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.nickname.tooltip",defaultMessage:"留言者称呼"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"contact",defaultMessage:"Contact"}),dataIndex:"contact",copyable:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.contact.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"type",defaultMessage:"留言类型"}),dataIndex:"type",copyable:!0,width:120,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.type.tooltip",defaultMessage:"留言类型"}),valueType:"select",valueEnum:(I={},j()(j()(j()(j()(j()(j()(j()(j()(j()(j()(I,n.sHH,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.consultation",defaultMessage:"咨询"}),status:"default"}),n.vvW,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.complaint",defaultMessage:"投诉"}),status:"error"}),n.hbS,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.suggestion",defaultMessage:"建议"}),status:"processing"}),n.te_,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.feedback",defaultMessage:"反馈"}),status:"processing"}),n.GpD,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.cooperation",defaultMessage:"合作"}),status:"default"}),n.jNT,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.recruitment",defaultMessage:"招聘"}),status:"default"}),n.FQ1,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.technical_support",defaultMessage:"技术支持"}),status:"processing"}),n.r8m,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.sales_inquiry",defaultMessage:"销售咨询"}),status:"default"}),n.tKt,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.billing",defaultMessage:"账单问题"}),status:"warning"}),n.L60,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.account",defaultMessage:"账户问题"}),status:"warning"}),j()(j()(j()(j()(I,n.B2x,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.feature_request",defaultMessage:"功能需求"}),status:"processing"}),n.gT6,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.bug_report",defaultMessage:"问题报告"}),status:"error"}),n.gRl,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.general",defaultMessage:"一般留言"}),status:"default"}),n.bjt,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.type.other",defaultMessage:"其他"}),status:"default"})),render:function(e,t){var a,s=(a={},j()(j()(j()(j()(j()(j()(j()(j()(j()(j()(a,n.sHH,{text:"咨询",color:"default"}),n.vvW,{text:"投诉",color:"error"}),n.hbS,{text:"建议",color:"processing"}),n.te_,{text:"反馈",color:"processing"}),n.GpD,{text:"合作",color:"default"}),n.jNT,{text:"招聘",color:"default"}),n.FQ1,{text:"技术支持",color:"processing"}),n.r8m,{text:"销售咨询",color:"default"}),n.tKt,{text:"账单问题",color:"warning"}),n.L60,{text:"账户问题",color:"warning"}),j()(j()(j()(j()(a,n.B2x,{text:"功能需求",color:"processing"}),n.gT6,{text:"问题报告",color:"error"}),n.gRl,{text:"一般留言",color:"default"}),n.bjt,{text:"其他",color:"default"}))[t.type]||{text:t.type||"-",color:"default"};return(0,se.jsx)(R.Z,{color:s.color,children:s.text})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"userNickname",defaultMessage:"用户昵称"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.userNickname.tooltip",defaultMessage:"用户昵称"}),render:function(e,t){var a;return(0,se.jsx)(se.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,ellipsis:!0,width:300,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.content.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"images",defaultMessage:"Images"}),dataIndex:"images",copyable:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.images.tooltip"}),render:function(e,t,a,s){return!t.images||0===t.images.length||1===t.images.length&&""===t.images[0]?(0,se.jsx)("span",{children:"-"}):t.images.map((function(e,t){return e?(0,se.jsx)("img",{src:e,alt:"image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,se.jsx)(i.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,width:120,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.status.tooltip"}),valueType:"select",valueEnum:j()(j()(j()(j()(j()(j()(j()(j()(j()({},n.d23,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.pending",defaultMessage:"待处理"}),status:"default"}),n.m7i,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.processing",defaultMessage:"处理中"}),status:"processing"}),n.d3_,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.read",defaultMessage:"已读"}),status:"default"}),n.oLW,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.replied",defaultMessage:"已回复"}),status:"success"}),n.KBB,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.transferred",defaultMessage:"已转接"}),status:"warning"}),n.v3R,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.escalated",defaultMessage:"已升级"}),status:"warning"}),n.uke,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.closed",defaultMessage:"已关闭"}),status:"success"}),n.fEl,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.spam",defaultMessage:"垃圾留言"}),status:"error"}),n.K0y,{text:(0,se.jsx)(i.FormattedMessage,{id:"leave.msg.status.invalid",defaultMessage:"无效留言"}),status:"error"}),render:function(e,t){return(0,P.It)(t.status)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.replyContent",defaultMessage:"Reply"}),dataIndex:"replyContent",copyable:!0,hideInSearch:!0,ellipsis:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.replyContent.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),dataIndex:"replyImages",copyable:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.replyImages.tooltip"}),render:function(e,t,a,s){return!t.replyImages||0===t.replyImages.length||1===t.replyImages.length&&""===t.replyImages[0]?(0,se.jsx)("span",{children:"-"}):t.replyImages.map((function(e,t){return e?(0,se.jsx)("img",{src:e,alt:"reply image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,se.jsx)(i.FormattedMessage,{id:"reply.user",defaultMessage:"回复人员"}),dataIndex:"replyUserNickname",hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.replyUser.tooltip"}),render:function(e,t){var a;return(0,se.jsx)(se.Fragment,{children:(null==t||null===(a=t.replyUser)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"repliedAt",defaultMessage:"回复时间"}),key:"repliedAt",dataIndex:"repliedAt",sorter:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.repliedAt.tooltip"}),render:function(e,t,a,s){return t.repliedAt?z()(t.repliedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,se.jsx)(i.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.createdAt.tooltip"}),render:function(e,t,a,s){return z()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,se.jsx)(i.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"leave.message.updatedAt.tooltip"}),render:function(e,t,a,s){return t.updatedAt?z()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],ce=function(e){var t=e.superUser,a=(0,i.useIntl)(),s=(0,L.useRef)(),r=(0,L.useState)(1),o=y()(r,2),l=o[0],c=o[1],g=(0,L.useState)(10),p=y()(g,2),x=p[0],M=p[1],v=(0,C.u)((function(e){return e.currentOrg})),j=(0,L.useState)(!1),k=y()(j,2),S=k[0],F=k[1],I=(0,L.useState)(),R=y()(I,2),q=R[0],z=R[1],P=(0,L.useState)([]),Y=y()(P,2),H=Y[0],_=Y[1],K=(0,L.useState)([]),G=y()(K,2),W=G[0],J=G[1],Q=(0,L.useState)(0),V=y()(Q,2),X=V[0],$=V[1],ee=(0,L.useState)({}),te=y()(ee,2),ae=te[0],re=te[1],ne=[].concat(de,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",render:function(e,t,s,r){return[(0,se.jsx)("a",{onClick:function(){oe(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,se.jsx)("a",{onClick:function(){ce(t)},children:a.formatMessage({id:"handle",defaultMessage:"Handle"})},"handle"),(0,se.jsx)(E.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ue(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,se.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),oe=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==v?void 0:v.uid,t:n.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},ce=function(e){console.log("handleProcess",e),z(e),F(!0)},ue=function(){var e=h()(m()().mark((function e(t){var r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),w.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{w.yw.destroy(),w.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(r=s.current)||void 0===r||r.reload()}catch(e){w.yw.destroy(),w.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=h()(m()().mark((function e(){var t,r,n,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==W.length){e.next=3;break}return w.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:w.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=f()(W);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}w.yw.destroy(),0===r?w.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):w.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),_([]),J([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=h()(m()().mark((function e(t,a,s){var r,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),r=localStorage.getItem(n.LA8),o=u()({orgUid:(null==v?void 0:v.uid)||"",accessToken:r||"",exportType:t},ae),"current"===t?(o.pageNumber=String(l-1),o.pageSize=String(x)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,T.kG)()+"/api/v1/message/leave/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),pe=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return fe("range",s,a)}})},n=0;n<s;n++)r();return t},me={selectedRowKeys:H,onChange:function(e,t){_(e),J(t)}};return(0,se.jsxs)(se.Fragment,{children:[(0,se.jsx)(U.Z,{columns:ne,actionRef:s,cardBordered:!0,rowSelection:me,scroll:{x:2800},request:function(){var e=h()(m()().mark((function e(a,s,r){var n,o,i,l,g,f,p,x;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.current,o=a.pageSize,i=d()(a,le),c(n),M(o),re(i),l=void 0,g=void 0,s&&Object.keys(s).length>0&&(f=Object.keys(s)[0],l=f,g="ascend"===s[f]?"ascend":"descend"),p=u()(u()({pageNumber:n-1,pageSize:o,orgUid:null==v?void 0:v.uid,superUser:t},i),{},{sortBy:l,sortDirection:g}),e.next=10,b(p);case 10:return x=e.sent,console.log("queryLeaveMsgsByOrg response:",x,p),200===x.code?$(x.data.totalElements):w.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"留言记录",toolBarRender:function(){return function(){var e=[],t=[];H.length>0&&t.push({key:"batchDelete",icon:(0,se.jsx)(Z.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(H.length,")"),onClick:function(){O.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(H.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ge,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,se.jsx)(A.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return fe("current")}}];return X>0&&(X<=1e3?s.push({key:"export-all",icon:(0,se.jsx)(A.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(X,"条)"),onClick:function(){return fe("all")}}):s.push({key:"export-range",icon:(0,se.jsx)(A.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(X,"条)"),children:pe(X)})),e.push((0,se.jsx)(B.Z,{menu:{items:s},placement:"bottom",children:(0,se.jsxs)(N.ZP,{icon:(0,se.jsx)(A.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,se.jsx)(D.Z,{})]},"button")},"export")),t.length>0&&e.push((0,se.jsx)(B.Z,{menu:{items:t},placement:"bottom",children:(0,se.jsxs)(N.ZP,{type:H.length>0?"primary":"default",danger:H.length>0,children:[H.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(H.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,se.jsx)(D.Z,{})]})},"batchOperations")),e}()}}),(0,se.jsx)(ie,{visible:S,onClose:function(){F(!1)},messageLeave:q,onSuccess:function(){var e;null===(e=s.current)||void 0===e||e.reload()}})]})};function ue(e){return ge.apply(this,arguments)}function ge(){return(ge=h()(m()().mark((function e(t){return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,i.request)("/api/v1/message/rating/query/org",{method:"GET",params:u()(u()({},t),{},{channel:n.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fe=["current","pageSize"],pe={ROBOT:{text:"机器人",color:"blue"},AGENT:{text:"人工客服",color:"green"},FAQ:{text:"常见问题",color:"purple"}},me={RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,se.jsx)(i.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.answer.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,ellipsis:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.question.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.fromType"}),dataIndex:"fromType",ellipsis:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.fromType.tooltip"}),render:function(e,t){var a=t.fromType||"",s=pe[a]||{text:a,color:"default"};return(0,se.jsx)(R.Z,{color:s.color,children:s.text||a})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=me[a]||{text:a,color:"default"};return(0,se.jsx)(R.Z,{color:s.color,children:s.text||a})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.tags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,se.jsx)(se.Fragment,{children:t.rateDownTagList.map((function(e){return(0,se.jsx)(R.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.reason.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"faq.rating.user",defaultMessage:"用户"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t){var a;return(0,se.jsx)(se.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,s){return t.createdAt?z()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],he=function(e){var t=e.superUser,a=(0,i.useIntl)(),s=(0,L.useRef)(),r=(0,L.useState)(1),o=y()(r,2),l=o[0],c=o[1],g=(0,L.useState)(10),p=y()(g,2),x=p[0],M=p[1],v=(0,C.u)((function(e){return e.currentOrg})),j=(0,L.useState)([]),b=y()(j,2),k=b[0],S=b[1],F=(0,L.useState)([]),I=y()(F,2),R=I[0],q=I[1],z=(0,L.useState)(0),P=y()(z,2),Y=P[0],H=P[1],_=(0,L.useState)({}),K=y()(_,2),G=K[0],W=K[1],J=[].concat(xe,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,r){return[(0,se.jsx)("a",{onClick:function(){Q(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,se.jsx)(E.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return V(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,se.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),Q=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==v?void 0:v.uid,t:n.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},V=function(){var e=h()(m()().mark((function e(t){var r;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),w.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{w.yw.destroy(),w.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(r=s.current)||void 0===r||r.reload()}catch(e){w.yw.destroy(),w.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),X=function(){var e=h()(m()().mark((function e(){var t,r,n,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==R.length){e.next=3;break}return w.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:w.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,r=0,n=f()(R);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}w.yw.destroy(),0===r?w.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):w.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:r})),S([]),q([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),$=function(){var e=h()(m()().mark((function e(t,a,s){var r,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),r=localStorage.getItem(n.LA8),o=u()({orgUid:(null==v?void 0:v.uid)||"",accessToken:r||"",exportType:t},G),"current"===t?(o.pageNumber=String(l-1),o.pageSize=String(x)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(o.pageNumber=String(a),o.pageSize=String(s)),window.open((0,T.kG)()+"/api/v1/message/rating/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ee=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return $("range",s,a)}})},n=0;n<s;n++)r();return t},te={selectedRowKeys:k,onChange:function(e,t){S(e),q(t)}};return(0,se.jsx)(U.Z,{columns:J,actionRef:s,cardBordered:!0,rowSelection:te,scroll:{x:2e3},request:function(){var e=h()(m()().mark((function e(a,s,r){var n,o,i,l,g,f,p,x;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=a.current,o=a.pageSize,i=d()(a,fe),c(n),M(o),W(i),l=void 0,g=void 0,s&&Object.keys(s).length>0&&(f=Object.keys(s)[0],l=f,g="ascend"===s[f]?"ascend":"descend"),p=u()(u()({pageNumber:n-1,pageSize:o,orgUid:null==v?void 0:v.uid,superUser:t},i),{},{sortBy:l,sortDirection:g}),e.next=10,ue(p);case 10:return x=e.sent,console.log("queryMessageRatingsByOrg response:",x,p),200===x.code?H(x.data.totalElements):w.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"message.tab.rating"}),toolBarRender:function(){return function(){var e=[],t=[];k.length>0&&t.push({key:"batchDelete",icon:(0,se.jsx)(Z.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(k.length,")"),onClick:function(){O.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(k.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:X,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,se.jsx)(A.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return $("current")}}];return Y>0&&(Y<=1e3?s.push({key:"export-all",icon:(0,se.jsx)(A.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Y,"条)"),onClick:function(){return $("all")}}):s.push({key:"export-range",icon:(0,se.jsx)(A.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Y,"条)"),children:ee(Y)})),e.push((0,se.jsx)(B.Z,{menu:{items:s},placement:"bottom",children:(0,se.jsxs)(N.ZP,{icon:(0,se.jsx)(A.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,se.jsx)(D.Z,{})]},"button")},"export")),t.length>0&&e.push((0,se.jsx)(B.Z,{menu:{items:t},placement:"bottom",children:(0,se.jsxs)(N.ZP,{type:k.length>0?"primary":"default",danger:k.length>0,children:[k.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(k.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,se.jsx)(D.Z,{})]})},"batchOperations")),e}()}})},Me=a(7374),ye=a(18751),ve=["current","pageSize"],je=function(e){var t=e.type,a=e.superUser,s=(0,i.useIntl)(),r=(0,L.useRef)(),o=(0,ye.Z)().translateString,l=(0,C.u)((function(e){return e.currentOrg})),c=(0,L.useState)(1),g=y()(c,2),p=g[0],x=g[1],M=(0,L.useState)(10),v=y()(M,2),j=v[0],b=v[1],k=(0,L.useState)([]),S=y()(k,2),F=S[0],I=S[1],R=(0,L.useState)([]),q=y()(R,2),z=q[0],Y=q[1],H=(0,L.useState)(0),_=y()(H,2),K=_[0],G=_[1],W=(0,L.useState)({}),J=y()(W,2),Q=J[0],V=J[1],X=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,se.jsx)(i.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,se.jsx)(i.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,se.jsx)(se.Fragment,{children:o(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,P.ng)(null==t?void 0:t.status)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,P.OI)(t.type)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,P.YG)(t.channel)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:s.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,se.jsx)("a",{onClick:function(){$(t)},children:s.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,se.jsx)(E.Z,{title:s.formatMessage({id:"deleteTip"}),description:"".concat(s.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ee(t)},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"}),children:(0,se.jsx)("a",{style:{color:"red",marginLeft:8},children:s.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],$=function(e){var t,a;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==l?void 0:l.uid,t:n.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(s)},ee=function(){var e=h()(m()().mark((function e(t){var a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),w.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{w.yw.destroy(),w.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(a=r.current)||void 0===a||a.reload()}catch(e){w.yw.destroy(),w.yw.error(s.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=h()(m()().mark((function e(){var t,a,n,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==z.length){e.next=3;break}return w.yw.warning(s.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:w.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,n=f()(z);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}w.yw.destroy(),0===a?w.yw.success(s.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):w.yw.warning(s.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),I([]),Y([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=h()(m()().mark((function e(a,s,r){var o,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,s,r),o=localStorage.getItem(n.LA8),i=u()({componentType:t,orgUid:(null==l?void 0:l.uid)||"",accessToken:o||"",exportType:a,threadType:n.H_O},Q),"current"===a?(i.pageNumber=String(p-1),i.pageSize=String(j)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==s&&void 0!==r&&(i.pageNumber=String(s),i.pageSize=String(r)),window.open((0,T.kG)()+"/api/v1/message/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),re=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return ae("range",s,a)}})},n=0;n<s;n++)r();return t},ne={selectedRowKeys:F,onChange:function(e,t){I(e),Y(t)}};return(0,se.jsx)(U.Z,{columns:X,actionRef:r,cardBordered:!0,rowSelection:ne,scroll:{x:1500},request:function(){var e=h()(m()().mark((function e(t,s,r){var o,i,c,g,f,p,h,M;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,s,r),o=t.current,i=t.pageSize,c=d()(t,ve),x(o),b(i),V(c),g=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],g=p,f="ascend"===s[p]?"ascend":"descend"),h=u()(u()({pageNumber:o-1,pageSize:i,threadType:n.H_O,orgUid:null==l?void 0:l.uid,superUser:a},c),{},{sortBy:g,sortDirection:f}),e.next=11,(0,Me.W5)(h);case 11:return M=e.sent,console.log("getAllMessages response:",h,M),200===M.code?G(M.data.totalElements):w.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:s.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];F.length>0&&t.push({key:"batchDelete",icon:(0,se.jsx)(Z.Z,{}),danger:!0,label:s.formatMessage({id:"batch.delete"})+" (".concat(F.length,")"),onClick:function(){O.Z.confirm({title:s.formatMessage({id:"batch.deleteTip"}),content:"".concat(s.formatMessage({id:"batch.deleteAffirm"})," ").concat(F.length," ").concat(s.formatMessage({id:"items"}),"?"),onOk:te,okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,se.jsx)(A.Z,{}),label:s.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ae("current")}}];return K>0&&(K<=1e3?a.push({key:"export-all",icon:(0,se.jsx)(A.Z,{}),label:s.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(K,"条)"),onClick:function(){return ae("all")}}):a.push({key:"export-range",icon:(0,se.jsx)(A.Z,{}),label:s.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(K,"条)"),children:re(K)})),e.push((0,se.jsx)(B.Z,{menu:{items:a},placement:"bottom",children:(0,se.jsxs)(N.ZP,{icon:(0,se.jsx)(A.Z,{}),type:"primary",children:[s.formatMessage({id:"export",defaultMessage:"Export"}),(0,se.jsx)(D.Z,{})]},"button")},"export")),t.length>0&&e.push((0,se.jsx)(B.Z,{menu:{items:t},placement:"bottom",children:(0,se.jsxs)(N.ZP,{type:F.length>0?"primary":"default",danger:F.length>0,children:[F.length>0?s.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(F.length,")"):s.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,se.jsx)(D.Z,{})]})},"batchOperations")),e}()}})},we=["current","pageSize"],be=function(e){var t=e.type,a=e.superUser,s=(0,i.useIntl)(),r=(0,L.useRef)(),o=(0,ye.Z)().translateString,l=(0,C.u)((function(e){return e.currentOrg})),c=(0,L.useState)(1),g=y()(c,2),p=g[0],x=g[1],M=(0,L.useState)(10),v=y()(M,2),j=v[0],b=v[1],k=(0,L.useState)([]),S=y()(k,2),F=S[0],I=S[1],R=(0,L.useState)([]),q=y()(R,2),z=q[0],Y=q[1],H=(0,L.useState)(0),_=y()(H,2),K=_[0],G=_[1],W=(0,L.useState)({}),J=y()(W,2),Q=J[0],V=J[1],X=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,se.jsx)(i.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,se.jsx)(i.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,se.jsx)(se.Fragment,{children:o(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,se.jsx)(i.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,se.jsx)(i.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,P.ng)(null==t?void 0:t.status)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,P.OI)(t.type)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,P.YG)(t.channel)}},{title:(0,se.jsx)(i.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,se.jsx)(i.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:s.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,se.jsx)("a",{onClick:function(){$(t)},children:s.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,se.jsx)(E.Z,{title:s.formatMessage({id:"deleteTip"}),description:"".concat(s.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ee(t)},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"}),children:(0,se.jsx)("a",{style:{color:"red",marginLeft:8},children:s.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],$=function(e){var t,a;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==l?void 0:l.uid,t:n.CCt,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(s)},ee=function(){var e=h()(m()().mark((function e(t){var a;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),w.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{w.yw.destroy(),w.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(a=r.current)||void 0===a||a.reload()}catch(e){w.yw.destroy(),w.yw.error(s.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),te=function(){var e=h()(m()().mark((function e(){var t,a,n,o;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==z.length){e.next=3;break}return w.yw.warning(s.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:w.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,n=f()(z);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}w.yw.destroy(),0===a?w.yw.success(s.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):w.yw.warning(s.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),I([]),Y([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=h()(m()().mark((function e(a,s,r){var o,i;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,s,r),o=localStorage.getItem(n.LA8),i=u()({componentType:t,orgUid:(null==l?void 0:l.uid)||"",accessToken:o||"",exportType:a,threadType:n.n4F},Q),"current"===a?(i.pageNumber=String(p-1),i.pageSize=String(j)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==s&&void 0!==r&&(i.pageNumber=String(s),i.pageSize=String(r)),window.open((0,T.kG)()+"/api/v1/message/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),re=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),r=function(){var s=n,r=n*a+1,o=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(o," (").concat(o-r+1,"条)"),onClick:function(){return ae("range",s,a)}})},n=0;n<s;n++)r();return t},ne={selectedRowKeys:F,onChange:function(e,t){I(e),Y(t)}};return(0,se.jsx)(U.Z,{columns:X,actionRef:r,cardBordered:!0,rowSelection:ne,scroll:{x:1500},request:function(){var e=h()(m()().mark((function e(t,s,r){var o,i,c,g,f,p,h,M;return m()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,s,r),o=t.current,i=t.pageSize,c=d()(t,we),x(o),b(i),V(c),g=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],g=p,f="ascend"===s[p]?"ascend":"descend"),h=u()(u()({pageNumber:o-1,pageSize:i,threadType:n.n4F,orgUid:null==l?void 0:l.uid,superUser:a},c),{},{sortBy:g,sortDirection:f}),e.next=11,(0,Me.W5)(h);case 11:return M=e.sent,console.log("getAllMessages response:",h,M),200===M.code?G(M.data.totalElements):w.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:s.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];F.length>0&&t.push({key:"batchDelete",icon:(0,se.jsx)(Z.Z,{}),danger:!0,label:s.formatMessage({id:"batch.delete"})+" (".concat(F.length,")"),onClick:function(){O.Z.confirm({title:s.formatMessage({id:"batch.deleteTip"}),content:"".concat(s.formatMessage({id:"batch.deleteAffirm"})," ").concat(F.length," ").concat(s.formatMessage({id:"items"}),"?"),onOk:te,okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,se.jsx)(A.Z,{}),label:s.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ae("current")}}];return K>0&&(K<=1e3?a.push({key:"export-all",icon:(0,se.jsx)(A.Z,{}),label:s.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(K,"条)"),onClick:function(){return ae("all")}}):a.push({key:"export-range",icon:(0,se.jsx)(A.Z,{}),label:s.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(K,"条)"),children:re(K)})),e.push((0,se.jsx)(B.Z,{menu:{items:a},placement:"bottom",children:(0,se.jsxs)(N.ZP,{icon:(0,se.jsx)(A.Z,{}),type:"primary",children:[s.formatMessage({id:"export",defaultMessage:"Export"}),(0,se.jsx)(D.Z,{})]},"button")},"export")),t.length>0&&e.push((0,se.jsx)(B.Z,{menu:{items:t},placement:"bottom",children:(0,se.jsxs)(N.ZP,{type:F.length>0?"primary":"default",danger:F.length>0,children:[F.length>0?s.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(F.length,")"):s.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,se.jsx)(D.Z,{})]})},"batchOperations")),e}()}})},ke=function(){var e=(0,i.useIntl)(),t=[{key:"message",label:e.formatMessage({id:"message.tab.all"}),children:(0,se.jsx)(s.Z,{type:n.Nqz})}];return(0,T.OJ)()&&t.push({key:"messageLeave",label:e.formatMessage({id:"message.tab.leave"}),children:(0,se.jsx)(ce,{})},{key:"robotMessage",label:e.formatMessage({id:"message.tab.robot"}),children:(0,se.jsx)(o.Z,{})},{key:"messageRating",label:e.formatMessage({id:"message.tab.rating"}),children:(0,se.jsx)(he,{superUser:!1})}),(0,T.Ox)()||t.push({key:"message.group",label:e.formatMessage({id:"message.tab.group"}),children:(0,se.jsx)(je,{type:n.Nqz,superUser:!1})},{key:"message.member",label:e.formatMessage({id:"message.tab.member"}),children:(0,se.jsx)(be,{type:n.Nqz,superUser:!1})}),(0,se.jsx)(se.Fragment,{children:(0,se.jsx)(r.Z,{defaultActiveKey:"message",items:t,style:{margin:10}})})}}}]);