"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2161],{62319:function(e,t,s){s.d(t,{Z:function(){return L}});var a=s(84176),r=s.n(a),o=s(73193),n=s.n(o),i=s(86222),d=s.n(i),l=s(90819),c=s.n(l),u=s(89933),p=s.n(u),g=s(45332),f=s.n(g),m=s(5025),h=s(18751),x=s(34599),M=s(5488),w=s(18580),k=s(54881),y=s(11090),j=s(2484),b=s(19975),v=s(14870),T=s(85817),S=s(5780),F=s(31261),C=s(88344),I=s(67652),Z=s(68349),A=s(78359),E=s(44194);function P(e){return D.apply(this,arguments)}function D(){return(D=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/robot/message/query/org",{method:"GET",params:n()({},t)}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var R=s(13775),N=s(24522),U=s(33363),q=s(31549),z=["current","pageSize"],_={RATE_PENDING:{text:"待评价",color:"default"},RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},L=function(e){var t=e.superUser,s=(0,v.useIntl)(),a=(0,N.Z)().isDarkMode,o=(0,E.useRef)(),i=(0,h.Z)().translateString,l=(0,x.u)((function(e){return e.currentOrg})),u=(0,E.useState)(1),g=f()(u,2),D=g[0],L=g[1],B=(0,E.useState)(10),O=f()(B,2),G=O[0],H=O[1],K=(0,E.useState)([]),W=f()(K,2),V=W[0],Q=W[1],J=(0,E.useState)([]),Y=f()(J,2),X=Y[0],$=Y[1],ee=(0,E.useState)(0),te=f()(ee,2),se=te[0],ae=te[1],re=(0,E.useState)({}),oe=f()(re,2),ne=oe[0],ie=oe[1],de=(0,E.useState)(!1),le=f()(de,2),ce=le[0],ue=le[1],pe=(0,E.useState)(""),ge=f()(pe,2),fe=ge[0],me=ge[1],he=(0,E.useState)(!1),xe=f()(he,2),Me=xe[0],we=xe[1],ke=(0,E.useState)(""),ye=f()(ke,2),je=ye[0],be=ye[1],ve=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,q.jsx)(v.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,q.jsx)(v.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",width:200,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.userNickname.tooltip"}),render:function(e,t){var s;return(0,q.jsx)(q.Fragment,{children:i(null==t||null===(s=t.user)||void 0===s?void 0:s.nickname)})}},{title:(0,q.jsx)(v.FormattedMessage,{id:"queue.member.robot",defaultMessage:"robotNickname"}),dataIndex:"robotNickname",width:120,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.robotNickname.tooltip"}),render:function(e,t){var s;return(0,q.jsx)(q.Fragment,{children:i(null==t||null===(s=t.robot)||void 0===s?void 0:s.nickname)})}},{title:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.prompt",defaultMessage:"Prompt"}),dataIndex:"prompt",hideInSearch:!0,width:250,ellipsis:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.prompt.tooltip"}),render:function(e,t){var a=t.prompt;return a?a.length>50?(0,q.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return Se(a)},children:[(0,q.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[a.substring(0,50),"..."]}),(0,q.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),Se(a)},children:s.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,q.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:a}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"question",defaultMessage:"Question"}),dataIndex:"content",ellipsis:!0,copyable:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.question.tooltip"})},{title:(0,q.jsx)(v.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.answer.tooltip"}),render:function(e,t){var a=t.answer;return a?a.length>100?(0,q.jsxs)("div",{style:{cursor:"pointer"},onClick:function(){return Fe(a)},children:[(0,q.jsxs)(T.Z.Text,{ellipsis:{tooltip:!1},children:[a.substring(0,100),"..."]}),(0,q.jsx)(S.ZP,{type:"link",size:"small",style:{padding:0,marginLeft:4},onClick:function(e){e.stopPropagation(),Fe(a)},children:s.formatMessage({id:"view",defaultMessage:"View"})})]}):(0,q.jsx)(T.Z.Text,{ellipsis:{tooltip:!0},children:a}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"message.status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.status.tooltip"}),render:function(e,t){return(0,R.ng)(null==t?void 0:t.status)}},{title:(0,q.jsx)(v.FormattedMessage,{id:"message.channel",defaultMessage:"Channel"}),dataIndex:"channel",width:100,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.channel.tooltip"}),render:function(e,t){return(0,R.YG)(t.channel)}},{title:(0,q.jsx)(v.FormattedMessage,{id:"ai.unanswered",defaultMessage:"未回答"}),dataIndex:"isUnAnswered",width:120,hideInSearch:!0,valueType:"select",valueEnum:{true:{text:"未回答",status:"Error"},false:{text:"已回答",status:"Success"}},tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.isUnAnswered.tooltip"}),render:function(e,t){var s=t.isUnAnswered;return null==s?"-":(0,q.jsx)(F.Z,{status:s?"error":"success",text:s?"未回答":"已回答"})}},{title:(0,q.jsx)(v.FormattedMessage,{id:"ai.tokens.prompt",defaultMessage:"Prompt Tokens"}),dataIndex:"promptTokens",width:160,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.promptTokens.tooltip"}),render:function(e,t){var s=t.promptTokens;return s?(0,q.jsx)(C.Z,{color:"blue",children:s}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"ai.tokens.completion",defaultMessage:"Completion Tokens"}),dataIndex:"completionTokens",width:160,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.completionTokens.tooltip"}),render:function(e,t){var s=t.completionTokens;return s?(0,q.jsx)(C.Z,{color:"green",children:s}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"ai.tokens.total",defaultMessage:"Total Tokens"}),dataIndex:"totalTokens",width:140,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.totalTokens.tooltip"}),render:function(e,t){var s=t.totalTokens;return s?(0,q.jsx)(C.Z,{color:"orange",children:s}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"ai.provider",defaultMessage:"AI Provider"}),dataIndex:"aiProvider",width:120,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.aiProvider.tooltip"}),render:function(e,t){var s=t.aiProvider;return s?(0,q.jsx)(C.Z,{color:"purple",children:s}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"ai.model",defaultMessage:"AI Model"}),dataIndex:"aiModel",width:120,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.aiModel.tooltip"}),render:function(e,t){var s=t.aiModel;return s?(0,q.jsx)(C.Z,{color:"cyan",children:s}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,valueType:"select",valueEnum:{RATE_PENDING:{text:"待评价",status:"Default"},RATE_UP:{text:"点赞",status:"Success"},RATE_DOWN:{text:"点踩",status:"Error"},RATE_FEEDBACK:{text:"反馈意见",status:"Warning"},RATE_TRANSFER:{text:"转人工",status:"Processing"}},tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.rateType.tooltip"}),render:function(e,t){var s=t.rateType||"",a=_[s]||{text:s,color:"default"};return(0,q.jsx)(C.Z,{color:a.color,children:a.text||s})}},{title:(0,q.jsx)(v.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.rateDownTags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,q.jsx)(q.Fragment,{children:t.rateDownTagList.map((function(e){return(0,q.jsx)(C.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,q.jsx)(v.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.rateDownReason.tooltip"})},{title:(0,q.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,q.jsx)(v.FormattedMessage,{id:"robot.message.createdAt.tooltip"})},{title:s.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,r){return[(0,q.jsx)("a",{onClick:function(){Te(t)},children:s.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,q.jsx)(I.Z,{title:s.formatMessage({id:"deleteTip"}),description:"".concat(s.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return Ce(t)},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"}),children:(0,q.jsx)("a",{style:{color:"red",marginLeft:8},children:s.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],Te=function(e){var t;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==l?void 0:l.uid,t:M.CCt,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(s)},Se=function(e){me(e),ue(!0)},Fe=function(e){be(e),we(!0)},Ce=function(){var e=p()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==o||null===(a=o.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(s.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ie=function(){var e=p()(c()().mark((function e(){var t,a,r,n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==X.length){e.next=3;break}return m.yw.warning(s.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,r=d()(X);try{for(r.s();!(n=r.n()).done;)n.value}catch(e){r.e(e)}finally{r.f()}m.yw.destroy(),0===a?m.yw.success(s.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(s.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),Q([]),$([]),null===(t=o.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ze=function(){var e=p()(c()().mark((function e(t,s,a){var r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,s,a),r=localStorage.getItem(M.LA8),o=n()({orgUid:(null==l?void 0:l.uid)||"",accessToken:r||"",exportType:t},ne),"current"===t?(o.pageNumber=String(D-1),o.pageSize=String(G)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==s&&void 0!==a&&(o.pageNumber=String(s),o.pageSize=String(a)),window.open((0,w.kG)()+"/api/v1/robot/message/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}(),Ae=function(e){for(var t=[],s=1e3,a=Math.ceil(e/s),r=function(){var a=o,r=o*s+1,n=Math.min((o+1)*s,e);t.push({key:"export-".concat(o),label:"".concat(r,"-").concat(n," (").concat(n-r+1,"条)"),onClick:function(){return Ze("range",a,s)}})},o=0;o<a;o++)r();return t},Ee={selectedRowKeys:V,onChange:function(e,t){Q(e),$(t)}};return(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(b.Z,{columns:ve,actionRef:o,cardBordered:!0,rowSelection:Ee,scroll:{x:3e3},request:function(){var e=p()(c()().mark((function e(s,a,o){var n,i,d,u,p,g,f,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",s,a,o),n=s.current,i=s.pageSize,d=r()(s,z),L(n),H(i),ie(d),u=void 0,p=void 0,a&&Object.keys(a).length>0&&(g=Object.keys(a)[0],u=g,p="ascend"===a[g]?"ascend":"descend"),f={pageNumber:n-1,pageSize:i,orgUid:null==l?void 0:l.uid,superUser:t,topic:d.topic,threadUid:d.threadUid,userNickname:d.userNickname,robotNickname:d.robotNickname,status:d.status,answer:d.answer,user:d.user,robot:d.robot,isUnAnswered:d.isUnAnswered,promptTokens:d.promptTokens,completionTokens:d.completionTokens,totalTokens:d.totalTokens,aiProvider:d.aiProvider,aiModel:d.aiModel,threads:d.threads,componentType:d.componentType,sortBy:u,sortDirection:p},e.next=11,P(f);case 11:return h=e.sent,console.log("getAllRobotMessages response:",f,h),200===h.code?ae(h.data.totalElements):m.yw.error(h.message),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,s,a){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"机器人消息",toolBarRender:function(){return function(){var e=[],t=[];V.length>0&&t.push({key:"batchDelete",icon:(0,q.jsx)(k.Z,{}),danger:!0,label:s.formatMessage({id:"batch.delete"})+" (".concat(V.length,")"),onClick:function(){Z.Z.confirm({title:s.formatMessage({id:"batch.deleteTip"}),content:"".concat(s.formatMessage({id:"batch.deleteAffirm"})," ").concat(V.length," ").concat(s.formatMessage({id:"items"}),"?"),onOk:Ie,okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,q.jsx)(y.Z,{}),label:s.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ze("current")}}];return se>0&&(se<=1e3?a.push({key:"export-all",icon:(0,q.jsx)(y.Z,{}),label:s.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(se,"条)"),onClick:function(){return Ze("all")}}):a.push({key:"export-range",icon:(0,q.jsx)(y.Z,{}),label:s.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(se,"条)"),children:Ae(se)})),e.push((0,q.jsx)(A.Z,{menu:{items:a},placement:"bottom",children:(0,q.jsxs)(S.ZP,{icon:(0,q.jsx)(y.Z,{}),type:"primary",children:[s.formatMessage({id:"export",defaultMessage:"Export"}),(0,q.jsx)(j.Z,{})]},"button")},"export")),t.length>0&&e.push((0,q.jsx)(A.Z,{menu:{items:t},placement:"bottom",children:(0,q.jsxs)(S.ZP,{type:V.length>0?"primary":"default",danger:V.length>0,children:[V.length>0?s.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(V.length,")"):s.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,q.jsx)(j.Z,{})]})},"batchOperations")),e}()}}),(0,q.jsx)(Z.Z,{title:s.formatMessage({id:"prompt.detail",defaultMessage:"Prompt Details"}),open:ce,onCancel:function(){return ue(!1)},footer:[(0,q.jsx)(S.ZP,{onClick:p()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.TE)(fe);case 2:e.sent.success?m.yw.success(s.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"})):m.yw.error(s.formatMessage({id:"copy.failed",defaultMessage:"Copy failed"}));case 4:case"end":return e.stop()}}),e)}))),children:s.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,q.jsx)(S.ZP,{onClick:function(){return ue(!1)},children:s.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,q.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,q.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:a?"#1f1f1f":"#f5f5f5",color:a?"#ffffff":"#000000",padding:"12px",borderRadius:"4px",border:"1px solid ".concat(a?"#434343":"#d9d9d9")},children:fe})})}),(0,q.jsx)(Z.Z,{title:s.formatMessage({id:"answer.detail",defaultMessage:"Answer Details"}),open:Me,onCancel:function(){return we(!1)},footer:[(0,q.jsx)(S.ZP,{onClick:p()(c()().mark((function e(){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,U.TE)(je);case 2:e.sent.success?m.yw.success(s.formatMessage({id:"copy.success",defaultMessage:"Copied to clipboard"})):m.yw.error(s.formatMessage({id:"copy.failed",defaultMessage:"Copy failed"}));case 4:case"end":return e.stop()}}),e)}))),children:s.formatMessage({id:"copy",defaultMessage:"Copy"})},"copy"),(0,q.jsx)(S.ZP,{onClick:function(){return we(!1)},children:s.formatMessage({id:"close",defaultMessage:"Close"})},"close")],width:800,children:(0,q.jsx)("div",{style:{maxHeight:"400px",overflow:"auto"},children:(0,q.jsx)(T.Z.Paragraph,{style:{whiteSpace:"pre-wrap",wordBreak:"break-word",fontFamily:"monospace",fontSize:"12px",lineHeight:"1.5",backgroundColor:a?"#1f1f1f":"#f5f5f5",color:a?"#ffffff":"#000000",padding:"12px",borderRadius:"4px",border:"1px solid ".concat(a?"#434343":"#d9d9d9")},children:je})})})]})}}}]);