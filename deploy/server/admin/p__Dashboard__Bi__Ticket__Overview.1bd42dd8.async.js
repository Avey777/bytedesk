"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4577],{16829:function(e,t,i){i.d(t,{Z:function(){return c}});var n=i(77260),a=i(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},r=i(5901),o=function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(o)},83381:function(e,t,i){i.d(t,{Z:function(){return c}});var n=i(77260),a=i(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},r=i(5901),o=function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(o)},33e3:function(e,t,i){i.d(t,{Z:function(){return c}});var n=i(77260),a=i(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M854.6 288.6L639.4 73.4c-6-6-14.1-9.4-22.6-9.4H192c-17.7 0-32 14.3-32 32v832c0 17.7 14.3 32 32 32h640c17.7 0 32-14.3 32-32V311.3c0-8.5-3.4-16.7-9.4-22.7zM790.2 326H602V137.8L790.2 326zm1.8 562H232V136h302v216a42 42 0 0042 42h216v494zM504 618H320c-4.4 0-8 3.6-8 8v48c0 4.4 3.6 8 8 8h184c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8zM312 490v48c0 4.4 3.6 8 8 8h384c4.4 0 8-3.6 8-8v-48c0-4.4-3.6-8-8-8H320c-4.4 0-8 3.6-8 8z"}}]},name:"file-text",theme:"outlined"},r=i(5901),o=function(e,t){return a.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var c=a.forwardRef(o)},73119:function(e,t,i){i.r(t);var n=i(90819),a=i.n(n),s=i(89933),r=i.n(s),o=i(45332),c=i.n(o),l=i(44194),d=i(41123),u=i(34251),f=i(71373),g=i(63065),m=i(43413),v=i(10337),h=i(77407),k=i(5858),p=i(9248),x=i(14318),y=i(68525),j=i(35911),T=i(33e3),b=i(14546),M=i(16829),w=i(83381),Z=i(75699),Y=i(61628),R=i(31756),D=i(31881),S=i(76001),z=i(7999),C=i(30234),B=i(25191),I=i(28977),O=i.n(I),H=i(89295),E=i(54693),F=i(31549),L=d.default.RangePicker,P=u.Z.Option;t.default=function(){var e,t,i=(0,Z.useIntl)(),n=(0,C.Z)().translateStringTranct,s=(0,l.useState)(O()().startOf("day")),o=c()(s,2),d=o[0],I=o[1],U=(0,l.useState)(O()().endOf("day")),W=c()(U,2),V=W[0],A=W[1],N=(0,l.useState)("today"),Q=c()(N,2),q=Q[0],G=Q[1],_=(0,l.useState)(B.whQ),J=c()(_,2),K=J[0],X=J[1],$=(0,l.useState)(),ee=c()($,2),te=ee[0],ie=ee[1],ne=(0,l.useState)(),ae=c()(ne,2),se=ae[0],re=ae[1],oe=(0,D.u)((function(e){return e.currentOrg})),ce=(0,S.E)((function(e){return e})),le=ce.agentResult,de=ce.setAgentResult,ue=(0,E.H)((function(e){return e})),fe=ue.departmentResult,ge=ue.setDepartmentResult,me=(0,l.useState)(),ve=c()(me,2),he=ve[0],ke=ve[1],pe=(0,l.useState)(!1),xe=c()(pe,2),ye=(xe[0],xe[1]),je=[{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,F.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,l.useEffect)((function(){if("custom"===q)I(d),A(V);else{var e=O()();"today"===q?(I(e),A(e)):"yesterday"===q?(I(e.subtract(1,"day")),A(e.subtract(1,"day"))):"week"===q?(I(e.startOf("week")),A(e.endOf("week"))):"lastWeek"===q?(I(e.subtract(1,"week").startOf("week")),A(e.subtract(1,"week").endOf("week"))):"month"===q&&(I(e.startOf("month")),A(e.endOf("month")))}}),[q]);var Te=function(){var e=r()(a()().mark((function e(){var t,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==oe?void 0:oe.uid},e.next=4,(0,H.dF)(t);case 4:200===(i=e.sent).code?(R.yw.destroy(),ge(i),i.data.content.length>0&&re(i.data.content[0].uid)):(R.yw.destroy(),R.yw.error(i.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=r()(a()().mark((function e(){var t,i;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==oe?void 0:oe.uid},e.next=4,(0,z._t)(t);case 4:200===(i=e.sent).code?(R.yw.destroy(),de(i),i.data.content.length>0&&ie(i.data.content[0].uid)):(R.yw.destroy(),R.yw.error(n(i.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=r()(a()().mark((function e(){var t,n;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye(!0),e.prev=1,R.yw.loading("loading"),t={type:K,startDate:null==d?void 0:d.format("YYYY-MM-DD"),endDate:null==V?void 0:V.format("YYYY-MM-DD"),departmentUid:se,assigneeUid:te,orgUid:null==oe?void 0:oe.uid},e.next=6,(0,Y.AD)(t);case 6:n=e.sent,console.log("queryStatisticTicketByDate response:",n.data,t),200===n.code?(R.yw.destroy(),ke(n.data)):(R.yw.destroy(),R.yw.error(n.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),R.yw.error(i.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,ye(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,l.useEffect)((function(){Te(),be()}),[]),(0,l.useEffect)((function(){Me()}),[K,te,se]),(0,l.useEffect)((function(){Me()}),[d,V]);var we=[{status:"新建",count:(null==he?void 0:he.newTickets)||0,percentage:null!=he&&he.totalTickets?Math.round(he.newTickets/he.totalTickets*100):0,color:"#1890ff"},{status:"处理中",count:(null==he?void 0:he.processingTickets)||0,percentage:null!=he&&he.totalTickets?Math.round(he.processingTickets/he.totalTickets*100):0,color:"#faad14"},{status:"已解决",count:(null==he?void 0:he.resolvedTickets)||0,percentage:null!=he&&he.totalTickets?Math.round(he.resolvedTickets/he.totalTickets*100):0,color:"#52c41a"},{status:"已关闭",count:(null==he?void 0:he.closedTickets)||0,percentage:null!=he&&he.totalTickets?Math.round(he.closedTickets/he.totalTickets*100):0,color:"#666"}].filter((function(e){return e.count>0})),Ze=[{key:"1",date:null==d?void 0:d.format("YYYY-MM-DD"),totalTickets:(null==he?void 0:he.totalTickets)||0,newTickets:(null==he?void 0:he.newTickets)||0,inProgress:(null==he?void 0:he.processingTickets)||0,resolved:(null==he?void 0:he.resolvedTickets)||0,closed:(null==he?void 0:he.closedTickets)||0,avgResolutionTime:"".concat((null==he?void 0:he.averageResolutionTime)||0,"小时"),priority:(null==he?void 0:he.criticalTickets)>0?"高":(null==he?void 0:he.highTickets)>0?"中":"低"}],Ye=[{title:i.formatMessage({id:"bi.ticket.table.date"}),dataIndex:"date",key:"date"},{title:i.formatMessage({id:"bi.ticket.table.totalTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:i.formatMessage({id:"bi.ticket.table.processingTickets"}),dataIndex:"processingTickets",key:"processingTickets",render:function(e,t){return(0,F.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:i.formatMessage({id:"bi.ticket.table.resolvedTickets"}),dataIndex:"resolvedTickets",key:"resolvedTickets",render:function(e,t){return(0,F.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:i.formatMessage({id:"bi.ticket.table.closedTickets"}),dataIndex:"closedTickets",key:"closedTickets",render:function(e,t){return(0,F.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:i.formatMessage({id:"bi.ticket.table.resolutionRate"}),dataIndex:"resolutionRate",key:"resolutionRate",render:function(e){return"".concat(e,"%")}},{title:i.formatMessage({id:"bi.ticket.table.avgResolutionTime"}),dataIndex:"avgResolutionTime",key:"avgResolutionTime",render:function(e){return"".concat(e).concat(i.formatMessage({id:"bi.ticket.unit.minute"}))}}];return(0,F.jsxs)("div",{style:{padding:"24px"},children:[(0,F.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,F.jsx)("h2",{children:i.formatMessage({id:"bi.ticket.title.overview"})}),(0,F.jsxs)("p",{children:[i.formatMessage({id:"bi.ticket.description.overview"}),"today"===q&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD"),")"]}),"yesterday"===q&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD"),")"]}),("week"===q||"lastWeek"===q||"month"===q||"custom"===q)&&(0,F.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD")," ~ ",V.format("YYYY-MM-DD"),")"]})]})]}),(0,F.jsx)(g.Z,{style:{marginBottom:16},children:(0,F.jsx)(m.Z,{direction:"vertical",style:{width:"100%"},children:(0,F.jsxs)(m.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,F.jsxs)(m.Z,{wrap:!0,children:[(0,F.jsx)(v.ZP.Group,{value:q,onChange:function(e){return G(e.target.value)},children:je.map((function(e){return(0,F.jsx)(v.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===q&&(0,F.jsx)(L,{value:[d,V],onChange:function(e){I(e[0]),A(e[1])}})]}),(0,F.jsxs)(m.Z,{wrap:!0,children:[(0,F.jsxs)(u.Z,{value:K,onChange:X,style:{width:120},placeholder:i.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,F.jsx)(P,{value:B.whQ,children:i.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,F.jsx)(P,{value:B.fyH,children:i.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,F.jsx)(P,{value:B.nYM,children:i.formatMessage({id:"bi.ticket.filterType.department"})})]}),K===B.fyH&&(0,F.jsx)(u.Z,{value:te,onChange:ie,style:{width:150},placeholder:i.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(e=le.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,F.jsx)(P,{value:e.uid,children:n(e.nickname)},e.uid)}))}),K===B.nYM&&(0,F.jsx)(u.Z,{value:se,onChange:re,style:{width:150},placeholder:i.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(t=fe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,F.jsx)(P,{value:e.uid,children:n(e.name)},e.uid)}))}),(0,F.jsx)(h.ZP,{type:"primary",icon:(0,F.jsx)(j.Z,{}),onClick:function(){return Me()},children:(0,F.jsx)(Z.FormattedMessage,{id:"bi.common.refresh"})})]})]})})}),(0,F.jsxs)(k.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,F.jsx)(p.Z,{span:6,children:(0,F.jsx)(g.Z,{children:(0,F.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==he?void 0:he.totalTickets)||0,prefix:(0,F.jsx)(T.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,F.jsx)(p.Z,{span:6,children:(0,F.jsx)(g.Z,{children:(0,F.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.processingTickets"}),value:(null==he?void 0:he.processingTickets)||0,prefix:(0,F.jsx)(b.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,F.jsx)(p.Z,{span:6,children:(0,F.jsx)(g.Z,{children:(0,F.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.resolvedTickets"}),value:(null==he?void 0:he.resolvedTickets)||0,prefix:(0,F.jsx)(M.Z,{}),valueStyle:{color:"#722ed1"}})})}),(0,F.jsx)(p.Z,{span:6,children:(0,F.jsx)(g.Z,{children:(0,F.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.avgResolutionTime"}),value:(null==he?void 0:he.averageResolutionTime)||0,prefix:(0,F.jsx)(w.Z,{}),valueStyle:{color:"#eb2f96"},suffix:i.formatMessage({id:"bi.ticket.unit.minute"})})})})]}),(0,F.jsxs)(k.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,F.jsx)(p.Z,{span:12,children:(0,F.jsx)(g.Z,{title:i.formatMessage({id:"bi.ticket.statusDistribution"}),children:(0,F.jsx)("div",{style:{height:300},children:we.map((function(e,t){return(0,F.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[(0,F.jsx)("span",{children:e.status}),(0,F.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,F.jsx)("div",{style:{width:12,height:12,backgroundColor:e.color,marginRight:8,borderRadius:2}}),(0,F.jsx)("span",{style:{marginRight:8},children:e.count}),(0,F.jsxs)("span",{style:{color:"#666"},children:["(",e.percentage,"%)"]})]})]},t)}))})})}),(0,F.jsx)(p.Z,{span:12,children:(0,F.jsx)(g.Z,{title:i.formatMessage({id:"bi.ticket.resolutionTrend"}),children:(0,F.jsx)("div",{style:{height:300,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,F.jsxs)("div",{style:{textAlign:"center"},children:[(0,F.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[null!=he&&he.totalTickets?Math.round(he.resolvedTickets/he.totalTickets*100):0,"%"]}),(0,F.jsx)("div",{style:{color:"#666"},children:"今日解决率"}),(0,F.jsxs)("div",{style:{marginTop:16,color:"#999"},children:["客户满意度: ",(null==he?void 0:he.customerSatisfactionRate)||0,"%"]})]})})})})]}),(0,F.jsx)(g.Z,{title:i.formatMessage({id:"bi.ticket.statusDistribution"}),children:(0,F.jsx)(y.Z,{columns:Ye,dataSource:Ze,pagination:!1,size:"middle"})})]})}}}]);