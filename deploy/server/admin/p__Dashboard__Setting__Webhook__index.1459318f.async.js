"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6892],{51344:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(73743),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},83381:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(73743),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},77686:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(73743),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},80503:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(73743),a=r(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=r(5901),l=function(e,t){return a.createElement(o.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var i=a.forwardRef(l)},38805:function(e,t,r){var n=r(7657),a=r(75101),s=r(34424),o=r(44194),l=r(13886),i=r(11764),c=r(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],f=function(e,t){var r=e.fieldProps,d=e.children,f=e.params,p=e.proFieldProps,h=e.mode,g=e.valueEnum,m=e.request,v=e.showSearch,x=e.options,y=(0,a.Z)(e,u),b=(0,o.useContext)(l.Z);return(0,c.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(g),request:m,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:x,mode:h,showSearch:v,getPopupContainer:b.getPopupContainer},r),ref:t,proFieldProps:p},y),{},{children:d}))},p=o.forwardRef((function(e,t){var r=e.fieldProps,u=e.children,f=e.params,p=e.proFieldProps,h=e.mode,g=e.valueEnum,m=e.request,v=e.options,x=(0,a.Z)(e,d),y=(0,n.Z)({options:v,mode:h||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),b=(0,o.useContext)(l.Z);return(0,c.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,s.h)(g),request:m,params:f,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:b.getPopupContainer},y),ref:t,proFieldProps:p},x),{},{children:u}))})),h=o.forwardRef(f);h.SearchSelect=p,h.displayName="ProFormComponent",t.Z=h},32698:function(e,t,r){var n=r(7657),a=r(75101),s=r(44194),o=r(11764),l=r(31549),i=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],c=s.forwardRef((function(e,t){var r=e.fieldProps,s=e.unCheckedChildren,c=e.checkedChildren,u=e.proFieldProps,d=(0,a.Z)(e,i);return(0,l.jsx)(o.Z,(0,n.Z)({valueType:"switch",fieldProps:(0,n.Z)({unCheckedChildren:s,checkedChildren:c},r),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},d))}));t.Z=c},47173:function(e,t,r){var n=r(69578),a=r(7657),s=r(75101),o=r(92032),l=r(8101),i=r(31328),c=r(21762),u=r(44194),d=r(11764),f=r(31549),p=["fieldProps","proFieldProps"],h=["fieldProps","proFieldProps"],g="text",m=function(e){var t=(0,o.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,n.Z)(t,2),s=r[0],c=r[1];return(0,f.jsx)(l.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,n=t.getFieldValue(e.name||[]);return(0,f.jsx)(i.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return c(e)},content:(0,f.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,n),e.strengthText?(0,f.jsx)("div",{style:{marginTop:10},children:(0,f.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:s,children:e.children}))}})},v=function(e){var t=e.fieldProps,r=e.proFieldProps,n=(0,s.Z)(e,p);return(0,f.jsx)(d.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:r},n))};v.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,o=(0,s.Z)(e,h),l=(0,u.useState)(!1),i=(0,n.Z)(l,2),p=i[0],v=i[1];return null!=t&&t.statusRender&&o.name?(0,f.jsx)(m,{name:o.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:p,onOpenChange:v,children:(0,f.jsx)("div",{children:(0,f.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,c.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),v(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),v(!0)}}),proFieldProps:r,filedConfig:{valueType:g}},o))})}):(0,f.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:g}},o))},v.displayName="ProFormComponent",t.Z=v},87587:function(e,t,r){var n=r(7657),a=r(75101),s=r(44194),o=r(11764),l=r(31549),i=["fieldProps","proFieldProps"],c=function(e,t){var r=e.fieldProps,s=e.proFieldProps,c=(0,a.Z)(e,i);return(0,l.jsx)(o.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:s},c))};t.Z=s.forwardRef(c)},18429:function(e,t,r){var n=r(63926),a=r(22176),s=r(93363);t.Z=function(){var e=(0,s.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},60019:function(e,t,r){r.r(t),r.d(t,{default:function(){return le}});var n=r(45332),a=r.n(n),s=r(44194),o=r(31717),l=r(73193),i=r.n(l),c=r(84176),u=r.n(c),d=r(86222),f=r.n(d),p=r(90819),h=r.n(p),g=r(89933),m=r.n(g),v=r(10154),x=r.n(v),y=r(28370),b=r(63926),w=r(93363);function M(e){return k.apply(this,arguments)}function k(){return(k=m()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/webhook/query/org",{method:"GET",params:i()(i()({},t),{},{client:b.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return j.apply(this,arguments)}function j(){return(j=m()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/webhook/create",{method:"POST",data:i()(i()({},t),{},{client:b.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return C.apply(this,arguments)}function C(){return(C=m()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/webhook/update",{method:"POST",data:i()(i()({},t),{},{client:b.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return T.apply(this,arguments)}function T(){return(T=m()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/webhook/delete",{method:"POST",data:i()(i()({},t),{},{client:b.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return A.apply(this,arguments)}function A(){return(A=m()(h()().mark((function e(t){return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,w.request)("/api/v1/webhook/delete/all",{method:"POST",data:i()(i()({},t),{},{client:b.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=r(53067),R=r(77686),E=r(83381),W=r(6992),z=r(91768),V=r(51344),q=r(80503),O=r(82860),L=r(76204),B=r(79847),U=r(86917),D=r(72244),N=r(73739),H=r(69935),K=r(47173),Y=r(38805),Q=r(32698),_=r(87587),G=r(91719),J=r(81417),$=r(58528),X=r(11862),ee=r(31549),te=function(e){var t=e.isEdit,r=e.webhook,n=e.open,o=e.onClose,l=e.onSubmit,c=H.A.useForm(),u=a()(c,1)[0],d=(0,I.u)((function(e){return e.currentOrg})),f=(0,s.useState)(!1),p=a()(f,2),h=p[0],g=p[1];return(0,s.useEffect)((function(){if(t){var e,n,a=null==r||null===(e=r.messageTypes)||void 0===e?void 0:e.includes("all");g(a),u.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,type:null==r?void 0:r.type,url:null==r?void 0:r.url,secret:null==r?void 0:r.secret,enabled:null===(n=null==r?void 0:r.enabled)||void 0===n||n,messageTypes:null==r?void 0:r.messageTypes,description:null==r?void 0:r.description})}else u.setFieldsValue({name:"",type:b.uY8,url:"",secret:"",enabled:!0,messageTypes:[]})}),[t,r,u]),(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(G.Z,{title:"Webhook",width:600,onClose:o,open:n,extra:(0,ee.jsxs)(J.Z,{children:[(0,ee.jsx)(D.ZP,{onClick:o,children:"取消"}),(0,ee.jsx)(D.ZP,{type:"primary",onClick:function(){return u.submit()},children:"提交"})]}),children:(0,ee.jsxs)(H.A,{form:u,name:"webhookForm",onFinish:function(){console.log("handleSubmit"),u.validateFields().then((function(e){var t=i()(i()({},e),{},{orgUid:null==d?void 0:d.uid});console.log("submit",t),l(t)}))},submitter:!1,children:[(0,ee.jsx)(K.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,ee.jsx)(Y.Z,{name:"type",label:"类型",width:"md",options:[{label:"企业微信",value:b.I53},{label:"飞书",value:b.xKB},{label:"Lark",value:b.PIp},{label:"钉钉",value:b.Ix4},{label:"自定义",value:b.uY8}],rules:[{required:!0}]}),(0,ee.jsx)(K.Z,{label:"Webhook URL",name:"url",rules:[{required:!0,message:"请输入Webhook URL"},{pattern:/^https?:\/\/.+/,message:"URL必须以http://或https://开头"}]}),(0,ee.jsx)(K.Z,{label:"Secret",name:"secret",placeholder:"可选，用于签名验证"}),(0,ee.jsx)(Q.Z,{label:"启用状态",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"}}),(0,ee.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,ee.jsxs)(J.Z,{direction:"horizontal",align:"baseline",children:[(0,ee.jsx)("div",{style:{marginRight:"8px",fontWeight:"normal",fontSize:"14px"},children:"消息类型:"}),(0,ee.jsx)($.Z,{title:"全选所有消息类型",children:(0,ee.jsx)(X.Z,{checked:h,onChange:function(e){g(e),e?u.setFieldsValue({messageTypes:["all"]}):u.setFieldsValue({messageTypes:[]})},size:"small",checkedChildren:"全选",unCheckedChildren:"选择"})})]}),(0,ee.jsx)("div",{style:{marginTop:"8px"},children:(0,ee.jsx)(Y.Z,{name:"messageTypes",mode:"multiple",width:"lg",options:[{label:"全部消息",value:"all"},{label:"文本消息",value:b.PYi},{label:"图片消息",value:b.Qm},{label:"文件消息",value:b.Qn},{label:"语音消息",value:b.Yu1},{label:"视频消息",value:b.tVi},{label:"链接消息",value:b.X$C},{label:"位置消息",value:b.UEG},{label:"事件消息",value:b.bjQ},{label:"通知消息",value:b.n$Z},{label:"系统消息",value:b.RKy}],placeholder:"请选择消息类型",rules:[{required:!0,message:"请选择至少一种消息类型"}]})})]}),(0,ee.jsx)(_.Z,{label:"描述",name:"description",placeholder:"可选，webhook用途描述"})]})})})},re=r(18429),ne=["current","pageSize"],ae=function(){var e=(0,w.useIntl)(),t=(0,s.useRef)(),r=(0,re.Z)().translateString,n=(0,s.useState)(1),o=a()(n,2),l=(o[0],o[1]),c=(0,s.useState)(10),d=a()(c,2),p=(d[0],d[1]),g=(0,I.u)((function(e){return e.currentOrg})),v=(0,s.useState)(!1),k=a()(v,2),j=k[0],C=k[1],T=(0,s.useState)({}),A=a()(T,2),H=A[0],K=A[1],Y=(0,s.useState)(!1),Q=a()(Y,2),_=Q[0],G=Q[1],J=L.Z.useModal(),$=a()(J,2),X=$[0],ae=$[1],se=(0,s.useState)([]),oe=a()(se,2),le=oe[0],ie=oe[1],ce=(0,s.useState)([]),ue=a()(ce,2),de=ue[0],fe=ue[1],pe=(0,s.useState)(0),he=a()(pe,2),ge=he[0],me=he[1],ve=(0,s.useState)({}),xe=a()(ve,2),ye=(xe[0],xe[1]),be=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ee.jsx)(w.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,ee.jsx)(w.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,filters:!0,filterMultiple:!0,valueEnum:x()(x()(x()(x()(x()({},b.I53,{text:"企业微信"}),b.xKB,{text:"飞书"}),b.PIp,{text:"Lark"}),b.Ix4,{text:"钉钉"}),b.uY8,{text:"自定义"}),render:function(e,t){var r="blue",n="自定义";switch(t.type){case b.I53:r="green",n="企业微信";break;case b.xKB:r="cyan",n="飞书";break;case b.PIp:r="geekblue",n="Lark";break;case b.Ix4:r="blue",n="钉钉";break;case b.uY8:default:r="purple",n="自定义"}return(0,ee.jsx)(B.Z,{color:r,children:n})}},{title:(0,ee.jsx)(w.FormattedMessage,{id:"url",defaultMessage:"URL"}),dataIndex:"url",copyable:!0,hideInSearch:!0,width:200,ellipsis:!0,render:function(e,t){var r=t.url?String(t.url):"";return(0,ee.jsxs)("a",{href:r,target:"_blank",rel:"noopener noreferrer",onClick:function(e){r&&(r.startsWith("http://")||r.startsWith("https://"))||(e.preventDefault(),r&&window.open("https://".concat(r),"_blank","noopener,noreferrer"))},children:[(0,ee.jsx)(R.Z,{style:{marginRight:5}}),r]})}},{title:(0,ee.jsx)(w.FormattedMessage,{id:"messageTypes",defaultMessage:"Message Types"}),dataIndex:"messageTypes",hideInSearch:!0,width:180,render:function(e,t){return t.messageTypes&&0!==t.messageTypes.length?t.messageTypes.includes("all")?(0,ee.jsx)(B.Z,{color:"green",children:"全部消息类型"}):(0,ee.jsx)(ee.Fragment,{children:t.messageTypes.map((function(e){return(0,ee.jsx)(B.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,ee.jsx)(w.FormattedMessage,{id:"enabled",defaultMessage:"Status"}),dataIndex:"enabled",hideInSearch:!0,width:100,filters:!0,filterMultiple:!1,valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}},render:function(e,t){return(0,ee.jsx)(B.Z,{color:t.enabled?"green":"red",style:{cursor:"pointer"},onClick:function(){return ke(t)},children:t.enabled?"启用":"禁用"})}},{title:(0,ee.jsx)(w.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,ee.jsx)(w.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],we=[].concat(be,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(t,n,a,s){return[(0,ee.jsx)("a",{onClick:function(){K(n),G(!0),C(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,ee.jsx)(U.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(n.name),"】？"),onConfirm:function(){return Me(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,ee.jsx)(E.Z,{style:{color:"red"}}),children:(0,ee.jsx)(D.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),Me=function(){var r=m()(h()().mark((function r(n){var a;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("deleteWebhook:",n),r.next=3,S(n);case 3:a=r.sent,console.log("deleteWebhook:",a),200===a.code?(y.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):y.yw.error(a.message);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),ke=function(){var r=m()(h()().mark((function r(n){var a,s,o;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return a={uid:n.uid,name:n.name,type:n.type,url:n.url,secret:n.secret,enabled:!n.enabled,messageTypes:n.messageTypes,description:n.description,orgUid:n.orgUid},r.next=3,P(a);case 3:s=r.sent,console.log("handleToggleEnabled response:",s),200===s.code?(y.yw.success(e.formatMessage({id:"toggle.success",defaultMessage:n.enabled?"禁用成功":"启用成功"})),null===(o=t.current)||void 0===o||o.reload()):y.yw.error(s.message);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),Ze=function(){var e=m()(h()().mark((function e(r){var n,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(r);case 2:n=e.sent,console.log("handleCreateWebhook response:",n),200===n.code?(null===(a=t.current)||void 0===a||a.reload(),C(!1)):y.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),je=function(){var e=m()(h()().mark((function e(r){var n,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.uid=null==H?void 0:H.uid,e.next=3,P(r);case 3:n=e.sent,console.log("handleUpdateWebhook response:",n),200===n.code?(null===(a=t.current)||void 0===a||a.reload(),C(!1)):y.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Pe=function(){C(!0),G(!1),K({})},Ce=function(){var r=m()(h()().mark((function r(){var n,a,s,o,l,i;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==de.length){r.next=3;break}return y.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),r.abrupt("return");case 3:y.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,s=0,o=f()(de),r.prev=7,o.s();case 9:if((l=o.n()).done){r.next=23;break}return i=l.value,r.prev=11,r.next=14,S(i);case 14:200===r.sent.code?a++:s++,r.next=21;break;case 18:r.prev=18,r.t0=r.catch(11),s++;case 21:r.next=9;break;case 23:r.next=28;break;case 25:r.prev=25,r.t1=r.catch(7),o.e(r.t1);case 28:return r.prev=28,o.f(),r.finish(28);case 31:y.yw.destroy(),0===s?y.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:a})):y.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:a,fail:s})),ie([]),fe([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 36:case"end":return r.stop()}}),r,null,[[7,25,28,31],[11,18]])})));return function(){return r.apply(this,arguments)}}(),Se=function(){var r=m()(h()().mark((function r(){var n,a,s;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==ge){r.next=3;break}return y.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),r.abrupt("return");case 3:return y.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),r.prev=4,n={orgUid:null==g?void 0:g.uid},r.next=8,F(n);case 8:200===(a=r.sent).code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=t.current)||void 0===s||s.reloadAndRest()):(y.yw.destroy(),y.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),r.next=17;break;case 12:r.prev=12,r.t0=r.catch(4),y.yw.destroy(),y.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",r.t0);case 17:case"end":return r.stop()}}),r,null,[[4,12]])})));return function(){return r.apply(this,arguments)}}(),Te={selectedRowKeys:le,onChange:function(e,t){ie(e),fe(t)}},Fe=function(){var e=m()(h()().mark((function e(t,r,n){var a,s,o,c,d;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,s=t.pageSize,o=u()(t,ne),l(a),p(s),ye(o),c=i()({pageNumber:a-1,pageSize:s,orgUid:null==g?void 0:g.uid},o),e.next=7,M(c);case 7:return d=e.sent,console.log("queryWebhooksByOrg response:",d,c),200===d.code?me(d.data.totalElements):y.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,ee.jsxs)(ee.Fragment,{children:[j&&(0,ee.jsx)(te,{isEdit:_,open:j,webhook:H,onClose:function(){C(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),_?je(e):Ze(e)}}),(0,ee.jsx)(O.Z,{columns:we,actionRef:t,cardBordered:!0,rowSelection:Te,request:Fe,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),p(t)}},dateFormatter:"string",headerTitle:"Webhook列表",toolBarRender:function(){return t=[(0,ee.jsx)(D.ZP,{type:"primary",icon:(0,ee.jsx)(W.Z,{}),onClick:Pe,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],r=[],le.length>0&&r.push({key:"batchDelete",icon:(0,ee.jsx)(z.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(le.length,")"),onClick:function(){X.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(le.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Ce,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.push({key:"deleteAll",icon:(0,ee.jsx)(V.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){X.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有Webhook数据吗？此操作不可恢复!"}),onOk:Se,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.length>0&&t.push((0,ee.jsx)(N.Z,{menu:{items:r},placement:"bottom",children:(0,ee.jsxs)(D.ZP,{type:le.length>0?"primary":"default",danger:le.length>0,children:[le.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(le.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ee.jsx)(q.Z,{})]})},"batchOperations")),t;var t,r}}),ae]})},se=["current","pageSize"],oe=function(){var e=(0,w.useIntl)(),t=(0,s.useRef)(),r=(0,re.Z)().translateString,n=(0,s.useState)(1),o=a()(n,2),l=(o[0],o[1]),c=(0,s.useState)(10),d=a()(c,2),p=(d[0],d[1]),g=(0,I.u)((function(e){return e.currentOrg})),v=(0,s.useState)(!1),x=a()(v,2),b=x[0],k=x[1],j=(0,s.useState)({}),C=a()(j,2),T=C[0],A=C[1],R=(0,s.useState)(!1),H=a()(R,2),K=H[0],Y=H[1],Q=L.Z.useModal(),_=a()(Q,2),G=_[0],J=_[1],$=(0,s.useState)([]),X=a()($,2),ne=X[0],ae=X[1],oe=(0,s.useState)([]),le=a()(oe,2),ie=le[0],ce=le[1],ue=(0,s.useState)(0),de=a()(ue,2),fe=de[0],pe=de[1],he=(0,s.useState)({}),ge=a()(he,2),me=(ge[0],ge[1]),ve=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,ee.jsx)(w.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,ee.jsx)(w.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,render:function(e,t){return(0,ee.jsx)(ee.Fragment,{children:(0,ee.jsx)(B.Z,{color:"blue",children:t.type})})}},{title:(0,ee.jsx)(w.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,ee.jsx)(w.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],xe=[].concat(ve,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(t,n,a,s){return[(0,ee.jsx)("a",{onClick:function(){A(n),Y(!0),k(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,ee.jsx)(U.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(n.name),"】？"),onConfirm:function(){return ye(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,ee.jsx)(E.Z,{style:{color:"red"}}),children:(0,ee.jsx)(D.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),ye=function(){var r=m()(h()().mark((function r(n){var a;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("deleteWebhook:",n),r.next=3,S(n);case 3:a=r.sent,console.log("deleteWebhook:",a),200===a.code?(y.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):y.yw.error(a.message);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),be=function(){var e=m()(h()().mark((function e(r){var n,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Z(r);case 2:n=e.sent,console.log("handleCreateWebhook response:",n),200===n.code?(null===(a=t.current)||void 0===a||a.reload(),k(!1)):y.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),we=function(){var e=m()(h()().mark((function e(r){var n,a;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.uid=null==T?void 0:T.uid,e.next=3,P(r);case 3:n=e.sent,console.log("handleUpdateWebhook response:",n),200===n.code?(null===(a=t.current)||void 0===a||a.reload(),k(!1)):y.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){k(!0),Y(!1),A({})},ke=function(){var r=m()(h()().mark((function r(){var n,a,s,o,l,i;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==ie.length){r.next=3;break}return y.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),r.abrupt("return");case 3:y.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,s=0,o=f()(ie),r.prev=7,o.s();case 9:if((l=o.n()).done){r.next=23;break}return i=l.value,r.prev=11,r.next=14,S(i);case 14:200===r.sent.code?a++:s++,r.next=21;break;case 18:r.prev=18,r.t0=r.catch(11),s++;case 21:r.next=9;break;case 23:r.next=28;break;case 25:r.prev=25,r.t1=r.catch(7),o.e(r.t1);case 28:return r.prev=28,o.f(),r.finish(28);case 31:y.yw.destroy(),0===s?y.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:a})):y.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:a,fail:s})),ae([]),ce([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 36:case"end":return r.stop()}}),r,null,[[7,25,28,31],[11,18]])})));return function(){return r.apply(this,arguments)}}(),Ze=function(){var r=m()(h()().mark((function r(){var n,a,s;return h()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==fe){r.next=3;break}return y.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),r.abrupt("return");case 3:return y.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),r.prev=4,n={orgUid:null==g?void 0:g.uid},r.next=8,F(n);case 8:200===(a=r.sent).code?(y.yw.destroy(),y.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(s=t.current)||void 0===s||s.reloadAndRest()):(y.yw.destroy(),y.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),r.next=17;break;case 12:r.prev=12,r.t0=r.catch(4),y.yw.destroy(),y.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",r.t0);case 17:case"end":return r.stop()}}),r,null,[[4,12]])})));return function(){return r.apply(this,arguments)}}(),je={selectedRowKeys:ne,onChange:function(e,t){ae(e),ce(t)}},Pe=function(){var e=m()(h()().mark((function e(t,r,n){var a,s,o,c,d;return h()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,s=t.pageSize,o=u()(t,se),l(a),p(s),me(o),c=i()({pageNumber:a-1,pageSize:s,orgUid:null==g?void 0:g.uid},o),e.next=7,M(c);case 7:return d=e.sent,console.log("queryWebhooksByOrg response:",d,c),200===d.code?pe(d.data.totalElements):y.yw.error(d.message),e.abrupt("return",{data:d.data.content,success:!0,total:d.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,ee.jsxs)(ee.Fragment,{children:[b&&(0,ee.jsx)(te,{isEdit:K,open:b,webhook:T,onClose:function(){k(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),K?we(e):be(e)}}),(0,ee.jsx)(O.Z,{columns:xe,actionRef:t,cardBordered:!0,rowSelection:je,request:Pe,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),p(t)}},dateFormatter:"string",headerTitle:"Webhook列表",toolBarRender:function(){return t=[(0,ee.jsx)(D.ZP,{type:"primary",icon:(0,ee.jsx)(W.Z,{}),onClick:Me,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],r=[],ne.length>0&&r.push({key:"batchDelete",icon:(0,ee.jsx)(z.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(ne.length,")"),onClick:function(){G.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ne.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:ke,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.push({key:"deleteAll",icon:(0,ee.jsx)(V.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){G.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有Webhook数据吗？此操作不可恢复!"}),onOk:Ze,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.length>0&&t.push((0,ee.jsx)(N.Z,{menu:{items:r},placement:"bottom",children:(0,ee.jsxs)(D.ZP,{type:ne.length>0?"primary":"default",danger:ne.length>0,children:[ne.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ne.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,ee.jsx)(q.Z,{})]})},"batchOperations")),t;var t,r}}),J]})},le=function(){var e=(0,w.useIntl)(),t=(0,s.useState)("webhooks"),r=a()(t,2),n=r[0],l=r[1],i=[{key:"webhooks",label:e.formatMessage({id:"webhook.config",defaultMessage:"配置管理"}),children:(0,ee.jsx)(ae,{})},{key:"messages",label:e.formatMessage({id:"webhook.messages",defaultMessage:"消息记录"}),children:(0,ee.jsx)(oe,{})}];return(0,ee.jsx)("div",{className:"webhook-container",children:(0,ee.jsx)(o.Z,{activeKey:n,onChange:function(e){return l(e)},items:i})})}}}]);