"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{76750:function(e,n,t){var r=t(55735),a=t(65461),s=t(41159);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},86067:function(e,n,t){t.r(n),t.d(n,{default:function(){return Ja}});var r=t(96865),a=t(75574),s=t(45332),i=t.n(s),o=t(23864),l=t(73193),c=t.n(l),u=t(76711),d=t.n(u),p=t(55735),f=t(44435),h=t(83642),m=t(83890),g=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,a=n().currentChannel;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:i,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResult:c()(c()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),x=t(9452),y=t(84288),v=t(44194),j=t(36310),w=t(31549),b=[{name:"web",nickname:"网站/H5",description:"用于网站/H5页面的客服接入"},{name:"npm",nickname:"Npm包",description:"通过Npm包集成到前端项目"}],k=function(){var e=(0,o.Z)().isDarkMode,n=(0,v.useState)([]),t=i()(n,2),r=t[0],a=t[1],s=g((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),l=s.currentChannel,c=s.setCurrentChannel;return(0,v.useEffect)((function(){var e=[].concat(b);!(0,j.Ox)()&&(0,j.OJ)()&&e.push({name:"app",nickname:"App应用",description:"App应用内嵌客服"},{name:"wechat",nickname:"微信应用",description:"微信小程序/公众号接入"},{name:"messenger",nickname:"Messenger(开发中)",description:"Facebook Messenger客服（开发中）"},{name:"instagram",nickname:"Instagram(开发中)",description:"Instagram客服（开发中）"},{name:"whatsapp",nickname:"Whatsapp(开发中)",description:"Whatsapp客服（开发中）"},{name:"telegram",nickname:"Telegram",description:"Telegram机器人客服"},{name:"line",nickname:"Line(开发中)",description:"Line客服（开发中）"},{name:"email",nickname:"Email(开发中)",description:"邮件客服（开发中）"},{name:"douyin",nickname:"抖音",description:"抖音平台客服"},{name:"xiaohongshu",nickname:"小红书",description:"小红书平台客服"}),a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(n,t){return(0,w.jsx)(x.Z.Item,{className:"".concat(e?"list-item-dark":"list-item"," ")+((null==l?void 0:l.name)===n.name?e?"dark-active":"active":""),onClick:function(){c(n)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,w.jsx)(y.C,{src:"".concat((0,j.kG)(),"/avatars/").concat(n.name,".png")}),title:(0,w.jsx)(w.Fragment,{children:null==n?void 0:n.nickname}),description:(0,w.jsx)("span",{className:"channel-desc",children:null==n?void 0:n.description})})})}})})},Z=t(8247),M=t(41159),C=function(){var e=(0,M.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(M.Access,{accessible:e.canDebug(),fallback:(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(M.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},A=t(90819),I=t.n(A),S=t(89933),E=t.n(S),T=t(10154),R=t.n(T),P=t(86803);function W(e){return L.apply(this,arguments)}function L(){return(L=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return D.apply(this,arguments)}function D(){return(D=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function q(e){return z.apply(this,arguments)}function z(){return(z=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function B(e){return U.apply(this,arguments)}function U(){return(U=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(e){return N.apply(this,arguments)}function N(){return(N=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return _.apply(this,arguments)}function _(){return(_=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var K=t(40612),G=t(15722),Y=t(82669),H=t(80556),J=t(59304),X=t(54881),Q=t(2484),$=t(53530),ee=t(27487),ne=t(75365),te=t(96485),re=t(76750),ae=t(72614),se=t(95490),ie=t(69169),oe=t(4499),le=t(84881),ce=t(73442),ue=t(3849),de="MP",pe="MINI",fe="WORK",he="KEFU",me=function(e){var n,t=e.isEdit,r=e.wechatApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||fe,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:fe,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"wechatWorkForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,w.jsx)(le.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:de},{label:"微信小程序",value:pe},{label:"企业微信",value:fe},{label:"微信客服",value:he}],fieldProps:{defaultValue:fe},rules:[{required:!0}]}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===fe?(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===fe?(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,w.jsx)(oe.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,w.jsx)(le.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},ge=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(n){e((function(e){e.wechatAppResult.data.content.unshift(n)}))},updateWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},deleteWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},setWechatAppResult:function(t){var r;(e({wechatAppResult:t}),""===n().currentWechatApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:t.data.content[0]}))},setCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().wechatAppResult),{},{data:{content:s}});e({wechatAppResult:i,currentWechatApp:t})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:t})},refreshCurrentWechatApp:function(n){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),n);var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatAppResult:c()(c()({},n().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatApp not found in cache:",t),n().currentWechatApp.uid===t&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),xe=R()(R()(R()(R()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),ye=function(e){e.type;var n=(0,M.useIntl)(),t=(0,v.useRef)(!1),r=(0,re.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,s=(0,v.useState)(!1),l=i()(s,2),c=l[0],u=l[1],d=(0,v.useState)(!1),p=i()(d,2),f=p[0],h=p[1],m=(0,v.useState)(!1),g=i()(m,2),y=g[0],j=g[1],b=(0,K.u)((function(e){return e.currentOrg})),k=ge((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),Z=k.wechatAppResult,C=k.currentWechatApp,A=k.setWechatAppResult,S=k.insertWechatApp,T=k.setCurrentWechatApp,R=k.deleteCurrentWechatApp,L=$.Z.useModal(),F=i()(L,2),D=F[0],z=F[1],U=function(){var e=E()(I()().mark((function e(t){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete wechatApp",t),P.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,V(t);case 4:r=e.sent,console.log("delete wechatApp response",r),200===r.code?(P.yw.destroy(),P.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),R(t.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=E()(I()().mark((function e(){var n,r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==b?void 0:b.uid},e.next=8,W(n);case 8:r=e.sent,console.log("getWechatApps",r),200===r.code?(P.yw.destroy(),A(r)):(P.yw.destroy(),P.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){N();var e=function(e){h(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var O=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),j(!0),e.prev=2,!f){e.next=8;break}return e.next=6,ae(n);case 6:e.next=10;break;case 8:return e.next=10,_(n);case 10:return e.prev=10,j(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),_=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,q(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateWechatApp response:",t),200===t.code?(S(t.data),T(t.data),u(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==C?void 0:C.uid,P.yw.loading("正在更新..."),e.next=4,B(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateWechatApp response:",t),200===t.code?(T(t.data),u(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){u(!0),h(!1)},children:n.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:N,children:n.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==C?void 0:C.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:n.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),u(!0)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:n.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=C,void D.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){U(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:Z.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:C.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(w.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(",xe[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,w.jsx)(me,{isEdit:f,open:c,loading:y,wechatApp:C,onClose:function(){u(!1)},onSubmit:O}),z]})},ve=t(32327),je=t(62673),we=t(73589),be=t(29266),ke=t(19116),Ze=t(88996),Me=t(38775),Ce=t(83337),Ae=t(34600),Ie=t(15892),Se=t(54800),Ee=t(32693),Te=t(5716),Re=t(5321),Pe=t(34545),We=t(28977),Le=t.n(We),Fe=ve.Z.Text,De=ve.Z.Paragraph,qe=R()(R()(R()(R()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),ze=R()(R()(R()(R()({},p.a4q,(0,w.jsx)(Ce.Z,{})),p.qRy,(0,w.jsx)(Ae.Z,{})),p._oo,(0,w.jsx)(Ie.Z,{})),p.rWo,(0,w.jsx)(Se.Z,{})),Be={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},Ue={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},Ve=function(){var e,n=(0,M.useIntl)(),t=ge((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),r=t.currentWechatApp,a=t.refreshCurrentWechatApp,s=(0,v.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,v.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,v.useState)(!1),m=i()(h,2),g=m[0],x=m[1],y=(0,v.useState)(!1),b=i()(y,2),k=b[0],Z=b[1],C=(0,v.useState)(!1),A=i()(C,2),S=(A[0],A[1],(0,v.useState)(!1)),T=i()(S,2),R=T[0],W=T[1],L=(0,v.useState)(!1),D=i()(L,2),q=D[0],z=D[1],B=function(e,n){return e?n?e:"******":"-"},U=function(){var e=E()(I()().mark((function e(){var n;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return P.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return W(!0),e.prev=4,e.next=7,O({uid:r.uid});case 7:n=e.sent,console.log("refreshAccessTokenWechatApp response",n),200===n.code?(P.yw.success("AccessToken 刷新成功"),a&&a(n.data),V()):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,W(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),V=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return P.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return z(!0),e.prev=4,e.next=7,F({uid:r.uid});case 7:n=e.sent,console.log("queryWechatAppByUid refresh detail",n),200===n.code?(t=n.data,P.yw.success("应用详情刷新成功"),a&&a(t)):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,z(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,w.jsxs)(je.Z,{title:(0,w.jsxs)(ue.Z,{children:[ze[r.type]||(0,w.jsx)(Ce.Z,{}),(0,w.jsx)("span",{children:r.name||"微信应用详情"}),(0,w.jsx)(be.Z,{color:"blue",children:qe[r.type]||r.type})]}),extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:V,loading:q,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(Fe,{copyable:!0,children:r.uid})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,w.jsx)(be.Z,{color:"blue",children:qe[r.type]||r.type})}),(0,w.jsx)(ke.Z.Item,{label:"AppID/企业ID",children:(0,w.jsx)(Fe,{copyable:!0,children:r.appId})}),(0,w.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Fe,{copyable:!!p&&{text:r.appSecret||""},children:B(r.appSecret,p)}),(0,w.jsx)(Ze.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,w.jsx)(ne.ZP,{type:"text",icon:p?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return f(!p)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"加密模式",children:(0,w.jsx)(be.Z,{color:Ue[r.encryptMode]||"default",children:Be[r.encryptMode]||r.encryptMode})}),(0,w.jsx)(ke.Z.Item,{label:"URL",children:(0,w.jsx)(Fe,{copyable:!0,children:(0,j.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/webhooks/"+r.uid})}),(0,w.jsx)(ke.Z.Item,{label:"Token",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Fe,{copyable:!!g&&{text:r.token||""},children:B(r.token,g)}),(0,w.jsx)(Ze.Z,{title:g?"隐藏Token":"显示Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:g?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return x(!g)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"EncodingAESKey",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Fe,{copyable:!!k&&{text:r.encodingAesKey||""},children:B(r.encodingAesKey,k)}),(0,w.jsx)(Ze.Z,{title:k?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,w.jsx)(ne.ZP,{type:"text",icon:k?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return Z(!k)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Fe,{copyable:!!l&&{text:r.accessToken||""},children:B(r.accessToken,l)}),(0,w.jsx)(Ze.Z,{title:l?"隐藏Token":"显示Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:l?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return c(!l)},size:"small"})}),(0,w.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,w.jsx)(ne.ZP,{type:"primary",icon:(0,w.jsx)(Pe.Z,{}),onClick:U,size:"small",loading:R,children:"刷新Token"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?Le()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,w.jsx)(De,{children:r.description})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Le()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(De,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,w.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,w.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,w.jsx)(je.Z,{bordered:!1,title:"微信应用详情",extra:(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),children:(0,w.jsx)(we.Z,{description:"请先在左侧列表选择一个微信应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},Ne=function(e){console.log(e)},Oe=[{key:"detail",label:"应用详情",children:(0,w.jsx)(Ve,{})}],_e=function(e){e.type;var n=(0,v.useState)(Oe),t=i()(n,2),r=t[0],a=t[1];return(0,v.useEffect)((function(){var e=[].concat(Oe);a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:Ne})})},Ke=a.Z.Sider,Ge=a.Z.Content,Ye=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(Ke,{width:i,style:s,children:(0,w.jsx)(ye,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Ge,{children:(0,w.jsx)(_e,{type:n})})})]})},He=t(24170),Je=t(91723),Xe=t(67402),Qe=t(71529),$e=function(e){var n=e.platform,t=void 0===n?"react":n,r=(0,M.useIntl)(),a=(0,v.useState)(t),s=i()(a,2),o=s[0],l=s[1],c=o.charAt(0).toUpperCase()+o.slice(1),u="vanilla"===o?"BytedeskVanilla":"Bytedesk".concat(c);return(0,w.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,w.jsxs)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,w.jsx)("h2",{children:(0,w.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:r.formatMessage({id:"install.guide.github"})})}),(0,w.jsx)(ne.ZP,{type:"primary",icon:(0,w.jsx)(Qe.Z,{}),href:"".concat("https://www.weiyuai.cn/docs/zh-CN/docs/channel/").concat("vanilla"===o?"web":o),target:"_blank",children:r.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===o?"Web":o.charAt(0).toUpperCase()+o.slice(1)})})]}),(0,w.jsx)(Me.Z,{orientation:"left",children:"选择框架"}),(0,w.jsx)(Xe.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:o,onChange:function(e){l(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,w.jsx)("h2",{children:r.formatMessage({id:"install.guide.steps"})}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h3",{children:r.formatMessage({id:"install.guide.step1.title"})}),(0,w.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(r.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h3",{children:r.formatMessage({id:"install.guide.step2.title"})}),(0,w.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:function(){switch(o){case"react":return"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';";case"vue":return"import { BytedeskVue } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';";case"svelte":return"import { BytedeskSvelte } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';";default:return"import { BytedeskVanilla } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"}}()})]}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h3",{children:r.formatMessage({id:"install.guide.step3.title"})}),(0,w.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(r.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(r.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,w.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,w.jsx)("h3",{children:r.formatMessage({id:"install.guide.step4.title"})}),(0,w.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('".concat(function(){switch(o){case"react":return"BytedeskReact";case"vue":return"BytedeskVue";case"svelte":return"BytedeskSvelte";default:return"BytedeskVanilla"}}()," initialized');\n  };\n\n  return (\n    <div>\n      <").concat(u," {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ").concat(r.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,w.jsxs)("div",{children:[(0,w.jsx)("h3",{children:r.formatMessage({id:"install.guide.step5.title"})}),(0,w.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,w.jsxs)("li",{children:[(0,w.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",r.formatMessage({id:"install.guide.step5.show"})]}),(0,w.jsxs)("li",{children:[(0,w.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",r.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},en=t(1902),nn=ve.Z.Title,tn=ve.Z.Text,rn=function(e){var n=e.channel,t=((0,v.useRef)(!1),(0,re.Z)().translateString),r=g((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),a=r.currentType,s=r.setCurrentType,o=(0,K.u)((function(e){return e.currentOrg})),l=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],c=(0,en.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),u=c.agentResult,d=c.currentAgent,f=c.setAgentResult,h=c.setCurrentAgent,m=(0,v.useState)([]),x=i()(m,2),y=x[0],j=x[1],b=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),k=b.workgroupResult,Z=b.currentWorkgroup,M=b.setWorkgroupResult,C=b.setCurrentWorkgroup,A=(0,v.useState)(null==d?void 0:d.uid),S=i()(A,2),T=S[0],R=S[1],W=(0,v.useState)(null==Z?void 0:Z.uid),L=i()(W,2),F=L[0],D=L[1],q=(0,v.useState)([]),z=i()(q,2),B=z[0],U=z[1],V=function(){var e=E()(I()().mark((function e(){var n,r,a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,He._t)(n);case 4:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(P.yw.destroy(),f(r),r.data.content.length>0&&(h(r.data.content[0]),R(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),j(a)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=E()(I()().mark((function e(){var n,r,a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,ae.LE)(n);case 4:r=e.sent,console.log("getWorkgroups",r),200===r.code?(P.yw.destroy(),M(r),r.data.content.length>0&&(C(r.data.content[0]),D(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),U(a)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){V(),N()}),[a]);var O=["web","npm"].includes((null==n?void 0:n.name)||"");return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(Xe.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),s(e.target.value)},options:l,defaultValue:a,optionType:"button",buttonStyle:"solid"}),(0,w.jsx)("br",{}),(0,w.jsx)("br",{}),a===p.Njn&&(null==d?void 0:d.uid)&&(0,w.jsx)(Xe.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=u.data.content.find((function(n){return n.uid===e.target.value}));h(n)},options:y,defaultValue:T,optionType:"button",buttonStyle:"solid"}),a===p.aZD&&(null==d?void 0:d.uid)&&(0,w.jsx)(Xe.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=k.data.content.find((function(n){return n.uid===e.target.value}));C(n)},options:B,defaultValue:F,optionType:"button",buttonStyle:"solid"}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(nn,{level:5,children:"组织orgUid"}),(0,w.jsx)(tn,{code:!0,copyable:!0,children:null==o?void 0:o.uid}),(0,w.jsx)(nn,{level:5,children:"一对一当前客服Uid"}),(0,w.jsx)(tn,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,w.jsx)(nn,{level:5,children:"当前技能组Uid"}),(0,w.jsx)(tn,{code:!0,copyable:!0,children:null==Z?void 0:Z.uid}),(0,w.jsx)(Me.Z,{}),O&&("web"===(null==n?void 0:n.name)?(0,w.jsx)(Je.Z,{type:p.aZD}):"npm"===(null==n?void 0:n.name)?(0,w.jsx)($e,{}):null)]})};function an(e){return sn.apply(this,arguments)}function sn(){return(sn=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function on(e){return ln.apply(this,arguments)}function ln(){return(ln=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function cn(e){return un.apply(this,arguments)}function un(){return(un=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dn(e){return pn.apply(this,arguments)}function pn(){return(pn=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var fn=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(n){e((function(e){e.appResult.data.content.unshift(n)}))},updateApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("App with uid ".concat(n.uid," not found."))}))},deleteApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("App with uid ".concat(n.uid," not found."))}))},setAppResult:function(t){var r;(e({appResult:t}),""===n().currentApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:t.data.content[0]}))},setCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().appResult),{},{data:{content:s}});e({appResult:i,currentApp:t})}else e({currentApp:t})},deleteCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({appResult:c()(c()({},n().appResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("App not found in cache:",t),n().currentApp.uid===t&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),hn=t(32350),mn=function(e){var n=e.open,t=e.isEdit,r=e.app,a=e.onClose,s=e.onSubmit,o=(0,M.useIntl)(),l=ie.A.useForm(),u=i()(l,1)[0],d=(0,K.u)((function(e){return e.currentOrg})),f=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,v.useEffect)((function(){n&&t&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[n,t,r,u]),(0,w.jsx)(ce.Z,{title:t?o.formatMessage({id:"edit",defaultMessage:"编辑应用"}):o.formatMessage({id:"add",defaultMessage:"添加应用"}),width:600,open:n,onClose:a,maskClosable:!0,extra:(0,w.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,w.jsx)(ne.ZP,{onClick:a,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,w.jsx)(ne.ZP,{onClick:function(){u.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:t?r.uid:void 0});s(n)}))},type:"primary",children:o.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,w.jsxs)(ie.A,{form:u,layout:"vertical",submitter:!1,children:[(0,w.jsx)(oe.Z,{name:"name",label:o.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:o.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:o.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,w.jsx)(le.Z,{name:"appPlatform",label:o.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:o.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:o.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:f}),(0,w.jsx)(oe.Z,{name:"appPackage",label:o.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:o.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:o.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,w.jsx)(oe.Z,{name:"appKey",label:"App Key",placeholder:o.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,w.jsx)(ne.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:n})},children:"随机生成"})}}),(0,w.jsx)(oe.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:o.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,w.jsx)(hn.Z,{name:"description",label:o.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:o.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},gn=function(e){e.type;var n=(0,M.useIntl)(),t=(0,v.useRef)(!1),r=(0,re.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,s=(0,v.useState)(!1),l=i()(s,2),c=l[0],u=l[1],d=(0,v.useState)(!1),p=i()(d,2),f=p[0],h=p[1],m=(0,K.u)((function(e){return e.currentOrg})),g=fn((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),y=g.appResult,j=g.currentApp,b=g.setAppResult,k=g.insertApp,Z=g.setCurrentApp,C=g.deleteCurrentApp,A=$.Z.useModal(),S=i()(A,2),T=S[0],R=S[1],W=function(){var e=E()(I()().mark((function e(t){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete app",t),P.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除"})),e.next=4,dn(t);case 4:r=e.sent,console.log("delete app response",r),200===r.code?(P.yw.destroy(),P.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),C(t.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),L=function(){var e=E()(I()().mark((function e(){var n,r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=8,an(n);case 8:r=e.sent,console.log("getApps",r),200===r.code?(P.yw.destroy(),b(r)):(P.yw.destroy(),P.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){L()}),[]);var F=function(){var e=E()(I()().mark((function e(t){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,on(t);case 2:r=e.sent,console.log("handleCreateApp response:",r),200===r.code?(k(r.data),u(!1),P.yw.success(n.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):P.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),D=function(){var e=E()(I()().mark((function e(t){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==j?void 0:j.uid,e.next=3,cn(t);case 3:r=e.sent,console.log("handleUpdateApp response:",r),200===r.code?(Z(r.data),u(!1),P.yw.success(n.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):P.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,w.jsx)(ne.ZP,{size:"small",type:"primary",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){u(!0),h(!1)},children:n.formatMessage({id:"create",defaultMessage:"新建"})}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){h(!0),u(!0)},disabled:""===(null==j?void 0:j.uid),children:n.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,w.jsx)(ne.ZP,{size:"small",danger:!0,onClick:function(){return function(e){T.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(e.name,"】？"),onOk:function(){W(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(j)},disabled:""===(null==j?void 0:j.uid),children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:y.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:j.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){Z(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(w.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(",r(null==e?void 0:e.appPlatform),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,w.jsx)(mn,{isEdit:f,open:c,app:j,onClose:function(){u(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),f?D(e):F(e)}}),R]})},xn=t(2523),yn=t(48006),vn=t(40795),jn=ve.Z.Text,wn=ve.Z.Paragraph,bn={android:(0,w.jsx)(xn.Z,{}),ios:(0,w.jsx)(yn.Z,{}),flutter:(0,w.jsx)(vn.Z,{}),uniapp:(0,w.jsx)(Ae.Z,{})},kn={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},Zn=function(){var e=(0,M.useIntl)(),n=fn().currentApp;return null!=n&&n.uid?(0,w.jsxs)(je.Z,{title:(0,w.jsxs)(ue.Z,{children:[bn[n.appPlatform]||(0,w.jsx)(vn.Z,{}),(0,w.jsx)("span",{children:n.name||"应用详情"}),(0,w.jsx)(be.Z,{color:"blue",children:kn[n.appPlatform]||n.appPlatform})]}),bordered:!1,children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(jn,{copyable:!0,children:n.uid})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:n.name}),n.appKey&&(0,w.jsx)(ke.Z.Item,{label:"App Key",children:(0,w.jsx)(jn,{copyable:!0,children:n.appKey})}),"android"===n.appPlatform&&n.appPackage&&(0,w.jsx)(ke.Z.Item,{label:"Package Name",children:n.appPackage}),n.description&&(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,w.jsx)(wn,{children:n.description})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:n.createdAt})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(wn,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的应用凭证（App Key 等），避免泄露"}),(0,w.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,w.jsx)(je.Z,{bordered:!1,children:(0,w.jsx)(we.Z,{description:"请先选择或创建一个应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},Mn=t(69079),Cn=t(72608),An=ve.Z.Title,In=ve.Z.Paragraph,Sn=ve.Z.Text,En=(ve.Z.Link,Z.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),Tn=function(){(0,M.useIntl)();var e=fn().currentApp,n=(0,K.u)((function(e){return e.currentOrg}));if(null==e||!e.uid)return(0,w.jsx)(je.Z,{bordered:!1,children:(0,w.jsx)(we.Z,{description:"请先选择或创建一个应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})});return(0,w.jsxs)(je.Z,{title:"集成指南",bordered:!1,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Mn.Z,{}),onClick:function(){var n=e.appPlatform,t=En[n];t?window.open(t,"_blank"):Cn.ZP.info("该平台暂无GitHub仓库链接")},children:"查看源码"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Qe.Z,{}),onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/category/channel","_blank")},children:"查看文档"})]}),children:[(0,w.jsxs)(An,{level:4,children:["集成 ",e.name," (",e.appPlatform,")"]}),(0,w.jsxs)(In,{children:["以下是将客服功能集成到 ",e.name," 应用的步骤说明。请按照指南完成配置，使用提供的App Key和其他凭证进行初始化。"]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(An,{level:5,children:"1. 基本配置"}),(0,w.jsx)(In,{children:(0,w.jsxs)("ul",{children:[e.appKey&&(0,w.jsxs)("li",{children:[(0,w.jsx)(Sn,{strong:!0,children:"App Key:"})," ",(0,w.jsx)(Sn,{copyable:!0,children:e.appKey})]}),(0,w.jsxs)("li",{children:[(0,w.jsx)(Sn,{strong:!0,children:"组织ID:"})," ",(0,w.jsx)(Sn,{copyable:!0,children:null==n?void 0:n.uid})]})]})}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(In,{type:"secondary",children:"如果在集成过程中遇到任何问题，请联系技术支持团队：270580156@qq.com"})]})},Rn=function(e){console.log(e)},Pn=[{key:"details",label:"应用详情",children:(0,w.jsx)(Zn,{})},{key:"integration",label:"集成指南",children:(0,w.jsx)(Tn,{})}],Wn=function(e){e.type;var n=(0,v.useState)([]),t=i()(n,2),r=t[0],a=t[1];fn((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,v.useEffect)((function(){var e=[].concat(Pn);a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"details",items:r,onChange:Rn})})},Ln=a.Z.Sider,Fn=a.Z.Content,Dn=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(Ln,{width:i,style:s,children:(0,w.jsx)(gn,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Fn,{children:(0,w.jsx)(Wn,{type:n})})})]})};function qn(e){return zn.apply(this,arguments)}function zn(){return(zn=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/email/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bn(e){return Un.apply(this,arguments)}function Un(){return Un=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/email/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Un.apply(this,arguments)}function Vn(e){return Nn.apply(this,arguments)}function Nn(){return(Nn=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/email/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return _n.apply(this,arguments)}function _n(){return _n=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/email/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),_n.apply(this,arguments)}var Kn=t(36099),Gn=t(93689),Yn=t(80601),Hn=t(48708),Jn="WORK",Xn=function(e){var n,t=e.isEdit,r=e.email,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Jn,enabled:!1!==(null==r?void 0:r.enabled),workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Jn,enabled:!0,workgroupUid:n})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"Email应用配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"wechatWorkForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(Hn.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,w.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Qn=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{emailResult:{data:{content:[]}},currentEmail:{uid:"",nickname:"",avatar:"",description:""},insertEmail:function(n){e((function(e){e.emailResult.data.content.unshift(n)}))},updateEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Email with uid ".concat(n.uid," not found."))}))},deleteEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Email with uid ".concat(n.uid," not found."))}))},setEmailResult:function(t){var r;(e({emailResult:t}),""===n().currentEmail.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentEmail:t.data.content[0]}))},setCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().emailResult),{},{data:{content:s}});e({emailResult:i,currentEmail:t})}else console.warn("Email with the specified uid not found."),e({currentEmail:t})},refreshCurrentEmail:function(n){e((function(e){e.currentEmail=c()(c()({},e.currentEmail),n);var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({emailResult:c()(c()({},n().emailResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Email not found in cache:",t),n().currentEmail.uid===t&&e({currentEmail:{uid:""}})},deleteEmailCache:function(){return e({},!0)}}})),{name:p.e73}))),$n=function(e){var n=e.type,t=(0,M.useIntl)(),r=(0,v.useRef)(!1),a=(0,re.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,v.useState)(!1),u=i()(l,2),d=u[0],p=u[1],f=(0,v.useState)(!1),h=i()(f,2),m=h[0],g=h[1],y=(0,v.useState)(!1),j=i()(y,2),b=j[0],k=j[1],Z=(0,K.u)((function(e){return e.currentOrg})),C=(0,v.useState)(null),A=i()(C,2),S=A[0],T=A[1],R=Qn((function(e){return{emailResult:e.emailResult,currentEmail:e.currentEmail,setEmailResult:e.setEmailResult,insertEmail:e.insertEmail,setCurrentEmail:e.setCurrentEmail,deleteCurrentEmail:e.deleteCurrentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})),W=R.emailResult,L=R.currentEmail,F=R.setEmailResult,D=R.insertEmail,q=R.setCurrentEmail,z=R.deleteCurrentEmail,B=R.refreshCurrentEmail,U=$.Z.useModal(),V=i()(U,2),N=V[0],O=V[1],_=function(){var e=E()(I()().mark((function e(n){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete email",n),P.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,On(n);case 4:r=e.sent,console.log("delete email response",r),200===r.code?(P.yw.destroy(),P.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,qn(n);case 8:t=e.sent,console.log("getEmails response:",t,n),200===t.code?(P.yw.destroy(),F(t)):(P.yw.destroy(),P.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){ae();var e=function(e){g(!0),p(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var se=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,oe(n);case 6:e.next=10;break;case 8:return e.next=10,ie(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,Bn(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateEmail response:",t),200===t.code?(D(t.data),q(t.data),p(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==L?void 0:L.uid,P.yw.loading("正在更新..."),e.next=4,Vn(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateEmail response:",t),200===t.code?(q(t.data),p(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=E()(I()().mark((function e(n,t){var r,a,s;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(n.uid),e.prev=1,e.next=4,Vn({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateEmail enabled response",r),200===r.code?(P.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=W&&null!==(a=W.data)&&void 0!==a&&a.content&&(s=W.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),F(c()(c()({},W),{},{data:c()(c()({},W.data),{},{content:s})}))),(null==L?void 0:L.uid)===n.uid&&B&&B(r.data)):P.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,T(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:ae,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==L?void 0:L.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==L.enabled?(0,w.jsx)(Kn.Z,{}):(0,w.jsx)(Gn.Z,{}),label:!1!==L.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return le(L,!1===L.enabled)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){N.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(L)}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:W.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:L.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]}),(0,w.jsx)(Yn.Z,{spinning:S===(null==e?void 0:e.uid),size:"small",children:(0,w.jsx)(be.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:a(null==e?void 0:e.description)})})}}),d&&(0,w.jsx)(Xn,{type:n,isEdit:m,open:d,loading:b,email:L,onClose:function(){p(!1)},onSubmit:se}),O]})},et=t(39042),nt=ve.Z.Text,tt=ve.Z.Paragraph,rt=R()(R()(R()(R()({},p.a4q,"Email公众号"),p.qRy,"Email小程序"),p._oo,"企业Email"),p.rWo,"Email客服"),at=R()(R()(R()(R()({},p.a4q,(0,w.jsx)(Ce.Z,{})),p.qRy,(0,w.jsx)(Ae.Z,{})),p._oo,(0,w.jsx)(Ie.Z,{})),p.rWo,(0,w.jsx)(Se.Z,{})),st=function(){var e,n=(0,M.useIntl)(),t=Qn((function(e){return{currentEmail:e.currentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})),r=t.currentEmail,a=t.refreshCurrentEmail,s=(0,v.useState)(!1),o=i()(s,2),l=(o[0],o[1],(0,v.useState)(!1)),c=i()(l,2),u=(c[0],c[1],(0,v.useState)(!1)),d=i()(u,2),p=(d[0],d[1],(0,v.useState)(!1)),f=i()(p,2),h=(f[0],f[1],(0,v.useState)(!1)),m=i()(h,2),g=(m[0],m[1],(0,v.useState)(!1)),x=i()(g,2),y=(x[0],x[1],(0,v.useState)(!1)),b=i()(y,2),k=b[0],Z=b[1],C=(0,v.useState)(!1),A=i()(C,2),S=A[0],T=A[1],R=function(){var e=E()(I()().mark((function e(){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return P.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:Z(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),W=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return P.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return T(!0),e.prev=4,e.next=7,Vn({uid:r.uid,enabled:n});case 7:t=e.sent,console.log("updateEmail enabled response",t),200===t.code?(P.yw.success("应用已".concat(n?"启用":"禁用")),a&&a(t.data)):P.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,T(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,w.jsxs)(je.Z,{title:(0,w.jsxs)(ue.Z,{children:[at[r.type]||(0,w.jsx)(Ce.Z,{}),(0,w.jsx)("span",{children:r.name||"Email应用详情"}),(0,w.jsx)(be.Z,{color:"blue",children:rt[r.type]||r.type}),(0,w.jsx)(be.Z,{color:!1!==r.enabled?"success":"default",icon:!1!==r.enabled?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==r.enabled?"已启用":"已禁用"})]}),extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:R,loading:k,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(nt,{copyable:!0,children:r.uid})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,w.jsx)(be.Z,{color:"blue",children:rt[r.type]||r.type})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(et.Z,{checked:!1!==r.enabled,onChange:W,loading:S,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,w.jsx)(nt,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,w.jsx)(ke.Z.Item,{label:"URL",children:(0,w.jsx)(nt,{copyable:!0,children:(0,j.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/hook/"+r.uid})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Le()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(tt,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的Email应用凭证，避免泄露"}),(0,w.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,w.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,w.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,w.jsx)(je.Z,{bordered:!1,title:"Email应用详情",extra:(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),children:(0,w.jsx)(we.Z,{description:"请先在左侧列表选择一个Email应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},it=function(e){console.log(e)},ot=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,w.jsx)(st,{type:n})}],r=(0,v.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,v.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:it})})},lt=a.Z.Sider,ct=a.Z.Content,ut=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(lt,{width:i,style:s,children:(0,w.jsx)($n,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(ct,{children:(0,w.jsx)(ot,{type:n})})})]})};function dt(e){return pt.apply(this,arguments)}function pt(){return(pt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/telegram/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ft(e){return ht.apply(this,arguments)}function ht(){return ht=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/telegram/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),ht.apply(this,arguments)}function mt(e){return gt.apply(this,arguments)}function gt(){return(gt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/telegram/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xt(e){return yt.apply(this,arguments)}function yt(){return yt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/telegram/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),yt.apply(this,arguments)}var vt="BOT",jt=function(e){var n,t=e.isEdit,r=e.telegram,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({nickname:null==r?void 0:r.nickname,username:null==r?void 0:r.username,description:null==r?void 0:r.description,token:null==r?void 0:r.token,type:(null==r?void 0:r.type)||vt,enabled:void 0===(null==r?void 0:r.enabled)||r.enabled,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({nickname:"",username:"",description:"",token:"",type:vt,enabled:!0,workgroupUid:n})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"Telegram Bot 配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"telegramForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"Bot 名称",name:"nickname",rules:[{required:!0,message:"请输入 Bot 名称"}],placeholder:"请输入 Bot 显示名称"}),(0,w.jsx)(oe.Z,{label:"Bot 用户名",name:"username",rules:[{required:!0,message:"请输入 Bot 用户名"}],placeholder:"请输入 Bot 用户名（不包含@）",extra:(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/telegram/",target:"_blank",rel:"noopener noreferrer",children:"查看 Telegram Bot 创建说明"})}),(0,w.jsx)(oe.Z,{label:"Bot Token",name:"token",rules:[{required:!0,message:"请输入 Bot Token"}],placeholder:"请输入从 BotFather 获取的 Token",fieldProps:{addonAfter:(0,w.jsx)(ue.Z,{children:(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})})}}),(0,w.jsx)(oe.Z,{label:"Bot 描述",name:"description",placeholder:"请输入 Bot 描述信息"}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(Hn.Z,{label:"启用 Bot",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制 Bot 是否启用，禁用后 Bot 将无法接收和处理消息"}),(0,w.jsx)("p",{children:"注：请确保您已经在 BotFather 创建了 Bot 并获取了 Token"})]})})})},wt=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{telegramResult:{data:{content:[]}},currentTelegram:{uid:"",nickname:"",avatar:"",description:"",enabled:!0},insertTelegram:function(n){e((function(e){e.telegramResult.data.content.unshift(n)}))},updateTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Telegram with uid ".concat(n.uid," not found."))}))},deleteTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Telegram with uid ".concat(n.uid," not found."))}))},setTelegramResult:function(t){var r;(e({telegramResult:t}),""===n().currentTelegram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentTelegram:t.data.content[0]}))},setCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().telegramResult),{},{data:{content:s}});e({telegramResult:i,currentTelegram:t})}else console.warn("Telegram with the specified uid not found."),e({currentTelegram:t})},refreshCurrentTelegram:function(n){e((function(e){e.currentTelegram=c()(c()({},e.currentTelegram),n);var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({telegramResult:c()(c()({},n().telegramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Telegram not found in cache:",t),n().currentTelegram.uid===t&&e({currentTelegram:{uid:"",enabled:!0}})},deleteTelegramCache:function(){return e({},!0)}}})),{name:p.I2C}))),bt=function(e){var n=e.type,t=(0,M.useIntl)(),r=(0,v.useRef)(!1),a=(0,re.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,v.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,v.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,v.useState)(!1),y=i()(g,2),j=y[0],b=y[1],k=(0,K.u)((function(e){return e.currentOrg})),Z=wt((function(e){return{telegramResult:e.telegramResult,currentTelegram:e.currentTelegram,setTelegramResult:e.setTelegramResult,insertTelegram:e.insertTelegram,setCurrentTelegram:e.setCurrentTelegram,deleteCurrentTelegram:e.deleteCurrentTelegram}})),C=Z.telegramResult,A=Z.currentTelegram,S=Z.setTelegramResult,T=Z.insertTelegram,R=Z.setCurrentTelegram,W=Z.deleteCurrentTelegram,L=$.Z.useModal(),F=i()(L,2),D=F[0],q=F[1],z=function(){var e=E()(I()().mark((function e(n){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete telegram",n),P.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,xt(n);case 4:r=e.sent,console.log("delete telegram response",r),200===r.code?(P.yw.destroy(),P.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),B=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==k?void 0:k.uid},e.next=8,dt(n);case 8:t=e.sent,console.log("getTelegrams response",t,n),200===t.code?(P.yw.destroy(),S(t)):(P.yw.destroy(),P.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){B();var e=function(e){m(!0),d(!0)};return window.addEventListener("telegram-edit",e),function(){window.removeEventListener("telegram-edit",e)}}),[]);var U=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),b(!0),e.prev=2,!h){e.next=8;break}return e.next=6,N(n);case 6:e.next=10;break;case 8:return e.next=10,V(n);case 10:return e.prev=10,b(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,ft(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateTelegram response:",t),200===t.code?(T(t.data),R(t.data),d(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==A?void 0:A.uid,P.yw.loading("正在更新..."),e.next=4,mt(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateTelegram response:",t),200===t.code?(R(t.data),d(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"绑定 Bot"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:B,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==A?void 0:A.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){D.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.nickname,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(A)}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:C.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:A.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){R(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(ee.Z,{align:"center",gap:"small",children:[(0,w.jsxs)("span",{children:[a(null==e?void 0:e.nickname)," ",(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(@",null==e?void 0:e.username,")"]})]}),(0,w.jsx)(be.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?"启用":"禁用"})]}),description:null==e?void 0:e.description})})}}),u&&(0,w.jsx)(jt,{type:n,isEdit:h,open:u,loading:j,telegram:A,onClose:function(){d(!1)},onSubmit:U}),q]})},kt=ve.Z.Text,Zt=ve.Z.Paragraph,Mt={BOT:(0,w.jsx)(Se.Z,{})},Ct=function(e){e.type;var n,t,r=(0,M.useIntl)(),a=wt((function(e){return{currentTelegram:e.currentTelegram,refreshCurrentTelegram:e.refreshCurrentTelegram}})),s=a.currentTelegram,o=a.refreshCurrentTelegram,l=(0,v.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,v.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,v.useState)(!1),x=i()(g,2),y=x[0],j=x[1],b=(r.formatMessage({id:"telegram.bot.type",defaultMessage:"Telegram Bot"}),function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s&&s.uid){e.next=3;break}return P.yw.error(r.formatMessage({id:"telegram.bot.toggle.error.incomplete",defaultMessage:"无法切换状态，Bot信息不完整"})),e.abrupt("return");case 3:return j(!0),e.prev=4,e.next=7,mt({uid:s.uid,enabled:n});case 7:t=e.sent,console.log("updateTelegram enabled response",t),200===t.code?(P.yw.success(r.formatMessage({id:n?"telegram.bot.toggle.success.enabled":"telegram.bot.toggle.success.disabled",defaultMessage:n?"Bot已启用":"Bot已禁用"})),o&&o(t.data)):P.yw.error(r.formatMessage({id:"telegram.bot.toggle.error.operation",defaultMessage:"操作失败"})+": ".concat(t.message||r.formatMessage({id:"telegram.bot.toggle.error.unknown",defaultMessage:"未知错误"}))),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error(r.formatMessage({id:"telegram.bot.toggle.error.exception",defaultMessage:"操作出错"})+": ".concat(e.t0 instanceof Error?e.t0.message:r.formatMessage({id:"telegram.bot.toggle.error.unknown",defaultMessage:"未知错误"})));case 15:return e.prev=15,j(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}()),k=function(){var e=E()(I()().mark((function e(){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=s&&s.uid){e.next=3;break}return P.yw.error(r.formatMessage({id:"telegram.bot.refresh.error.incomplete",defaultMessage:"无法刷新详情，应用信息不完整"})),e.abrupt("return");case 3:m(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=s&&s.uid?(0,w.jsxs)(je.Z,{title:(0,w.jsxs)(ue.Z,{children:[Mt[s.type]||(0,w.jsx)(Se.Z,{}),(0,w.jsx)("span",{children:(null==s?void 0:s.nickname)||r.formatMessage({id:"telegram.bot.detail",defaultMessage:"Telegram Bot 详情"})}),(0,w.jsx)(be.Z,{color:s.enabled?"success":"default",icon:s.enabled?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:s.enabled?r.formatMessage({id:"telegram.bot.enabled",defaultMessage:"已启用"}):r.formatMessage({id:"telegram.bot.disabled",defaultMessage:"已禁用"})})]}),extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://core.telegram.org/bots/api","_blank")},type:"link",children:r.formatMessage({id:"telegram.bot.documentation",defaultMessage:"文档"})}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("telegram-edit",{detail:{app:s}});window.dispatchEvent(e)},type:"default",children:r.formatMessage({id:"telegram.bot.edit",defaultMessage:"编辑"})}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:k,loading:h,type:"primary",children:r.formatMessage({id:"telegram.bot.refresh.details",defaultMessage:"刷新详情"})})]}),bordered:!1,children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:r.formatMessage({id:"app.uid",defaultMessage:"Bot UID"}),children:(0,w.jsx)(kt,{copyable:!0,children:s.uid})}),(0,w.jsx)(ke.Z.Item,{label:r.formatMessage({id:"telegram.bot.name",defaultMessage:"Bot 名称"}),children:s.nickname}),(0,w.jsxs)(ke.Z.Item,{label:r.formatMessage({id:"telegram.bot.username",defaultMessage:"Bot 用户名"}),children:["@",s.username]}),(0,w.jsx)(ke.Z.Item,{label:r.formatMessage({id:"telegram.bot.description",defaultMessage:"Bot 描述"}),children:s.description||"-"}),(0,w.jsx)(ke.Z.Item,{label:r.formatMessage({id:"telegram.bot.enabled.status",defaultMessage:"启用状态"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(et.Z,{checked:s.enabled,onChange:b,loading:y,checkedChildren:r.formatMessage({id:"telegram.bot.enable",defaultMessage:"启用"}),unCheckedChildren:r.formatMessage({id:"telegram.bot.disable",defaultMessage:"禁用"})}),(0,w.jsx)(kt,{type:s.enabled?"success":"danger",children:s.enabled?r.formatMessage({id:"telegram.bot.enabled",defaultMessage:"已启用"}):r.formatMessage({id:"telegram.bot.disabled",defaultMessage:"已禁用"})})]})}),(0,w.jsx)(ke.Z.Item,{label:r.formatMessage({id:"telegram.bot.token",defaultMessage:"Bot Token"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(kt,{copyable:!0,children:(n=s.token,t=u,n?t?n:"******":"-")}),(0,w.jsx)(ne.ZP,{type:"text",icon:u?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return d(!u)}})]})}),(0,w.jsx)(ke.Z.Item,{label:r.formatMessage({id:"telegram.bot.created.time",defaultMessage:"创建时间"}),children:s.createdAt?Le()(s.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:r.formatMessage({id:"telegram.bot.security.instructions",defaultMessage:"安全说明"})}),(0,w.jsx)(Zt,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:r.formatMessage({id:"telegram.bot.security.token.warning",defaultMessage:"请妥善保管您的 Bot Token，避免泄露"})}),(0,w.jsx)("li",{children:r.formatMessage({id:"telegram.bot.security.token.credential",defaultMessage:"Bot Token 是访问 Bot API 的唯一凭证，泄露可能导致 Bot 被他人控制"})}),(0,w.jsx)("li",{children:r.formatMessage({id:"telegram.bot.security.token.rotation",defaultMessage:"建议定期更换 Bot Token，特别是在怀疑可能泄露的情况下"})}),(0,w.jsx)("li",{children:r.formatMessage({id:"telegram.bot.security.token.reset",defaultMessage:"如发现安全问题，请立即在 BotFather 中重置 Token 并联系我们的支持团队"})}),(0,w.jsx)("li",{children:r.formatMessage({id:"telegram.bot.security.enabled.control",defaultMessage:"Bot启用状态控制着是否接收和处理消息，禁用后Bot将暂停工作"})}),(0,w.jsx)("li",{children:r.formatMessage({id:"telegram.bot.security.maintenance",defaultMessage:"建议在维护或调试时临时禁用Bot，避免接收不必要的消息"})})]})})]}):(0,w.jsx)(je.Z,{bordered:!1,title:r.formatMessage({id:"telegram.bot.detail",defaultMessage:"Telegram Bot 详情"}),extra:(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://core.telegram.org/bots/api","_blank")},type:"link",children:r.formatMessage({id:"telegram.bot.documentation",defaultMessage:"文档"})}),children:(0,w.jsx)(we.Z,{description:r.formatMessage({id:"telegram.bot.select.prompt",defaultMessage:"请先在左侧列表选择一个 Telegram Bot"}),image:we.Z.PRESENTED_IMAGE_SIMPLE})})},At=function(e){console.log(e)},It=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,w.jsx)(Ct,{type:n})}],r=(0,v.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,v.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:At})})},St=a.Z.Sider,Et=a.Z.Content,Tt=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(St,{width:i,style:s,children:(0,w.jsx)(bt,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Et,{children:(0,w.jsx)(It,{type:n})})})]})};function Rt(e){return Pt.apply(this,arguments)}function Pt(){return(Pt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/line/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wt(e){return Lt.apply(this,arguments)}function Lt(){return Lt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/line/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Lt.apply(this,arguments)}function Ft(e){return Dt.apply(this,arguments)}function Dt(){return(Dt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/line/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qt(e){return zt.apply(this,arguments)}function zt(){return zt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/line/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),zt.apply(this,arguments)}var Bt=function(e){var n,t=e.isEdit,r=e.line,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||"MESSAGING_API",enabled:!1!==(null==r?void 0:r.enabled),workgroupUid:null==r?void 0:r.workgroupUid,channelId:null==r?void 0:r.channelId,channelSecret:null==r?void 0:r.channelSecret});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:"MESSAGING_API",enabled:!0,workgroupUid:n,channelId:"",channelSecret:""})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"Line应用配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"lineAppForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,w.jsx)(le.Z,{label:"应用类型",name:"type",options:[{label:"LINE Messaging API",value:"MESSAGING_API"}],fieldProps:{defaultValue:"MESSAGING_API"},rules:[{required:!0}]}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,w.jsx)(oe.Z,{label:"Channel ID",name:"channelId",rules:[{required:!0}],fieldProps:{addonAfter:(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("channelId");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})},extra:(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Channel ID获取说明"})})}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:(0,w.jsx)(oe.Z,{label:"Channel Secret",name:"channelSecret",rules:[{required:!0}],fieldProps:{addonAfter:(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("channelSecret");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})},extra:(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/line/#%E7%82%B9%E5%87%BB%E5%A4%8D%E5%88%B6-channel-id-%E5%92%8C-channel-secret-%E5%A1%AB%E5%86%99%E5%88%B0%E5%BE%AE%E8%AF%AD%E5%90%8E%E5%8F%B0",target:"_blank",rel:"noopener noreferrer",children:"查看Channel Secret获取说明"})})}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(Hn.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,w.jsx)("p",{children:"注：请到 LINE Developers 平台获取 Channel ID 和 Channel Secret"})]})})})},Ut=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{lineResult:{data:{content:[]}},currentLine:{uid:"",nickname:"",avatar:"",description:""},insertLine:function(n){e((function(e){e.lineResult.data.content.unshift(n)}))},updateLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Line with uid ".concat(n.uid," not found."))}))},deleteLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Line with uid ".concat(n.uid," not found."))}))},setLineResult:function(t){var r;(e({lineResult:t}),""===n().currentLine.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLine:t.data.content[0]}))},setCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().lineResult),{},{data:{content:s}});e({lineResult:i,currentLine:t})}else console.warn("Line with the specified uid not found."),e({currentLine:t})},refreshCurrentLine:function(n){e((function(e){e.currentLine=c()(c()({},e.currentLine),n);var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({lineResult:c()(c()({},n().lineResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Line not found in cache:",t),n().currentLine.uid===t&&e({currentLine:{uid:""}})},deleteLineCache:function(){return e({},!0)}}})),{name:p.yRi}))),Vt=function(e){var n=e.type,t=(0,M.useIntl)(),r=(0,v.useRef)(!1),a=(0,re.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,v.useState)(!1),u=i()(l,2),d=u[0],p=u[1],f=(0,v.useState)(!1),h=i()(f,2),m=h[0],g=h[1],y=(0,v.useState)(!1),j=i()(y,2),b=j[0],k=j[1],Z=(0,K.u)((function(e){return e.currentOrg})),C=(0,v.useState)(null),A=i()(C,2),S=A[0],T=A[1],R=Ut((function(e){return{lineResult:e.lineResult,currentLine:e.currentLine,setLineResult:e.setLineResult,insertLine:e.insertLine,setCurrentLine:e.setCurrentLine,deleteCurrentLine:e.deleteCurrentLine,refreshCurrentLine:e.refreshCurrentLine}})),W=R.lineResult,L=R.currentLine,F=R.setLineResult,D=R.insertLine,q=R.setCurrentLine,z=R.deleteCurrentLine,B=R.refreshCurrentLine,U=$.Z.useModal(),V=i()(U,2),N=V[0],O=V[1],_=function(){var e=E()(I()().mark((function e(n){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete line",n),P.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,qt(n);case 4:r=e.sent,console.log("delete line response",r),200===r.code?(P.yw.destroy(),P.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,Rt(n);case 8:t=e.sent,console.log("getLines response:",t,n),200===t.code?(P.yw.destroy(),F(t)):(P.yw.destroy(),P.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){ae();var e=function(e){g(!0),p(!0)};return window.addEventListener("lineapp-edit",e),function(){window.removeEventListener("lineapp-edit",e)}}),[]);var se=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,oe(n);case 6:e.next=10;break;case 8:return e.next=10,ie(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,Wt(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateLine response:",t),200===t.code?(D(t.data),q(t.data),p(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==L?void 0:L.uid,P.yw.loading("正在更新..."),e.next=4,Ft(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateLine response:",t),200===t.code?(q(t.data),p(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=E()(I()().mark((function e(n,t){var r,a,s;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(n.uid),e.prev=1,e.next=4,Ft({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateLine enabled response",r),200===r.code?(P.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=W&&null!==(a=W.data)&&void 0!==a&&a.content&&(s=W.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),F(c()(c()({},W),{},{data:c()(c()({},W.data),{},{content:s})}))),(null==L?void 0:L.uid)===n.uid&&B&&B(r.data)):P.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,T(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:ae,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==L?void 0:L.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==L.enabled?(0,w.jsx)(Kn.Z,{}):(0,w.jsx)(Gn.Z,{}),label:!1!==L.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return le(L,!1===L.enabled)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){N.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(L)}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:W.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:L.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,w.jsx)(Yn.Z,{spinning:S===(null==e?void 0:e.uid),size:"small",children:(0,w.jsx)(be.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]})})})}}),d&&(0,w.jsx)(Bt,{type:n,isEdit:m,open:d,loading:b,line:L,onClose:function(){p(!1)},onSubmit:se}),O]})},Nt=ve.Z.Text,Ot=ve.Z.Paragraph,_t=function(e){e.type;var n=(0,M.useIntl)(),t=Ut((function(e){return{currentLine:e.currentLine,refreshCurrentLine:e.refreshCurrentLine}})),r=t.currentLine,a=t.refreshCurrentLine,s=(0,v.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,v.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=function(e,n){return e?n?e:"******":"-"},m=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return P.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return f(!0),e.prev=4,e.next=7,Ft({uid:r.uid,enabled:n});case 7:t=e.sent,console.log("updateLine enabled response",t),200===t.code?(P.yw.success("应用已".concat(n?"启用":"禁用")),a&&a(t.data)):P.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,f(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}(),g=function(){var e=E()(I()().mark((function e(){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return P.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:c(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,w.jsxs)(je.Z,{title:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)("span",{children:r.name||"Line应用详情"}),(0,w.jsx)(be.Z,{color:!1!==r.enabled?"success":"default",icon:!1!==r.enabled?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==r.enabled?"已启用":"已禁用"})]}),extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/line","_blank")},type:"link",children:"文档"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("lineapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:g,loading:l,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(Nt,{copyable:!0,children:r.uid})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"line.channelId",defaultMessage:"Channel ID"}),children:(0,w.jsx)(Nt,{copyable:{text:r.channelId},children:h(r.channelId,!0)})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"line.channelSecret",defaultMessage:"Channel Secret"}),children:(0,w.jsx)(Nt,{copyable:{text:r.channelSecret},children:h(r.channelSecret,!1)})}),(0,w.jsx)(ke.Z.Item,{label:"Webhook URL",children:(0,w.jsx)(Nt,{copyable:!0,children:(0,j.kG)()+"/line/webhooks/"+r.uid})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(et.Z,{checked:!1!==r.enabled,onChange:m,loading:p,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,w.jsx)(Nt,{type:!1!==r.enabled?"success":"danger",children:!1!==r.enabled?"已启用":"已禁用"})]})}),(0,w.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?Le()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(Ot,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的Line应用凭证，避免泄露"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,w.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,w.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,w.jsx)(je.Z,{bordered:!1,title:"Line应用详情",extra:(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/line","_blank")},type:"link",children:"文档"}),children:(0,w.jsx)(we.Z,{description:"请先在左侧列表选择一个Line应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},Kt=function(e){console.log(e)},Gt=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,w.jsx)(_t,{type:n})}],r=(0,v.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,v.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Kt})})},Yt=a.Z.Sider,Ht=a.Z.Content,Jt=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(Yt,{width:i,style:s,children:(0,w.jsx)(Vt,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Ht,{children:(0,w.jsx)(Gt,{type:n})})})]})};function Xt(e){return Qt.apply(this,arguments)}function Qt(){return(Qt=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/whatsapp/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $t(e){return er.apply(this,arguments)}function er(){return(er=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/whatsapp/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function nr(e){return tr.apply(this,arguments)}function tr(){return(tr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/whatsapp/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rr(e){return ar.apply(this,arguments)}function ar(){return(ar=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/whatsapp/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sr(e){return ir.apply(this,arguments)}function ir(){return(ir=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/whatsapp/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function or(e){return lr.apply(this,arguments)}function lr(){return(lr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/whatsapp/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var cr="MP",ur="MINI",dr="WORK",pr="KEFU",fr=function(e){var n,t=e.isEdit,r=e.whatsApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||dr,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid,enabled:!1!==(null==r?void 0:r.enabled)});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:dr,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n,enabled:!0})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"WhatsApp应用配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"wechatWorkForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,w.jsx)(le.Z,{label:"应用类型",name:"type",options:[{label:"WhatsApp公众号",value:cr},{label:"WhatsApp小程序",value:ur},{label:"企业WhatsApp",value:dr},{label:"WhatsApp客服",value:pr}],fieldProps:{defaultValue:dr},rules:[{required:!0}]}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===dr?(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===dr?(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,w.jsx)(oe.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,w.jsx)(le.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(Hn.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,w.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},hr=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{whatsAppResult:{data:{content:[]}},currentWhatsApp:{uid:"",nickname:"",avatar:"",description:""},insertWhatsApp:function(n){e((function(e){e.whatsAppResult.data.content.unshift(n)}))},updateWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},deleteWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},setWhatsAppResult:function(t){var r;(e({whatsAppResult:t}),""===n().currentWhatsApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWhatsApp:t.data.content[0]}))},setCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().whatsAppResult),{},{data:{content:s}});e({whatsAppResult:i,currentWhatsApp:t})}else console.warn("WhatsApp with the specified uid not found."),e({currentWhatsApp:t})},refreshCurrentWhatsApp:function(n){e((function(e){e.currentWhatsApp=c()(c()({},e.currentWhatsApp),n);var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({whatsAppResult:c()(c()({},n().whatsAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WhatsApp not found in cache:",t),n().currentWhatsApp.uid===t&&e({currentWhatsApp:{uid:""}})},deleteWhatsAppCache:function(){return e({},!0)}}})),{name:p.TvW}))),mr=function(e){var n=e.type,t=(0,M.useIntl)(),r=(0,v.useRef)(!1),a=(0,re.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,v.useState)(!1),u=i()(l,2),d=u[0],p=u[1],f=(0,v.useState)(!1),h=i()(f,2),m=h[0],g=h[1],y=(0,v.useState)(!1),j=i()(y,2),b=j[0],k=j[1],Z=(0,K.u)((function(e){return e.currentOrg})),C=(0,v.useState)(null),A=i()(C,2),S=A[0],T=A[1],R=hr((function(e){return{whatsAppResult:e.whatsAppResult,currentWhatsApp:e.currentWhatsApp,setWhatsAppResult:e.setWhatsAppResult,insertWhatsApp:e.insertWhatsApp,setCurrentWhatsApp:e.setCurrentWhatsApp,deleteCurrentWhatsApp:e.deleteCurrentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),W=R.whatsAppResult,L=R.currentWhatsApp,F=R.setWhatsAppResult,D=R.insertWhatsApp,q=R.setCurrentWhatsApp,z=R.deleteCurrentWhatsApp,B=R.refreshCurrentWhatsApp,U=$.Z.useModal(),V=i()(U,2),N=V[0],O=V[1],_=function(){var e=E()(I()().mark((function e(n){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete whatsApp",n),P.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,sr(n);case 4:r=e.sent,console.log("delete whatsApp response",r),200===r.code?(P.yw.destroy(),P.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,P.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,Xt(n);case 8:t=e.sent,console.log("getWhatsApps response",t,n),200===t.code?(P.yw.destroy(),F(t)):(P.yw.destroy(),P.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){ae();var e=function(e){g(!0),p(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var se=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,oe(n);case 6:e.next=10;break;case 8:return e.next=10,ie(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,nr(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateWhatsApp response:",t),200===t.code?(D(t.data),q(t.data),p(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==L?void 0:L.uid,P.yw.loading("正在更新..."),e.next=4,rr(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateWhatsApp response:",t),200===t.code?(q(t.data),p(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=E()(I()().mark((function e(n,t){var r,a,s;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(n.uid),e.prev=1,e.next=4,rr({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateWhatsApp enabled response",r),200===r.code?(P.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=W&&null!==(a=W.data)&&void 0!==a&&a.content&&(s=W.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),F(c()(c()({},W),{},{data:c()(c()({},W.data),{},{content:s})}))),(null==L?void 0:L.uid)===n.uid&&B&&B(r.data)):P.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,T(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:ae,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==L?void 0:L.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==L.enabled?(0,w.jsx)(Kn.Z,{}):(0,w.jsx)(Gn.Z,{}),label:!1!==L.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return le(L,!1===L.enabled)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=L,void N.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})});var e}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:W.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:L.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]}),(0,w.jsx)(Yn.Z,{spinning:S===(null==e?void 0:e.uid),size:"small",children:(0,w.jsx)(be.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:a(null==e?void 0:e.description)})})}}),d&&(0,w.jsx)(fr,{type:n,isEdit:m,open:d,loading:b,whatsApp:L,onClose:function(){p(!1)},onSubmit:se}),O]})},gr=ve.Z.Text,xr=ve.Z.Paragraph,yr=R()(R()(R()(R()({},p.a4q,"WhatsApp公众号"),p.qRy,"WhatsApp小程序"),p._oo,"企业WhatsApp"),p.rWo,"WhatsApp客服"),vr=R()(R()(R()(R()({},p.a4q,(0,w.jsx)(Ce.Z,{})),p.qRy,(0,w.jsx)(Ae.Z,{})),p._oo,(0,w.jsx)(Ie.Z,{})),p.rWo,(0,w.jsx)(Se.Z,{})),jr={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},wr={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},br=function(e){e.type;var n,t=(0,M.useIntl)(),r=hr((function(e){return{currentWhatsApp:e.currentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),a=r.currentWhatsApp,s=r.refreshCurrentWhatsApp,o=(0,v.useState)(!1),l=i()(o,2),c=l[0],u=l[1],d=(0,v.useState)(!1),p=i()(d,2),f=p[0],h=p[1],m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],b=(0,v.useState)(!1),k=i()(b,2),Z=k[0],C=k[1],A=(0,v.useState)(!1),S=i()(A,2),T=S[0],R=S[1],W=(0,v.useState)(!1),L=i()(W,2),F=L[0],D=L[1],q=(0,v.useState)(!1),z=i()(q,2),B=z[0],U=z[1],V=function(){return u(!c)},N=function(){return h(!f)},O=function(){return y(!x)},_=function(){return C(!Z)},K=function(e,n){return e?n?e:"******":"-"},G=function(){var e=E()(I()().mark((function e(){var n;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return P.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return R(!0),e.prev=4,e.next=7,or({uid:a.uid});case 7:n=e.sent,console.log("refreshAccessTokenWhatsApp response",n),200===n.code?(P.yw.success("AccessToken 刷新成功"),s&&s(n.data),Y()):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,R(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),Y=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return P.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return D(!0),e.prev=4,e.next=7,$t({uid:a.uid});case 7:n=e.sent,console.log("queryWhatsAppByUid refresh detail",n),200===n.code?(t=n.data,P.yw.success("应用详情刷新成功"),s&&s(t)):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,D(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return P.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return U(!0),e.prev=4,e.next=7,rr({uid:a.uid,enabled:n});case 7:t=e.sent,console.log("updateWhatsApp enabled response",t),200===t.code?(P.yw.success("应用已".concat(n?"启用":"禁用")),s&&s(t.data)):P.yw.error("操作失败: ".concat(t.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,U(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsx)(je.Z,{title:null!=a&&a.uid?(0,w.jsxs)(ue.Z,{children:[vr[a.type]||(0,w.jsx)(Ce.Z,{}),(0,w.jsx)("span",{children:a.name||"WhatsApp应用详情"}),(0,w.jsx)(be.Z,{color:"blue",children:yr[a.type]||a.type}),(0,w.jsx)(be.Z,{color:!1!==a.enabled?"success":"default",icon:!1!==a.enabled?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==a.enabled?"已启用":"已禁用"})]}):"WhatsApp应用详情",extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/whatsapp","_blank")},type:"link",children:"文档"}),(null==a?void 0:a.uid)&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:a}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:Y,loading:F,type:"primary",children:"刷新详情"})]})]}),bordered:!1,children:null!=a&&a.uid?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(gr,{copyable:!0,children:a.uid})}),(0,w.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:a.name}),(0,w.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,w.jsx)(be.Z,{color:"blue",children:yr[a.type]||a.type})}),(0,w.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(et.Z,{checked:!1!==a.enabled,onChange:X,loading:B,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,w.jsx)(gr,{type:!1!==a.enabled?"success":"danger",children:!1!==a.enabled?"已启用":"已禁用"})]})}),(0,w.jsx)(ke.Z.Item,{label:"AppID/企业ID",children:(0,w.jsx)(gr,{copyable:!0,children:a.appId})}),(0,w.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(gr,{copyable:!!f&&{text:a.appSecret||""},children:K(a.appSecret,f)}),(0,w.jsx)(Ze.Z,{title:f?"隐藏AppSecret":"显示AppSecret",children:(0,w.jsx)(ne.ZP,{type:"text",icon:f?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:N,size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"加密模式",children:(0,w.jsx)(be.Z,{color:wr[a.encryptMode]||"default",children:jr[a.encryptMode]||a.encryptMode})}),(0,w.jsx)(ke.Z.Item,{label:"URL",children:(0,w.jsx)(gr,{copyable:!0,children:(0,j.kG)()+"/wechat/"+(null==a||null===(n=a.type)||void 0===n?void 0:n.toLowerCase())+"/hook/"+a.uid})}),(0,w.jsx)(ke.Z.Item,{label:"Token",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(gr,{copyable:!!x&&{text:a.token||""},children:K(a.token,x)}),(0,w.jsx)(Ze.Z,{title:x?"隐藏Token":"显示Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:x?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:O,size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"EncodingAESKey",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(gr,{copyable:!!Z&&{text:a.encodingAesKey||""},children:K(a.encodingAesKey,Z)}),(0,w.jsx)(Ze.Z,{title:Z?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,w.jsx)(ne.ZP,{type:"text",icon:Z?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:_,size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(gr,{copyable:!!c&&{text:a.accessToken||""},children:K(a.accessToken,c)}),(0,w.jsx)(Ze.Z,{title:c?"隐藏Token":"显示Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:c?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:V,size:"small"})}),(0,w.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,w.jsx)(ne.ZP,{type:"primary",icon:(0,w.jsx)(Pe.Z,{}),onClick:G,size:"small",loading:T,children:"刷新Token"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Token过期时间",children:a.accessTokenExpiresAt?Le()(a.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),a.description&&(0,w.jsx)(ke.Z.Item,{label:t.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,w.jsx)(xr,{children:a.description})}),(0,w.jsx)(ke.Z.Item,{label:t.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:a.createdAt?Le()(a.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(xr,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的WhatsApp应用凭证，避免泄露"}),(0,w.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,w.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,w.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,w.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,w.jsx)(we.Z,{description:"请先在左侧列表选择一个WhatsApp应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},kr=function(e){console.log(e)},Zr=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,w.jsx)(br,{type:n})}],r=(0,v.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,v.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:kr})})},Mr=a.Z.Sider,Cr=a.Z.Content,Ar=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(Mr,{width:i,style:s,children:(0,w.jsx)(mr,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Cr,{children:(0,w.jsx)(Zr,{type:n})})})]})};function Ir(e){return Sr.apply(this,arguments)}function Sr(){return(Sr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Er(e){return Tr.apply(this,arguments)}function Tr(){return(Tr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rr(e){return Pr.apply(this,arguments)}function Pr(){return(Pr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Wr(e){return Lr.apply(this,arguments)}function Lr(){return(Lr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fr(e){return Dr.apply(this,arguments)}function Dr(){return(Dr=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qr=t(84176),zr=t.n(qr),Br=["token"],Ur="WEBHOOK",Vr="MESSENGER",Nr="INSTAGRAM",Or="WHATSAPP",_r=function(e){var n,t=e.isEdit,r=e.messenger,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=e.token,t=zr()(e,Br),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==h?void 0:h.uid});console.log("submit",r),u(r)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Vr,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.verifyToken,pageId:null==r?void 0:r.pageId,pageAccessToken:null==r?void 0:r.pageAccessToken,workgroupUid:null==r?void 0:r.workgroupUid,enabled:!1!==(null==r?void 0:r.enabled)});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Vr,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:n,enabled:!0})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"wechatWorkForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,w.jsx)(le.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:Ur},{label:"Messenger",value:Vr},{label:"Instagram",value:Nr},{label:"Whatsapp",value:Or}],fieldProps:{defaultValue:Ur},rules:[{required:!0}]}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"应用ID(App ID)",name:"appId",rules:[{required:!0}],extra:(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App ID获取说明"})})}}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"应用Secret(App Secret)",name:"appSecret",rules:[{required:!0}],extra:(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App Secret获取说明"})})}}),(0,w.jsx)(oe.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,w.jsx)(ie.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,w.jsx)(oe.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID",extra:(0,w.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-id",target:"_blank",rel:"noopener noreferrer",children:"查看Page ID获取说明"})})}}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(Hn.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,w.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Kr=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{messengerResult:{data:{content:[]}},currentMessenger:{uid:"",nickname:"",avatar:"",description:""},insertMessenger:function(n){e((function(e){e.messengerResult.data.content.unshift(n)}))},updateMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Messenger with uid ".concat(n.uid," not found."))}))},deleteMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Messenger with uid ".concat(n.uid," not found."))}))},setMessengerResult:function(t){var r;(e({messengerResult:t}),""===n().currentMessenger.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentMessenger:t.data.content[0]}))},setCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().messengerResult),{},{data:{content:s}});e({messengerResult:i,currentMessenger:t})}else console.warn("Messenger with the specified uid not found."),e({currentMessenger:t})},refreshCurrentMessenger:function(n){e((function(e){e.currentMessenger=c()(c()({},e.currentMessenger),n);var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({messengerResult:c()(c()({},n().messengerResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Messenger not found in cache:",t),n().currentMessenger.uid===t&&e({currentMessenger:{uid:""}})},deleteMessengerCache:function(){return e({},!0)}}})),{name:p.Gmi}))),Gr=R()(R()(R()(R()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Yr=function(e){var n=e.type,t=(0,M.useIntl)(),r=(0,v.useRef)(!1),a=(0,re.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,v.useState)(!1),u=i()(l,2),d=u[0],p=u[1],f=(0,v.useState)(!1),h=i()(f,2),m=h[0],g=h[1],y=(0,v.useState)(!1),j=i()(y,2),b=j[0],k=j[1],Z=(0,K.u)((function(e){return e.currentOrg})),C=(0,v.useState)(null),A=i()(C,2),S=A[0],T=A[1],R=Kr((function(e){return{messengerResult:e.messengerResult,currentMessenger:e.currentMessenger,setMessengerResult:e.setMessengerResult,insertMessenger:e.insertMessenger,setCurrentMessenger:e.setCurrentMessenger,deleteCurrentMessenger:e.deleteCurrentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),W=R.messengerResult,L=R.currentMessenger,F=R.setMessengerResult,D=R.insertMessenger,q=R.setCurrentMessenger,z=R.deleteCurrentMessenger,B=R.refreshCurrentMessenger,U=$.Z.useModal(),V=i()(U,2),N=V[0],O=V[1],_=function(){var e=E()(I()().mark((function e(n){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete messenger",n),P.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Fr(n);case 4:r=e.sent,console.log("delete messenger response",r),200===r.code?(P.yw.destroy(),P.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=E()(I()().mark((function e(){var t,a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,P.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==Z?void 0:Z.uid},e.next=8,Ir(t);case 8:a=e.sent,console.log("getMessengers response",a,t),200===a.code?(P.yw.destroy(),F(a)):(P.yw.destroy(),P.yw.error(a.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){ae();var e=function(e){g(!0),p(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var se=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,oe(n);case 6:e.next=10;break;case 8:return e.next=10,ie(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,Rr(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateMessenger response:",t),200===t.code?(D(t.data),q(t.data),p(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==L?void 0:L.uid,P.yw.loading("正在更新..."),e.next=4,Wr(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateMessenger response:",t),200===t.code?(q(t.data),p(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=E()(I()().mark((function e(n,t){var r,a,s;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(n.uid),e.prev=1,e.next=4,Wr({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateMessenger enabled response",r),200===r.code?(P.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=W&&null!==(a=W.data)&&void 0!==a&&a.content&&(s=W.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),F(c()(c()({},W),{},{data:c()(c()({},W.data),{},{content:s})}))),(null==L?void 0:L.uid)===n.uid&&B&&B(r.data)):P.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,T(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:ae,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==L?void 0:L.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==L.enabled?(0,w.jsx)(Kn.Z,{}):(0,w.jsx)(Gn.Z,{}),label:!1!==L.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return le(L,!1===L.enabled)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){N.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(L)}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:W.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:(null==L?void 0:L.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(",Gr[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]}),(0,w.jsx)(Yn.Z,{spinning:S===(null==e?void 0:e.uid),size:"small",children:(0,w.jsx)(be.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:a(null==e?void 0:e.description)})})}}),d&&(0,w.jsx)(_r,{isEdit:m,open:d,loading:b,messenger:L,onClose:function(){p(!1)},onSubmit:se}),O]})},Hr=ve.Z.Text,Jr=ve.Z.Paragraph,Xr=R()(R()(R()(R()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Qr=R()(R()(R()(R()({},p.Iap,(0,w.jsx)(Re.Z,{})),p.Ff2,(0,w.jsx)(Ce.Z,{})),p.cRk,(0,w.jsx)(Ae.Z,{})),p.SbP,(0,w.jsx)(Ie.Z,{})),$r="appSecret",ea="verifyToken",na="accessToken",ta="pageAccessToken",ra=function(){var e=(0,M.useIntl)(),n=Kr((function(e){return{currentMessenger:e.currentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),t=n.currentMessenger,r=n.refreshCurrentMessenger,a=(0,v.useState)(R()(R()(R()(R()({},$r,!1),ea,!1),na,!1),ta,!1)),s=i()(a,2),o=s[0],l=s[1],u=(0,v.useState)(!1),d=i()(u,2),p=(d[0],d[1],(0,v.useState)(!1)),f=i()(p,2),h=(f[0],f[1],(0,v.useState)(!1)),m=i()(h,2),g=m[0],x=m[1],y=(0,v.useState)(!1),b=i()(y,2),k=b[0],Z=b[1],C=function(e){l((function(n){return c()(c()({},n),{},R()({},e,!n[e]))}))},A=function(e,n){return e?n?e:"******":"-"},S=function(){var e=E()(I()().mark((function e(){var n,a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return P.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return x(!0),e.prev=4,e.next=7,Er({uid:t.uid});case 7:n=e.sent,console.log("queryMessengerByUid refresh detail",n),200===n.code?(a=n.data,P.yw.success("应用详情刷新成功"),r&&r(a)):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,x(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),T=function(){var e=E()(I()().mark((function e(n){var a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return P.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return Z(!0),e.prev=4,e.next=7,Wr({uid:t.uid,enabled:n});case 7:a=e.sent,console.log("updateMessenger enabled response",a),200===a.code?(P.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(a.data)):P.yw.error("操作失败: ".concat(a.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,Z(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return(0,w.jsx)(je.Z,{title:null!=t&&t.uid?(0,w.jsxs)(ue.Z,{children:[Qr[t.type]||(0,w.jsx)(Ce.Z,{}),(0,w.jsx)("span",{children:t.name||"Messenger应用详情"}),(0,w.jsx)(be.Z,{color:"blue",children:Xr[t.type]||t.type}),(0,w.jsx)(be.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"})]}):"Messenger应用详情",extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook","_blank")},type:"link",children:"文档"}),(null==t?void 0:t.uid)&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:S,loading:g,type:"primary",children:"刷新详情"})]})]}),bordered:!1,children:null!=t&&t.uid?(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(Hr,{copyable:!0,children:t.uid})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,w.jsx)(be.Z,{color:"blue",children:Xr[t.type]||t.type})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(et.Z,{checked:!1!==t.enabled,onChange:T,loading:k,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,w.jsx)(Hr,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,w.jsx)(ke.Z.Item,{label:"AppID",children:(0,w.jsx)(Hr,{copyable:!0,children:t.appId})}),(0,w.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Hr,{copyable:!!o[$r]&&{text:t.appSecret||""},children:A(t.appSecret,o[$r])}),(0,w.jsx)(Ze.Z,{title:o[$r]?"隐藏AppSecret":"显示AppSecret",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[$r]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return C($r)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Webhook URL",children:(0,w.jsx)(Hr,{copyable:!0,children:(0,j.kG)()+"/meta/webhooks/"+t.uid})}),(0,w.jsx)(ke.Z.Item,{label:"验证口令",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Hr,{copyable:!!o[ea]&&{text:t.verifyToken||""},children:A(t.verifyToken,o[ea])}),(0,w.jsx)(Ze.Z,{title:o[ea]?"隐藏Verify Token":"显示Verify Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[ea]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return C(ea)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Page Access Token",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Hr,{copyable:!!o[ta]&&{text:t.pageAccessToken||""},children:A(t.pageAccessToken,o[ta])}),(0,w.jsx)(Ze.Z,{title:o[ta]?"隐藏Page Access Token":"显示Page Access Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[ta]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return C(ta)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Page ID",children:(0,w.jsx)(Hr,{copyable:!0,children:t.pageId||"-"})}),t.description&&(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,w.jsx)(Jr,{children:t.description})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Le()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(Jr,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的Messenger应用凭证，避免泄露"}),(0,w.jsx)("li",{children:"请妥善保存 验证口令 和 AppSecret，这些信息不应公开"}),(0,w.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,w.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,w.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,w.jsx)(we.Z,{description:"请先在左侧列表选择一个Messenger应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},aa=function(e){console.log(e)},sa=[{key:"detail",label:"应用详情",children:(0,w.jsx)(ra,{})}],ia=function(e){e.type;var n=(0,v.useState)(sa),t=i()(n,2),r=t[0],a=t[1];return(0,v.useEffect)((function(){var e=[].concat(sa);a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:aa})})},oa=a.Z.Sider,la=a.Z.Content,ca=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(oa,{width:i,style:s,children:(0,w.jsx)(Yr,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(la,{children:(0,w.jsx)(ia,{type:n})})})]})};function ua(e){return da.apply(this,arguments)}function da(){return(da=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function pa(e){return fa.apply(this,arguments)}function fa(){return(fa=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ha(e){return ma.apply(this,arguments)}function ma(){return(ma=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ga(e){return xa.apply(this,arguments)}function xa(){return(xa=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ya(e){return va.apply(this,arguments)}function va(){return(va=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ja(e){return wa.apply(this,arguments)}function wa(){return(wa=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var ba=["token"],ka="WEBHOOK",Za="MESSENGER",Ma="INSTAGRAM",Ca="WHATSAPP",Aa=function(e){var n,t=e.isEdit,r=e.instagram,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=ie.A.useForm(),p=i()(d,1)[0],f=(0,re.Z)().translateStringTranct,h=(0,K.u)((function(e){return e.currentOrg})),m=(0,v.useState)(!1),g=i()(m,2),x=g[0],y=g[1],j=(0,se.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),b=j.workgroupResult,k=j.setWorkgroupResult,Z=function(){console.log("handleSubmit"),y(!0),p.validateFields().then((function(e){var n=e.token,t=zr()(e,ba),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==h?void 0:h.uid});console.log("submit",r),u(r)})).catch((function(){y(!1)}))};(0,v.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Ma,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.verifyToken,pageId:null==r?void 0:r.pageId,pageAccessToken:null==r?void 0:r.pageAccessToken,workgroupUid:null==r?void 0:r.workgroupUid,enabled:!1!==(null==r?void 0:r.enabled)});else{var e,n=(null==b||null===(e=b.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?b.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Ma,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:n,enabled:!0})}}),[t,r,p,b]);var M=function(){var e=E()(I()().mark((function e(){var n,t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,ae.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(P.yw.destroy(),k(t)):(P.yw.destroy(),P.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){M()}),[]);return(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(ce.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{onClick:l,children:"取消"}),(0,w.jsx)(ne.ZP,{type:"primary",onClick:Z,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,w.jsxs)(ie.A,{form:p,name:"wechatWorkForm",onFinish:Z,submitter:!1,children:[(0,w.jsx)(oe.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,w.jsx)(le.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:ka},{label:"Messenger",value:Za},{label:"Instagram",value:Ma},{label:"Whatsapp",value:Ca}],fieldProps:{defaultValue:ka},rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,w.jsx)(ne.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),P.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,w.jsx)(oe.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,w.jsx)(oe.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID"}),(0,w.jsx)(le.Z,{label:"客服技能组",name:"workgroupUid",options:null==b||null===(n=b.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,w.jsx)(Hn.Z,{label:"启用应用",name:"enabled",fieldProps:{checkedChildren:"启用",unCheckedChildren:"禁用"},extra:"控制应用是否启用，禁用后应用将无法接收和处理消息"}),(0,w.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Ia=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{instagramResult:{data:{content:[]}},currentInstagram:{uid:"",nickname:"",avatar:"",description:""},insertInstagram:function(n){e((function(e){e.instagramResult.data.content.unshift(n)}))},updateInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Instagram with uid ".concat(n.uid," not found."))}))},deleteInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Instagram with uid ".concat(n.uid," not found."))}))},setInstagramResult:function(t){var r;(e({instagramResult:t}),""===n().currentInstagram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentInstagram:t.data.content[0]}))},setCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().instagramResult),{},{data:{content:s}});e({instagramResult:i,currentInstagram:t})}else console.warn("Instagram with the specified uid not found."),e({currentInstagram:t})},refreshCurrentInstagram:function(n){e((function(e){e.currentInstagram=c()(c()({},e.currentInstagram),n);var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({instagramResult:c()(c()({},n().instagramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Instagram not found in cache:",t),n().currentInstagram.uid===t&&e({currentInstagram:{uid:""}})},deleteInstagramCache:function(){return e({},!0)}}})),{name:p.S6e}))),Sa=R()(R()(R()(R()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Ea=function(e){var n=e.type,t=(0,M.useIntl)(),r=(0,v.useRef)(!1),a=(0,re.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,v.useState)(!1),u=i()(l,2),d=u[0],p=u[1],f=(0,v.useState)(!1),h=i()(f,2),m=h[0],g=h[1],y=(0,v.useState)(!1),j=i()(y,2),b=j[0],k=j[1],Z=(0,K.u)((function(e){return e.currentOrg})),C=(0,v.useState)(null),A=i()(C,2),S=A[0],T=A[1],R=Ia((function(e){return{instagramResult:e.instagramResult,currentInstagram:e.currentInstagram,setInstagramResult:e.setInstagramResult,insertInstagram:e.insertInstagram,setCurrentInstagram:e.setCurrentInstagram,deleteCurrentInstagram:e.deleteCurrentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),W=R.instagramResult,L=R.currentInstagram,F=R.setInstagramResult,D=R.insertInstagram,q=R.setCurrentInstagram,z=R.deleteCurrentInstagram,B=R.refreshCurrentInstagram,U=$.Z.useModal(),V=i()(U,2),N=V[0],O=V[1],_=function(){var e=E()(I()().mark((function e(n){var r;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete instagram",n),P.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,ya(n);case 4:r=e.sent,console.log("delete instagram response",r),200===r.code?(P.yw.destroy(),P.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),z(n.uid)):(P.yw.destroy(),P.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=E()(I()().mark((function e(){var t,a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,P.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==Z?void 0:Z.uid},e.next=8,ua(t);case 8:a=e.sent,console.log("getInstagram response",a,t),200===a.code?(P.yw.destroy(),F(a)):(P.yw.destroy(),P.yw.error(a.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){ae();var e=function(e){g(!0),p(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var se=function(){var e=E()(I()().mark((function e(n){return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!m){e.next=8;break}return e.next=6,oe(n);case 6:e.next=10;break;case 8:return e.next=10,ie(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),ie=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return P.yw.loading("正在创建..."),e.next=3,ha(n);case 3:t=e.sent,P.yw.destroy(),console.log("handleCreateInstagram response:",t),200===t.code?(D(t.data),q(t.data),p(!1),P.yw.success("创建成功")):P.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),oe=function(){var e=E()(I()().mark((function e(n){var t;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==L?void 0:L.uid,P.yw.loading("正在更新..."),e.next=4,ga(n);case 4:t=e.sent,P.yw.destroy(),console.log("handleUpdateInstagram response:",t),200===t.code?(q(t.data),p(!1),P.yw.success("更新成功")):P.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),le=function(){var e=E()(I()().mark((function e(n,t){var r,a,s;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T(n.uid),e.prev=1,e.next=4,ga({uid:n.uid,enabled:t});case 4:r=e.sent,console.log("updateInstagram enabled response",r),200===r.code?(P.yw.success("应用【".concat(n.name,"】已").concat(t?"启用":"禁用")),null!=W&&null!==(a=W.data)&&void 0!==a&&a.content&&(s=W.data.content.map((function(e){return e.uid===n.uid?c()(c()({},e),{},{enabled:t}):e})),F(c()(c()({},W),{},{data:c()(c()({},W.data),{},{content:s})}))),(null==L?void 0:L.uid)===n.uid&&B&&B(r.data)):P.yw.error("操作失败: ".concat(r.message||"未知错误")),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(1),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 12:return e.prev=12,T(null),e.finish(12);case 15:case"end":return e.stop()}}),e,null,[[1,9,12,15]])})));return function(n,t){return e.apply(this,arguments)}}();return(0,w.jsxs)(w.Fragment,{children:[(0,w.jsxs)(ee.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,w.jsxs)(ee.Z,{gap:"small",children:[(0,w.jsx)(ne.ZP,{type:"primary",size:"small",icon:(0,w.jsx)(Y.Z,{}),onClick:function(){p(!0),g(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(H.Z,{}),onClick:ae,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==L?void 0:L.uid)&&(0,w.jsx)(te.Z,{menu:{items:[{key:"edit",icon:(0,w.jsx)(J.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){g(!0),p(!0)}},{key:"toggle_enabled",icon:!1!==L.enabled?(0,w.jsx)(Kn.Z,{}):(0,w.jsx)(Gn.Z,{}),label:!1!==L.enabled?t.formatMessage({id:"app.disable",defaultMessage:"禁用"}):t.formatMessage({id:"app.enable",defaultMessage:"启用"}),onClick:function(){return le(L,!1===L.enabled)}},{key:"delete",icon:(0,w.jsx)(X.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){N.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,w.jsx)(G.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){_(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(L)}}]},children:(0,w.jsx)(ne.ZP,{size:"small",icon:(0,w.jsx)(Q.Z,{})})})]}),(0,w.jsx)(x.Z,{itemLayout:"horizontal",dataSource:W.data.content,renderItem:function(e,n){return(0,w.jsx)(x.Z.Item,{style:(null==L?void 0:L.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},children:(0,w.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)("span",{children:a(null==e?void 0:e.name)}),(0,w.jsxs)("span",{style:{color:"#1677ff"},children:["(",Sa[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]}),(0,w.jsx)(Yn.Z,{spinning:S===(null==e?void 0:e.uid),size:"small",children:(0,w.jsx)(be.Z,{color:!1!==(null==e?void 0:e.enabled)?"success":"default",icon:!1!==(null==e?void 0:e.enabled)?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==(null==e?void 0:e.enabled)?"已启用":"已禁用"})})]}),description:a(null==e?void 0:e.description)})})}}),d&&(0,w.jsx)(Aa,{isEdit:m,open:d,loading:b,instagram:L,onClose:function(){p(!1)},onSubmit:se}),O]})},Ta=ve.Z.Text,Ra=ve.Z.Paragraph,Pa=R()(R()(R()(R()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Wa=R()(R()(R()(R()({},p.Iap,(0,w.jsx)(Re.Z,{})),p.Ff2,(0,w.jsx)(Ce.Z,{})),p.cRk,(0,w.jsx)(Ae.Z,{})),p.SbP,(0,w.jsx)(Ie.Z,{})),La="appSecret",Fa="verifyToken",Da="accessToken",qa="pageAccessToken",za=function(){var e=(0,M.useIntl)(),n=Ia((function(e){return{currentInstagram:e.currentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),t=n.currentInstagram,r=n.refreshCurrentInstagram,a=(0,v.useState)(R()(R()(R()(R()({},La,!1),Fa,!1),Da,!1),qa,!1)),s=i()(a,2),o=s[0],l=s[1],u=(0,v.useState)(!1),d=i()(u,2),p=(d[0],d[1],(0,v.useState)(!1)),f=i()(p,2),h=f[0],m=f[1],g=(0,v.useState)(!1),x=i()(g,2),y=x[0],b=x[1],k=(0,v.useState)(!1),Z=i()(k,2),C=Z[0],A=Z[1],S=function(e){l((function(n){return c()(c()({},n),{},R()({},e,!n[e]))}))},T=function(e,n){return e?n?e:"******":"-"},W=function(){var e=E()(I()().mark((function e(){var n;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return P.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return m(!0),e.prev=4,e.next=7,ja({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenInstagram response",n),200===n.code?(P.yw.success("AccessToken 刷新成功"),r&&r(n.data),L()):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,m(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),L=function(){var e=E()(I()().mark((function e(){var n,a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return P.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return b(!0),e.prev=4,e.next=7,pa({uid:t.uid});case 7:n=e.sent,console.log("queryInstagramByUid refresh detail",n),200===n.code?(a=n.data,P.yw.success("应用详情刷新成功"),r&&r(a)):P.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,b(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),F=function(){var e=E()(I()().mark((function e(n){var a;return I()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return P.yw.error("无法切换状态，应用信息不完整"),e.abrupt("return");case 3:return A(!0),e.prev=4,e.next=7,ga({uid:t.uid,enabled:n});case 7:a=e.sent,console.log("updateInstagram enabled response",a),200===a.code?(P.yw.success("应用已".concat(n?"启用":"禁用")),r&&r(a.data)):P.yw.error("操作失败: ".concat(a.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),P.yw.error("操作出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,A(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(n){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,w.jsxs)(je.Z,{title:(0,w.jsxs)(ue.Z,{children:[Wa[t.type]||(0,w.jsx)(Ce.Z,{}),(0,w.jsx)("span",{children:t.name||"Instagram应用详情"}),(0,w.jsx)(be.Z,{color:"blue",children:Pa[t.type]||t.type}),(0,w.jsx)(be.Z,{color:!1!==t.enabled?"success":"default",icon:!1!==t.enabled?(0,w.jsx)(Gn.Z,{}):(0,w.jsx)(Kn.Z,{}),children:!1!==t.enabled?"已启用":"已禁用"})]}),extra:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(J.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(H.Z,{}),onClick:L,loading:y,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,w.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,w.jsx)(Ta,{copyable:!0,children:t.uid})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,w.jsx)(be.Z,{color:"blue",children:Pa[t.type]||t.type})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.enabled",defaultMessage:"启用状态"}),children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(et.Z,{checked:!1!==t.enabled,onChange:F,loading:C,checkedChildren:"启用",unCheckedChildren:"禁用"}),(0,w.jsx)(Ta,{type:!1!==t.enabled?"success":"danger",children:!1!==t.enabled?"已启用":"已禁用"})]})}),(0,w.jsx)(ke.Z.Item,{label:"AppID",children:(0,w.jsx)(Ta,{copyable:!0,children:t.appId})}),(0,w.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Ta,{copyable:!!o[La]&&{text:t.appSecret||""},children:T(t.appSecret,o[La])}),(0,w.jsx)(Ze.Z,{title:o[La]?"隐藏AppSecret":"显示AppSecret",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[La]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return S(La)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"回调网址",children:(0,w.jsx)(Ta,{copyable:!0,children:(0,j.kG)()+"/meta/webhooks/"+t.uid})}),(0,w.jsx)(ke.Z.Item,{label:"验证口令",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Ta,{copyable:!!o[Fa]&&{text:t.verifyToken||""},children:T(t.verifyToken,o[Fa])}),(0,w.jsx)(Ze.Z,{title:o[Fa]?"隐藏Verify Token":"显示Verify Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[Fa]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return S(Fa)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Page Access Token",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Ta,{copyable:!!o[qa]&&{text:t.pageAccessToken||""},children:T(t.pageAccessToken,o[qa])}),(0,w.jsx)(Ze.Z,{title:o[qa]?"隐藏Page Access Token":"显示Page Access Token",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[qa]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return S(qa)},size:"small"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Page ID",children:(0,w.jsx)(Ta,{copyable:!0,children:t.pageId||"-"})}),(0,w.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,w.jsxs)(ue.Z,{children:[(0,w.jsx)(Ta,{copyable:!!o[Da]&&{text:t.accessToken||""},children:T(t.accessToken,o[Da])}),(0,w.jsx)(Ze.Z,{title:o[Da]?"隐藏AccessToken":"显示AccessToken",children:(0,w.jsx)(ne.ZP,{type:"text",icon:o[Da]?(0,w.jsx)(Te.Z,{}):(0,w.jsx)(Re.Z,{}),onClick:function(){return S(Da)},size:"small"})}),(0,w.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,w.jsx)(ne.ZP,{type:"primary",icon:(0,w.jsx)(Pe.Z,{}),onClick:W,size:"small",loading:h,children:"刷新Token"})})]})}),(0,w.jsx)(ke.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?Le()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,w.jsx)(Ra,{children:t.description})}),(0,w.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?Le()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,w.jsx)(Me.Z,{}),(0,w.jsx)(ve.Z.Title,{level:5,children:"安全说明"}),(0,w.jsx)(Ra,{children:(0,w.jsxs)("ul",{children:[(0,w.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,w.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,w.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,w.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"}),(0,w.jsx)("li",{children:"应用启用状态控制着是否接收和处理消息，禁用后应用将暂停工作"}),(0,w.jsx)("li",{children:"建议在维护或调试时临时禁用应用，避免接收不必要的消息"})]})})]}):(0,w.jsx)(je.Z,{bordered:!1,title:"Instagram应用详情",extra:(0,w.jsx)(ne.ZP,{icon:(0,w.jsx)(Ee.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),children:(0,w.jsx)(we.Z,{description:"请先在左侧列表选择一个Instagram应用",image:we.Z.PRESENTED_IMAGE_SIMPLE})})},Ba=function(e){console.log(e)},Ua=[{key:"detail",label:"应用详情",children:(0,w.jsx)(za,{})}],Va=function(e){e.type;var n=(0,v.useState)(Ua),t=i()(n,2),r=t[0],a=t[1];return(0,v.useEffect)((function(){var e=[].concat(Ua);a(e)}),[]),(0,w.jsx)(w.Fragment,{children:(0,w.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:Ba})})},Na=a.Z.Sider,Oa=a.Z.Content,_a=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(Na,{width:i,style:s,children:(0,w.jsx)(Ea,{type:n})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Oa,{children:(0,w.jsx)(Va,{type:n})})})]})},Ka=function(e){var n=e.channel,t="web"===(null==n?void 0:n.name)||"npm"===(null==n?void 0:n.name);return(0,w.jsxs)("div",{children:[t&&(0,w.jsx)(rn,{channel:n}),"app"===(null==n?void 0:n.name)&&(0,w.jsx)(Dn,{type:null==n?void 0:n.name}),"wechat"===(null==n?void 0:n.name)&&(0,w.jsx)(Ye,{type:null==n?void 0:n.name}),"messenger"===(null==n?void 0:n.name)&&(0,w.jsx)(ca,{type:p.Ff2}),"instagram"===(null==n?void 0:n.name)&&(0,w.jsx)(_a,{type:p.cRk}),"whatsapp"===(null==n?void 0:n.name)&&(0,w.jsx)(Ar,{type:p.SbP}),"telegram"===(null==n?void 0:n.name)&&(0,w.jsx)(Tt,{type:null==n?void 0:n.name}),"line"===(null==n?void 0:n.name)&&(0,w.jsx)(Jt,{type:null==n?void 0:n.name}),"email"===(null==n?void 0:n.name)&&(0,w.jsx)(ut,{type:null==n?void 0:n.name}),"douyin"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"baidu"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"weibo"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"pdd"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"jd"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"qianniu"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"doudian"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"telegram"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"facebook"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"line"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"shopify"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"lazada"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"wordpress"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"opencart"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"magento"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"prestashop"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"dify"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{}),"coze"===(null==n?void 0:n.name)&&(0,w.jsx)(C,{})]})},Ga=function(){var e=(0,v.useState)(""),n=i()(e,2),t=n[0],r=n[1],a=(0,v.useState)([]),s=i()(a,2),o=s[0],l=s[1],c=g().currentChannel;(0,v.useEffect)((function(){c&&u(c)}),[c]);var u=function(e){var n=e.name;-1===o.findIndex((function(e){return e.key===n}))&&l([].concat(d()(o),[{label:e.nickname,key:n,children:(0,w.jsx)(Ka,{channel:e}),channelInfo:e,closable:!0}])),r(n)};return(0,w.jsx)(Z.Z,{hideAdd:!0,onChange:function(e){r(e)},activeKey:t,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=o.findIndex((function(n){return n.key===e})),a=o.filter((function(n){return n.key!==e}));if(a.length&&e===t){var s=a[n===a.length?n-1:n].key;r(s)}l(a)}(e)},items:o})},Ya=a.Z.Sider,Ha=a.Z.Content,Ja=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,w.jsx)(w.Fragment,{children:(0,w.jsxs)(a.Z,{children:[(0,w.jsx)(Ya,{style:n,children:(0,w.jsx)(k,{})}),(0,w.jsx)(a.Z,{children:(0,w.jsx)(Ha,{style:t,children:(0,w.jsx)(Ga,{})})})]})})}}}]);