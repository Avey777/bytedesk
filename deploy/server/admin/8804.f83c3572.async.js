"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8804],{20252:function(e,n,r){r.d(n,{Jr:function(){return m},LF:function(){return d},Oh:function(){return y},WS:function(){return h}});var t=r(90819),a=r.n(t),i=r(73193),o=r.n(i),s=r(89933),u=r.n(s),l=r(2622),c=r(59318);function d(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return x.apply(this,arguments)}function x(){return(x=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},44631:function(e,n,r){r.d(n,{G9:function(){return b},J$:function(){return j},N6:function(){return g},VM:function(){return l},c8:function(){return d},gF:function(){return h},rg:function(){return m},sF:function(){return y}});var t=r(90819),a=r.n(t),i=r(89933),o=r.n(i),s=r(2622),u=r(59318);function l(){return c.apply(this,arguments)}function c(){return(c=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/ping",{method:"GET",params:{channel:s.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function d(){return p.apply(this,arguments)}function p(){return(p=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/local-models",{method:"GET",params:{channel:s.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(){return f.apply(this,arguments)}function f(){return(f=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models",{method:"GET",params:{channel:s.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return v.apply(this,arguments)}function v(){return(v=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/library/models/"+n+"/details",{method:"GET",params:{channel:s.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return x.apply(this,arguments)}function x(){return(x=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models/"+n+"/details",{method:"GET",params:{channel:s.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return w.apply(this,arguments)}function w(){return(w=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models/pull",{method:"POST",params:{channel:s.XtJ},data:{model:n}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return k.apply(this,arguments)}function k(){return(k=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models/delete",{method:"POST",params:{channel:s.XtJ},data:{model:n}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return C.apply(this,arguments)}function C(){return(C=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/embedding-model/exists",{method:"GET",params:{channel:s.XtJ,model:n}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},38804:function(e,n,r){var t=r(10154),a=r.n(t),i=r(73193),o=r.n(i),s=r(90819),u=r.n(s),l=r(89933),c=r.n(l),d=r(45332),p=r.n(d),m=r(78929),f=r(20252),h=r(44631),v=r(67794),y=r(2622),x=r(58889),g=r(62821),w=r(55599),b=r(27431),k=r(12722),j=r(18613),C=r(20374),M=r(43807),T=r(59318),S=r(44194),q=r(31549),L=g.Z.Text,J=S.memo((function(e){var n,r=e.visible,t=e.onCancel,i=e.onOk,s=e.initialProvider,l=e.initialModel,d=e.initialModelLabel,J=e.providers,Z=e.currentOrgUid,P=e.existingProviderModels,O=void 0===P?{}:P,X=e.onModelsLoaded,N=e.allowedModelTypes,E=void 0===N?[]:N,F=(0,T.useIntl)(),G=(0,v.Z)().translateString,I=(0,S.useState)(s||""),R=p()(I,2),z=R[0],U=R[1],A=(0,S.useState)(O),B=p()(A,2),H=B[0],V=B[1],D=(0,S.useState)(s||""),K=p()(D,2),Q=K[0],W=K[1],$=(0,S.useState)(l||""),Y=p()($,2),_=Y[0],ee=Y[1],ne=(0,S.useState)(d||""),re=p()(ne,2),te=re[0],ae=re[1],ie=(0,S.useState)(!1),oe=p()(ie,2),se=oe[0],ue=oe[1];(0,S.useEffect)((function(){W(s),ee(l),ae(d),U(s)}),[s,l,d,r]),(0,S.useEffect)((function(){if(r&&z&&!H[z]&&!se){ue(!0),m.yw.loading({content:F.formatMessage({id:"loading"}),key:"modelLoading"});var e=J.find((function(e){return e.name===z}));e&&("ollama"===e.name?me():he(e))}}),[r,z,J]);var le=(0,S.useCallback)((function(){Q&&_&&i(Q,_,te)}),[Q,_,te,i]),ce=(0,S.useCallback)((function(){t(),T.history.push("/ai/model")}),[t]),de=(0,S.useCallback)((function(e){return["bge","embed","m3e","vector","nomic","e5","gte","instructor","sentence-transformers","text-embedding","all-mpnet","multi-qa","paraphrase","sbert","clip","jina","onnx"].some((function(n){return e.toLowerCase().includes(n.toLowerCase())}))}),[]),pe=(0,S.useCallback)((function(e){return e?e.filter((function(e){return!de(e.value)&&(!E||0===E.length||(!e.type||E.includes(e.type)))})):[]}),[E,de]),me=function(){var e=c()(u()().mark((function e(){var n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.VM)();case 3:200===(n=e.sent).code&&n.data?fe():(m.yw.error(n.message),m.yw.destroy("modelLoading"),ue(!1)),e.next=13;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to check Ollama status:",e.t0),m.yw.error(F.formatMessage({id:"error"})),m.yw.destroy("modelLoading"),ue(!1);case 13:case"end":return e.stop()}}),e,null,[[0,7]])})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=c()(u()().mark((function e(){var n,r,t;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,(0,h.c8)();case 3:200===(n=e.sent).code?(r=n.data.map((function(e){return{value:e.name,label:e.name,providerName:"ollama"}})),t=pe(r),V((function(e){return o()(o()({},e),{},{ollama:t})})),X&&X("ollama",t)):m.yw.error(n.message),e.next=11;break;case 7:e.prev=7,e.t0=e.catch(0),console.error("Failed to fetch local models:",e.t0),m.yw.error(F.formatMessage({id:"error"}));case 11:return e.prev=11,m.yw.destroy("modelLoading"),ue(!1),e.finish(11);case 15:case"end":return e.stop()}}),e,null,[[0,7,11,15]])})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=c()(u()().mark((function e(n){var r,t,i,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,r={pageNumber:0,pageSize:50,providerUid:null==n?void 0:n.uid,orgUid:Z,level:y.whQ},e.next=4,(0,f.LF)(r);case 4:t=e.sent,console.log("queryLlmModelsByOrg:",t.data,r),200===t.code?(i=t.data.content.map((function(e){return{value:e.name,label:e.nickname,description:e.description,type:e.type,providerName:n.name}})),s=pe(i),V((function(e){return o()(o()({},e),{},a()({},n.name,s))})),X&&X(n.name,s)):m.yw.error(t.message),e.next=13;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch models:",e.t0),m.yw.error(F.formatMessage({id:"error"}));case 13:return e.prev=13,m.yw.destroy("modelLoading"),ue(!1),e.finish(13);case 17:case"end":return e.stop()}}),e,null,[[0,9,13,17]])})));return function(n){return e.apply(this,arguments)}}(),ve=(0,S.useCallback)((function(e,n){W(e),ee(n.value),ae(n.label)}),[]),ye=(0,S.useCallback)((function(e){if(U(e),!H[e]&&!se){ue(!0),m.yw.loading({content:F.formatMessage({id:"loading"}),key:"modelLoading"});var n=J.find((function(n){return n.name===e}));n&&("ollama"===n.name?me():he(n))}}),[J,H,se]),xe=S.memo((function(e){var n=e.model,r=e.providerName;return(0,q.jsxs)(w.Z,{hoverable:!0,style:{cursor:"pointer",border:_===n.value&&Q===r?"2px solid #1890ff":"1px solid #e8e8e8"},onClick:function(){return ve(r,n)},children:[(0,q.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start"},children:[(0,q.jsx)(g.Z.Title,{level:5,style:{margin:0},children:n.label}),(0,q.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"flex-end"},children:[n.type&&(0,q.jsx)("div",{style:{marginBottom:8},children:(0,x.Rb)(n.type)}),_===n.value&&Q===r&&(0,q.jsx)(b.Z,{status:"processing",text:"已选"})]})]}),n.description&&(0,q.jsxs)(q.Fragment,{children:[(0,q.jsx)(g.Z.Text,{type:"secondary",children:null==n?void 0:n.value}),(0,q.jsx)(g.Z.Paragraph,{ellipsis:{rows:2},type:"secondary",style:{marginTop:8},children:n.description})]})]},n.value)}),(function(e,n){return e.model.value===n.model.value&&e.providerName===n.providerName&&(_===e.model.value&&Q===e.providerName)===(_===n.model.value&&Q===n.providerName)})),ge=(0,S.useMemo)((function(){return J.map((function(e){var n,r;return{key:e.name,label:G(e.nickname),children:(0,q.jsx)("div",{style:{minHeight:"400px",width:"100%"},children:(0,q.jsxs)(k.Z,{direction:"vertical",style:{width:"100%"},children:[se&&z===e.name&&!H[e.name]?(0,q.jsx)("div",{style:{textAlign:"center",padding:"20px"},children:(0,q.jsx)(L,{type:"secondary",children:"加载模型中..."})}):(!H[e.name]||0===(null===(n=H[e.name])||void 0===n?void 0:n.length))&&(0,q.jsx)(L,{type:"secondary",children:"暂无可用模型"}),(0,q.jsx)("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fill, minmax(200px, 1fr))",gap:"16px"},children:null===(r=H[e.name])||void 0===r?void 0:r.map((function(n){return(0,q.jsx)(xe,{model:n,providerName:e.name},n.value)}))})]})})}}))}),[J,H,z,se,_,Q,G]);return(0,q.jsx)(j.Z,{title:"选择AI模型",open:r,onClose:t,width:700,destroyOnClose:!1,footer:(0,q.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:[(0,q.jsxs)("div",{style:{display:"flex",alignItems:"center",padding:"8px 12px",backgroundColor:"#f6f8fa",borderRadius:"6px",border:"1px solid #e1e4e8"},children:[(0,q.jsx)(L,{type:"secondary",style:{fontSize:"14px",marginRight:"8px"},children:"找不到想要的模型？"}),(0,q.jsx)(C.ZP,{type:"link",onClick:ce,style:{padding:0,height:"auto",fontSize:"14px"},children:"点击这里添加新模型 →"})]}),(0,q.jsxs)("div",{children:[(0,q.jsx)(C.ZP,{onClick:t,style:{marginRight:8},children:"取消"}),(0,q.jsx)(C.ZP,{onClick:le,type:"primary",children:"确定"})]})]}),children:J.length>0&&(0,q.jsx)(M.Z,{activeKey:z||(null===(n=J[0])||void 0===n?void 0:n.name),onChange:ye,items:ge,destroyOnHidden:!1})})}),(function(e,n){return e.visible===n.visible&&e.initialProvider===n.initialProvider&&e.initialModel===n.initialModel&&e.initialModelLabel===n.initialModelLabel}));n.Z=J}}]);