"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1894],{2484:function(e,n,t){t.d(n,{Z:function(){return u}});var r=t(77260),a=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},o=t(54183),i=function(e,n){return a.createElement(o.Z,(0,r.Z)({},e,{ref:n,icon:s}))};var u=a.forwardRef(i)},90486:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return v},t5:function(){return m},v_:function(){return b}});var r=t(90819),a=t.n(r),s=t(73193),o=t.n(s),i=t(89933),u=t.n(i),l=t(5488),c=t(14870);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return p.apply(this,arguments)}function p(){return(p=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return g.apply(this,arguments)}function g(){return(g=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:o()(o()({},n),{},{channel:l.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},74424:function(e,n,t){var r=t(24522);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},82568:function(e,n,t){t.d(n,{Z:function(){return A}});var r=t(90819),a=t.n(r),s=t(89933),o=t.n(s),i=t(45332),u=t.n(i),l=t(68349),c=t(90317),d=t(5780),f=t(78359),b=t(96501),p=t(44194),m=t(10154),g=t.n(m),v=t(73193),h=t.n(v),k=t(5025),y=t(18751),x=t(34599),w=t(5488),K=t(32394),Z=t(47783),M=t(48821),j=t(16331),C=t(21463),S=(t(91221),t(31549)),P=function(e){var n=e.open,t=e.isEdit,r=e.type,s=e.kbase,i=e.onCancel,c=e.onSubmit,d=K.A.useForm(),f=u()(d,1)[0],b=(0,y.Z)().translateString,m=(0,x.u)((function(e){return e.currentOrg})),v=(0,p.useRef)(null),P=(0,p.useState)([]),F=u()(P,2),R=F[0],T=(F[1],(0,p.useState)({})),E=u()(T,2),H=E[0],V=E[1],q=(0,p.useState)(!1),L=u()(q,2),z=L[0],O=L[1],D="ollama",A="bge-m3:latest",I=(0,p.useState)((null==s?void 0:s.embeddingProvider)||D),U=u()(I,2),_=U[0],J=U[1],X=(0,p.useState)((null==s?void 0:s.embeddingModel)||A),N=u()(X,2),W=N[0],B=N[1],Q=(0,p.useState)(""),G=u()(Q,2),Y=G[0],$=G[1];(0,p.useEffect)((function(){t?(f.setFieldsValue({name:b(null==s?void 0:s.name)}),f.setFieldsValue({headline:b(null==s?void 0:s.headline)}),f.setFieldsValue({footerHtml:b(null==s?void 0:s.footerHtml)}),f.setFieldsValue({descriptionHtml:b(null==s?void 0:s.descriptionHtml)}),f.setFieldsValue({language:null==s?void 0:s.language}),f.setFieldsValue({subType:null==s?void 0:s.subType}),null!=s&&s.embeddingProvider&&(J(s.embeddingProvider),f.setFieldsValue({embeddingProvider:s.embeddingProvider})),null!=s&&s.embeddingModel&&(B(s.embeddingModel),f.setFieldsValue({embeddingModel:s.embeddingModel}))):(f.resetFields(),f.setFieldsValue({language:"ZH_CN"}),f.setFieldsValue({subType:"DEFAULT"}),f.setFieldsValue({embeddingProvider:D,embeddingModel:A})),n&&setTimeout((function(){var e;null===(e=v.current)||void 0===e||e.focus()}),100)}),[n,t,s]),(0,p.useEffect)((function(){if(_&&W&&H[_]){var e=H[_].find((function(e){return e.value===W}));e&&$(e.label)}}),[H,_,W]);var ee=(0,p.useCallback)((function(){O(!1)}),[]),ne=(0,p.useCallback)((function(e,n,t){J(e),B(n),$(t),f.setFieldValue("embeddingProvider",e),f.setFieldValue("embeddingModel",n),O(!1)}),[f]),te=(0,p.useCallback)((function(e,n){V((function(t){return h()(h()({},t),{},g()({},e,n))}))}),[]),re=function(){f.validateFields().then(function(){var e=o()(a()().mark((function e(n){var o;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("KbaseForm handleSubmit:",n),o={uid:t?null==s?void 0:s.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:r,subType:n.subType,language:n.language,embeddingProvider:n.embeddingProvider||D,embeddingModel:n.embeddingModel||A,orgUid:null==m?void 0:m.uid},c(o);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),k.yw.error("创建知识库失败")}))},ae=function(e){"Enter"===e.key&&re()};return(0,S.jsxs)("div",{children:[(0,S.jsx)(l.Z,{title:"新建知识库",open:n,forceRender:!0,onOk:re,onCancel:i,children:(0,S.jsxs)(K.A,{form:f,submitter:!1,children:[(0,S.jsx)(Z.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,S.jsx)(Z.Z,{label:"知识库子类型",name:"subType",rules:[{required:!0,message:"请选择知识库子类型!"}],options:[{label:"默认",value:w.cmo},{label:"Coze",value:w.hBf,disabled:!0},{label:"Dify",value:w.o7x,disabled:!0},{label:"Ragflow",value:w.zLP,disabled:!0},{label:"Maxkb",value:w.a6z,disabled:!0}],fieldProps:{placeholder:"请选择知识库子类型",allowClear:!0}}),(0,S.jsx)(M.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:ae,placeholder:"请输入名称",ref:v}}),r===w.VX&&(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(M.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:ae,placeholder:"请输入名称"}}),(0,S.jsx)(j.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,S.jsx)(j.Z,{label:"描述",name:"descriptionHtml"})]})}),r===w.QPQ&&(0,S.jsx)(C.Z,{visible:z,onCancel:ee,onOk:ne,initialProvider:_,initialModel:W,initialModelLabel:Y,providers:R,currentOrgUid:null==m?void 0:m.uid,existingProviderModels:H,onModelsLoaded:te,allowedModelTypes:[w.xTq]})]})},F=t(90486),R=t(68866),T=t(24522),E=t(14870),H=t(15722),V=t(82669),q=t(80556),L=t(59304),z=t(54881),O=t(2484),D=l.Z.confirm,A=function(e){var n=e.type,t=(0,E.useIntl)(),r=(0,p.useState)(!1),s=u()(r,2),i=s[0],l=s[1],m=(0,p.useRef)(!1),g=(0,p.useState)(!1),v=u()(g,2),h=v[0],K=v[1],Z=(0,T.Z)().isDarkMode,M=(0,y.Z)().translateString,j=(0,x.u)((function(e){return e.currentOrg})),C=(0,p.useState)(!0),A=u()(C,2),I=A[0],U=A[1],_=(0,R.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),J=_.kbaseResult,X=_.currentKbase,N=_.insertKbase,W=_.updateLocalKbase,B=_.setKbaseResult,Q=_.setCurrentKbase,G=_.removeKbase,Y=function(){var e=o()(a()().mark((function e(){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!m.current){e.next=3;break}return console.log("isLoading: 1",m.current),e.abrupt("return");case 3:return m.current=!0,l(!0),k.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==j?void 0:j.uid},e.next=9,(0,F.AP)(t);case 9:r=e.sent,console.log("queryKbasesByOrg: ",r),200===r.code?(k.yw.destroy(),B(r)):(k.yw.destroy(),k.yw.error(r.message)),m.current=!1,l(!1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,p.useEffect)((function(){console.log("useEffect"),Y()}),[]);var $=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",k.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,F.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(N(r.data),Q(r.data),k.yw.success({content:"创建成功！",key:t,duration:2}),K(!1)):(console.log("create kb failed",r),k.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ee=function(){var e=o()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",k.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,F.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(W(r.data),Q(r.data),k.yw.success({content:"更新成功！",key:t,duration:2}),K(!1)):(console.log("update kb failed",r),k.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ne=function(){var e=o()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",X),U(!0),K(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=o()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I?ee(n):$(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=o()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==J.data.content.length){e.next=4;break}return k.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,F._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(G(n.uid),Y()):(console.log("handleDeleteKbase: ",r),k.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(e){var t,r=function(e){return n!==w._FS?M(e.descriptionHtml):e.level===w.Hxq?"全平台客服可见":e.level===w.whQ?"本组织客服可见":e.level===w.fyH?"本客服可见":M(e.descriptionHtml)}(e),a=(t=e.subType)?{DEFAULT:"默认",COZE:"Coze",DIFY:"Dify",RAGFLOW:"Ragflow"}[t]||t:"";return a?"".concat(r," | 子类型: ").concat(a):r};return(0,S.jsxs)(S.Fragment,{children:[(0,S.jsxs)(c.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,S.jsxs)(c.Z,{gap:"small",children:[(0,S.jsx)(d.ZP,{type:"primary",size:"small",icon:(0,S.jsx)(V.Z,{}),onClick:function(){console.log("new kb"),U(!1),K(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,S.jsx)(d.ZP,{size:"small",icon:(0,S.jsx)(q.Z,{spin:i}),onClick:Y,loading:i,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==X?void 0:X.uid)&&(0,S.jsx)(f.Z,{menu:{items:[{key:"edit",icon:(0,S.jsx)(L.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ne},{key:"delete",icon:(0,S.jsx)(z.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){D({title:t.formatMessage({id:"deleteTip"}),icon:(0,S.jsx)(H.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(M(e.name),"】？"),onOk:function(){re(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(X)}}]},children:(0,S.jsx)(d.ZP,{size:"small",icon:(0,S.jsx)(O.Z,{})})})]}),(0,S.jsx)(b.Z,{itemLayout:"horizontal",dataSource:J.data.content,renderItem:function(e,n){return(0,S.jsx)(b.Z.Item,{style:X.uid===e.uid?{backgroundColor:Z?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){Q(e)},children:(0,S.jsx)(b.Z.Item.Meta,{style:{marginLeft:"10px"},title:M(e.name),description:ae(e)})})}}),h&&(0,S.jsx)(P,{open:h,isEdit:I,type:n,kbase:X,onSubmit:te,onCancel:function(){K(!1)}})]})}},68866:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),o=t.n(s),i=t(5488),u=t(16894),l=t(45034),c=t(47401),d=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var i=[].concat(o()(r.slice(0,s)),[t],o()(r.slice(s+1))),u=a()(a()({},n().kbaseResult),{},{data:{content:i}});e({kbaseResult:u,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(o()(r.slice(0,s)),o()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))}}]);