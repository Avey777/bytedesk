"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[2255],{93689:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M699 353h-46.9c-10.2 0-19.9 4.9-25.9 13.3L469 584.3l-71.2-98.8c-6-8.3-15.6-13.3-25.9-13.3H325c-6.5 0-10.3 7.4-6.5 12.7l124.6 172.8a31.8 31.8 0 0051.7 0l210.6-292c3.9-5.3.1-12.7-6.4-12.7z"}},{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}}]},name:"check-circle",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},58275:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},77274:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M811.4 418.7C765.6 297.9 648.9 212 512.2 212S258.8 297.8 213 418.6C127.3 441.1 64 519.1 64 612c0 110.5 89.5 200 199.9 200h496.2C870.5 812 960 722.5 960 612c0-92.7-63.1-170.7-148.6-193.3zm36.3 281a123.07 123.07 0 01-87.6 36.3H263.9c-33.1 0-64.2-12.9-87.6-36.3A123.3 123.3 0 01140 612c0-28 9.1-54.3 26.2-76.3a125.7 125.7 0 0166.1-43.7l37.9-9.9 13.9-36.6c8.6-22.8 20.6-44.1 35.7-63.4a245.6 245.6 0 0152.4-49.9c41.1-28.9 89.5-44.2 140-44.2s98.9 15.3 140 44.2c19.9 14 37.5 30.8 52.4 49.9 15.1 19.3 27.1 40.7 35.7 63.4l13.8 36.5 37.8 10c54.3 14.5 92.1 63.8 92.1 120 0 33.1-12.9 64.3-36.3 87.7z"}}]},name:"cloud",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},61353:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M573 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40zm-280 0c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}},{tag:"path",attrs:{d:"M894 345a343.92 343.92 0 00-189-130v.1c-17.1-19-36.4-36.5-58-52.1-163.7-119-393.5-82.7-513 81-96.3 133-92.2 311.9 6 439l.8 132.6c0 3.2.5 6.4 1.5 9.4a31.95 31.95 0 0040.1 20.9L309 806c33.5 11.9 68.1 18.7 102.5 20.6l-.5.4c89.1 64.9 205.9 84.4 313 49l127.1 41.4c3.2 1 6.5 1.6 9.9 1.6 17.7 0 32-14.3 32-32V753c88.1-119.6 90.4-284.9 1-408zM323 735l-12-5-99 31-1-104-8-9c-84.6-103.2-90.2-251.9-11-361 96.4-132.2 281.2-161.4 413-66 132.2 96.1 161.5 280.6 66 412-80.1 109.9-223.5 150.5-348 102zm505-17l-8 10 1 104-98-33-12 5c-56 20.8-115.7 22.5-171 7l-.2-.1A367.31 367.31 0 00729 676c76.4-105.3 88.8-237.6 44.4-350.4l.6.4c23 16.5 44.1 37.1 62 62 72.6 99.6 68.5 235.2-8 330z"}},{tag:"path",attrs:{d:"M433 421c-23.1 0-41 17.9-41 40s17.9 40 41 40c21.1 0 39-17.9 39-40s-17.9-40-39-40z"}}]},name:"comment",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},11090:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM770.87 199.13l-52.2-52.2a8.01 8.01 0 014.7-13.6l179.4-21c5.1-.6 9.5 3.7 8.9 8.9l-21 179.4c-.8 6.6-8.9 9.4-13.6 4.7l-52.4-52.4-256.2 256.2a8.03 8.03 0 01-11.3 0l-42.4-42.4a8.03 8.03 0 010-11.3l256.1-256.3z"}}]},name:"export",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},30617:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{"fill-rule":"evenodd",viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M880 912H144c-17.7 0-32-14.3-32-32V144c0-17.7 14.3-32 32-32h360c4.4 0 8 3.6 8 8v56c0 4.4-3.6 8-8 8H184v656h656V520c0-4.4 3.6-8 8-8h56c4.4 0 8 3.6 8 8v360c0 17.7-14.3 32-32 32zM653.3 424.6l52.2 52.2a8.01 8.01 0 01-4.7 13.6l-179.4 21c-5.1.6-9.5-3.7-8.9-8.9l21-179.4c.8-6.6 8.9-9.4 13.6-4.7l52.4 52.4 256.2-256.2c3.1-3.1 8.2-3.1 11.3 0l42.4 42.4c3.1 3.1 3.1 8.2 0 11.3L653.3 424.6z"}}]},name:"import",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},71529:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M574 665.4a8.03 8.03 0 00-11.3 0L446.5 781.6c-53.8 53.8-144.6 59.5-204 0-59.5-59.5-53.8-150.2 0-204l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3l-39.8-39.8a8.03 8.03 0 00-11.3 0L191.4 526.5c-84.6 84.6-84.6 221.5 0 306s221.5 84.6 306 0l116.2-116.2c3.1-3.1 3.1-8.2 0-11.3L574 665.4zm258.6-474c-84.6-84.6-221.5-84.6-306 0L410.3 307.6a8.03 8.03 0 000 11.3l39.7 39.7c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c53.8-53.8 144.6-59.5 204 0 59.5 59.5 53.8 150.2 0 204L665.3 562.6a8.03 8.03 0 000 11.3l39.8 39.8c3.1 3.1 8.2 3.1 11.3 0l116.2-116.2c84.5-84.6 84.5-221.5 0-306.1zM610.1 372.3a8.03 8.03 0 00-11.3 0L372.3 598.7a8.03 8.03 0 000 11.3l39.6 39.6c3.1 3.1 8.2 3.1 11.3 0l226.4-226.4c3.1-3.1 3.1-8.2 0-11.3l-39.5-39.6z"}}]},name:"link",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},58087:function(e,t,n){var r=n(77260),a=n(44194),s=n(15323),o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s.Z}))},l=a.forwardRef(i);t.Z=l},55785:function(e,t,n){n.d(t,{Z:function(){return l}});var r=n(77260),a=n(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"},o=n(54183),i=function(e,t){return a.createElement(o.Z,(0,r.Z)({},e,{ref:t,icon:s}))};var l=a.forwardRef(i)},59606:function(e,t,n){var r=n(39328),a=n(17323),s=n(44194),o=n(64665),i=n(31549),l=["fieldProps","min","proFieldProps","max"],c=function(e,t){var n=e.fieldProps,s=e.min,c=e.proFieldProps,u=e.max,d=(0,a.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"digit",fieldProps:(0,r.Z)({min:s,max:u},n),ref:t,filedConfig:{defaultProps:{width:"100%"}},proFieldProps:c},d))},u=s.forwardRef(c);t.Z=u},13750:function(e,t,n){var r=n(39328),a=n(17323),s=n(55824),o=n(32973),i=n(44194),l=n(72870),c=n(64665),u=n(31549),d=["fieldProps","options","radioType","layout","proFieldProps","valueEnum"],f=i.forwardRef((function(e,t){var n=e.fieldProps,o=e.options,i=e.radioType,l=e.layout,f=e.proFieldProps,p=e.valueEnum,g=(0,a.Z)(e,d);return(0,u.jsx)(c.Z,(0,r.Z)((0,r.Z)({valueType:"button"===i?"radioButton":"radio",ref:t,valueEnum:(0,s.h)(p,void 0)},g),{},{fieldProps:(0,r.Z)({options:o,layout:l},n),proFieldProps:f,filedConfig:{customLightMode:!0}}))})),p=i.forwardRef((function(e,t){var n=e.fieldProps,a=e.children;return(0,u.jsx)(o.ZP,(0,r.Z)((0,r.Z)({},n),{},{ref:t,children:a}))})),g=(0,l.G)(p,{valuePropName:"checked",ignoreWidth:!0});g.Group=f,g.Button=o.ZP.Button,g.displayName="ProFormComponent",t.Z=g},11137:function(e,t,n){var r=n(39328),a=n(17323),s=n(44194),o=n(64665),i=n(31549),l=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],c=s.forwardRef((function(e,t){var n=e.fieldProps,s=e.unCheckedChildren,c=e.checkedChildren,u=e.proFieldProps,d=(0,a.Z)(e,l);return(0,i.jsx)(o.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:s,checkedChildren:c},n),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},d))}));t.Z=c},52202:function(e,t,n){n.d(t,{G9:function(){return k},J$:function(){return Z},N6:function(){return w},VM:function(){return d},c8:function(){return p},gF:function(){return x},rg:function(){return m},sF:function(){return y}});var r=n(90819),a=n.n(r),s=n(73193),o=n.n(s),i=n(89933),l=n.n(i),c=n(5488),u=n(14870);function d(e){return f.apply(this,arguments)}function f(){return(f=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return g.apply(this,arguments)}function g(){return(g=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function m(e){return h.apply(this,arguments)}function h(){return(h=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function x(e){return v.apply(this,arguments)}function v(){return(v=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return b.apply(this,arguments)}function b(){return(b=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return j.apply(this,arguments)}function j(){return(j=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return S.apply(this,arguments)}function S(){return(S=l()(a()().mark((function e(t){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,u.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},t),{},{channel:c.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},62757:function(e,t,n){var r=n(45332),a=n.n(r),s=n(34599),o=n(5488),i=n(32394),l=n(48821),c=n(47783),u=n(14870),d=n(68349),f=n(44194),p=n(31549);t.Z=function(e){var t=e.open,n=e.onClose,r=e.onSubmit,g=(0,u.useIntl)(),m=i.A.useForm(),h=a()(m,1)[0],x=(0,s.u)((function(e){return e.currentOrg})),v=function(){console.log("handleSaveRobot"),h.validateFields().then((function(e){console.log("handleSaveRobot values:",e);var t={name:e.nickname,nickname:e.nickname,type:e.type,serviceSettings:{showQuickFaqs:!1,quickFaqs:[],showFaqs:!1,faqs:[],showGuessFaqs:!1,guessFaqs:[],showHotFaqs:!1,hotFaqs:[],showShortcutFaqs:!1,shortcutFaqs:[]},kbEnabled:!1,orgUid:null==x?void 0:x.uid};console.log("robotObject:",t),r(t),h.resetFields()})).catch((function(e){console.log("Form errors:",e)}))};return(0,f.useEffect)((function(){console.log("RobotForm useEffect"),t&&(h.resetFields(),h.setFieldsValue({type:o.f4h}))}),[t,h]),(0,p.jsx)("div",{children:(0,p.jsx)(d.Z,{title:g.formatMessage({id:"pages.robot.new",defaultMessage:"New"}),open:t,forceRender:!0,okText:g.formatMessage({id:"save",defaultMessage:"Save"}),onOk:v,onCancel:function(){h.resetFields(),n()},children:(0,p.jsxs)(i.A,{form:h,name:"basic",style:{maxWidth:400},submitter:!1,children:[(0,p.jsx)(l.Z,{label:g.formatMessage({id:"nickname",defaultMessage:"Nickname"}),name:"nickname",rules:[{required:!0,message:g.formatMessage({id:"nickname",defaultMessage:"Nickname"})}],fieldProps:{onPressEnter:function(){return v()}}}),(0,p.jsx)(c.Z,{label:g.formatMessage({id:"type",defaultMessage:"Type"}),name:["type"],options:[{label:g.formatMessage({id:o.f4h,defaultMessage:"Service"}),value:o.f4h},{label:g.formatMessage({id:o.Qeb,defaultMessage:"Chat"}),value:o.Qeb}],rules:[{required:!0,message:g.formatMessage({id:"choose",defaultMessage:"Choose"})}],fieldProps:{placeholder:g.formatMessage({id:"choose",defaultMessage:"Choose"}),onChange:function(e){console.log("onTreeSelectChange:",e)},allowClear:!0}})]})})})}},85143:function(e,t,n){n.r(t),n.d(t,{default:function(){return Bn}});var r=n(74424),a=n(93322),s=n(5488),o=n(42699),i=n(44194),l=n(37963),c=n(14870),u=n(84176),d=n.n(u),f=n(73193),p=n.n(f),g=n(86222),m=n.n(g),h=n(90819),x=n.n(h),v=n(89933),y=n.n(v),M=n(45332),w=n.n(M),b=n(5025);function k(e){return j.apply(this,arguments)}function j(){return(j=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/file/query/org",{method:"GET",params:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Z(e){return S.apply(this,arguments)}function S(){return(S=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/file/update",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return A.apply(this,arguments)}function A(){return(A=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/file/delete",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return I.apply(this,arguments)}function I(){return(I=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/file/delete/all",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function P(e){return T.apply(this,arguments)}function T(){return(T=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/file/rechunk",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var E=n(18751),F=n(68866),q=n(34599),O=n(90033),R=n(18580),z=n(68724),D=n(49616),L=n(5780),B=n(53504),Y=n(31549),V=function(e){var t=e.type,n=e.open,r=e.onClose,a=(0,E.Z)().translateString,s=(0,F.j)((function(e){return e.currentKbase})),o=(0,O.L)((function(e){return e.userInfo})),l=(0,q.u)((function(e){return e.currentOrg})),c=(0,i.useState)(""),u=w()(c,2),d=u[0],f=u[1],p=(0,i.useState)(!1),g=w()(p,2),m=g[0],h=g[1],x=function(){console.log("refresh"),h(!1);var e=(0,R.Cn)()+"?org="+encodeURIComponent(null==l?void 0:l.uid)+"&t="+encodeURIComponent(t)+"&sid="+encodeURIComponent(null==s?void 0:s.uid)+"&uid="+encodeURIComponent(null==o?void 0:o.uid)+"&nickname="+encodeURIComponent(null==o?void 0:o.nickname)+"&avatar="+encodeURIComponent(null==o?void 0:o.avatar)+"&navbar=0&"+(new Date).getTime();f(e)};(0,i.useEffect)((function(){x()}),[s]);return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsxs)(z.Z,{title:a(null==s?void 0:s.name),onClose:function(){r&&r()},open:n,extra:(0,Y.jsxs)(D.Z,{children:[(0,Y.jsx)(L.ZP,{onClick:function(){window.open(d)},children:"新窗口"}),(0,Y.jsx)(L.ZP,{onClick:function(){console.log("restart"),x()},type:"primary",children:"重新开始"})]}),styles:{body:{padding:0}},children:[(0,Y.jsx)(B.Z,{spinning:!m,style:{position:"absolute",width:"100%",zIndex:1001},size:"large"}),(0,Y.jsx)("iframe",{id:"chat-iframe",src:d,title:"demo",width:"100%",height:"100%",style:{border:0},"data-loaded":"true",onLoad:function(){h(!0),console.log("Iframe loaded successfully!")}})]})})},H=n(8065),N=n(50456),J=n(71529),Q=n(77260),X={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M483.2 790.3L861.4 412c1.7-1.7 2.5-4 2.3-6.3l-25.5-301.4c-.7-7.8-6.8-13.9-14.6-14.6L522.2 64.3c-2.3-.2-4.7.6-6.3 2.3L137.7 444.8a8.03 8.03 0 000 11.3l334.2 334.2c3.1 3.2 8.2 3.2 11.3 0zm62.6-651.7l224.6 19 19 224.6L477.5 694 233.9 450.5l311.9-311.9zm60.16 186.23a48 48 0 1067.88-67.89 48 48 0 10-67.88 67.89zM889.7 539.8l-39.6-39.5a8.03 8.03 0 00-11.3 0l-362 361.3-237.6-237a8.03 8.03 0 00-11.3 0l-39.6 39.5a8.03 8.03 0 000 11.3l243.2 242.8 39.6 39.5c3.1 3.1 8.2 3.1 11.3 0l407.3-406.6c3.1-3.1 3.1-8.2 0-11.3z"}}]},name:"tags",theme:"outlined"},K=n(54183),W=function(e,t){return i.createElement(K.Z,(0,Q.Z)({},e,{ref:t,icon:X}))};var G=i.forwardRef(W),_=n(59304),$={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M567.1 512l318.5-319.3c5-5 1.5-13.7-5.6-13.7h-90.5c-2.1 0-4.2.8-5.6 2.3l-273.3 274-90.2-90.5c12.5-22.1 19.7-47.6 19.7-74.8 0-83.9-68.1-152-152-152s-152 68.1-152 152 68.1 152 152 152c27.7 0 53.6-7.4 75.9-20.3l90 90.3-90.1 90.3A151.04 151.04 0 00288 582c-83.9 0-152 68.1-152 152s68.1 152 152 152 152-68.1 152-152c0-27.2-7.2-52.7-19.7-74.8l90.2-90.5 273.3 274c1.5 1.5 3.5 2.3 5.6 2.3H880c7.1 0 10.7-8.6 5.6-13.7L567.1 512zM288 370c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80zm0 444c-44.1 0-80-35.9-80-80s35.9-80 80-80 80 35.9 80 80-35.9 80-80 80z"}}]},name:"scissor",theme:"outlined"},ee=function(e,t){return i.createElement(K.Z,(0,Q.Z)({},e,{ref:t,icon:$}))};var te=i.forwardRef(ee),ne=n(54881),re=n(10162),ae=n(58275),se=n(11090),oe=n(2484),ie=n(851),le=n(68349),ce=n(85817),ue=n(88344),de=n(27473),fe=n(67652),pe=n(78359),ge=n(28977),me=n.n(ge),he=n(26929),xe=n(78323),ve=n(93892),ye=n(49260),Me=n(52202),we=n(46747),be=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(n)ye.ZP.info("正在检查模型状态，请稍后再试");else{var r=we.A.getState().llmproviderConfigDefault.defaultEmbeddingProvider,a="ollama"===r;a?t?e():(0,Me.J$)().then((function(t){if(404===t.code)return console.log("API 返回 404，不影响操作，直接执行"),void e();var n=we.A.getState().llmproviderConfigDefault.defaultEmbeddingModel,r="请首先拉取Embedding向量模型".concat(n,"，用于知识库向量检索");le.Z.warning({title:"嵌入式模型缺失",content:r,okText:"确定"})})).catch((function(t){console.error("重新检查模型时出错:",t),console.log("API 调用异常，不影响操作，直接执行"),e()})):e()}},ke=function(e){var t=e.onModelStatusChange,n=(0,c.useIntl)(),r=(0,i.useState)(!1),a=w()(r,2),s=a[0],o=a[1],l=(0,i.useState)(!1),u=w()(l,2),d=u[0],f=u[1],p=(0,we.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingModel})),g=(0,we.A)((function(e){return e.llmproviderConfigDefault.defaultEmbeddingProvider})),m=(0,i.useState)(!1),h=w()(m,2),v=h[0],M=h[1],b=function(){return"ollama"===g},k=function(){var e=y()(x()().mark((function e(){var n;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("检查嵌入式模型是否存在:",{defaultEmbeddingModel:p,defaultEmbeddingProvider:g}),b()){e.next=5;break}return console.log("不需要检查模型：",{defaultEmbeddingModel:p,defaultEmbeddingProvider:g}),null==t||t(!0),e.abrupt("return");case 5:return e.prev=5,f(!0),null==t||t(!1),e.next=10,(0,Me.J$)(p);case 10:n=e.sent,console.log("Embedding model check response:",n),200===n.code?(o(n.data),null==t||t(n.data),M(!1)):404===n.code?(o(!0),null==t||t(!0),M(!1),console.log("接口404，不影响使用，视为模型存在")):(o(!1),null==t||t(!1),M(!1)),e.next=22;break;case 15:e.prev=15,e.t0=e.catch(5),console.error("检查嵌入式模型失败:",e.t0),o(!0),null==t||t(!0),M(!1),console.log("接口异常，不影响使用，视为模型存在");case 22:return e.prev=22,f(!1),e.finish(22);case 25:case"end":return e.stop()}}),e,null,[[5,15,22,25]])})));return function(){return e.apply(this,arguments)}}();return(0,i.useEffect)((function(){k()}),[p,g]),b()?d?(0,Y.jsx)(ve.Z,{type:"info",showIcon:!0,message:n.formatMessage({id:"embedding.model.checking",defaultMessage:"正在检查Embedding向量模型..."}),style:{marginBottom:16}}):s?v?(0,Y.jsx)(ve.Z,{type:"warning",showIcon:!0,message:(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,Y.jsx)("span",{children:"嵌入模型配置警告"})}),description:"嵌入模型 ".concat(p," 不存在或无法访问，可能会影响知识库向量检索功能，请检查配置或联系管理员"),style:{marginBottom:16}}):null:(0,Y.jsx)(ve.Z,{type:"warning",showIcon:!0,message:(0,Y.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",width:"100%"},children:(0,Y.jsx)("span",{children:n.formatMessage({id:"embedding.model.missing.title",defaultMessage:"嵌入式模型缺失"})})}),description:n.formatMessage({id:"embedding.model.missing.content",defaultMessage:"请拉取Embedding向量模型".concat(p,"，用于知识库向量检索")}),style:{marginBottom:16}}):null},je=n(76711),Ze=n.n(je),Se=n(61353),Ce=n(33232),Ae=n(62757),Ue=n(95660),Ie=n(27904),Pe=n(82373),Te="CREATE_NEW_ROBOT",Ee=function(e){var t=e.visible,n=e.loading,r=e.robotList,a=e.selectedRobotUid,s=e.currentKbaseUid,o=e.onOk,i=e.onCancel,l=e.onChange,u=(0,c.useIntl)();return Ue.Z.debug("RobotSelectModal rendering with:",{robotList:r,selectedRobotUid:a,currentKbaseUid:s}),(0,Y.jsx)(le.Z,{title:u.formatMessage({id:"robot.select.title",defaultMessage:"选择机器人"}),open:t,onOk:o,onCancel:i,okText:u.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:u.formatMessage({id:"cancel",defaultMessage:"取消"}),okButtonProps:{disabled:!a},children:(0,Y.jsx)(B.Z,{spinning:n,children:(0,Y.jsxs)("div",{style:{marginBottom:16},children:[(0,Y.jsx)("p",{children:u.formatMessage({id:"robot.select.desc",defaultMessage:"选择一个机器人并绑定到当前知识库"})}),(0,Y.jsxs)(Ie.Z,{style:{width:"100%"},placeholder:u.formatMessage({id:"robot.select.placeholder",defaultMessage:"请选择一个机器人"}),value:a,onChange:l,optionLabelProp:"label",children:[r.map((function(e){console.log("Robot ".concat(e.name||e.nickname,": kbUid=").concat(e.kbUid,", currentKbaseUid=").concat(s));var t=!!e.kbUid&&""!==e.kbUid.trim(),n=t&&e.kbUid===s,r=e.name||e.nickname||e.uid;return t&&(r="".concat(r,n?" (已绑定当前知识库)":" (已绑定其他知识库)")),(0,Y.jsx)(Ie.Z.Option,{value:e.uid,label:r,children:r},e.uid)})),r.length>0&&(0,Y.jsx)(Ie.Z.Option,{value:"divider",disabled:!0,children:(0,Y.jsx)(Pe.Z,{style:{margin:"4px 0"}})}),(0,Y.jsx)(Ie.Z.Option,{value:Te,label:u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"}),children:(0,Y.jsxs)("div",{style:{color:"#1890ff"},children:[(0,Y.jsx)(re.Z,{})," ",u.formatMessage({id:"robot.create.new",defaultMessage:"创建新机器人"})]})})]})]})})})},Fe=function(e){var t=e.currentKbase,n=e.currentOrg,r=e.embeddingModelExists,a=e.checkingEmbeddingModel,o=(0,c.useIntl)(),l=(0,i.useState)(!1),u=w()(l,2),d=u[0],f=u[1],g=(0,i.useState)(!1),m=w()(g,2),h=m[0],v=m[1],M=(0,i.useState)(!1),k=w()(M,2),j=k[0],Z=k[1],S=(0,i.useState)(),C=w()(S,2),A=(C[0],C[1]),U=(0,i.useState)([]),I=w()(U,2),P=I[0],T=I[1],E=(0,i.useState)(""),F=w()(E,2),q=F[0],O=F[1],R=function(){var e=y()(x()().mark((function e(r){var a,i,l,c;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Z(!0),e.prev=1,a={pageNumber:0,pageSize:100,kbEnabled:!0,kbUid:r?null==t?void 0:t.uid:"",categoryUid:"",level:s.whQ,type:s.f4h,orgUid:null==n?void 0:n.uid},console.log("Fetching robots with params:",a),e.next=6,(0,Ce.p0)(a);case 6:if(i=e.sent,console.log("queryRobotsByOrg response:",i),200!==i.code){e.next=16;break}return l=i.data.content||[],c=l.map((function(e){return console.log("Processing robot: ".concat(e.name||e.nickname,", kbUid: ").concat(e.kbUid)),e})),T(c),r&&c.length>0&&A(c[0]),e.abrupt("return",c);case 16:return b.yw.error(i.message),e.abrupt("return",[]);case 18:e.next=25;break;case 20:return e.prev=20,e.t0=e.catch(1),console.error("获取机器人失败:",e.t0),b.yw.error(o.formatMessage({id:"fetch.robot.error",defaultMessage:"获取机器人失败"})),e.abrupt("return",[]);case 25:return e.prev=25,Z(!1),e.finish(25);case 28:case"end":return e.stop()}}),e,null,[[1,20,25,28]])})));return function(t){return e.apply(this,arguments)}}(),z=function(){var e=y()(x()().mark((function e(){var n,r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q&&null!=t&&t.uid){e.next=3;break}return b.yw.error(o.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return",!1);case 3:return b.yw.loading(o.formatMessage({id:"updating",defaultMessage:"更新中..."})),n={uid:q,kbEnabled:!0,kbUid:null==t?void 0:t.uid},e.prev=5,e.next=8,(0,Ce.Xd)(n);case 8:if(r=e.sent,console.log("updateRobotKbUid response:",r),200!==r.code){e.next=18;break}return b.yw.destroy(),b.yw.success(o.formatMessage({id:"update.success",defaultMessage:"更新成功"})),a=r.data,A(a),e.abrupt("return",!0);case 18:return b.yw.destroy(),b.yw.error(r.message),e.abrupt("return",!1);case 21:e.next=29;break;case 23:return e.prev=23,e.t0=e.catch(5),b.yw.destroy(),b.yw.error(o.formatMessage({id:"update.failed",defaultMessage:"更新失败"})),console.error("更新机器人知识库失败:",e.t0),e.abrupt("return",!1);case 29:case"end":return e.stop()}}),e,null,[[5,23]])})));return function(){return e.apply(this,arguments)}}(),D=function(){var e=y()(x()().mark((function e(){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleChatKb"),r){e.next=4;break}return le.Z.confirm({title:o.formatMessage({id:"warning",defaultMessage:"警告"}),content:o.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:o.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:o.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=y()(x()().mark((function e(){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,B();case 2:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 4:if(!a){e.next=7;break}return b.yw.info("正在检查模型状态，请稍后再试"),e.abrupt("return");case 7:return e.next=9,B();case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),B=function(){var e=y()(x()().mark((function e(){var n,r;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=3;break}return b.yw.error(o.formatMessage({id:"kb.select.required",defaultMessage:"请先选择一个知识库"})),e.abrupt("return");case 3:return b.yw.loading(o.formatMessage({id:"loading",defaultMessage:"加载中..."})),e.next=6,R(!0);case 6:if(n=e.sent,b.yw.destroy(),!(n.length>0)){e.next=12;break}n.length>1?(T(n),O(""),f(!0)):V(n[0]),e.next=21;break;case 12:return e.next=14,R(!1);case 14:if(r=e.sent,console.log("All robots without kbase filter:",r),0!==r.length){e.next=19;break}return b.yw.info(o.formatMessage({id:"robot.none",defaultMessage:"没有可用的机器人，请先创建机器人"})),e.abrupt("return");case 19:O(""),f(!0);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),V=function(e){var t;if(e&&e.uid){var r={chatConfig:{org:null==n?void 0:n.uid,t:s.ACv,sid:e.uid}};null===(t=window.bytedesk)||void 0===t||t.showChat(r)}else b.yw.error(o.formatMessage({id:"robot.invalid",defaultMessage:"无效的机器人"}))},H=function(){var e=y()(x()().mark((function e(){var n;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(q){e.next=3;break}return b.yw.error(o.formatMessage({id:"robot.select.required",defaultMessage:"请先选择一个机器人"})),e.abrupt("return");case 3:if(null==(n=P.find((function(e){return e.uid===q})))||!n.kbUid||n.kbUid===(null==t?void 0:t.uid)){e.next=7;break}return le.Z.confirm({title:o.formatMessage({id:"robot.already.bound",defaultMessage:"机器人已绑定知识库"}),content:o.formatMessage({id:"robot.rebind.confirm",defaultMessage:"该机器人已绑定其他知识库，是否更换绑定到当前知识库？"}),okText:o.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:o.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){var e=y()(x()().mark((function e(){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,z();case 2:e.sent&&(f(!1),V(n));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}()}),e.abrupt("return");case 7:return e.next=9,z();case 9:e.sent&&(f(!1),n&&V(n));case 11:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=y()(x()().mark((function e(n){var r,a,s,i;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b.yw.loading(o.formatMessage({id:"creating",defaultMessage:"创建中..."})),console.log("Current Kbase info:",t),r=p()(p()({},n),{},{kbEnabled:!0,kbUid:null==t?void 0:t.uid}),console.log("Creating robot with data:",r),e.next=7,(0,Ce.lg)(r);case 7:if(a=e.sent,console.log("Create robot response:",a),200!==a.code){e.next=29;break}if(b.yw.destroy(),b.yw.success(o.formatMessage({id:"create.success",defaultMessage:"创建成功"})),v(!1),s=a.data,console.log("New robot data:",s),null==s||!s.uid){e.next=23;break}O(s.uid),A(s),T((function(e){var t=[s].concat(Ze()(e));return console.log("Updated robot list:",t),t})),f(!1),V(s),e.next=27;break;case 23:return e.next=25,R(!1);case 25:i=e.sent,console.log("Fetched all robots after creation:",i);case 27:e.next=31;break;case 29:b.yw.destroy(),b.yw.error(a.message||o.formatMessage({id:"create.failed",defaultMessage:"创建失败"}));case 31:e.next=38;break;case 33:e.prev=33,e.t0=e.catch(0),b.yw.destroy(),b.yw.error(o.formatMessage({id:"create.error",defaultMessage:"创建过程发生错误"})),console.error("创建机器人错误:",e.t0);case 38:case"end":return e.stop()}}),e,null,[[0,33]])})));return function(t){return e.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(L.ZP,{icon:(0,Y.jsx)(Se.Z,{}),type:"primary",onClick:D,disabled:a,children:o.formatMessage({id:"chat.test"})}),(0,Y.jsx)(Ee,{visible:d,loading:j,robotList:P,selectedRobotUid:q,currentKbaseUid:null==t?void 0:t.uid,onOk:H,onCancel:function(){return f(!1)},onChange:function(e){e===Te?(v(!0),O("")):O(e)}}),h&&(0,Y.jsx)(Ae.Z,{open:h,onClose:function(){return v(!1)},onSubmit:N})]})},qe=n(32394),Oe=n(47783),Re=n(48821),ze=n(16331),De=n(27259),Le=n(55785),Be=n(14377),Ye=function(e){var t=e.isEdit,n=void 0===t||t,r=e.file,a=e.open,s=e.onClose,o=e.onSubmit,l=qe.A.useForm(),c=w()(l,1)[0],u=(0,F.j)((function(e){return e.currentKbase})),d=(0,q.u)((function(e){return e.currentOrg})),f=(0,H.v)((function(e){return e.categorySelectOptions})),g=(0,i.useState)(),m=w()(g,2),h=m[0],v=m[1],M=(0,i.useState)([]),b=w()(M,2),k=b[0],j=b[1],Z=(0,i.useState)(!1),S=w()(Z,2),C=S[0],A=S[1],U=(0,i.useState)(""),I=w()(U,2),P=I[0],T=I[1],E=(0,i.useState)(!1),O=w()(E,2),R=O[0],B=O[1],V=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},N=function(){var e=y()(x()().mark((function e(){var t,n;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,B(!0),e.next=4,c.validateFields();case 4:t=e.sent,n=p()(p()(p()({},r),t),{},{categoryUid:h,tagList:V(k),kbUid:null==u?void 0:u.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",n),o(n),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),ye.ZP.error("请检查表单填写是否正确");case 14:return e.prev=14,B(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),J=function(){var e=P.trim();e&&!k.includes(e)&&j([].concat(Ze()(k),[e])),A(!1),T("")},Q=function(){A(!1),T("")};return(0,i.useEffect)((function(){if(n)c.setFieldsValue({uid:null==r?void 0:r.uid,fileName:null==r?void 0:r.fileName,content:null==r?void 0:r.content,categoryUid:null==r?void 0:r.categoryUid,enabled:void 0===(null==r?void 0:r.enabled)||r.enabled}),v(null==r?void 0:r.categoryUid),j(V((null==r?void 0:r.tagList)||[]));else{if(c.setFieldsValue({fileName:"",content:"",enabled:!0}),f&&f.length>0){var e=f[0].value;c.setFieldValue("categoryUid",e),v(e)}j([]),A(!1),T("")}}),[n,r,c,f]),(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(z.Z,{title:n?"编辑文件":"添加文件",onClose:s,open:a,width:600,extra:(0,Y.jsxs)(D.Z,{children:[(0,Y.jsx)(L.ZP,{onClick:s,children:"取消"}),(0,Y.jsx)(L.ZP,{type:"primary",onClick:N,loading:R,children:"提交"})]}),footer:null,children:(0,Y.jsxs)(qe.A,{form:c,name:"fileForm",submitter:!1,children:[(0,Y.jsx)(Oe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:f,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("file category selected ".concat(e)),v(e)}}}),(0,Y.jsx)(Re.Z,{label:"文件名称",name:"fileName",rules:[{required:!0,message:"请输入文件名称"}],placeholder:"请输入文件名称"}),(0,Y.jsx)(ze.Z,{label:"文件内容",name:"content",rules:[{required:!0,message:"请输入文件内容"}],placeholder:"请输入文件内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"文件的文本内容，用于知识库检索"}),(0,Y.jsx)(qe.A.Item,{label:"标签",name:"tagList",tooltip:"为文件添加标签，便于分类和检索",children:(0,Y.jsxs)("div",{style:{minHeight:"32px"},children:[(0,Y.jsx)(D.Z,{wrap:!0,style:{marginBottom:8},children:V(k).map((function(e,t){return(0,Y.jsx)(ue.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void j(V(k.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),C?(0,Y.jsxs)(D.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)(De.Z,{value:P,onChange:function(e){T(e.target.value)},onKeyDown:function(e){"Enter"===e.key?J():"Escape"===e.key&&Q()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,Y.jsx)(L.ZP,{type:"primary",size:"small",icon:(0,Y.jsx)(Le.Z,{}),onClick:J,disabled:!P.trim(),children:"保存"}),(0,Y.jsx)(L.ZP,{size:"small",icon:(0,Y.jsx)(Be.Z,{}),onClick:Q,children:"取消"})]}):(0,Y.jsx)(L.ZP,{type:"dashed",onClick:function(){A(!0),T("")},icon:(0,Y.jsx)(re.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),!1]})})})},Ve=["current","pageSize"],He=function(){var e=(0,c.useIntl)(),t=(0,i.useRef)(),n=(0,E.Z)().translateString,r=(0,i.useState)(1),a=w()(r,2),o=a[0],l=a[1],u=(0,i.useState)(10),f=w()(u,2),g=f[0],h=f[1],v=(0,q.u)((function(e){return e.currentOrg})),M=(0,F.j)((function(e){return e.currentKbase})),j=(0,H.v)((function(e){return e.currentCategory})),S=(0,H.v)((function(e){return e.categorySelectOptions})),A=(0,i.useState)(!1),I=w()(A,2),T=I[0],O=I[1],z=(0,i.useState)(!1),D=w()(z,2),B=D[0],Q=D[1],X=(0,i.useState)([]),K=w()(X,2),W=K[0],$=K[1],ee=(0,i.useState)([]),ge=w()(ee,2),ve=ge[0],ye=ge[1],Me=(0,i.useState)(!1),we=w()(Me,2),je=we[0],Ze=we[1],Se=(0,i.useState)(!1),Ce=w()(Se,2),Ae=Ce[0],Ue=Ce[1],Ie=(0,i.useState)({}),Pe=w()(Ie,2),Te=Pe[0],Ee=Pe[1],qe=(0,i.useState)(0),Oe=w()(qe,2),Re=Oe[0],ze=Oe[1],De=le.Z.useModal(),Le=w()(De,2),Be=Le[0],He=Le[1],Ne=(0,i.useState)(!1),Je=w()(Ne,2),Qe=Je[0],Xe=Je[1],Ke=(0,i.useState)(void 0),We=w()(Ke,2),Ge=We[0],_e=We[1],$e=function(){var n=y()(x()().mark((function n(r){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,C(r);case 2:200===n.sent.code?(null==t||t.current.reload(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):b.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 4:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),et=function(){var n=y()(x()().mark((function n(r){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("handleFileDrawerSubmit",r),b.yw.success(e.formatMessage({id:"update.success",defaultMessage:"更新成功"})),Xe(!1),_e(void 0),n.next=6,Z(r);case 6:200===n.sent.code?(null==t||t.current.reload(),b.yw.success(e.formatMessage({id:"update.success",defaultMessage:"更新成功"}))):b.yw.error(e.formatMessage({id:"update.error",defaultMessage:"更新失败"}));case 8:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),tt=function(){var n=y()(x()().mark((function n(r){var a,s,o;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"rechunking",defaultMessage:"正在重新切块..."})),n.prev=1,a={uid:r.uid},n.next=5,P(a);case 5:s=n.sent,console.log("rechunk response",s,a),b.yw.destroy(),200===s.code?(b.yw.success(e.formatMessage({id:"rechunk.success",defaultMessage:"重新切块成功"})),null===(o=t.current)||void 0===o||o.reload()):b.yw.error(s.message||e.formatMessage({id:"rechunk.failed",defaultMessage:"重新切块失败"})),n.next=16;break;case 11:n.prev=11,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"rechunk.error",defaultMessage:"重新切块过程发生错误"})),console.error("重新切块错误:",n.t0);case 16:case"end":return n.stop()}}),n,null,[[1,11]])})));return function(e){return n.apply(this,arguments)}}(),nt=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(c.FormattedMessage,{id:"fileName",defaultMessage:"fileName"}),dataIndex:"fileName",ellipsis:!0,copyable:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.file.fileName.tooltip"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.fileName;null!=t&&null!==(a=t.fileName)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.fileName)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)("span",{style:{marginRight:4},children:o}),(0,Y.jsx)(ce.Z.Text,{copyable:{text:(null==t?void 0:t.fileName)||""}})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"fileUrl",defaultMessage:"File URL"}),dataIndex:"fileUrl",ellipsis:!0,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.fileUrl.tooltip"}),render:function(t,n){return n.fileUrl?(0,Y.jsxs)("a",{href:n.fileUrl,target:"_blank",rel:"noopener noreferrer",children:[(0,Y.jsx)(J.Z,{})," ",e.formatMessage({id:"view.file"})]}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.tags.tooltip"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(G,{})," ",null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,Y.jsx)(ue.Z,{children:e},e)}))]}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:e.formatMessage({id:"enabled"}),status:"Success"},false:{text:e.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.enabled.tooltip"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",ellipsis:!0,hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.file.category.tooltip"}),render:function(e,t){var n=S.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,Y.jsx)(ue.Z,{color:"blue",children:n.label}):(0,Y.jsx)(ue.Z,{color:"default",children:"未分类"})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.createdAt.tooltip"}),render:function(e,t){return me()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.file.updatedAt.tooltip"}),render:function(e,t){return t.updatedAt?me()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"actions",defaultMessage:"Actions"}),key:"option",valueType:"option",width:140,fixed:"right",render:function(t,n){return[(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,Y.jsx)(L.ZP,{type:"text",size:"small",icon:(0,Y.jsx)(_.Z,{}),onClick:function(){return function(e){_e(e),Xe(!0)}(n)}})},"edit"),(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"rechunk",defaultMessage:"重新切块"}),children:(0,Y.jsx)(L.ZP,{type:"text",size:"small",icon:(0,Y.jsx)(te,{}),onClick:function(){return tt(n)}})},"rechunk"),(0,Y.jsx)(fe.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.fileName,"】？"),onConfirm:function(){return $e(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,Y.jsx)(L.ZP,{type:"text",size:"small",icon:(0,Y.jsx)(ne.Z,{}),danger:!0})})},"delete")]}}],rt=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ve.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(ve),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,C(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),$([]),ye([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),at=function(){var e=y()(x()().mark((function e(t,n,r){var a,i;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),i=p()({categoryUid:(null==j?void 0:j.uid)===s.zBg?"":null==j?void 0:j.uid,kbUid:null==M?void 0:M.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:a||"",exportType:t},Te),"current"===t?(i.pageNumber=o-1,i.pageSize=g):"all"===t?(i.pageNumber=0,i.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=n,i.pageSize=r),window.open((0,R.kG)()+"/api/v1/llm/file/export?"+new URLSearchParams(Object.entries(i).reduce((function(e,t){var n=w()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),st=function(){var n=y()(x()().mark((function n(){var r,a,o;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Re){n.next=3;break}return b.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return b.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==j?void 0:j.uid)===s.zBg?"":null==j?void 0:j.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},n.next=8,U(r);case 8:a=n.sent,console.log("handleDeleteAllConfirm response:",a,r),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(b.yw.destroy(),b.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),b.yw.destroy(),b.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),ot=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return at("range",r,n)}})},s=0;s<r;s++)a();return t};(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[M,j]),(0,i.useEffect)((function(){return N.Z.on(s.YwV,(function(e){var n;null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){N.Z.off(s.YwV)}}),[]);var it=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,xe.HK)(s.QPQ,null==v?void 0:v.uid,null==M?void 0:M.uid,s.whQ,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ke,{onModelStatusChange:function(e){Ze(e),Ue(!1)}}),(0,Y.jsx)(ie.Z,{columns:nt,actionRef:t,cardBordered:!0,rowSelection:{selectedRowKeys:W,onChange:function(e,t){$(e),ye(t)}},scroll:{x:1800},request:function(){var e=y()(x()().mark((function e(t,n,r){var a,o,i,c,u,f,g,m;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,o=t.pageSize,i=d()(t,Ve),l(a),h(o),Ee(i),c=void 0,u=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],c=f,u="ascend"===n[f]?"ascend":"descend"),g=p()(p()({pageNumber:a-1,pageSize:o,categoryUid:(null==j?void 0:j.uid)===s.zBg?"":null==j?void 0:j.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},i),{},{sortBy:c,sortDirection:u}),e.next=10,k(g);case 10:return 200===(m=e.sent).code?(console.log("queryFilesByOrg response:",g,m),ze(m.data.totalElements)):b.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 13:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:n(null==M?void 0:M.name)+" - 文件上传列表",tooltip:"所上传内容会自动添加到 '拆分' 列表中",toolBarRender:function(){var t=[(0,Y.jsx)(L.ZP,{icon:(0,Y.jsx)(re.Z,{}),type:"primary",onClick:function(){return be((function(){return O(!0)}),je,Ae)},disabled:Ae||!je,children:e.formatMessage({id:"upload",defaultMessage:"File"})},"upload"),(0,Y.jsx)(Fe,{currentKbase:M,currentOrg:v,embeddingModelExists:je,checkingEmbeddingModel:Ae||!je},"chat")],n=[];W.length>0&&n.push({key:"batchDelete",icon:(0,Y.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){Be.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:rt,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),n.push({key:"deleteAll",icon:(0,Y.jsx)(ae.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Be.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文件数据吗？此操作不可恢复!"}),onOk:st,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}});var r=[{key:"export-current",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return at("current")}}];return Re>0&&(Re<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Re,"条)"),onClick:function(){return at("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Re,"条)"),children:ot(Re)})),t.push((0,Y.jsx)(pe.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:"primary",children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,Y.jsx)(oe.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,Y.jsx)(pe.Z,{menu:{items:n},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(oe.Z,{})]})},"batchOperations")),t}}),T&&(0,Y.jsx)(he.Z,{type:s.n1c,acceptType:"*",isModalOpen:T,handleSubmit:function(e){O(!1),null==t||t.current.reload(),it()},handleCancel:function(){O(!1),null==t||t.current.reload()}}),B&&(0,Y.jsx)(V,{type:s.ACv,open:B,onClose:function(){return Q(!1)}}),Qe&&(0,Y.jsx)(Ye,{file:Ge,open:Qe,onClose:function(){Xe(!1),_e(void 0)},onSubmit:et}),He]})};function Ne(e){return Je.apply(this,arguments)}function Je(){return(Je=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/query/org",{method:"GET",params:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Qe(e){return Xe.apply(this,arguments)}function Xe(){return(Xe=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/create",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ke(e){return We.apply(this,arguments)}function We(){return(We=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/update",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ge(e){return _e.apply(this,arguments)}function _e(){return(_e=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/delete",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function $e(e){return et.apply(this,arguments)}function et(){return(et=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/deleteAll",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tt(e){return nt.apply(this,arguments)}function nt(){return(nt=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/updateIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function rt(e){return at.apply(this,arguments)}function at(){return(at=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/updateVectorIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function st(e){return ot.apply(this,arguments)}function ot(){return(ot=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/updateAllIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e){return lt.apply(this,arguments)}function lt(){return(lt=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/updateAllVectorIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ct(e){return ut.apply(this,arguments)}function ut(){return(ut=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function dt(e){return ft.apply(this,arguments)}function ft(){return(ft=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/text/enable",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pt=n(77274),gt=n(15722),mt=n(93689),ht=n(40439),xt=n(30617),vt=n(61107),yt=n(82812),Mt=n(58087),wt=n(96501),bt=function(e){var t=e.isEdit,n=e.text,r=e.open,a=e.onClose,s=e.onSubmit,o=qe.A.useForm(),l=w()(o,1)[0],c=(0,i.useState)(""),u=w()(c,2),d=(u[0],u[1]),f=(0,q.u)((function(e){return e.currentOrg})),g=(0,H.v)((function(e){return e.categorySelectOptions})),m=(0,i.useState)(),h=w()(m,2),v=h[0],M=h[1],k=(0,F.j)((function(e){return e.currentKbase})),j=(0,i.useState)([]),Z=w()(j,2),S=Z[0],C=Z[1],A=(0,i.useState)(!1),U=w()(A,2),I=U[0],P=U[1],T=(0,i.useState)(""),E=w()(T,2),O=E[0],R=E[1],B=(0,i.useState)([]),V=w()(B,2),N=V[0],J=V[1],Q=(0,i.useState)(!1),X=w()(Q,2),K=X[0],W=X[1],G=(0,i.useState)(new Set),_=w()(G,2),$=_[0],ee=_[1],te=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},ne=function(){var e=y()(x()().mark((function e(){var t,n,r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.getFieldValue("title"),n=l.getFieldValue("content"),t&&n){e.next=5;break}return b.yw.warning("请先填写标题和内容"),e.abrupt("return");case 5:return W(!0),e.prev=6,r={title:t,content:n,orgUid:null==f?void 0:f.uid},e.next=10,ct(r);case 10:a=e.sent,console.log("生成常见问题返回:",a.data,r),200===a.code?(b.yw.success("常见问题生成成功"),J(a.data),ee(new Set)):(J([]),b.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),b.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,W(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}();(0,i.useEffect)((function(){if(r){if(t)l.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid}),d((null==n?void 0:n.content)||""),M(null==n?void 0:n.categoryUid),C(te((null==n?void 0:n.tagList)||[]));else{if(l.resetFields(),g&&g.length>0){var e=g[0].value;l.setFieldValue("categoryUid",e),M(e)}C([]),P(!1),R("")}J([]),ee(new Set)}}),[r,t,n,l,g]);var ae=function(){var e=O.trim();if(e&&!S.includes(e)){var t=te([].concat(Ze()(S),[e]));C(t)}P(!1),R("")},se=function(){P(!1),R("")},oe=function(){var e=y()(x()().mark((function e(t,n){var r,a,s;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!$.has(n)){e.next=4;break}return b.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=p()(p()({},t),{},{categoryUid:v||l.getFieldValue("categoryUid"),kbUid:null==k?void 0:k.uid,orgUid:null==f?void 0:f.uid,type:"TEXT"}),b.yw.loading("正在保存常见问题..."),e.next=8,(0,yt.kh)(r);case 8:200===(a=e.sent).code?((s=new Set($)).add(n),ee(s),b.yw.success("常见问题保存成功")):b.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),b.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(z.Z,{title:t?"修改文本":"新建文本",onClose:a,open:r,width:650,extra:(0,Y.jsxs)(D.Z,{children:[(0,Y.jsx)(L.ZP,{onClick:a,children:"取消"}),(0,Y.jsx)(L.ZP,{onClick:function(){console.log("handleSubmit"),l.validateFields().then((function(e){var t=p()(p()({},e),{},{categoryUid:v,tagList:te(S),kbUid:null==k?void 0:k.uid,orgUid:null==f?void 0:f.uid});console.log("submit",t),s(t)}))},type:"primary",children:"保存"}),(0,Y.jsx)(L.ZP,{onClick:ne,type:"default",loading:K,icon:(0,Y.jsx)(Mt.Z,{}),children:"智能生成常见问题"})]}),children:(0,Y.jsxs)(qe.A,{form:l,submitter:{render:function(){return null}},children:[(0,Y.jsx)(Oe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:g,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),M(e)}}}),(0,Y.jsx)(Re.Z,{label:"标题",name:"title",rules:[{required:!0}]}),(0,Y.jsx)(qe.A.Item,{label:"标签",name:"tagList",tooltip:"为文本添加标签，便于分类和检索",children:(0,Y.jsxs)("div",{style:{minHeight:"32px"},children:[(0,Y.jsx)(D.Z,{wrap:!0,style:{marginBottom:8},children:te(S).map((function(e,t){return(0,Y.jsx)(ue.Z,{closable:!0,color:"blue",onClose:function(){return t=e,n=te(S.filter((function(e){return e!==t}))),void C(n);var t,n},style:{marginBottom:4},children:e},t)}))}),I?(0,Y.jsxs)(D.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)(De.Z,{value:O,onChange:function(e){R(e.target.value)},onKeyDown:function(e){"Enter"===e.key?ae():"Escape"===e.key&&se()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,Y.jsx)(L.ZP,{type:"primary",size:"small",icon:(0,Y.jsx)(Le.Z,{}),onClick:ae,disabled:!O.trim(),children:"保存"}),(0,Y.jsx)(L.ZP,{size:"small",icon:(0,Y.jsx)(Be.Z,{}),onClick:se,children:"取消"})]}):(0,Y.jsx)(L.ZP,{type:"dashed",onClick:function(){P(!0),R("")},icon:(0,Y.jsx)(re.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,Y.jsx)(ze.Z,{label:"内容",name:"content",rules:[{required:!0}]}),N.length>0&&(0,Y.jsxs)("div",{style:{marginTop:16},children:[(0,Y.jsx)(ce.Z.Title,{level:5,children:"常见问题列表"}),(0,Y.jsx)(wt.Z,{bordered:!0,dataSource:N,renderItem:function(e,t){return(0,Y.jsx)(wt.Z.Item,{actions:[(0,Y.jsx)(de.Z,{title:$.has(t)?"已保存":"保存到常见问题库",children:(0,Y.jsx)(L.ZP,{type:$.has(t)?"default":"primary",icon:(0,Y.jsx)(Le.Z,{}),size:"small",disabled:$.has(t),onClick:function(){return oe(e,t)},children:$.has(t)?"已保存":"保存"})},"save")],children:(0,Y.jsx)(wt.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})})},kt=["current","pageSize"],jt=function(){var e=(0,c.useIntl)(),t=(0,i.useRef)(),n=(0,E.Z)().translateString,r=(0,i.useState)(1),a=w()(r,2),o=a[0],l=a[1],u=(0,i.useState)(10),f=w()(u,2),g=f[0],h=f[1],v=(0,q.u)((function(e){return e.currentOrg})),M=(0,F.j)((function(e){return e.currentKbase})),k=(0,H.v)((function(e){return e.currentCategory})),j=(0,H.v)((function(e){return e.categorySelectOptions})),Z=(0,i.useState)(!1),S=w()(Z,2),C=S[0],A=S[1],U=(0,i.useState)({}),I=w()(U,2),P=I[0],T=I[1],O=(0,i.useState)(!1),z=w()(O,2),D=z[0],B=z[1],V=le.Z.useModal(),N=w()(V,2),J=N[0],Q=N[1],X=(0,i.useState)([]),K=w()(X,2),W=K[0],G=K[1],_=(0,i.useState)([]),$=w()(_,2),ee=$[0],te=$[1],ce=(0,i.useState)(!1),fe=w()(ce,2),ge=fe[0],ve=fe[1],ye=(0,i.useState)(!1),Me=w()(ye,2),we=Me[0],be=Me[1],je=(0,i.useState)({}),Ze=w()(je,2),Se=Ze[0],Ce=Ze[1],Ae=(0,i.useState)(0),Ue=w()(Ae,2),Ie=Ue[0],Pe=Ue[1],Te=(0,i.useState)(!1),Ee=w()(Te,2),qe=Ee[0],Oe=Ee[1],Re=function(){var n=y()(x()().mark((function n(r){var a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log("deleteText:",r),n.next=3,Ge(r);case 3:a=n.sent,console.log("deleteMember:",a),200===a.code?(b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):b.yw.error(a.message);case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),ze=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ee.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(ee),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Ge(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),G([]),te([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),De=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(c.FormattedMessage,{id:"title",defaultMessage:"Title"}),dataIndex:"title",copyable:!0,ellipsis:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.text.title.tooltip",defaultMessage:"文档的标题"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,search:!0,copyable:!0,tooltip:e.formatMessage({id:"llm.text.content.tooltip",defaultMessage:"文档的具体内容"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.status.tooltip",defaultMessage:"文档索引处理状态"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,Y.jsx)(ue.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.vectorStatus.tooltip",defaultMessage:"文档向量化处理状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,Y.jsx)(ue.Z,{color:a,icon:(0,Y.jsx)(pt.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.text.category.tooltip",defaultMessage:"文档所属的分类"}),render:function(e,t){var n=j.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,Y.jsx)(ue.Z,{color:"blue",children:n.label}):(0,Y.jsx)(ue.Z,{color:"default",children:"未分类"})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:e.formatMessage({id:"llm.text.tags.tooltip",defaultMessage:"文档的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,Y.jsxs)("div",{children:[r.map((function(e,t){return(0,Y.jsx)(ue.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,Y.jsxs)(ue.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.createdAt.tooltip",defaultMessage:"文档创建的时间"}),render:function(e,t){return me()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.text.updatedAt.tooltip",defaultMessage:"文档最后更新的时间"}),render:function(e,t){return t.updatedAt?me()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Le=[].concat(De,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){T(n),B(!0),A(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,Y.jsx)(L.ZP,{type:"link",onClick:function(){return function(t){J.confirm({title:e.formatMessage({id:"deleteTip"}),icon:(0,Y.jsx)(gt.Z,{}),content:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(t.title,"】？"),onOk:function(){Re(t)},onCancel:function(){},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}(n)},danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete"),(0,Y.jsx)(pe.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return Ve(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return He(n)}}]},placement:"bottomRight",children:(0,Y.jsxs)(L.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,Y.jsx)(oe.Z,{})]})},"indexOperations")]}}]);(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[M,k]);var Be=function(){var e=y()(x()().mark((function e(n){var r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Qe(n);case 2:r=e.sent,console.log("handleCreateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),A(!1)):b.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ye=function(){var e=y()(x()().mark((function e(n){var r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==P?void 0:P.uid,e.next=3,Ke(n);case 3:r=e.sent,console.log("handleUpdateText response:",r),200===r.code?(null===(a=t.current)||void 0===a||a.reload(),A(!1)):b.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Ve=function(){var n=y()(x()().mark((function n(r){var a,s;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n.prev=1,n.next=4,tt({uid:r.uid});case 4:a=n.sent,b.yw.destroy(),200===a.code?(b.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):b.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),He=function(){var n=y()(x()().mark((function n(r){var a,s;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n.prev=1,n.next=4,rt({uid:r.uid});case 4:a=n.sent,b.yw.destroy(),200===a.code?(b.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):b.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),Je=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ee.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=m()(ee),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,tt({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):b.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Xe=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ee.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=m()(ee),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,rt({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):b.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),We=function(){var n=y()(x()().mark((function n(){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=y()(x()().mark((function n(){var r,a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),n.prev=1,n.next=4,st({kbUid:null==M?void 0:M.uid,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,orgUid:null==v?void 0:v.uid});case 4:r=n.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=t.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),_e=function(){var n=y()(x()().mark((function n(){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=y()(x()().mark((function n(){var r,a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),n.prev=1,n.next=4,it({kbUid:null==M?void 0:M.uid,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,orgUid:null==v?void 0:v.uid});case 4:r=n.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=t.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),et=function(){ge?we?b.yw.info("正在检查模型状态，请稍后再试"):(A(!0),B(!1),T({})):J.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},nt=function(){var n=y()(x()().mark((function n(){var r,a,o;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Ie){n.next=3;break}return b.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return b.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},n.next=8,$e(r);case 8:a=n.sent,console.log("handleDeleteAllConfirm response:",a,r),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(b.yw.destroy(),b.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),b.yw.destroy(),b.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),at=function(){var e=y()(x()().mark((function e(t,n,r){var a,i;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),i=p()({categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid,accessToken:a||"",exportType:t},Se),"current"===t?(i.pageNumber=String(o-1),i.pageSize=String(g)):"all"===t?(i.pageNumber="0",i.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=String(n),i.pageSize=String(r)),window.open((0,R.kG)()+"/api/v1/llm/text/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),ot=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,xe.HK)(s.QPQ,null==v?void 0:v.uid,null==M?void 0:M.uid,s.whQ,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),lt=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(ge){t.next=3;break}return J.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响向量检索质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){Oe(!0)}}),t.abrupt("return");case 3:if(!we){t.next=6;break}return b.yw.info("正在检查模型状态，请稍后再试"),t.abrupt("return");case 6:Oe(!0);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),ct={selectedRowKeys:W,onChange:function(e,t){G(e),te(t)}},ut=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return at("range",r,n)}})},s=0;s<r;s++)a();return t},ft=function(){var n=y()(x()().mark((function n(r){var a,s,o,i,l,c;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==ee.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"请选择要处理的项目"})),n.abrupt("return");case 3:b.yw.loading(r?e.formatMessage({id:"enabling",defaultMessage:"正在启用..."}):e.formatMessage({id:"disabling",defaultMessage:"正在禁用..."})),s=0,o=0,i=m()(ee),n.prev=7,i.s();case 9:if((l=i.n()).done){n.next=23;break}return c=l.value,n.prev=11,n.next=14,dt({uid:c.uid,enabled:r});case 14:200===n.sent.code?s++:o++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),o++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),i.e(n.t1);case 28:return n.prev=28,i.f(),n.finish(28);case 31:b.yw.destroy(),0===o?b.yw.success(r?e.formatMessage({id:"batch.enable.success",defaultMessage:"成功启用 {count} 条记录"},{count:s}):e.formatMessage({id:"batch.disable.success",defaultMessage:"成功禁用 {count} 条记录"},{count:s})):b.yw.warning(r?e.formatMessage({id:"batch.enable.partial",defaultMessage:"启用了 {success} 条记录，{fail} 条记录启用失败"},{success:s,fail:o}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"禁用了 {success} 条记录，{fail} 条记录禁用失败"},{success:s,fail:o})),G([]),te([]),null===(a=t.current)||void 0===a||a.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(e){return n.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ke,{onModelStatusChange:function(e){ve(e),be(!1)}}),(0,Y.jsx)(ie.Z,{columns:Le,actionRef:t,cardBordered:!0,rowSelection:ct,scroll:{x:1500},sticky:!0,request:function(){var t=y()(x()().mark((function t(n,r,a){var o,i,c,u,f,g,m,y;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),b.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,i=n.pageSize,c=d()(n,kt),l(o),h(i),Ce(c),u=void 0,f=void 0,r&&Object.keys(r).length>0&&(g=Object.keys(r)[0],u=g,f="ascend"===r[g]?"ascend":"descend"),m=p()(p()({pageNumber:o-1,pageSize:i,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},c),{},{sortBy:u,sortDirection:f}),t.next=12,Ne(m);case 12:return y=t.sent,console.log("queryTextsByOrg response:",m,y),b.yw.destroy(),200===y.code?Pe(y.data.totalElements):b.yw.error(y.message),t.abrupt("return",{data:y.data.content,success:!0,total:y.data.totalElements});case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:n(null==M?void 0:M.name)+" - 文本列表",tooltip:we?"正在检查嵌入式模型...":ge?"所添加文本内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return function(){var t=[];(0,R.Ox)()||t.push((0,Y.jsx)(L.ZP,{icon:(0,Y.jsx)(re.Z,{}),type:"primary",onClick:et,disabled:we,children:e.formatMessage({id:"create"})},"create"),(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,Y.jsx)(Fe,{currentKbase:M,currentOrg:v,embeddingModelExists:ge,checkingEmbeddingModel:we})},"chat"));var n=[];W.length>0&&n.push({key:"batchDelete",icon:(0,Y.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){le.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:ze,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,Y.jsx)(mt.Z,{}),label:e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(W.length,")"),onClick:function(){return ft(!0)}},{key:"batchDisable",icon:(0,Y.jsx)(ht.Z,{}),label:e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(W.length,")"),onClick:function(){return ft(!1)}},{key:"batchUpdateIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(W.length,")"),onClick:Je},{key:"batchUpdateVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(W.length,")"),onClick:Xe}),n.push({key:"deleteAll",icon:(0,Y.jsx)(ae.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){le.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有文本数据吗？此操作不可恢复!"}),onOk:nt,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:We},{key:"updateAllVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:_e});var r=[{key:"import",icon:(0,Y.jsx)(xt.Z,{}),label:e.formatMessage({id:"import"}),onClick:lt,disabled:we},{key:"export-current",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return at("current")}}];return Ie>0&&(Ie<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Ie,"条)"),onClick:function(){return at("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Ie,"条)"),children:ut(Ie)})),r.push({key:"download",icon:(0,Y.jsx)(vt.Z,{}),label:e.formatMessage({id:"download.template",defaultMessage:"下载模板"}),onClick:function(){return(0,R.LG)()}}),t.push((0,Y.jsx)(pe.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,Y.jsx)(oe.Z,{})]})},"importExport")),n.length>0&&t.push((0,Y.jsx)(pe.Z,{menu:{items:n},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(oe.Z,{})]})},"batchOperations")),t}()}}),C&&(0,Y.jsx)(bt,{isEdit:D,open:C,text:P,onClose:function(){A(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),D?Ye(e):Be(e)}}),qe&&(0,Y.jsx)(he.Z,{type:s.pBv,acceptType:".xlsx,.xls,.csv",isModalOpen:qe,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),Oe(!1),null==t||t.current.reload(),ot()},handleCancel:function(){console.log("handleUploadDragCancel"),Oe(!1),null==t||t.current.reload()}}),Q]})};function Zt(e){return St.apply(this,arguments)}function St(){return(St=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/query/org",{method:"GET",params:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e){return At.apply(this,arguments)}function At(){return(At=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/update",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ut(e){return It.apply(this,arguments)}function It(){return(It=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/delete",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pt(e){return Tt.apply(this,arguments)}function Tt(){return(Tt=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/delete/all",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Et(e){return Ft.apply(this,arguments)}function Ft(){return(Ft=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/updateIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function qt(e){return Ot.apply(this,arguments)}function Ot(){return(Ot=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/updateVectorIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Rt(e){return zt.apply(this,arguments)}function zt(){return(zt=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/updateAllIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e){return Lt.apply(this,arguments)}function Lt(){return(Lt=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/chunk/updateAllVectorIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Bt(e){return Yt.apply(this,arguments)}function Yt(){return(Yt=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/robot/agent/content/generate-faq",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Vt=n(26411),Ht=n(33363),Nt=n(11137),Jt=function(e){var t=e.isEdit,n=e.chunk,r=e.open,a=e.onClose,s=e.onSubmit,o=qe.A.useForm(),l=w()(o,1)[0],u=(0,c.useIntl)(),d=(0,q.u)((function(e){return e.currentOrg})),f=(0,F.j)((function(e){return e.currentKbase})),g=(0,H.v)((function(e){return e.currentCategory})),m=(0,H.v)((function(e){return e.categorySelectOptions})),h=(0,i.useState)(),v=w()(h,2),M=v[0],k=v[1],j=(0,i.useState)([]),Z=w()(j,2),S=Z[0],C=Z[1],A=(0,i.useState)(!1),U=w()(A,2),I=U[0],P=U[1],T=(0,i.useState)(""),E=w()(T,2),O=E[0],R=E[1],B=(0,i.useState)(!1),V=w()(B,2),N=V[0],J=V[1],Q=(0,i.useState)([]),X=w()(Q,2),K=X[0],W=X[1],G=(0,i.useState)(new Set),_=w()(G,2),$=_[0],ee=_[1],te=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},ne=function(){var e=y()(x()().mark((function e(){var t,r;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,J(!0),e.next=4,l.validateFields();case 4:t=e.sent,r=p()(p()(p()({},n),t),{},{categoryUid:M,tagList:te(S),kbUid:null==f?void 0:f.uid,orgUid:null==d?void 0:d.uid}),console.log("submit",r),s(r),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),b.yw.error("请检查表单填写是否正确");case 14:return e.prev=14,J(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[0,10,14,17]])})));return function(){return e.apply(this,arguments)}}(),ae=function(){var e=O.trim();e&&!S.includes(e)&&C([].concat(Ze()(S),[e])),P(!1),R("")},se=function(){P(!1),R("")},oe=function(){var e=y()(x()().mark((function e(){var t,n,r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=l.getFieldValue("name"),n=l.getFieldValue("content"),t&&n){e.next=5;break}return b.yw.warning("请先填写名称和内容"),e.abrupt("return");case 5:return J(!0),e.prev=6,r={name:t,content:n,orgUid:null==d?void 0:d.uid},e.next=10,Bt(r);case 10:a=e.sent,console.log("生成常见问题返回:",a.data,r),200===a.code?(b.yw.success("常见问题生成成功"),W(a.data),ee(new Set)):(W([]),b.yw.warning("生成常见问题失败，请稍后重试")),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(6),console.error("生成常见问题出错:",e.t0),b.yw.error("生成常见问题失败，请稍后重试");case 19:return e.prev=19,J(!1),e.finish(19);case 22:case"end":return e.stop()}}),e,null,[[6,15,19,22]])})));return function(){return e.apply(this,arguments)}}(),ie=function(){var e=y()(x()().mark((function e(t,n){var r,a,s;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!$.has(n)){e.next=4;break}return b.yw.info("该问题已保存"),e.abrupt("return");case 4:return r=p()(p()({},t),{},{categoryUid:null==g?void 0:g.uid,kbUid:null==f?void 0:f.uid,orgUid:null==d?void 0:d.uid,type:"TEXT"}),b.yw.loading("正在保存常见问题..."),e.next=8,(0,yt.kh)(r);case 8:200===(a=e.sent).code?((s=new Set($)).add(n),ee(s),b.yw.success("常见问题保存成功")):b.yw.error(a.message||"保存常见问题失败"),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("保存常见问题出错:",e.t0),b.yw.error("保存常见问题失败，请稍后重试");case 16:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t,n){return e.apply(this,arguments)}}();return(0,i.useEffect)((function(){if(t&&n)l.setFieldsValue({uid:null==n?void 0:n.uid,name:null==n?void 0:n.name,content:null==n?void 0:n.content,categoryUid:null==n?void 0:n.categoryUid,enabled:void 0===(null==n?void 0:n.enabled)||n.enabled}),k(null==n?void 0:n.categoryUid),C(te((null==n?void 0:n.tagList)||[]));else{if(l.setFieldsValue({name:"",content:"",enabled:!0}),m&&m.length>0){var e=m[0].value;l.setFieldValue("categoryUid",e),k(e)}C([]),P(!1),R("")}W([]),ee(new Set)}),[t,n,l,m]),(0,Y.jsx)(z.Z,{title:"编辑拆分文档",onClose:a,open:r,width:600,extra:(0,Y.jsxs)(D.Z,{children:[(0,Y.jsx)(L.ZP,{onClick:a,children:"取消"}),(0,Y.jsx)(L.ZP,{onClick:ne,type:"primary",children:"保存"}),(0,Y.jsx)(L.ZP,{onClick:oe,type:"default",loading:N,icon:(0,Y.jsx)(Mt.Z,{}),children:"智能生成常见问题"})]}),children:(0,Y.jsxs)(qe.A,{form:l,name:"chunkForm",submitter:!1,children:[(0,Y.jsx)(Oe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:m,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("chunk category selected ".concat(e)),k(e)}}}),(0,Y.jsx)(Re.Z,{label:u.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0,message:"请输入名称"}],placeholder:"请输入拆分文档名称"}),(0,Y.jsx)(Nt.Z,{label:"启用状态",name:"enabled",checkedChildren:"启用",unCheckedChildren:"禁用",tooltip:"控制拆分文档是否在知识库中生效",fieldProps:{defaultChecked:!0}}),(0,Y.jsx)(ze.Z,{label:u.formatMessage({id:"content",defaultMessage:"Content"}),name:"content",rules:[{required:!0,message:"请输入内容"}],placeholder:"请输入拆分文档内容",fieldProps:{rows:6,maxLength:1e4,showCount:!0},tooltip:"拆分文档的文本内容，用于知识库检索"}),(0,Y.jsx)(qe.A.Item,{label:"标签",name:"tagList",tooltip:"为拆分文档添加标签，便于分类和检索",children:(0,Y.jsxs)("div",{style:{minHeight:"32px"},children:[(0,Y.jsx)(D.Z,{wrap:!0,style:{marginBottom:8},children:te(S).map((function(e,t){return(0,Y.jsx)(ue.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void C(te(S.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),I?(0,Y.jsxs)(D.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)(De.Z,{value:O,onChange:function(e){R(e.target.value)},onKeyDown:function(e){"Enter"===e.key?ae():"Escape"===e.key&&se()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,Y.jsx)(L.ZP,{type:"primary",size:"small",icon:(0,Y.jsx)(Le.Z,{}),onClick:ae,disabled:!O.trim(),children:"保存"}),(0,Y.jsx)(L.ZP,{size:"small",icon:(0,Y.jsx)(Be.Z,{}),onClick:se,children:"取消"})]}):(0,Y.jsx)(L.ZP,{type:"dashed",onClick:function(){P(!0),R("")},icon:(0,Y.jsx)(re.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),K.length>0&&(0,Y.jsxs)("div",{style:{marginTop:16},children:[(0,Y.jsx)(ce.Z.Title,{level:5,children:"常见问题列表"}),(0,Y.jsx)(wt.Z,{bordered:!0,dataSource:K,renderItem:function(e,t){return(0,Y.jsx)(wt.Z.Item,{actions:[(0,Y.jsx)(de.Z,{title:$.has(t)?"已保存":"保存到常见问题库",children:(0,Y.jsx)(L.ZP,{type:$.has(t)?"default":"primary",icon:(0,Y.jsx)(Le.Z,{}),size:"small",disabled:$.has(t),onClick:function(){return ie(e,t)},children:$.has(t)?"已保存":"保存"})},"save")],children:(0,Y.jsx)(wt.Z.Item.Meta,{title:"".concat(t+1,". ").concat(null==e?void 0:e.question),description:null==e?void 0:e.answer})},t)}})]})]})})},Qt=n(7358),Xt=["current","pageSize"],Kt=function(){var e=(0,c.useIntl)(),t=(0,i.useRef)(),n=(0,E.Z)().translateString,r=(0,i.useState)(1),a=w()(r,2),o=a[0],l=a[1],u=(0,i.useState)(10),f=w()(u,2),g=f[0],h=f[1],v=(0,q.u)((function(e){return e.currentOrg})),M=(0,F.j)((function(e){return e.currentKbase})),k=(0,H.v)((function(e){return e.currentCategory})),j=(0,H.v)((function(e){return e.categorySelectOptions})),Z=(0,i.useState)(!1),S=w()(Z,2),C=S[0],A=S[1],U=(0,i.useState)(!1),I=w()(U,2),P=I[0],T=I[1],O=(0,i.useState)(),z=w()(O,2),D=z[0],B=z[1],J=(0,i.useState)([]),Q=w()(J,2),X=Q[0],K=Q[1],W=(0,i.useState)([]),G=w()(W,2),_=G[0],$=G[1],ee=(0,i.useState)(!1),te=w()(ee,2),re=te[0],de=te[1],ge=(0,i.useState)(!1),he=w()(ge,2),xe=he[0],ve=he[1],ye=(0,i.useState)({}),Me=w()(ye,2),we=Me[0],be=Me[1],je=(0,i.useState)(0),Ze=w()(je,2),Se=Ze[0],Ce=Ze[1],Ae=le.Z.useModal(),Ue=w()(Ae,2),Ie=Ue[0],Pe=Ue[1],Te=[{dataIndex:"index",valueType:"indexBorder",width:48,hideInSearch:!0,fixed:"left"},{title:(0,Y.jsx)(c.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",ellipsis:!0,copyable:!0,fixed:"left",tooltip:e.formatMessage({id:"llm.chunk.name.tooltip",defaultMessage:"拆分后的内容块名称"}),render:function(e,t,n,r){var a,s,o=null==t?void 0:t.name;null!=t&&null!==(a=t.name)&&void 0!==a&&a.includes("_")&&(o=null==t||null===(s=t.name)||void 0===s?void 0:s.split("_").slice(1).join("_"));return(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)("span",{style:{marginRight:4},children:o}),(0,Y.jsx)(ce.Z.Text,{copyable:{text:(null==t?void 0:t.name)||""}})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",ellipsis:!0,copyable:!0,width:300,tooltip:e.formatMessage({id:"llm.chunk.content.tooltip",defaultMessage:"拆分后的内容块具体内容"}),render:function(t,n){var r=n.content||"-",a=function(){var t=y()(x()().mark((function t(n){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,Ht.TE)(n);case 2:t.sent.success?b.yw.success(e.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):b.yw.error(e.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,Y.jsx)(Vt.Z,{content:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,Y.jsx)("span",{children:e.formatMessage({id:"chunk.content.preview",defaultMessage:"拆分内容预览"})}),(0,Y.jsx)(L.ZP,{type:"text",icon:(0,Y.jsx)(Qt.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:e.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,Y.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:e.formatMessage({id:"chunk.content",defaultMessage:"拆分内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,Y.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.status.tooltip",defaultMessage:"拆分内容的处理状态，主要用于全文检索"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,Y.jsx)(ue.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.vectorStatus.tooltip",defaultMessage:"拆分内容的向量化处理状态，主要用于向量存储和检索"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,Y.jsx)(ue.Z,{color:a,icon:(0,Y.jsx)(pt.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",width:150,tooltip:e.formatMessage({id:"llm.chunk.tags.tooltip",defaultMessage:"拆分内容的标签，用于分类和搜索"}),render:function(e,t){var n;return null!=t&&t.tagList&&0!==(null==t?void 0:t.tagList.length)?(0,Y.jsx)(Y.Fragment,{children:null==t||null===(n=t.tagList)||void 0===n?void 0:n.map((function(e){return(0,Y.jsx)(ue.Z,{color:"blue",style:{marginBottom:4},children:e},e)}))}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"llm.chunk.category.tooltip",defaultMessage:"拆分内容所属的分类"}),render:function(e,t){var n=j.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,Y.jsx)(ue.Z,{color:"blue",children:n.label}):(0,Y.jsx)(ue.Z,{color:"default",children:"未分类"})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",valueEnum:{true:{text:e.formatMessage({id:"enabled"}),status:"Success"},false:{text:e.formatMessage({id:"disabled"}),status:"Error"}},hideInSearch:!0,width:100,tooltip:e.formatMessage({id:"llm.chunk.enabled.tooltip",defaultMessage:"拆分内容是否启用"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.chunk.createdAt.tooltip",defaultMessage:"拆分内容创建的时间"}),render:function(e,t){return me()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"llm.chunk.updatedAt.tooltip",defaultMessage:"拆分内容最后更新的时间"}),render:function(e,t){return t.updatedAt?me()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Ee=function(){var n=y()(x()().mark((function n(r){var a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return console.log(r),n.next=3,Ut(r);case 3:a=n.sent,console.log("delete response:",a),200===a.code?(null==t||t.current.reload(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):b.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return n.stop()}}),n)})));return function(e){return n.apply(this,arguments)}}(),qe=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==_.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(_),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Ut(l);case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),K([]),$([]),null===(r=t.current)||void 0===r||r.reloadAndRest();case 36:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Oe=function(){var n=y()(x()().mark((function n(r){var a,s;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(n.prev=0,!D){n.next=7;break}return n.next=4,Ct(p()(p()({},r),{},{uid:D.uid}));case 4:a=n.sent,n.next=7;break;case 7:200===a.code?(b.yw.success(e.formatMessage({id:D?"update.success":"add.success",defaultMessage:D?"Update Success":"Add Success"})),T(!1),null==t||null===(s=t.current)||void 0===s||s.reload()):b.yw.error(a.message),n.next=13;break;case 10:n.prev=10,n.t0=n.catch(0),b.yw.error(e.formatMessage({id:D?"update.error":"add.error",defaultMessage:D?"Update Error":"Add Error"}));case 13:case"end":return n.stop()}}),n,null,[[0,10]])})));return function(e){return n.apply(this,arguments)}}(),Re=[].concat(Te,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){return function(e){B(e),T(!0)}(n)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,Y.jsx)(fe.Z,{title:e.formatMessage({id:"deleteTip",defaultMessage:"Delete Tip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(null==n?void 0:n.name,"】？"),onConfirm:function(){return Ee(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)(L.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete"),(0,Y.jsx)(pe.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return ze(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return De(n)}}]},placement:"bottomRight",children:(0,Y.jsxs)(L.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,Y.jsx)(oe.Z,{})]})},"indexOperations")]}}]),ze=function(){var n=y()(x()().mark((function n(r){var a,s;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),n.prev=1,n.next=4,Et({uid:r.uid});case 4:a=n.sent,b.yw.destroy(),200===a.code?(b.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):b.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),De=function(){var n=y()(x()().mark((function n(r){var a,s;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),n.prev=1,n.next=4,qt({uid:r.uid});case 4:a=n.sent,b.yw.destroy(),200===a.code?(b.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=t.current)||void 0===s||s.reload()):b.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(e){return n.apply(this,arguments)}}(),Le=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==_.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=m()(_),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,Et({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):b.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Be=function(){var n=y()(x()().mark((function n(){var r,a,s,o,i,l;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==_.length){n.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),n.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=m()(_),n.prev=7,o.s();case 9:if((i=o.n()).done){n.next=23;break}return l=i.value,n.prev=11,n.next=14,qt({uid:l.uid});case 14:200===n.sent.code?a++:s++,n.next=21;break;case 18:n.prev=18,n.t0=n.catch(11),s++;case 21:n.next=9;break;case 23:n.next=28;break;case 25:n.prev=25,n.t1=n.catch(7),o.e(n.t1);case 28:return n.prev=28,o.f(),n.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):b.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(r=t.current)||void 0===r||r.reload();case 34:case"end":return n.stop()}}),n,null,[[7,25,28,31],[11,18]])})));return function(){return n.apply(this,arguments)}}(),Ye=function(){var n=y()(x()().mark((function n(){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=y()(x()().mark((function n(){var r,a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),n.prev=1,n.next=4,Rt({kbUid:null==M?void 0:M.uid,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,orgUid:null==v?void 0:v.uid});case 4:r=n.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=t.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}(),Ve=function(){var n=y()(x()().mark((function n(){return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var n=y()(x()().mark((function n(){var r,a;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),n.prev=1,n.next=4,Dt({kbUid:null==M?void 0:M.uid,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,orgUid:null==v?void 0:v.uid});case 4:r=n.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=t.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),n.next=14;break;case 9:n.prev=9,n.t0=n.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",n.t0);case 14:case"end":return n.stop()}}),n,null,[[1,9]])})));return function(){return n.apply(this,arguments)}}()});case 1:case"end":return n.stop()}}),n)})));return function(){return n.apply(this,arguments)}}();(0,i.useEffect)((function(){var e;null==t||null===(e=t.current)||void 0===e||e.reload()}),[M,k]),(0,i.useEffect)((function(){return N.Z.on(s.YwV,(function(e){var n;console.log("EVENT_BUS_MQTT_NOTICE",e),null==t||null===(n=t.current)||void 0===n||n.reload()})),function(){N.Z.off(s.YwV)}}),[]);var He=function(){var e=y()(x()().mark((function e(t,n,r){var a,i;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),i=p()({categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:a||"",exportType:t},we),"current"===t?(i.pageNumber=o-1,i.pageSize=g):"all"===t?(i.pageNumber=0,i.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=n,i.pageSize=r),window.open((0,R.kG)()+"/api/v1/llm/chunk/export?"+new URLSearchParams(Object.entries(i).reduce((function(e,t){var n=w()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ne=function(){var n=y()(x()().mark((function n(){var r,a,o;return x()().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(0!==Se){n.next=3;break}return b.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),n.abrupt("return");case 3:return b.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),n.prev=4,r={categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},n.next=8,Pt(r);case 8:a=n.sent,console.log("handleDeleteAllConfirm response:",a,r),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(b.yw.destroy(),b.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),n.next=18;break;case 13:n.prev=13,n.t0=n.catch(4),b.yw.destroy(),b.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",n.t0);case 18:case"end":return n.stop()}}),n,null,[[4,13]])})));return function(){return n.apply(this,arguments)}}(),Je=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return He("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ke,{onModelStatusChange:function(e){de(e),ve(!1)}}),(0,Y.jsx)(ie.Z,{columns:Re,actionRef:t,cardBordered:!0,rowSelection:{selectedRowKeys:X,onChange:function(e,t){K(e),$(t)}},scroll:{x:2e3},request:function(){var e=y()(x()().mark((function e(t,n,r){var a,o,i,c,u,f,g,m;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,n,r),a=t.current,o=t.pageSize,i=d()(t,Xt),l(a),h(o),be(i),c=void 0,u=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],c=f,u="ascend"===n[f]?"ascend":"descend"),g=p()(p()({pageNumber:a-1,pageSize:o,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},i),{},{sortBy:c,sortDirection:u}),e.next=11,Zt(g);case 11:return m=e.sent,console.log("queryChunksByOrg response:",m,g),200===m.code?Ce(m.data.totalElements):b.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),search:{labelWidth:"auto"},rowKey:"uid",pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:n(null==M?void 0:M.name)+" - 系统自动拆分内容列表",tooltip:"用于向量检索和存储，如无必要，请不要随便修改",toolBarRender:function(){var t=[(0,Y.jsx)(Fe,{currentKbase:M,currentOrg:v,embeddingModelExists:re,checkingEmbeddingModel:xe||!re},"chat")],n=[];X.length>0&&n.push({key:"batchDelete",icon:(0,Y.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(X.length,")"),onClick:function(){Ie.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(X.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:qe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchUpdateIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(X.length,")"),onClick:Le},{key:"batchUpdateVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(X.length,")"),onClick:Be}),n.push({key:"deleteAll",icon:(0,Y.jsx)(ae.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){Ie.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有拆分数据吗？此操作不可恢复!"}),onOk:Ne,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:Ye},{key:"updateAllVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:Ve});var r=[{key:"export-current",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return He("current")}}];return Se>0&&(Se<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Se,"条)"),onClick:function(){return He("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Se,"条)"),children:Je(Se)})),t.push((0,Y.jsx)(pe.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:"primary",children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,Y.jsx)(oe.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,Y.jsx)(pe.Z,{menu:{items:n},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:X.length>0?"primary":"default",danger:X.length>0,children:[X.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(X.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(oe.Z,{})]})},"batchOperations")),t}}),C&&(0,Y.jsx)(V,{type:s.ACv,open:C,onClose:function(){return A(!1)}}),(0,Y.jsx)(Jt,{isEdit:!!D,chunk:D,open:P,onClose:function(){return T(!1)},onSubmit:Oe}),Pe]})},Wt=n(21256),Gt=n(80474),_t=n(59606),$t=n(13750),en=n(39328),tn=n(17323),nn=n(59847),rn=n(32871),an=n(64665),sn=["fieldProps","proFieldProps"],on="dateRange",ln=i.forwardRef((function(e,t){var n=e.fieldProps,r=e.proFieldProps,a=(0,tn.Z)(e,sn),s=(0,i.useContext)(rn.Z);return(0,Y.jsx)(an.Z,(0,en.Z)({ref:t,fieldProps:(0,en.Z)({getPopupContainer:s.getPopupContainer},n),valueType:on,proFieldProps:r,filedConfig:{valueType:on,customLightMode:!0,lightFilterLabelFormatter:function(e){return(0,nn.c)(e,(null==n?void 0:n.format)||"YYYY-MM-DD")}}},a))})),cn=n(15435),un=n(90251),dn=n(79401),fn=n(12624),pn=["key"],gn=function(e){var t=e.isEdit,n=e.faq,r=e.open,a=e.onClose,o=e.onSubmit,l=qe.A.useForm(),c=w()(l,1)[0],u=(0,i.useState)(""),f=w()(u,2),g=f[0],m=f[1],h=(0,i.useState)(""),v=w()(h,2),M=v[0],k=v[1],j=(0,i.useState)(""),Z=w()(j,2),S=Z[0],C=Z[1],A=(0,q.u)((function(e){return e.currentOrg})),U=(0,F.j)((function(e){return e.currentKbase})),I=(0,H.v)((function(e){return e.categorySelectOptions})),P=(0,H.v)((function(e){return e.currentCategory})),T=(0,i.useState)(),E=w()(T,2),O=(E[0],E[1]),B=(0,i.useState)([]),V=w()(B,2),N=V[0],J=V[1],Q=(0,i.useState)(!1),X=w()(Q,2),K=X[0],W=X[1],G=(0,i.useState)(""),_=w()(G,2),$=_[0],ee=_[1],te=(0,i.useRef)(null),ne=(0,i.useState)([]),ae=w()(ne,2),se=(ae[0],ae[1]),oe=(0,i.useState)([]),ie=w()(oe,2),ce=ie[0],fe=ie[1],pe=(0,i.useState)(!0),ge=w()(pe,2),he=ge[0],xe=ge[1],ve=(0,i.useState)("permanent"),ye=w()(ve,2),Me=ye[0],we=ye[1],be=(0,i.useState)([]),ke=w()(be,2),je=ke[0],Se=ke[1],Ce=(0,i.useState)(!1),Ae=w()(Ce,2),Ue=Ae[0],Ie=Ae[1],Te=(0,i.useState)([]),Ee=w()(Te,2),Fe=Ee[0],Le=Ee[1],Be=(0,i.useState)([]),Ye=w()(Be,2),Ve=Ye[0],He=Ye[1],Ne=(0,i.useState)(!1),Je=w()(Ne,2),Qe=Je[0],Xe=Je[1],Ke=(0,i.useState)(""),We=w()(Ke,2),Ge=We[0],_e=We[1],$e=(0,i.useState)(""),et=w()($e,2),tt=et[0],nt=et[1],rt=(0,i.useState)([]),at=w()(rt,2),st=at[0],ot=at[1],it=(0,i.useState)([]),lt=w()(it,2),ct=lt[0],ut=lt[1],dt=(0,i.useState)(!1),ft=w()(dt,2),pt=ft[0],gt=ft[1];(0,i.useEffect)((function(){var e=function(){var e=y()(x()().mark((function e(){var t,r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,b.yw.loading("正在加载常见问题列表..."),t={pageNumber:0,pageSize:100,categoryUid:(null==P?void 0:P.uid)===s.zBg?"":null==P?void 0:P.uid,kbUid:null==U?void 0:U.uid,orgUid:null==A?void 0:A.uid},e.next=5,(0,yt.pf)(t);case 5:r=e.sent,b.yw.destroy(),200===r.code?(a=r.data.content.map((function(e){return{label:e.question,value:e.uid}})),fe(a.filter((function(e){return e.value!==(null==n?void 0:n.uid)})))):b.yw.error(r.message||"加载常见问题失败"),e.next=15;break;case 10:e.prev=10,e.t0=e.catch(0),b.yw.destroy(),b.yw.error("加载常见问题列表失败"),console.error("获取FAQ列表出错:",e.t0);case 15:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(){return e.apply(this,arguments)}}();r&&e()}),[r,null==U?void 0:U.uid,null==A?void 0:A.uid,null==P?void 0:P.uid,null==n?void 0:n.uid]),(0,i.useEffect)((function(){if(t){var e,r,a,s,o,i=Array.isArray(null==n?void 0:n.similarQuestions)?n.similarQuestions.map((function(e){return"string"==typeof e?e:String(e)})).filter((function(e){return""!==e.trim()})):[];if(c.setFieldsValue({question:null==n?void 0:n.question,similarQuestions:i,answer:null==n?void 0:n.answer,answerHtml:null==n?void 0:n.answerHtml,answerMarkdown:null==n?void 0:n.answerMarkdown,categoryUid:null==n?void 0:n.categoryUid,kbUid:null==U?void 0:U.uid,answerList:(null==n?void 0:n.answerList)||[],enabled:!1!==(null==n?void 0:n.enabled),relatedFaqUids:(null==n||null===(e=n.relatedFaqs)||void 0===e?void 0:e.map((function(e){return e.uid})))||[],dateType:"permanent",dateRange:null!=n&&n.startDate&&null!=n&&n.endDate?[me()(n.startDate),me()(n.endDate)]:void 0}),console.log("edit faq:",n),m((null==n?void 0:n.answer)||""),k((null==n?void 0:n.answerHtml)||(null==n?void 0:n.answer)||""),C((null==n?void 0:n.answerMarkdown)||(null==n?void 0:n.answer)||""),Ie(!1),J((null==n||null===(r=n.tagList)||void 0===r?void 0:r.filter((function(e){return e&&""!==e.trim()})))||[]),se((null==n||null===(a=n.relatedFaqs)||void 0===a?void 0:a.map((function(e){return e.uid})))||[]),xe(!1!==(null==n?void 0:n.enabled)),Se(i),null!=n&&null!==(s=n.images)&&void 0!==s&&s.length&&n.images.some((function(e){return e&&""!==e.trim()}))){var l=n.images.filter((function(e){return e&&""!==e.trim()})),u=l.map((function(e,t){return{uid:"-".concat(t+1),name:"image_".concat(t+1,".jpg"),status:"done",url:e,thumbUrl:e}}));Le(u),He(l)}else Le([]),He([]);if(null!=n&&null!==(o=n.attachments)&&void 0!==o&&o.length&&n.attachments.some((function(e){return e&&""!==e.trim()}))){var d=n.attachments.filter((function(e){return e&&""!==e.trim()})),f=d.map((function(e,t){var n=e.substring(e.lastIndexOf("/")+1);return{uid:"-".concat(t+1),name:n||"attachment_".concat(t+1),status:"done",url:e}}));ot(f),ut(d)}else ot([]),ut([])}else{var p=I.length>0?I[0].value:"";c.setFieldsValue({question:"",similarQuestions:[],answer:"",categoryUid:p,kbUid:null==U?void 0:U.uid,answerList:[],enabled:!0,relatedFaqUids:[],dateType:"permanent",dateRange:void 0,autoSyncLlmQa:!1,llmQaKbUid:""}),p&&O(p),m(""),k(""),C(""),Ie(!1),J([]),se([]),xe(!0),Se([]),Le([]),He([]),ot([]),ut([])}}),[n,r,I]),(0,i.useEffect)((function(){var e;K&&(null===(e=te.current)||void 0===e||e.focus())}),[K]),(0,i.useEffect)((function(){console.log("editorAnswer",g),console.log("editorAnswerHtml",M)}),[g,M]);var mt=function(){$&&-1===N.indexOf($)&&J([].concat(Ze()(N),[$])),W(!1),ee("")},ht=function(){var e=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:_e(t.url||t.thumbUrl),Xe(!0),nt(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xt=(0,Y.jsx)(L.ZP,{icon:(0,Y.jsx)(re.Z,{}),children:"上传图片"}),vt={name:"file",accept:"image/*",action:(0,R.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},listType:"picture-card",fileList:Fe,onPreview:ht,onChange:function(e){var t=Ze()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n=e.file.response.data.fileUrl;He((function(e){return[].concat(Ze()(e),[n])})),b.yw.success("上传 ".concat(e.file.name," 成功"))}else b.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&b.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){return e.response&&200===e.response.code?p()(p()({},e),{},{url:e.response.data.fileUrl,thumbUrl:e.response.data.fileUrl}):e})),Le(t)},data:function(e){return{file:e,fileName:me()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:s.IrL,categoryUid:c.getFieldValue("categoryUid")||"",kbUid:(null==U?void 0:U.uid)||"",channel:s.XtJ}},onRemove:function(e){return e.url&&He((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},wt={name:"file",action:(0,R.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(s.LA8)},fileList:st,onChange:function(e){var t=Ze()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var n=e.file.response.data.fileUrl;ut((function(e){return[].concat(Ze()(e),[n])})),b.yw.success("上传 ".concat(e.file.name," 成功"))}else b.yw.error("上传 ".concat(e.file.name," 失败: ").concat(e.file.response.message));else"error"===e.file.status&&b.yw.error("上传 ".concat(e.file.name," 失败"));t=t.map((function(e){return e.response&&200===e.response.code?p()(p()({},e),{},{url:e.response.data.fileUrl}):e})),ot(t)},data:function(e){return{file:e,fileName:me()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name,fileType:e.type,isAvatar:"false",kbType:s.IrL,categoryUid:c.getFieldValue("categoryUid")||"",kbUid:(null==U?void 0:U.uid)||"",channel:s.XtJ}},onRemove:function(e){return e.url&&ut((function(t){return t.filter((function(t){return t!==e.url}))})),!0}},bt=function(){var e=y()(x()().mark((function e(){var t,n,r,a,s,o,i;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if((0,R.OJ)()){e.next=3;break}return b.yw.error("生成相似问法功能仅在企业版和平台版可用"),e.abrupt("return");case 3:if((t=c.getFieldValue("question"))&&""!==t.trim()){e.next=7;break}return b.yw.error("请先输入问题后再生成相似问法"),e.abrupt("return");case 7:return e.prev=7,gt(!0),b.yw.loading("正在智能生成相似问法..."),n={question:t,orgUid:null==A?void 0:A.uid},e.next=13,(0,yt.YQ)(n);case 13:r=e.sent,console.log("生成相似问法响应:",n,r),b.yw.destroy(),200===r.code?(a=r.data,console.log("生成的相似问法:",a),s=a.similarQuestions.filter((function(e){return e&&""!==e.trim()})),o=je.filter((function(e){return e&&""!==e.trim()})),i=Ze()(o),s.forEach((function(e){i.includes(e)||i.push(e)})),Se(i),c.setFieldValue("similarQuestions",i),b.yw.success("已成功生成 ".concat(s.length," 条相似问法"))):b.yw.error(r.message||"生成相似问法失败"),e.next=24;break;case 19:e.prev=19,e.t0=e.catch(7),console.error("生成相似问法出错:",e.t0),b.yw.destroy(),b.yw.error("生成相似问法失败");case 24:return e.prev=24,gt(!1),e.finish(24);case 27:case"end":return e.stop()}}),e,null,[[7,19,24,27]])})));return function(){return e.apply(this,arguments)}}();return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(z.Z,{title:t?"修改常见问题":"新建常见问题",width:650,onClose:a,open:r,extra:(0,Y.jsxs)(D.Z,{children:[(0,Y.jsx)(L.ZP,{onClick:a,children:"取消"}),(0,Y.jsx)(L.ZP,{onClick:function(){var e=je.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e}));c.setFieldValue("similarQuestions",e),c.validateFields().then((function(e){var t,r;if(console.log("handleSubmit values:",e),console.log("handleSubmit edited:",g,M,S),"permanent"===e.dateType)t=me()().format("YYYY-MM-DDTHH:mm:ss"),r=me()().add(100,"years").format("YYYY-MM-DDTHH:mm:ss");else{var a=e.dateRange;t=null!=a&&a[0]?a[0].format("YYYY-MM-DDTHH:mm:ss"):void 0,r=null!=a&&a[1]?a[1].format("YYYY-MM-DDTHH:mm:ss"):void 0}var i=je.map((function(e){return null==e?void 0:e.trim()})).filter((function(e){return e&&""!==e})),l=Ve.filter((function(e){return e&&""!==e.trim()})),c=ct.filter((function(e){return e&&""!==e.trim()})),u=N.filter((function(e){return e&&""!==e.trim()})),d=p()(p()(p()({},n),e),{},{type:s.PYi,kbUid:null==U?void 0:U.uid,orgUid:null==A?void 0:A.uid,answer:e.answerHtml,answerHtml:e.answerHtml,answerMarkdown:e.answerHtml,similarQuestions:i,answerList:e.answerList||[],tagList:u,relatedFaqUids:e.relatedFaqUids||[],startDate:t,endDate:r,images:l,attachments:c});o(d)})).catch((function(e){console.log("Form errors:",e),b.yw.error("请检查表单填写")}))},type:"primary",children:"保存"})]}),children:(0,Y.jsxs)(qe.A,{form:c,submitter:{render:function(){return null}},children:[(0,Y.jsx)(Oe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:I,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("category selected ".concat(e)),O(e)}}}),(0,Y.jsx)(Re.Z,{label:"问题",name:"question",rules:[{required:!0,message:"请输入问题"}]}),(0,Y.jsx)(Wt.u,{name:"similarQuestions",label:(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},children:[(0,Y.jsx)("span",{children:"相似问法"}),(0,Y.jsxs)(de.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:["                ",(0,Y.jsx)(de.Z,{title:"可在AI助手-》提示词 中搜索名称为：faq_similar_questions 的提示词，修改大模型和编辑提示词",children:(0,Y.jsx)(L.ZP,{type:"primary",icon:(0,Y.jsx)(Mt.Z,{}),onClick:bt,loading:pt,size:"small",children:"智能生成"})})]})]}),creatorButtonProps:{creatorButtonText:"添加相似问法",icon:(0,Y.jsx)(re.Z,{}),type:"dashed",block:!0,onClick:function(){var e=[].concat(Ze()(je),[""]);Se(e),c.setFieldValue("similarQuestions",e)}},copyIconProps:!1,min:0,style:{width:"100%"},initialValue:[],onAfterAdd:function(e,t,n){var r=c.getFieldValue("similarQuestions")||[],a=Array.isArray(r)?r.map((function(e){return"string"==typeof e?e:""})):Ze()(je);Se(a)},onAfterRemove:function(e,t){var n=c.getFieldValue("similarQuestions")||[],r=Array.isArray(n)?n.map((function(e){return"string"==typeof e?e:""})):[];Se(r)},actionRender:function(e,t,n){return[(0,Y.jsx)(L.ZP,{type:"link",danger:!0,onClick:function(){var n=e.name,r=Ze()(je);r.splice(n,1),Se(r),t.remove(e.name)},children:"删除"},"delete")]},children:function(e,t,n){var r=e.key,a=d()(e,pn);return(0,Y.jsx)(Re.Z,p()(p()({},a),{},{placeholder:"请输入相似问法",rules:[{required:!0,message:"请输入相似问法"}],width:"xl",fieldProps:{maxLength:500,autoComplete:"off",value:je[t]||"",onChange:function(e){var n=Ze()(je);n[t]=e.target.value,Se(n),c.setFieldValue(["similarQuestions",t],e.target.value)}}}),r)}}),(0,Y.jsx)(qe.A.Item,{name:"answerHtml",label:"文本答案",children:(0,Y.jsx)(fn.Z,{defaultValue:M,toolbarKeys:(0,Ht.eD)(),style:{height:"200px",width:"600px"},maxLength:16383,onChange:function(e,t,n){console.log("Editor content changed: html",e),console.log("Editor content changed: markdown",t),console.log("Editor content changed: text",n),m(n),k(e),C(t),Ue||Ie(!0)}})}),(0,Y.jsxs)(qe.A.Item,{label:"图片",tooltip:"可以上传多张图片作为回复内容",children:[(0,Y.jsx)(cn.Z,p()(p()({},vt),{},{children:xt})),(0,Y.jsx)(le.Z,{open:Qe,title:tt,footer:null,onCancel:function(){return Xe(!1)},children:(0,Y.jsx)(un.Z,{alt:"预览图片",style:{width:"100%"},src:Ge})})]}),(0,Y.jsx)(qe.A.Item,{label:"附件",tooltip:"可以上传多个附件作为回复内容",children:(0,Y.jsx)(cn.Z,p()(p()({},wt),{},{children:(0,Y.jsx)(L.ZP,{icon:(0,Y.jsx)(re.Z,{}),children:"上传附件"})}))}),(0,Y.jsxs)(Pe.Z,{orientation:"left",children:["扩展答案列表",(0,Y.jsx)(L.ZP,{type:"link",onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/admin/kbase/viplevel")},children:"使用说明"})]}),(0,Y.jsx)(Wt.u,{name:"answerList",creatorButtonProps:{creatorButtonText:"添加答案",icon:(0,Y.jsx)(re.Z,{}),type:"dashed",block:!0},itemRender:function(e,t){var n=e.listDom,r=e.action,a=t.index;return(0,Y.jsx)(dn.Z,{size:"small",style:{marginBottom:16},extra:r,children:n},a)},initialValue:[],copyIconProps:!1,itemContainerRender:function(e){return(0,Y.jsx)("div",{children:e})},children:(0,Y.jsxs)(Gt.UW,{children:[(0,Y.jsx)(_t.Z,{name:"vipLevel",label:"VIP等级",rules:[{required:!0,message:"请输入VIP等级"}],placeholder:"输入VIP等级",min:1}),(0,Y.jsx)(ze.Z,{name:"answer",label:"答案内容",rules:[{required:!0,message:"请输入答案内容"}],placeholder:"输入答案内容",fieldProps:{rows:3}})]})}),(0,Y.jsx)(Oe.Z,{name:"relatedFaqUids",label:"相关问题",mode:"multiple",options:ce,fieldProps:{placeholder:"请选择相关问题"}}),(0,Y.jsx)(qe.A.Item,{label:"标签",children:(0,Y.jsxs)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px"},children:[N.map((function(e){return(0,Y.jsx)(ue.Z,{closable:!0,onClose:function(){return t=e,n=N.filter((function(e){return e!==t})),void J(n);var t,n},children:e},e)})),K?(0,Y.jsx)(De.Z,{ref:te,type:"text",size:"small",style:{width:78},value:$,onChange:function(e){ee(e.target.value)},onBlur:mt,onPressEnter:mt}):(0,Y.jsxs)(ue.Z,{onClick:function(){W(!0)},style:{borderStyle:"dashed",cursor:"pointer"},children:[(0,Y.jsx)(re.Z,{})," 新标签"]})]})}),(0,Y.jsx)($t.Z.Group,{name:"dateType",label:"有效期设置",options:[{label:"永久有效",value:"permanent"},{label:"自定义日期",value:"custom"}],fieldProps:{onChange:function(e){we(e.target.value),"permanent"===e.target.value&&c.setFieldValue("dateRange",void 0)},value:Me}}),"custom"===Me&&(0,Y.jsx)(ln,{name:"dateRange",label:"有效日期",rules:[{required:"custom"===Me,message:"请选择有效日期范围"}],fieldProps:{style:{width:"100%"}}}),(0,Y.jsx)(Nt.Z,{name:"enabled",label:"是否启用",fieldProps:{checked:he,onChange:function(e){xe(e)}}})]})})})},mn=["current","pageSize"],hn=function(){var e=(0,c.useIntl)(),t=(0,E.Z)().translateString,n=(0,i.useRef)(),r=(0,i.useState)(!0),a=w()(r,2),o=a[0],l=a[1],u=(0,i.useState)(),f=w()(u,2),g=f[0],h=f[1],v=(0,i.useState)(!1),M=w()(v,2),k=M[0],j=M[1],Z=(0,i.useState)(1),S=w()(Z,2),C=S[0],A=S[1],U=(0,i.useState)(10),I=w()(U,2),P=I[0],T=I[1],O=(0,q.u)((function(e){return e.currentOrg})),z=(0,F.j)((function(e){return e.currentKbase})),D=(0,H.v)((function(e){return e.currentCategory})),B=(0,H.v)((function(e){return e.categorySelectOptions})),V=(0,i.useState)(!1),N=w()(V,2),J=N[0],Q=N[1],X=(0,i.useState)([]),K=w()(X,2),W=K[0],G=K[1],_=(0,i.useState)([]),$=w()(_,2),ee=$[0],te=$[1],ce=(0,i.useState)(0),ge=w()(ce,2),ve=ge[0],ye=ge[1],Me=(0,i.useState)(!1),we=w()(Me,2),be=we[0],je=we[1],Ze=(0,i.useState)(!1),Se=w()(Ze,2),Ce=Se[0],Ae=Se[1],Ue=(0,i.useState)({}),Ie=w()(Ue,2),Pe=Ie[0],Te=Ie[1],Ee=function(){var t=y()(x()().mark((function t(r){var a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(r),t.next=3,(0,yt.Yg)(r);case 3:a=t.sent,console.log("delete response:",a),200===a.code?(null==n||n.current.reload(),b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete Success"}))):b.yw.error(e.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}));case 6:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),qe=function(){var t=y()(x()().mark((function t(){var r,a,s,o,i,l;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ee.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),t.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),a=0,s=0,o=m()(ee),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,yt.Yg)(l);case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:a,fail:s})),G([]),te([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Oe=function(){var t=y()(x()().mark((function t(r){var a,s,o,i,l,c;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ee.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.noselection",defaultMessage:"Please select items to process"})),t.abrupt("return");case 3:b.yw.loading(r?e.formatMessage({id:"enabling",defaultMessage:"Enabling..."}):e.formatMessage({id:"disabling",defaultMessage:"Disabling..."})),s=0,o=0,i=m()(ee),t.prev=7,i.s();case 9:if((l=i.n()).done){t.next=23;break}return c=l.value,t.prev=11,t.next=14,(0,yt.kv)({uid:c.uid,enabled:r});case 14:200===t.sent.code?s++:o++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),o++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),i.e(t.t1);case 28:return t.prev=28,i.f(),t.finish(28);case 31:b.yw.destroy(),0===o?b.yw.success(r?e.formatMessage({id:"batch.enable.success",defaultMessage:"Successfully enabled {count} items"},{count:s}):e.formatMessage({id:"batch.disable.success",defaultMessage:"Successfully disabled {count} items"},{count:s})):b.yw.warning(r?e.formatMessage({id:"batch.enable.partial",defaultMessage:"Enabled {success} items, failed to enable {fail} items"},{success:s,fail:o}):e.formatMessage({id:"batch.disable.partial",defaultMessage:"Disabled {success} items, failed to disable {fail} items"},{success:s,fail:o})),G([]),te([]),null===(a=n.current)||void 0===a||a.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(e){return t.apply(this,arguments)}}(),Re=function(){var t=y()(x()().mark((function t(){var r,a,o;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ve){t.next=3;break}return b.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),t.abrupt("return");case 3:return b.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),t.prev=4,r={categoryUid:(null==D?void 0:D.uid)===s.zBg?"":null==D?void 0:D.uid,kbUid:null==z?void 0:z.uid,orgUid:null==O?void 0:O.uid},t.next=8,(0,yt.QB)(r);case 8:200===(a=t.sent).code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=n.current)||void 0===o||o.reloadAndRest()):(b.yw.destroy(),b.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),t.next=17;break;case 12:t.prev=12,t.t0=t.catch(4),b.yw.destroy(),b.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",t.t0);case 17:case"end":return t.stop()}}),t,null,[[4,12]])})));return function(){return t.apply(this,arguments)}}(),ze=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,fixed:"left",width:100,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"faq.question.tooltip",defaultMessage:"常见问题的问题内容"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.similar.questions",defaultMessage:"相似问法"}),dataIndex:"similarQuestions",width:200,ellipsis:!0,search:!1,tooltip:e.formatMessage({id:"faq.similar.questions.tooltip",defaultMessage:"表达相同意思的其他问法"}),render:function(t,n){if(!n.similarQuestions||0===n.similarQuestions.length||1===n.similarQuestions.length&&""===n.similarQuestions[0])return"-";var r=n.similarQuestions.length>3,a=n.similarQuestions.slice(0,3),s=(0,Y.jsx)("div",{style:{maxWidth:300,maxHeight:300,overflow:"auto"},children:n.similarQuestions.map((function(e,t){return(0,Y.jsxs)("div",{style:{marginBottom:8},children:[(0,Y.jsx)(ue.Z,{color:"blue",style:{marginRight:4},children:t+1}),e]},t)}))}),o=(0,Y.jsxs)("div",{children:[a.map((function(e,t){return(0,Y.jsx)(ue.Z,{color:"blue",style:{marginBottom:4},children:e},t)})),r&&(0,Y.jsxs)(ue.Z,{color:"orange",children:["+",n.similarQuestions.length-3]})]});return(0,Y.jsx)(Vt.Z,{content:s,title:e.formatMessage({id:"faq.similar.questions",defaultMessage:"所有相似问法"}),placement:"right",trigger:"hover",children:o})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",width:200,ellipsis:!0,search:!0,tooltip:e.formatMessage({id:"faq.answer.tooltip",defaultMessage:"常见问题的回答内容"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.status.tooltip",defaultMessage:"问题处理状态"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r&&(a="processing"),(0,Y.jsx)(ue.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase())})})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.vectorStatus.tooltip",defaultMessage:"向量化处理状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r?a="success":"ERROR"===r?a="error":"NEW"===r?a="processing":"PROCESSING"===r&&(a="warning"),r?(0,Y.jsx)(ue.Z,{color:a,icon:(0,Y.jsx)(pt.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase())})||r}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.clickCount"}),dataIndex:"clickCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.clickCount.tooltip",defaultMessage:"问题被点击的次数"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.upCount"}),dataIndex:"upCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.upCount.tooltip",defaultMessage:"问题被点赞的次数"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.downCount"}),dataIndex:"downCount",width:100,hideInSearch:!0,sorter:!0,tooltip:e.formatMessage({id:"faq.downCount.tooltip",defaultMessage:"问题被踩的次数"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"faq.category.tooltip",defaultMessage:"问题所属的分类"}),render:function(e,t){var n=B.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return(0,Y.jsx)(ue.Z,{color:"blue",children:(null==n?void 0:n.label)||"-"})},filters:B.map((function(e){return{text:e.label,value:e.value}})),filterMode:"tree"},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.tags",defaultMessage:"标签"}),dataIndex:"tagList",width:150,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.tags.tooltip",defaultMessage:"用于分类和搜索的标签"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,Y.jsxs)("div",{children:[r.map((function(e,t){return(0,Y.jsx)(ue.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,Y.jsxs)(ue.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.isValid"}),dataIndex:"enabled",width:100,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.isValid.tooltip",defaultMessage:"问题是否有效可用"}),valueEnum:{true:{text:"有效",status:"Success"},false:{text:"无效",status:"Error"}}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.startDate"}),dataIndex:"startDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"faq.startDate.tooltip",defaultMessage:"问题生效的开始时间"}),render:function(e,t){return t.startDate?me()(t.startDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"faq.endDate"}),dataIndex:"endDate",width:160,valueType:"dateTime",hideInSearch:!0,tooltip:e.formatMessage({id:"faq.endDate.tooltip",defaultMessage:"问题失效的结束时间"}),render:function(e,t){return t.endDate?me()(t.endDate).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.createdAt.tooltip",defaultMessage:"问题创建的时间"}),render:function(e,t){return me()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,width:200,hideInSearch:!0,tooltip:e.formatMessage({id:"faq.updatedAt.tooltip",defaultMessage:"问题最后更新的时间"}),render:function(e,t){return t.updatedAt?me()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:e.formatMessage({id:"actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){!function(e){console.log("showEditDrawer",e),h(e),l(!0),j(!0)}(n)},children:e.formatMessage({id:"edit"})},"editable"),(0,Y.jsx)(fe.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm"}),"【").concat(null==n?void 0:n.question,"】？"),onConfirm:function(){return Ee(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),children:(0,Y.jsx)(L.ZP,{size:"small",type:"link",danger:!0,children:e.formatMessage({id:"delete"})})},"delete"),(0,Y.jsx)(pe.Z,{menu:{items:[{key:"updateIndex",label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return De(n)}},{key:"updateVectorIndex",label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Le(n)}}]},placement:"bottomRight",children:(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),children:(0,Y.jsxs)(L.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"update.indexes",defaultMessage:"更新索引"}),(0,Y.jsx)(oe.Z,{})]})})},"indexOperations")]}}],De=function(){var t=y()(x()().mark((function t(r){var a,s;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),t.prev=1,t.next=4,(0,yt.RF)({uid:r.uid});case 4:a=t.sent,b.yw.destroy(),200===a.code?(b.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新成功"})),null===(s=n.current)||void 0===s||s.reload()):b.yw.error(a.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Le=function(){var t=y()(x()().mark((function t(r){var a,s;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),t.prev=1,t.next=4,(0,yt.YO)({uid:r.uid});case 4:a=t.sent,b.yw.destroy(),200===a.code?(b.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新成功"})),null===(s=n.current)||void 0===s||s.reload()):b.yw.error(a.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(e){return t.apply(this,arguments)}}(),Be=function(){be?Ce?b.yw.info("正在检查模型状态，请稍后再试"):(h(void 0),l(!1),j(!0)):le.Z.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){h(void 0),l(!1),j(!0)}})},Ye=function(){var t=y()(x()().mark((function t(r){var a,s;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.log("handleSubmitDrawer",r),o?b.yw.loading(e.formatMessage({id:"updating"})):b.yw.loading(e.formatMessage({id:"creating"})),!o){t.next=8;break}return t.next=5,(0,yt.y)(r);case 5:t.t0=t.sent,t.next=11;break;case 8:return t.next=10,(0,yt.kh)(r);case 10:t.t0=t.sent;case 11:a=t.t0,console.log("createFaq response:",r,a),200===a.code?(b.yw.destroy(),b.yw.success(e.formatMessage({id:"create.success",defaultMessage:"create success"})),j(!1),null===(s=n.current)||void 0===s||s.reloadAndRest()):(b.yw.destroy(),b.yw.error(a.message));case 14:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ve=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(be){t.next=3;break}return le.Z.confirm({title:e.formatMessage({id:"warning",defaultMessage:"警告"}),content:e.formatMessage({id:"embedding.model.missing.warning",defaultMessage:"嵌入式模型未加载，可能会影响问答质量。是否继续？"}),okText:e.formatMessage({id:"ok",defaultMessage:"确定"}),cancelText:e.formatMessage({id:"cancel",defaultMessage:"取消"}),onOk:function(){Q(!0)}}),t.abrupt("return");case 3:if(!Ce){t.next=6;break}return b.yw.info("正在检查模型状态，请稍后再试"),t.abrupt("return");case 6:Q(!0);case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,i.useEffect)((function(){var e;null===(e=n.current)||void 0===e||e.reloadAndRest()}),[z,D]);var He=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,xe.HK)(s.QPQ,null==O?void 0:O.uid,null==z?void 0:z.uid,s.whQ,{showLoading:!0,loadingMessage:e.formatMessage({id:"loading"}),errorMessage:e.formatMessage({id:"fetch.categories.error",defaultMessage:"Failed to fetch categories"})});case 2:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ne=function(){var t=y()(x()().mark((function t(){var r,a,s,o,i,l;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ee.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),a=0,s=0,o=m()(ee),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,yt.RF)({uid:l.uid});case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的索引")})):b.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的索引，").concat(s," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 34:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Je=function(){var t=y()(x()().mark((function t(){var r,a,s,o,i,l;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==ee.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),a=0,s=0,o=m()(ee),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,(0,yt.YO)({uid:l.uid});case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(a," 条记录的向量索引")})):b.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(a," 条记录的向量索引，").concat(s," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 34:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Qe=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=y()(x()().mark((function t(){var r,a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),t.prev=1,t.next=4,(0,yt.L0)({kbUid:null==z?void 0:z.uid,categoryUid:(null==D?void 0:D.uid)===s.zBg?"":null==D?void 0:D.uid,orgUid:null==O?void 0:O.uid});case 4:r=t.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=n.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Xe=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=y()(x()().mark((function t(){var r,a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),t.prev=1,t.next=4,(0,yt.Bv)({kbUid:null==z?void 0:z.uid,categoryUid:(null==D?void 0:D.uid)===s.zBg?"":null==D?void 0:D.uid,orgUid:null==O?void 0:O.uid});case 4:r=t.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=n.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ke=function(){var e=y()(x()().mark((function e(t,n,r){var a,o;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,n,r),a=localStorage.getItem(s.LA8),o=p()({categoryUid:(null==D?void 0:D.uid)===s.zBg?"":null==D?void 0:D.uid,kbUid:null==z?void 0:z.uid,orgUid:(null==O?void 0:O.uid)||"",accessToken:a||"",exportType:t},Pe),"current"===t?(o.pageNumber=String(C-1),o.pageSize=String(P)):"all"===t?(o.pageNumber="0",o.pageSize="1000"):"range"===t&&void 0!==n&&void 0!==r&&(o.pageNumber=String(n),o.pageSize=String(r)),window.open((0,R.kG)()+"/api/v1/faq/export?"+new URLSearchParams(o).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),We={selectedRowKeys:W,onChange:function(e,t){G(e),te(t)}},Ge=function(){var t=y()(x()().mark((function t(n,r,a){var o,i,l,c,u,f,g,m;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return console.log("request:",n,r,a),b.yw.loading(e.formatMessage({id:"loading",defaultMessage:"Loading"})),o=n.current,i=n.pageSize,l=d()(n,mn),A(o),T(i),Te(l),c=void 0,u=void 0,r&&Object.keys(r).length>0&&(f=Object.keys(r)[0],c=f,u="ascend"===r[f]?"ascend":"descend"),g=p()(p()({pageNumber:o-1,pageSize:i,categoryUid:(null==D?void 0:D.uid)===s.zBg?"":null==D?void 0:D.uid,kbUid:null==z?void 0:z.uid,orgUid:null==O?void 0:O.uid},l),{},{sortBy:c,sortDirection:u}),t.next=12,(0,yt.pf)(g);case 12:return m=t.sent,console.log("queryFaqsByOrg response:",g,m),b.yw.destroy(),200===m.code?ye(m.data.totalElements):b.yw.error(m.message),t.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 17:case"end":return t.stop()}}),t)})));return function(e,n,r){return t.apply(this,arguments)}}(),_e=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Ke("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ke,{onModelStatusChange:function(e){je(e),Ae(!1)}}),(0,Y.jsx)(ie.Z,{columns:ze,actionRef:n,cardBordered:!0,rowSelection:We,request:Ge,scroll:{x:2300},rowKey:"uid",search:{labelWidth:"auto"},pagination:{pageSize:10,onChange:function(e,t){A(e),T(t)}},dateFormatter:"string",headerTitle:t(null==z?void 0:z.name)+" - 常见问题",tooltip:Ce?"正在检查嵌入式模型...":be?"所添加FAQ内容会自动添加到 '拆分' 列表中 ":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){return function(){var t=[];(0,R.Ox)()||t.push((0,Y.jsx)(L.ZP,{icon:(0,Y.jsx)(re.Z,{}),type:"primary",onClick:Be,disabled:Ce,children:e.formatMessage({id:"create"})},"create"),(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"chat.test.tooltip",defaultMessage:"请确认上传内容状态为：处理成功"}),children:(0,Y.jsx)(Fe,{currentKbase:z,currentOrg:O,embeddingModelExists:be,checkingEmbeddingModel:Ce})},"chat"));var n=[];W.length>0&&n.push({key:"batchDelete",icon:(0,Y.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(W.length,")"),onClick:function(){le.Z.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(W.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:qe,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"batchEnable",icon:(0,Y.jsx)(mt.Z,{}),label:e.formatMessage({id:"batch.enable",defaultMessage:"Enable"})+" (".concat(W.length,")"),onClick:function(){return Oe(!0)}},{key:"batchDisable",icon:(0,Y.jsx)(ht.Z,{}),label:e.formatMessage({id:"batch.disable",defaultMessage:"Disable"})+" (".concat(W.length,")"),onClick:function(){return Oe(!1)}},{key:"batchUpdateIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(W.length,")"),onClick:Ne},{key:"batchUpdateVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(W.length,")"),onClick:Je}),n.push({key:"deleteAll",icon:(0,Y.jsx)(ae.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){le.Z.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有问答对数据吗？此操作不可恢复!"}),onOk:Re,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}},{key:"updateAllIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:Qe},{key:"updateAllVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:Xe});var r=[{key:"import",icon:(0,Y.jsx)(xt.Z,{}),label:e.formatMessage({id:"import"}),onClick:Ve,disabled:Ce},{key:"export-current",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Ke("current")}}];return ve>0&&(ve<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ve,"条)"),onClick:function(){return Ke("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ve,"条)"),children:_e(ve)})),r.push({key:"download",icon:(0,Y.jsx)(vt.Z,{}),label:e.formatMessage({id:"download.template"}),onClick:function(){return(0,R.IY)()}}),t.push((0,Y.jsx)(pe.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:"primary",children:[e.formatMessage({id:"import.export",defaultMessage:"导入导出"}),(0,Y.jsx)(oe.Z,{})]})},"importExport")),n.length>0&&t.push((0,Y.jsx)(pe.Z,{menu:{items:n},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:W.length>0?"primary":"default",danger:W.length>0,children:[W.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(W.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(oe.Z,{})]})},"batchOperations")),t}()}}),(0,Y.jsx)(gn,{isEdit:o,open:k,faq:g,onClose:function(){return j(!1)},onSubmit:Ye}),J&&(0,Y.jsx)(he.Z,{type:s.hqx,acceptType:".xlsx,.xls,.csv",isModalOpen:J,handleSubmit:function(e){console.log("handleUploadDragSubmit",e),Q(!1),null==n||n.current.reload(),He()},handleCancel:function(){console.log("handleUploadDragCancel"),Q(!1),null==n||n.current.reload()}})]})};function xn(e){return vn.apply(this,arguments)}function vn(){return(vn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/query/org",{method:"GET",params:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function yn(e){return Mn.apply(this,arguments)}function Mn(){return(Mn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/create",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wn(e){return bn.apply(this,arguments)}function bn(){return(bn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/update",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kn(e){return jn.apply(this,arguments)}function jn(){return(jn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/delete",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Zn(e){return Sn.apply(this,arguments)}function Sn(){return(Sn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/crawl",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Cn(e){return An.apply(this,arguments)}function An(){return(An=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/updateIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Un(e){return In.apply(this,arguments)}function In(){return(In=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/updateVectorIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pn(e){return Tn.apply(this,arguments)}function Tn(){return(Tn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/updateAllIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function En(e){return Fn.apply(this,arguments)}function Fn(){return(Fn=y()(x()().mark((function e(t){return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/llm/webpage/updateAllVectorIndex",{method:"POST",data:p()(p()({},t),{},{channel:s.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var qn=function(e){var t=e.isEdit,n=e.webpage,r=e.open,a=e.onClose,s=e.onSubmit,o=qe.A.useForm(),l=w()(o,1)[0],c=(0,F.j)((function(e){return e.currentKbase})),u=(0,q.u)((function(e){return e.currentOrg})),d=(0,H.v)((function(e){return e.categorySelectOptions})),f=(0,i.useState)(),g=w()(f,2),m=g[0],h=g[1],v=(0,i.useState)([]),M=w()(v,2),b=M[0],k=M[1],j=(0,i.useState)(!1),Z=w()(j,2),S=Z[0],C=Z[1],A=(0,i.useState)(""),U=w()(A,2),I=U[0],P=U[1],T=(0,i.useState)(!1),E=w()(T,2),O=E[0],R=E[1],B=(0,i.useState)(""),V=w()(B,2),N=(V[0],V[1]),J=function(e){return e.filter((function(e){return e&&""!==e.trim()}))},Q=function(){var e=y()(x()().mark((function e(){var t,n,r;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,R(!0),e.next=4,l.validateFields();case 4:t=e.sent,!(n=t.url)||n.startsWith("http://")||n.startsWith("https://")||(n="https://".concat(n)),r=p()(p()({},t),{},{url:n,categoryUid:m,tagList:J(b),kbUid:null==c?void 0:c.uid,orgUid:null==u?void 0:u.uid}),console.log("submit",r),s(r),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(0),console.error("表单校验失败:",e.t0),ye.ZP.error("请检查表单填写是否正确");case 16:return e.prev=16,R(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[0,12,16,19]])})));return function(){return e.apply(this,arguments)}}(),X=function(){var e=I.trim();e&&!b.includes(e)&&k([].concat(Ze()(b),[e])),C(!1),P("")},K=function(){C(!1),P("")};return(0,i.useEffect)((function(){if(t)l.setFieldsValue({uid:null==n?void 0:n.uid,title:null==n?void 0:n.title,url:null==n?void 0:n.url,content:null==n?void 0:n.content,description:null==n?void 0:n.description,categoryUid:null==n?void 0:n.categoryUid}),h(null==n?void 0:n.categoryUid),k(J((null==n?void 0:n.tagList)||[]));else{if(l.setFieldsValue({title:"",url:"",content:"",description:""}),d&&d.length>0){var e=d[0].value;l.setFieldValue("categoryUid",e),h(e)}k([]),C(!1),P("")}}),[t,n,l,d]),(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(z.Z,{title:t?"编辑网页":"添加网页",onClose:a,open:r,width:600,extra:(0,Y.jsxs)(D.Z,{children:[(0,Y.jsx)(L.ZP,{onClick:a,children:"取消"}),(0,Y.jsx)(L.ZP,{type:"primary",onClick:Q,loading:O,children:"提交"})]}),footer:null,children:(0,Y.jsxs)(qe.A,{form:l,name:"webpageForm",submitter:!1,children:[(0,Y.jsx)(Oe.Z,{label:"分类",name:"categoryUid",rules:[{required:!0,message:"请选择分类"}],options:d,fieldProps:{allowClear:!0,placeholder:"请选择分类",onChange:function(e){console.log("webpage category selected ".concat(e)),h(e)}}}),(0,Y.jsx)(Re.Z,{label:"名称",name:"title",rules:[{required:!0,message:"请输入网页名称"}],placeholder:"请输入网页名称"}),(0,Y.jsx)(Re.Z,{label:"URL",name:"url",rules:[{required:!0,message:"请输入网页地址"},{pattern:/^(https?:\/\/)?([\da-z.-]+)\.([a-z.]{2,6})([/\w .-]*)*\/?$/,message:"请输入有效的网址"}],placeholder:"请输入网址，例如：www.example.com",fieldProps:{addonAfter:(0,Y.jsx)(L.ZP,{type:"link",onClick:function(){var e=l.getFieldValue("url");if(e){var t=e;e.startsWith("http://")||e.startsWith("https://")||(t="https://".concat(e)),N(t),window.open(t,"_blank")}else ye.ZP.warning("请输入网址")},children:"预览"})},tooltip:"支持 http 或 https 开头的网址"}),t&&(0,Y.jsx)(ze.Z,{label:"内容",name:"content",placeholder:"网页内容",fieldProps:{maxLength:1e4,showCount:!0,rows:8},tooltip:"网页的文本内容，用于知识库检索"}),(0,Y.jsx)(qe.A.Item,{label:"标签",name:"tagList",tooltip:"为网页添加标签，便于分类和检索",children:(0,Y.jsxs)("div",{style:{minHeight:"32px"},children:[(0,Y.jsx)(D.Z,{wrap:!0,style:{marginBottom:8},children:J(b).map((function(e,t){return(0,Y.jsx)(ue.Z,{closable:!0,color:"blue",onClose:function(){return t=e,void k(J(b.filter((function(e){return e!==t}))));var t},style:{marginBottom:4},children:e},t)}))}),S?(0,Y.jsxs)(D.Z.Compact,{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)(De.Z,{value:I,onChange:function(e){P(e.target.value)},onKeyDown:function(e){"Enter"===e.key?X():"Escape"===e.key&&K()},placeholder:"输入标签名称",size:"small",style:{width:"120px"},autoFocus:!0}),(0,Y.jsx)(L.ZP,{type:"primary",size:"small",icon:(0,Y.jsx)(Le.Z,{}),onClick:X,disabled:!I.trim(),children:"保存"}),(0,Y.jsx)(L.ZP,{size:"small",icon:(0,Y.jsx)(Be.Z,{}),onClick:K,children:"取消"})]}):(0,Y.jsx)(L.ZP,{type:"dashed",onClick:function(){C(!0),P("")},icon:(0,Y.jsx)(re.Z,{}),size:"small",style:{height:"24px"},children:"添加标签"})]})}),(0,Y.jsx)(ze.Z,{label:"描述",name:"description",placeholder:"请输入网页描述",fieldProps:{maxLength:500,showCount:!0}})]})})})},On=["current","pageSize"],Rn=function(){var e=(0,c.useIntl)(),t=(0,E.Z)().translateString,n=(0,i.useRef)(),r=(0,i.useState)(1),a=w()(r,2),o=a[0],l=a[1],u=(0,i.useState)(10),f=w()(u,2),g=f[0],h=f[1],v=(0,q.u)((function(e){return e.currentOrg})),M=(0,F.j)((function(e){return e.currentKbase})),k=(0,H.v)((function(e){return e.currentCategory})),j=(0,H.v)((function(e){return e.categorySelectOptions})),Z=(0,i.useState)(!1),S=w()(Z,2),C=S[0],A=S[1],U=(0,i.useState)({}),I=w()(U,2),P=I[0],T=I[1],O=(0,i.useState)(!1),z=w()(O,2),D=z[0],B=z[1],V=le.Z.useModal(),N=w()(V,2),J=(N[0],N[1]),Q=(0,i.useState)(!1),X=w()(Q,2),K=X[0],W=X[1],G=(0,i.useState)(!1),_=w()(G,2),$=_[0],ee=_[1],te=(0,i.useState)({}),ae=w()(te,2),ge=ae[0],he=ae[1],xe=(0,i.useState)(0),ve=w()(xe,2),ye=ve[0],Me=ve[1],we=(0,i.useState)([]),je=w()(we,2),Ze=je[0],Se=je[1],Ce=(0,i.useState)([]),Ae=w()(Ce,2),Ue=Ae[0],Ie=Ae[1],Pe=function(){var t=y()(x()().mark((function t(r){var a,s,o;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.content&&""!==r.content.trim()){t.next=3;break}return b.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),t.abrupt("return");case 3:return b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),t.prev=4,a={uid:r.uid},t.next=8,Cn(a);case 8:s=t.sent,console.log("更新索引响应:",s,a),b.yw.destroy(),200===s.code?(b.yw.success(e.formatMessage({id:"update.index.success",defaultMessage:"索引更新已触发"})),null===(o=n.current)||void 0===o||o.reload()):b.yw.error(s.message||e.formatMessage({id:"update.index.failed",defaultMessage:"索引更新失败"})),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(4),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.index.error",defaultMessage:"更新索引过程发生错误"})),console.error("更新索引错误:",t.t0);case 19:case"end":return t.stop()}}),t,null,[[4,14]])})));return function(e){return t.apply(this,arguments)}}(),Te=function(){var t=y()(x()().mark((function t(r){var a,s,o;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(r.content&&""!==r.content.trim()){t.next=3;break}return b.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})),t.abrupt("return");case 3:return b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),t.prev=4,a={uid:r.uid},t.next=8,Un(a);case 8:s=t.sent,console.log("更新向量索引响应:",s,a),b.yw.destroy(),200===s.code?(b.yw.success(e.formatMessage({id:"update.vector.index.success",defaultMessage:"向量索引更新已触发"})),null===(o=n.current)||void 0===o||o.reload()):b.yw.error(s.message||e.formatMessage({id:"update.vector.index.failed",defaultMessage:"向量索引更新失败"})),t.next=19;break;case 14:t.prev=14,t.t0=t.catch(4),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.vector.index.error",defaultMessage:"更新向量索引过程发生错误"})),console.error("更新向量索引错误:",t.t0);case 19:case"end":return t.stop()}}),t,null,[[4,14]])})));return function(e){return t.apply(this,arguments)}}(),Ee=function(){var t=y()(x()().mark((function t(r){var a,s,o;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"crawling.content",defaultMessage:"正在抓取网页内容..."})),t.prev=1,a={uid:r.uid},t.next=5,Zn(a);case 5:s=t.sent,console.log("抓取网页内容响应:",s,a),b.yw.destroy(),200===s.code?(b.yw.success(e.formatMessage({id:"crawl.content.success",defaultMessage:"网页内容抓取已触发"})),null===(o=n.current)||void 0===o||o.reload()):b.yw.error(s.message||e.formatMessage({id:"crawl.content.failed",defaultMessage:"网页内容抓取失败"})),t.next=16;break;case 11:t.prev=11,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"crawl.content.error",defaultMessage:"抓取网页内容过程发生错误"})),console.error("抓取网页内容错误:",t.t0);case 16:case"end":return t.stop()}}),t,null,[[1,11]])})));return function(e){return t.apply(this,arguments)}}(),qe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,Y.jsx)(c.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"title",copyable:!0,tooltip:e.formatMessage({id:"webpage.name.tooltip",defaultMessage:"网页的名称或标识"}),width:200,fixed:"left",render:function(e,t){return(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.title}),(0,Y.jsx)(ce.Z.Text,{copyable:{text:(null==t?void 0:t.title)||""}})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"url",defaultMessage:"Url"}),dataIndex:"url",hideInSearch:!0,copyable:!0,width:250,tooltip:e.formatMessage({id:"webpage.url.tooltip",defaultMessage:"网页的URL地址，用于爬取内容"}),render:function(e,t){return(0,Y.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,Y.jsx)("span",{style:{marginRight:4},children:null==t?void 0:t.url}),(0,Y.jsx)(ce.Z.Text,{copyable:{text:(null==t?void 0:t.url)||""}})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"category",defaultMessage:"Category"}),dataIndex:"categoryUid",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"webpage.category.tooltip",defaultMessage:"网页内容所属的分类"}),render:function(e,t){var n=j.find((function(e){return e.value===(null==t?void 0:t.categoryUid)}));return null!=n&&n.label?(0,Y.jsx)(ue.Z,{color:"blue",children:n.label}):(0,Y.jsx)(ue.Z,{color:"default",children:"未分类"})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",hideInSearch:!0,width:120,tooltip:e.formatMessage({id:"webpage.status.tooltip",defaultMessage:"网页索引状态"}),render:function(t,n){var r=n.elasticStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="processing"),(0,Y.jsx)(ue.Z,{color:a,children:e.formatMessage({id:"llm.status.".concat(r.toLowerCase()),defaultMessage:r})})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"vectorStatus",defaultMessage:"Vector Status"}),dataIndex:"vectorStatus",hideInSearch:!0,width:150,tooltip:e.formatMessage({id:"webpage.vectorStatus.tooltip",defaultMessage:"网页内容向量化状态"}),render:function(t,n){var r=n.vectorStatus||"",a="";return"SUCCESS"===r.toUpperCase()?a="success":"ERROR"===r.toUpperCase()||"FAILED"===r.toUpperCase()?a="error":"NEW"===r.toUpperCase()||"PENDING"===r.toUpperCase()?a="default":"PROCESSING"===r.toUpperCase()&&(a="warning"),r?(0,Y.jsx)(ue.Z,{color:a,icon:(0,Y.jsx)(pt.Z,{}),children:e.formatMessage({id:"llm.vectorStatus.".concat(r.toLowerCase()),defaultMessage:r})}):"-"}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,ellipsis:!0,width:200,tooltip:e.formatMessage({id:"webpage.description.tooltip",defaultMessage:"网页的简要描述信息"})},{title:(0,Y.jsx)(c.FormattedMessage,{id:"tags",defaultMessage:"Tags"}),dataIndex:"tagList",hideInSearch:!0,width:150,tooltip:e.formatMessage({id:"webpage.tags.tooltip",defaultMessage:"网页的标签列表"}),render:function(e,t){if(null==t||!t.tagList||0===(null==t?void 0:t.tagList.length))return"-";var n=(null==t?void 0:t.tagList.length)>3,r=null==t?void 0:t.tagList.slice(0,3);return(0,Y.jsxs)("div",{children:[r.map((function(e,t){return(0,Y.jsx)(ue.Z,{color:"green",style:{marginBottom:4},children:e},t)})),n&&(0,Y.jsxs)(ue.Z,{color:"orange",children:["+",(null==t?void 0:t.tagList.length)-3]})]})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",hideInSearch:!0,ellipsis:!0,copyable:!0,width:300,tooltip:e.formatMessage({id:"webpage.content.tooltip",defaultMessage:"爬取的网页内容摘要"}),render:function(t,n){var r=n.content||"-",a=function(){var t=y()(x()().mark((function t(n){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,(0,Ht.TE)(n);case 2:t.sent.success?b.yw.success(e.formatMessage({id:"copy.success",defaultMessage:"复制成功"})):b.yw.error(e.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}));case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();return(0,Y.jsx)(Vt.Z,{content:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,Y.jsx)("span",{children:e.formatMessage({id:"webpage.content.preview",defaultMessage:"网页内容预览"})}),(0,Y.jsx)(L.ZP,{type:"text",icon:(0,Y.jsx)(Qt.Z,{}),onClick:function(e){e.stopPropagation(),a(r)},title:e.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,Y.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:r})]}),title:e.formatMessage({id:"webpage.content",defaultMessage:"网页内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,Y.jsx)("span",{style:{cursor:"pointer"},children:r})})}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180,tooltip:e.formatMessage({id:"webpage.createdAt.tooltip",defaultMessage:"网页记录创建的时间"}),render:function(e,t,n,r){return me()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,Y.jsx)(c.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180,tooltip:e.formatMessage({id:"webpage.updatedAt.tooltip",defaultMessage:"网页记录更新的时间"}),render:function(e,t){return t.updatedAt?me()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],Oe=[].concat(qe,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:220,fixed:"right",render:function(t,n,r,a){return[(0,Y.jsx)("a",{onClick:function(){T(n),B(!0),A(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,Y.jsx)(fe.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n.title,"】？"),onConfirm:function(){return Re(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,Y.jsx)(gt.Z,{style:{color:"red"}}),children:(0,Y.jsx)(L.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})},"delete")},"delete"),(0,Y.jsx)(pe.Z,{menu:{items:[{key:"crawlContent",icon:(0,Y.jsx)(vt.Z,{}),label:e.formatMessage({id:"crawl.content",defaultMessage:"抓取内容"}),onClick:function(){return Ee(n)}},{key:"updateIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"update.index",defaultMessage:"更新索引"}),onClick:function(){return Pe(n)}},{key:"updateVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"update.vector.index",defaultMessage:"更新向量索引"}),onClick:function(){return Te(n)}}]},placement:"bottomRight",children:(0,Y.jsx)(de.Z,{title:e.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),children:(0,Y.jsxs)(L.ZP,{size:"small",type:"link",children:[e.formatMessage({id:"content.operations",defaultMessage:"内容操作"}),(0,Y.jsx)(oe.Z,{})]})})},"indexOperations")]}}]);(0,i.useEffect)((function(){var e;null==n||null===(e=n.current)||void 0===e||e.reload()}),[M,k]);var Re=function(){var t=y()(x()().mark((function t(r){var a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,kn(r);case 2:200===(a=t.sent).code?(b.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),n.current.reload()):b.yw.error(a.message);case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),ze=function(){var e=y()(x()().mark((function e(t){var r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,yn(t);case 2:200===(r=e.sent).code?(null===(a=n.current)||void 0===a||a.reload(),A(!1)):b.yw.error(r.message);case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),De=function(){var e=y()(x()().mark((function e(t){var r,a;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==P?void 0:P.uid,e.next=3,wn(t);case 3:200===(r=e.sent).code?(null===(a=n.current)||void 0===a||a.reload(),A(!1)):b.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Le=function(){K?$?b.yw.info("正在检查模型状态，请稍后再试"):(A(!0),B(!1),T({})):le.Z.warning({title:"嵌入式模型缺失",content:"请首先拉取Embedding向量模型bge-m3:latest，用于知识库向量检索",okText:"确定"})},Be=function(){var t=y()(x()().mark((function t(){var r,a,s,o,i,l;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Ue.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),t.abrupt("return");case 3:b.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,s=0,o=m()(Ue),t.prev=7,o.s();case 9:if((i=o.n()).done){t.next=23;break}return l=i.value,t.prev=11,t.next=14,kn(l);case 14:200===t.sent.code?a++:s++,t.next=21;break;case 18:t.prev=18,t.t0=t.catch(11),s++;case 21:t.next=9;break;case 23:t.next=28;break;case 25:t.prev=25,t.t1=t.catch(7),o.e(t.t1);case 28:return t.prev=28,o.f(),t.finish(28);case 31:b.yw.destroy(),0===s?b.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 项"},{count:a})):b.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 项，但有 {fail} 项删除失败"},{success:a,fail:s})),Se([]),Ie([]),null===(r=n.current)||void 0===r||r.reloadAndRest();case 36:case"end":return t.stop()}}),t,null,[[7,25,28,31],[11,18]])})));return function(){return t.apply(this,arguments)}}(),Ye=function(){var t=y()(x()().mark((function t(){var r,a,s,o,i,l,c;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Ue.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:if(a=Ue.filter((function(e){return!e.content||""===e.content.trim()})),!(a.length>0)){t.next=7;break}return b.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(a.length,"条记录)")),t.abrupt("return");case 7:b.yw.loading(e.formatMessage({id:"updating.index",defaultMessage:"正在更新索引..."})),s=0,o=0,i=m()(Ue),t.prev=11,i.s();case 13:if((l=i.n()).done){t.next=27;break}return c=l.value,t.prev=15,t.next=18,Cn({uid:c.uid});case 18:200===t.sent.code?s++:o++,t.next=25;break;case 22:t.prev=22,t.t0=t.catch(15),o++;case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t1=t.catch(11),i.e(t.t1);case 32:return t.prev=32,i.f(),t.finish(32);case 35:b.yw.destroy(),0===o?b.yw.success(e.formatMessage({id:"batch.update.index.success"},{defaultMessage:"成功更新 ".concat(s," 条记录的索引")})):b.yw.error(e.formatMessage({id:"batch.update.index.partial"},{defaultMessage:"更新了 ".concat(s," 条记录的索引，").concat(o," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 38:case"end":return t.stop()}}),t,null,[[11,29,32,35],[15,22]])})));return function(){return t.apply(this,arguments)}}(),Ve=function(){var t=y()(x()().mark((function t(){var r,a,s,o,i,l,c;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(0!==Ue.length){t.next=3;break}return b.yw.warning(e.formatMessage({id:"batch.update.noselection",defaultMessage:"请选择要更新的项目"})),t.abrupt("return");case 3:if(a=Ue.filter((function(e){return!e.content||""===e.content.trim()})),!(a.length>0)){t.next=7;break}return b.yw.warning(e.formatMessage({id:"content.empty.crawl.first",defaultMessage:"内容为空，请先抓取内容"})+" (".concat(a.length,"条记录)")),t.abrupt("return");case 7:b.yw.loading(e.formatMessage({id:"updating.vector.index",defaultMessage:"正在更新向量索引..."})),s=0,o=0,i=m()(Ue),t.prev=11,i.s();case 13:if((l=i.n()).done){t.next=27;break}return c=l.value,t.prev=15,t.next=18,Un({uid:c.uid});case 18:200===t.sent.code?s++:o++,t.next=25;break;case 22:t.prev=22,t.t0=t.catch(15),o++;case 25:t.next=13;break;case 27:t.next=32;break;case 29:t.prev=29,t.t1=t.catch(11),i.e(t.t1);case 32:return t.prev=32,i.f(),t.finish(32);case 35:b.yw.destroy(),0===o?b.yw.success(e.formatMessage({id:"batch.update.vector.index.success"},{defaultMessage:"成功更新 ".concat(s," 条记录的向量索引")})):b.yw.error(e.formatMessage({id:"batch.update.vector.index.partial"},{defaultMessage:"更新了 ".concat(s," 条记录的向量索引，").concat(o," 条记录更新失败")})),null===(r=n.current)||void 0===r||r.reload();case 38:case"end":return t.stop()}}),t,null,[[11,29,32,35],[15,22]])})));return function(){return t.apply(this,arguments)}}(),He=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.index.confirm.title",defaultMessage:"更新全部索引确认"}),content:e.formatMessage({id:"updateAll.index.confirm.content",defaultMessage:"确定要更新所有记录的索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=y()(x()().mark((function t(){var r,a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.index",defaultMessage:"正在更新所有索引..."})),t.prev=1,t.next=4,Pn({kbUid:null==M?void 0:M.uid,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,orgUid:null==v?void 0:v.uid});case 4:r=t.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.index.success",defaultMessage:"所有索引更新请求已发送"})),null===(a=n.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.index.failed",defaultMessage:"所有索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.index.error",defaultMessage:"更新所有索引过程发生错误"})),console.error("更新所有索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Ne=function(){var t=y()(x()().mark((function t(){return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:le.Z.confirm({title:e.formatMessage({id:"updateAll.vector.index.confirm.title",defaultMessage:"更新全部向量索引确认"}),content:e.formatMessage({id:"updateAll.vector.index.confirm.content",defaultMessage:"确定要更新所有记录的向量索引吗？此操作可能需要一些时间。"}),onOk:function(){var t=y()(x()().mark((function t(){var r,a;return x()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return b.yw.loading(e.formatMessage({id:"updating.all.vector.index",defaultMessage:"正在更新所有向量索引..."})),t.prev=1,t.next=4,En({kbUid:null==M?void 0:M.uid,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,orgUid:null==v?void 0:v.uid});case 4:r=t.sent,b.yw.destroy(),200===r.code?(b.yw.success(e.formatMessage({id:"update.all.vector.index.success",defaultMessage:"所有向量索引更新请求已发送"})),null===(a=n.current)||void 0===a||a.reload()):b.yw.error(r.message||e.formatMessage({id:"update.all.vector.index.failed",defaultMessage:"所有向量索引更新请求失败"})),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(1),b.yw.destroy(),b.yw.error(e.formatMessage({id:"update.all.vector.index.error",defaultMessage:"更新所有向量索引过程发生错误"})),console.error("更新所有向量索引错误:",t.t0);case 14:case"end":return t.stop()}}),t,null,[[1,9]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Je=function(){var e=y()(x()().mark((function e(t,n,r){var a,i;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=localStorage.getItem(s.LA8),i=p()({categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:(null==v?void 0:v.uid)||"",accessToken:a||"",exportType:t},ge),"current"===t?(i.pageNumber=o-1,i.pageSize=g):"all"===t?(i.pageNumber=0,i.pageSize=1e3):"range"===t&&void 0!==n&&void 0!==r&&(i.pageNumber=n,i.pageSize=r),window.open((0,R.kG)()+"/api/v1/webpage/export?"+new URLSearchParams(Object.entries(i).reduce((function(e,t){var n=w()(t,2),r=n[0],a=n[1];return e[r]=String(a),e}),{})).toString());case 4:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Qe=function(e){for(var t=[],n=1e3,r=Math.ceil(e/n),a=function(){var r=s,a=s*n+1,o=Math.min((s+1)*n,e);t.push({key:"export-".concat(s),label:"".concat(a,"-").concat(o," (").concat(o-a+1,"条)"),onClick:function(){return Je("range",r,n)}})},s=0;s<r;s++)a();return t};return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(ke,{onModelStatusChange:function(e){W(e),ee(!1)}}),(0,Y.jsx)(ie.Z,{columns:Oe,actionRef:n,cardBordered:!0,scroll:{x:2200},rowSelection:{selectedRowKeys:Ze,onChange:function(e,t){Se(e),Ie(t)}},request:function(){var e=y()(x()().mark((function e(t,n,r){var a,o,i,c,u,f,g,m;return x()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,o=t.pageSize,i=d()(t,On),l(a),h(o),he(i),c=void 0,u=void 0,n&&Object.keys(n).length>0&&(f=Object.keys(n)[0],c=f,u="ascend"===n[f]?"ascend":"descend"),g=p()(p()({pageNumber:a-1,pageSize:o,categoryUid:(null==k?void 0:k.uid)===s.zBg?"":null==k?void 0:k.uid,kbUid:null==M?void 0:M.uid,orgUid:null==v?void 0:v.uid},i),{},{sortBy:c,sortDirection:u}),e.next=10,xn(g);case 10:return m=e.sent,console.log("queryWebpagesByOrg: ",m,g),200===m.code?Me(m.data.totalElements):b.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:t(null==M?void 0:M.name)+" - 网页爬虫",tooltip:$?"正在检查嵌入式模型...":K?"添加网页后会自动爬取内容并添加到知识库":"请首先拉取Embedding向量模型bge-m3:latest",toolBarRender:function(){var t=[(0,Y.jsx)(L.ZP,{type:"primary",icon:(0,Y.jsx)(re.Z,{}),onClick:function(){return be(Le,K,$)},disabled:$||!K,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create"),(0,Y.jsx)(Fe,{currentKbase:M,currentOrg:v,embeddingModelExists:K,checkingEmbeddingModel:$||!K},"chat")],n=[];Ze.length>0&&n.push({key:"batchDelete",icon:(0,Y.jsx)(ne.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete",defaultMessage:"批量删除"})+" (".concat(Ze.length,")"),onClick:function(){}},{key:"batchUpdateIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.index",defaultMessage:"更新索引"})+" (".concat(Ze.length,")"),onClick:Ye},{key:"batchUpdateVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"batch.update.vector.index",defaultMessage:"更新向量索引"})+" (".concat(Ze.length,")"),onClick:Ve}),n.push({key:"updateAllIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.index",defaultMessage:"更新所有索引"}),onClick:He},{key:"updateAllVectorIndex",icon:(0,Y.jsx)(pt.Z,{}),label:e.formatMessage({id:"updateAll.vector.index",defaultMessage:"更新所有向量索引"}),onClick:Ne});var r=[{key:"export-current",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return Je("current")}}];return ye>0&&(ye<=1e3?r.push({key:"export-all",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ye,"条)"),onClick:function(){return Je("all")}}):r.push({key:"export-range",icon:(0,Y.jsx)(se.Z,{}),label:e.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ye,"条)"),children:Qe(ye)})),t.push((0,Y.jsx)(pe.Z,{menu:{items:r},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:"primary",icon:(0,Y.jsx)(se.Z,{}),children:[e.formatMessage({id:"export.options",defaultMessage:"导出"}),(0,Y.jsx)(oe.Z,{})]})},"exportDropdown")),n.length>0&&t.push((0,Y.jsx)(fe.Z,{title:e.formatMessage({id:"batch.deleteTip",defaultMessage:"批量删除确认"}),description:"".concat(e.formatMessage({id:"batch.deleteAffirm",defaultMessage:"确定要删除"})," ").concat(Ze.length," ").concat(e.formatMessage({id:"items",defaultMessage:"项"}),"?"),onConfirm:Be,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,Y.jsx)(gt.Z,{style:{color:"red"}}),disabled:0===Ze.length,children:(0,Y.jsx)(pe.Z,{menu:{items:n},placement:"bottom",children:(0,Y.jsxs)(L.ZP,{type:Ze.length>0?"primary":"default",danger:Ze.length>0,children:[Ze.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(Ze.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,Y.jsx)(oe.Z,{})]})},"batchOperations")},"batchDeleteConfirm")),t}}),C&&(0,Y.jsx)(qn,{isEdit:D,open:C,webpage:P,onClose:function(){A(!1)},onSubmit:function(e){D?De(e):ze(e)}}),J]})};var zn=function(){var e=(0,c.useIntl)(),t=(0,i.useMemo)((function(){var t=[{key:"faq",label:e.formatMessage({id:"pages.robot.kb.faq",defaultMessage:"Q&A"}),children:(0,Y.jsx)(hn,{})}];return(0,R.OJ)()&&t.push({key:"text",label:e.formatMessage({id:"pages.robot.kb.text",defaultMessage:"Text"}),children:(0,Y.jsx)(jt,{})},{key:"file",label:e.formatMessage({id:"pages.robot.kb.file",defaultMessage:"File"}),children:(0,Y.jsx)(He,{})},{key:"split",label:e.formatMessage({id:"pages.robot.kb.split",defaultMessage:"Split"}),children:(0,Y.jsx)(Kt,{})},{key:"webpage",label:e.formatMessage({id:"pages.robot.kb.webpage",defaultMessage:"Webpage Crawling"}),children:(0,Y.jsx)(Rn,{})}),t}),[e]);return(0,Y.jsx)(Y.Fragment,{children:(0,Y.jsx)(l.Z,{items:t})})},Dn=a.Z.Sider,Ln=a.Z.Content,Bn=function(){var e=(0,r.Z)(),t=e.leftSiderWidth,n=e.leftSiderStyle,i=e.contentStyle,l=(0,F.j)((function(e){return{currentKbase:e.currentKbase}})).currentKbase,c=!(null!=l&&l.subType)||l.subType===s.cmo;return(0,Y.jsx)("div",{children:(0,Y.jsxs)(a.Z,{children:[c&&(0,Y.jsx)(Dn,{width:t,style:n,children:(0,Y.jsx)(o.Z,{type:s.QPQ})}),(0,Y.jsx)(a.Z,{children:(0,Y.jsx)(Ln,{style:i,children:null!=l&&l.subType&&l.subType!==s.cmo?(l.subType,(0,Y.jsx)(zn,{})):(0,Y.jsx)(zn,{})})})]})})}}}]);