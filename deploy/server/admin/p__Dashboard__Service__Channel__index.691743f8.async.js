"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[5131],{76750:function(e,n,t){var r=t(55735),a=t(65461),s=t(41159);n.Z=function(){var e=(0,s.useIntl)();return{translateString:function(n){return null==n?n:n&&(null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_"))?e.formatMessage({id:n,defaultMessage:n}):n},translateStringTranct:function(n){return null==n?n:null!=n&&n.startsWith(r.VoP)||null!=n&&n.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:n,defaultMessage:n}),10):(0,a.aS)(n,10)}}}},19496:function(e,n,t){t.r(n),t.d(n,{default:function(){return ns}});var r=t(96865),a=t(75574),s=t(45332),i=t.n(s),o=t(23864),l=t(73193),c=t.n(l),u=t(76711),d=t.n(u),p=t(55735),f=t(44435),h=t(83642),m=t(83890),g=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{llmproviderResult:{data:{content:[]}},currentChannel:{name:"web",nickname:"网站/H5"},currentType:p.aZD,insertChannel:function(n){e((function(e){e.llmproviderResult.data.content.unshift(n)}))},setChannelResult:function(t){e({llmproviderResult:t});var r,a=n().currentChannel;""!==a.uid&&void 0!==a||(null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentChannel:t.data.content[0]})},setCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().llmproviderResult),{},{data:{content:s}});e({llmproviderResult:i,currentChannel:t})}else e({currentChannel:t})},setCurrentType:function(n){e({currentType:n})},deleteCurrentChannel:function(t){var r=n().llmproviderResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({llmproviderResult:c()(c()({},n().llmproviderResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Channel not found in cache:",t),n().currentChannel.uid===t&&e({currentChannel:{uid:""}})},deleteChannelCache:function(){return e({},!0)}}})),{name:p.uCV}))),x=t(9452),y=t(44194),v=t(36310),j=t(31549),w=[{name:"web",nickname:"网站/H5"},{name:"npm",nickname:"Npm包"}],k=function(){var e=(0,o.Z)().isDarkMode,n=(0,y.useState)([]),t=i()(n,2),r=t[0],a=t[1],s=g((function(e){return{currentChannel:e.currentChannel,setCurrentChannel:e.setCurrentChannel}})),l=s.currentChannel,c=s.setCurrentChannel;return(0,y.useEffect)((function(){var e=[].concat(w);!(0,v.Ox)()&&(0,v.OJ)()&&e.push({name:"app",nickname:"App应用"},{name:"wechat-app",nickname:"微信应用"},{name:"messenger",nickname:"Messenger(开发中)"},{name:"instagram",nickname:"Instagram(开发中)"},{name:"whatsapp",nickname:"Whatsapp(开发中)"},{name:"telegram",nickname:"Telegram(开发中)"},{name:"line",nickname:"Line(开发中)"},{name:"email",nickname:"Email(开发中)"}),a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:r,renderItem:function(n,t){return(0,j.jsx)(x.Z.Item,{style:(null==l?void 0:l.name)===n.name?{backgroundColor:e?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){c(n)},children:(0,j.jsx)(x.Z.Item.Meta,{title:(0,j.jsx)("div",{style:{marginLeft:10},children:n.nickname})})})}})})},Z=t(8247),b=t(41159),A=function(){var e=(0,b.useAccess)();return e.canDebug&&console.log("Developing canDebug"),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(b.Access,{accessible:e.canDebug(),fallback:(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(b.FormattedMessage,{id:p.h5w})}),children:"can debug"})})},M=t(90819),C=t.n(M),I=t(89933),S=t.n(I),E=t(10154),T=t.n(E),R=t(86803);function P(e){return W.apply(this,arguments)}function W(){return(W=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function F(e){return q.apply(this,arguments)}function q(){return(q=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function L(e){return D.apply(this,arguments)}function D(){return(D=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function z(e){return V.apply(this,arguments)}function V(){return(V=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function U(e){return N.apply(this,arguments)}function N(){return(N=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){return K.apply(this,arguments)}function K(){return(K=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/wechat/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var _=t(40612),B=t(15722),Y=t(82669),G=t(80556),H=t(59304),J=t(54881),X=t(2484),Q=t(53530),$=t(27487),ee=t(75365),ne=t(96485),te=t(76750),re=t(72614),ae=t(95490),se=t(69169),ie=t(4499),oe=t(84881),le=t(73442),ce=t(3849),ue="MP",de="MINI",pe="WORK",fe="KEFU",he=function(e){var n,t=e.isEdit,r=e.wechatApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||pe,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:pe,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:ue},{label:"微信小程序",value:de},{label:"企业微信",value:pe},{label:"微信客服",value:fe}],fieldProps:{defaultValue:pe},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===pe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===pe?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},me=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{wechatAppResult:{data:{content:[]}},currentWechatApp:{uid:"",nickname:"",avatar:"",description:""},insertWechatApp:function(n){e((function(e){e.wechatAppResult.data.content.unshift(n)}))},updateWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},deleteWechatApp:function(n){e((function(e){var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WechatApp with uid ".concat(n.uid," not found."))}))},setWechatAppResult:function(t){var r;(e({wechatAppResult:t}),""===n().currentWechatApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWechatApp:t.data.content[0]}))},setCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().wechatAppResult),{},{data:{content:s}});e({wechatAppResult:i,currentWechatApp:t})}else console.warn("WechatApp with the specified uid not found."),e({currentWechatApp:t})},refreshCurrentWechatApp:function(n){e((function(e){e.currentWechatApp=c()(c()({},e.currentWechatApp),n);var t=e.wechatAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWechatApp:function(t){var r=n().wechatAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({wechatAppResult:c()(c()({},n().wechatAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WechatApp not found in cache:",t),n().currentWechatApp.uid===t&&e({currentWechatApp:{uid:""}})},deleteWechatAppCache:function(){return e({},!0)}}})),{name:p.x1y}))),ge=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),xe=function(e){e.type;var n=(0,b.useIntl)(),t=(0,y.useRef)(!1),r=(0,te.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,s=(0,y.useState)(!1),l=i()(s,2),c=l[0],u=l[1],d=(0,y.useState)(!1),p=i()(d,2),f=p[0],h=p[1],m=(0,y.useState)(!1),g=i()(m,2),v=g[0],w=g[1],k=(0,_.u)((function(e){return e.currentOrg})),Z=me((function(e){return{wechatAppResult:e.wechatAppResult,currentWechatApp:e.currentWechatApp,setWechatAppResult:e.setWechatAppResult,insertWechatApp:e.insertWechatApp,setCurrentWechatApp:e.setCurrentWechatApp,deleteCurrentWechatApp:e.deleteCurrentWechatApp}})),A=Z.wechatAppResult,M=Z.currentWechatApp,I=Z.setWechatAppResult,E=Z.insertWechatApp,T=Z.setCurrentWechatApp,W=Z.deleteCurrentWechatApp,F=Q.Z.useModal(),q=i()(F,2),D=q[0],V=q[1],N=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete wechatApp",t),R.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,U(t);case 4:r=e.sent,console.log("delete wechatApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==k?void 0:k.uid},e.next=8,P(n);case 8:r=e.sent,console.log("getWechatApps",r),200===r.code?(R.yw.destroy(),I(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){O();var e=function(e){h(!0),u(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var K=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),w(!0),e.prev=2,!f){e.next=8;break}return e.next=6,ae(n);case 6:e.next=10;break;case 8:return e.next=10,re(n);case 10:return e.prev=10,w(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,L(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateWechatApp response:",t),200===t.code?(E(t.data),T(t.data),u(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==M?void 0:M.uid,R.yw.loading("正在更新..."),e.next=4,z(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateWechatApp response:",t),200===t.code?(T(t.data),u(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){u(!0),h(!1)},children:n.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:O,children:n.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==M?void 0:M.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:n.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){h(!0),u(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:n.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=M,void D.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){N(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})});var e}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:M.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){T(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",ge[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,j.jsx)(he,{isEdit:f,open:c,loading:v,wechatApp:M,onClose:function(){u(!1)},onSubmit:K}),V]})},ye=t(32327),ve=t(62673),je=t(73589),we=t(29266),ke=t(19116),Ze=t(88996),be=t(38775),Ae=t(83337),Me=t(34600),Ce=t(15892),Ie=t(54800),Se=t(32693),Ee=t(5716),Te=t(90297),Re=t(34545),Pe=t(28977),We=t.n(Pe),Fe=ye.Z.Text,qe=ye.Z.Paragraph,Le=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),De=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Ae.Z,{})),p.qRy,(0,j.jsx)(Me.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),ze={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},Ve={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},Ue=function(){var e,n=(0,b.useIntl)(),t=me((function(e){return{currentWechatApp:e.currentWechatApp,refreshCurrentWechatApp:e.refreshCurrentWechatApp}})),r=t.currentWechatApp,a=t.refreshCurrentWechatApp,s=(0,y.useState)(!1),o=i()(s,2),l=o[0],c=o[1],u=(0,y.useState)(!1),d=i()(u,2),p=d[0],f=d[1],h=(0,y.useState)(!1),m=i()(h,2),g=m[0],x=m[1],w=(0,y.useState)(!1),k=i()(w,2),Z=k[0],A=k[1],M=(0,y.useState)(!1),I=i()(M,2),E=(I[0],I[1],(0,y.useState)(!1)),T=i()(E,2),P=T[0],W=T[1],q=(0,y.useState)(!1),L=i()(q,2),D=L[0],z=L[1],V=function(e,n){return e?n?e:"******":"-"},U=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return W(!0),e.prev=4,e.next=7,O({uid:r.uid});case 7:n=e.sent,console.log("refreshAccessTokenWechatApp response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),a&&a(n.data),N()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,W(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return z(!0),e.prev=4,e.next=7,F({uid:r.uid});case 7:n=e.sent,console.log("queryWechatAppByUid refresh detail",n),200===n.code?(t=n.data,R.yw.success("应用详情刷新成功"),a&&a(t)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,z(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[De[r.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:r.name||"微信应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:Le[r.type]||r.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:N,loading:D,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Fe,{copyable:!0,children:r.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:Le[r.type]||r.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID/企业ID",children:(0,j.jsx)(Fe,{copyable:!0,children:r.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fe,{copyable:!!p&&{text:r.appSecret||""},children:V(r.appSecret,p)}),(0,j.jsx)(Ze.Z,{title:p?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:p?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return f(!p)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"加密模式",children:(0,j.jsx)(we.Z,{color:Ve[r.encryptMode]||"default",children:ze[r.encryptMode]||r.encryptMode})}),(0,j.jsx)(ke.Z.Item,{label:"URL",children:(0,j.jsx)(Fe,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==r||null===(e=r.type)||void 0===e?void 0:e.toLowerCase())+"/webhooks/"+r.uid})}),(0,j.jsx)(ke.Z.Item,{label:"Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fe,{copyable:!!g&&{text:r.token||""},children:V(r.token,g)}),(0,j.jsx)(Ze.Z,{title:g?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:g?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return x(!g)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fe,{copyable:!!Z&&{text:r.encodingAesKey||""},children:V(r.encodingAesKey,Z)}),(0,j.jsx)(Ze.Z,{title:Z?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(ee.ZP,{type:"text",icon:Z?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return A(!Z)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(Fe,{copyable:!!l&&{text:r.accessToken||""},children:V(r.accessToken,l)}),(0,j.jsx)(Ze.Z,{title:l?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:l?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return c(!l)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Re.Z,{}),onClick:U,size:"small",loading:P,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:r.accessTokenExpiresAt?We()(r.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),r.description&&(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(qe,{children:r.description})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?We()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(qe,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,title:"微信应用详情",extra:(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work","_blank")},type:"link",children:"文档"}),children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个微信应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Ne=function(e){console.log(e)},Oe=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Ue,{})}],Ke=function(e){e.type;var n=(0,y.useState)(Oe),t=i()(n,2),r=t[0],a=t[1];return(0,y.useEffect)((function(){var e=[].concat(Oe);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:Ne})})},_e=a.Z.Sider,Be=a.Z.Content,Ye=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(_e,{width:i,style:s,children:(0,j.jsx)(xe,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Be,{children:(0,j.jsx)(Ke,{type:n})})})]})},Ge=t(24170),He=t(91723),Je=t(67402),Xe=t(71529),Qe=function(e){var n=e.platform,t=void 0===n?"react":n,r=(0,b.useIntl)(),a=(0,y.useState)(t),s=i()(a,2),o=s[0],l=s[1],c=o.charAt(0).toUpperCase()+o.slice(1),u="vanilla"===o?"BytedeskVanilla":"Bytedesk".concat(c);return(0,j.jsxs)("div",{style:{maxWidth:"800px"},children:[(0,j.jsxs)("div",{style:{marginBottom:"20px",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,j.jsx)("h2",{children:(0,j.jsx)("a",{href:"https://github.com/Bytedesk/bytedesk-web",target:"_blank",rel:"noopener noreferrer",children:r.formatMessage({id:"install.guide.github"})})}),(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Xe.Z,{}),href:"".concat("https://www.weiyuai.cn/docs/zh-CN/docs/channel/").concat("vanilla"===o?"web":o),target:"_blank",children:r.formatMessage({id:"install.guide.docs"},{platform:"vanilla"===o?"Web":o.charAt(0).toUpperCase()+o.slice(1)})})]}),(0,j.jsx)(be.Z,{orientation:"left",children:"选择框架"}),(0,j.jsx)(Je.ZP.Group,{options:[{label:"React",value:"react"},{label:"Vue",value:"vue"},{label:"Svelte",value:"svelte"},{label:"Vanilla",value:"vanilla"}],value:o,onChange:function(e){l(e.target.value)},optionType:"button",buttonStyle:"solid",style:{marginBottom:"20px"}}),(0,j.jsx)("h2",{children:r.formatMessage({id:"install.guide.steps"})}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step1.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"npm install bytedesk-web\n# ".concat(r.formatMessage({id:"install.guide.step1.or"}),"\nyarn add bytedesk-web")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step2.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:function(){switch(o){case"react":return"import { BytedeskReact } from 'bytedesk-web/react';\nimport type { BytedeskConfig } from 'bytedesk-web/react';";case"vue":return"import { BytedeskVue } from 'bytedesk-web/vue';\nimport type { BytedeskConfig } from 'bytedesk-web/vue';";case"svelte":return"import { BytedeskSvelte } from 'bytedesk-web/svelte';\nimport type { BytedeskConfig } from 'bytedesk-web/svelte';";default:return"import { BytedeskVanilla } from 'bytedesk-web';\nimport type { BytedeskConfig } from 'bytedesk-web';"}}()})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step3.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const config: BytedeskConfig = {\n  placement: 'bottom-right',\n  marginBottom: 20,\n  marginSide: 20,\n  chatConfig: {\n    org: 'df_org_uid',  // ".concat(r.formatMessage({id:"install.guide.step3.org.comment"}),"\n    t: \"2\",\n    sid: 'df_rt_uid'    // ").concat(r.formatMessage({id:"install.guide.step3.sid.comment"}),"\n  }\n};")})]}),(0,j.jsxs)("div",{style:{marginBottom:"20px"},children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step4.title"})}),(0,j.jsx)("pre",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px"},children:"const App = () => {\n  const handleInit = () => {\n    console.log('".concat(function(){switch(o){case"react":return"BytedeskReact";case"vue":return"BytedeskVue";case"svelte":return"BytedeskSvelte";default:return"BytedeskVanilla"}}()," initialized');\n  };\n\n  return (\n    <div>\n      <").concat(u," {...config} onInit={handleInit} />\n      <button onClick={() => (window as any).bytedesk?.showChat()}>\n        ").concat(r.formatMessage({id:"install.guide.step4.open.chat"}),"\n      </button>\n    </div>\n  );\n};")})]}),(0,j.jsxs)("div",{children:[(0,j.jsx)("h3",{children:r.formatMessage({id:"install.guide.step5.title"})}),(0,j.jsxs)("ul",{style:{background:"#dddddd",padding:"15px",borderRadius:"4px",lineHeight:"1.6"},children:[(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.showChat()"})," - ",r.formatMessage({id:"install.guide.step5.show"})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)("code",{children:"(window as any).bytedesk?.hideChat()"})," - ",r.formatMessage({id:"install.guide.step5.hide"})]})]})]})]})},$e=t(1902),en=ye.Z.Title,nn=ye.Z.Text,tn=function(e){var n=e.channel,t=((0,y.useRef)(!1),(0,te.Z)().translateString),r=g((function(e){return{currentType:e.currentType,setCurrentType:e.setCurrentType}})),a=r.currentType,s=r.setCurrentType,o=(0,_.u)((function(e){return e.currentOrg})),l=[{label:"一对一",value:p.Njn},{label:"技能组",value:p.aZD}],c=(0,$e.E)((function(e){return{agentResult:e.agentResult,currentAgent:e.currentAgent,setAgentResult:e.setAgentResult,setCurrentAgent:e.setCurrentAgent}})),u=c.agentResult,d=c.currentAgent,f=c.setAgentResult,h=c.setCurrentAgent,m=(0,y.useState)([]),x=i()(m,2),v=x[0],w=x[1],k=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,currentWorkgroup:e.currentWorkgroup,setWorkgroupResult:e.setWorkgroupResult,setCurrentWorkgroup:e.setCurrentWorkgroup}})),Z=k.workgroupResult,b=k.currentWorkgroup,A=k.setWorkgroupResult,M=k.setCurrentWorkgroup,I=(0,y.useState)(null==d?void 0:d.uid),E=i()(I,2),T=E[0],P=E[1],W=(0,y.useState)(null==b?void 0:b.uid),F=i()(W,2),q=F[0],L=F[1],D=(0,y.useState)([]),z=i()(D,2),V=z[0],U=z[1],N=function(){var e=S()(C()().mark((function e(){var n,r,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,Ge._t)(n);case 4:r=e.sent,console.log("queryAgentsByOrg: ",r),200===r.code?(R.yw.destroy(),f(r),r.data.content.length>0&&(h(r.data.content[0]),P(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),w(a)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(){var n,r,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==o?void 0:o.uid},e.next=4,(0,re.LE)(n);case 4:r=e.sent,console.log("getWorkgroups",r),200===r.code?(R.yw.destroy(),A(r),r.data.content.length>0&&(M(r.data.content[0]),L(r.data.content[0].uid)),a=[],r.data.content.forEach((function(e){var n={label:t(e.nickname),value:e.uid};a.push(n)})),U(a)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){N(),O()}),[a]);var K=["web","npm","ios","android","flutter","uniapp"].includes((null==n?void 0:n.name)||"");return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(Je.ZP.Group,{onChange:function(e){console.log("radio type checked:".concat(e.target.value)),s(e.target.value)},options:l,defaultValue:a,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)("br",{}),(0,j.jsx)("br",{}),a===p.Njn&&(null==d?void 0:d.uid)&&(0,j.jsx)(Je.ZP.Group,{onChange:function(e){console.log("radio agent checked:".concat(e.target.value));var n=u.data.content.find((function(n){return n.uid===e.target.value}));h(n)},options:v,defaultValue:T,optionType:"button",buttonStyle:"solid"}),a===p.aZD&&(null==d?void 0:d.uid)&&(0,j.jsx)(Je.ZP.Group,{onChange:function(e){console.log("radio workgroup checked:".concat(e.target.value));var n=Z.data.content.find((function(n){return n.uid===e.target.value}));M(n)},options:V,defaultValue:q,optionType:"button",buttonStyle:"solid"}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(en,{level:5,children:"组织orgUid"}),(0,j.jsx)(nn,{code:!0,copyable:!0,children:null==o?void 0:o.uid}),(0,j.jsx)(en,{level:5,children:"一对一当前客服Uid"}),(0,j.jsx)(nn,{code:!0,copyable:!0,children:null==d?void 0:d.uid}),(0,j.jsx)(en,{level:5,children:"当前技能组Uid"}),(0,j.jsx)(nn,{code:!0,copyable:!0,children:null==b?void 0:b.uid}),(0,j.jsx)(be.Z,{}),K&&("web"===(null==n?void 0:n.name)?(0,j.jsx)(He.Z,{type:p.aZD}):"npm"===(null==n?void 0:n.name)?(0,j.jsx)(Qe,{}):null)]})};function rn(e){return an.apply(this,arguments)}function an(){return(an=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function sn(e){return on.apply(this,arguments)}function on(){return(on=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ln(e){return cn.apply(this,arguments)}function cn(){return(cn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function un(e){return dn.apply(this,arguments)}function dn(){return(dn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/channel/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pn=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{appResult:{data:{content:[]}},currentApp:{uid:"",name:"",appPlatform:"",description:""},insertApp:function(n){e((function(e){e.appResult.data.content.unshift(n)}))},updateApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("App with uid ".concat(n.uid," not found."))}))},deleteApp:function(n){e((function(e){var t=e.appResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("App with uid ".concat(n.uid," not found."))}))},setAppResult:function(t){var r;(e({appResult:t}),""===n().currentApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentApp:t.data.content[0]}))},setCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().appResult),{},{data:{content:s}});e({appResult:i,currentApp:t})}else e({currentApp:t})},deleteCurrentApp:function(t){var r=n().appResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({appResult:c()(c()({},n().appResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("App not found in cache:",t),n().currentApp.uid===t&&e({currentApp:{uid:""}})},deleteAppCache:function(){return e({},!0)}}})),{name:p.WJP}))),fn=t(32350),hn=function(e){var n=e.open,t=e.isEdit,r=e.app,a=e.onClose,s=e.onSubmit,o=(0,b.useIntl)(),l=se.A.useForm(),u=i()(l,1)[0],d=(0,_.u)((function(e){return e.currentOrg})),f=[{label:"Android",value:p.XCo},{label:"iOS",value:p.wTN},{label:"Flutter",value:p.oLY},{label:"UniApp",value:p.c7m},{label:"QuickApp",value:p.Cy5},{label:"Other",value:p.AJd}];return(0,y.useEffect)((function(){n&&t&&r?u.setFieldsValue({name:r.name,platform:r.appPlatform,appKey:r.appKey,appPackage:r.appPackage,description:r.description}):u.resetFields()}),[n,t,r,u]),(0,j.jsx)(le.Z,{title:t?o.formatMessage({id:"edit",defaultMessage:"编辑应用"}):o.formatMessage({id:"add",defaultMessage:"添加应用"}),width:600,open:n,onClose:a,maskClosable:!0,extra:(0,j.jsxs)("div",{style:{display:"flex",gap:8},children:[(0,j.jsx)(ee.ZP,{onClick:a,children:o.formatMessage({id:"cancel",defaultMessage:"取消"})}),(0,j.jsx)(ee.ZP,{onClick:function(){u.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==d?void 0:d.uid,uid:t?r.uid:void 0});s(n)}))},type:"primary",children:o.formatMessage({id:"confirm",defaultMessage:"确定"})})]}),children:(0,j.jsxs)(se.A,{form:u,layout:"vertical",submitter:!1,children:[(0,j.jsx)(ie.Z,{name:"name",label:o.formatMessage({id:"app.name",defaultMessage:"应用名称"}),rules:[{required:!0,message:o.formatMessage({id:"app.name.required",defaultMessage:"请输入应用名称"})}],placeholder:o.formatMessage({id:"app.name.placeholder",defaultMessage:"请输入应用名称"})}),(0,j.jsx)(oe.Z,{name:"appPlatform",label:o.formatMessage({id:"app.platform",defaultMessage:"平台类型"}),rules:[{required:!0,message:o.formatMessage({id:"app.platform.required",defaultMessage:"请选择平台类型"})}],placeholder:o.formatMessage({id:"app.platform.placeholder",defaultMessage:"请选择平台类型"}),options:f}),(0,j.jsx)(ie.Z,{name:"appPackage",label:o.formatMessage({id:"app.package",defaultMessage:"包名"}),rules:[{required:!0,message:o.formatMessage({id:"app.package.required",defaultMessage:"请输入包名"})}],placeholder:o.formatMessage({id:"app.package.placeholder",defaultMessage:"请输入包名"})}),(0,j.jsx)(ie.Z,{name:"appKey",label:"App Key",placeholder:o.formatMessage({id:"app.appKey.placeholder",defaultMessage:"请输入App Key"}),fieldProps:{addonAfter:(0,j.jsx)(ee.ZP,{type:"text",size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<16;t++)n+=e.charAt(Math.floor(Math.random()*e.length));u.setFieldsValue({appKey:n})},children:"随机生成"})}}),(0,j.jsx)(ie.Z,{name:"appPackage",label:"Package Name",hidden:"android"!==u.getFieldValue("platform"),placeholder:o.formatMessage({id:"app.packageName.placeholder",defaultMessage:"请输入Android Package Name"})}),(0,j.jsx)(fn.Z,{name:"description",label:o.formatMessage({id:"description",defaultMessage:"描述"}),placeholder:o.formatMessage({id:"description.placeholder",defaultMessage:"请输入描述信息"}),fieldProps:{rows:4}})]})})},mn=function(e){e.type;var n=(0,b.useIntl)(),t=(0,y.useRef)(!1),r=(0,te.Z)().translateStringTranct,a=(0,o.Z)().isDarkMode,s=(0,y.useState)(!1),l=i()(s,2),c=l[0],u=l[1],d=(0,y.useState)(!1),p=i()(d,2),f=p[0],h=p[1],m=(0,_.u)((function(e){return e.currentOrg})),g=pn((function(e){return{appResult:e.appResult,currentApp:e.currentApp,setAppResult:e.setAppResult,insertApp:e.insertApp,setCurrentApp:e.setCurrentApp,deleteCurrentApp:e.deleteCurrentApp}})),v=g.appResult,w=g.currentApp,k=g.setAppResult,Z=g.insertApp,A=g.setCurrentApp,M=g.deleteCurrentApp,I=Q.Z.useModal(),E=i()(I,2),T=E[0],P=E[1],W=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete app",t),R.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"正在删除"})),e.next=4,un(t);case 4:r=e.sent,console.log("delete app response",r),200===r.code?(R.yw.destroy(),R.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"删除成功"})),M(t.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),F=function(){var e=S()(C()().mark((function e(){var n,r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.current){e.next=3;break}return console.log("isLoading: 1",t.current),e.abrupt("return");case 3:return t.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==m?void 0:m.uid},e.next=8,rn(n);case 8:r=e.sent,console.log("getApps",r),200===r.code?(R.yw.destroy(),k(r)):(R.yw.destroy(),R.yw.error(r.message)),t.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){F()}),[]);var q=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,sn(t);case 2:r=e.sent,console.log("handleCreateApp response:",r),200===r.code?(Z(r.data),u(!1),R.yw.success(n.formatMessage({id:"app.create.success",defaultMessage:"应用创建成功"}))):R.yw.error(r.message);case 5:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),L=function(){var e=S()(C()().mark((function e(t){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==w?void 0:w.uid,e.next=3,ln(t);case 3:r=e.sent,console.log("handleUpdateApp response:",r),200===r.code?(A(r.data),u(!1),R.yw.success(n.formatMessage({id:"app.update.success",defaultMessage:"应用更新成功"}))):R.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{style:{margin:10},gap:"small",align:"flex-start",children:[(0,j.jsx)(ee.ZP,{size:"small",type:"primary",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){u(!0),h(!1)},children:n.formatMessage({id:"create",defaultMessage:"新建"})}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){h(!0),u(!0)},disabled:""===(null==w?void 0:w.uid),children:n.formatMessage({id:"edit",defaultMessage:"编辑"})}),(0,j.jsx)(ee.ZP,{size:"small",danger:!0,onClick:function(){return function(e){T.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"确定删除"}),"【").concat(e.name,"】？"),onOk:function(){W(e)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})}(w)},disabled:""===(null==w?void 0:w.uid),children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"删除"})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:v.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:w.uid===(null==e?void 0:e.uid)?{backgroundColor:a?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){A(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[r(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",r(null==e?void 0:e.appPlatform),")"]})]}),description:r(null==e?void 0:e.description)})})}}),c&&(0,j.jsx)(hn,{isEdit:f,open:c,app:w,onClose:function(){u(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),f?L(e):q(e)}}),P]})},gn=t(2523),xn=t(48006),yn=t(40795),vn=ye.Z.Text,jn=ye.Z.Paragraph,wn={android:(0,j.jsx)(gn.Z,{}),ios:(0,j.jsx)(xn.Z,{}),flutter:(0,j.jsx)(yn.Z,{}),uniapp:(0,j.jsx)(Me.Z,{})},kn={android:"Android",ios:"iOS",flutter:"Flutter",uniapp:"UniApp"},Zn=function(){var e=(0,b.useIntl)(),n=pn().currentApp;return null!=n&&n.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[wn[n.appPlatform]||(0,j.jsx)(yn.Z,{}),(0,j.jsx)("span",{children:n.name||"应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:kn[n.appPlatform]||n.appPlatform})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(vn,{copyable:!0,children:n.uid})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:n.name}),n.appKey&&(0,j.jsx)(ke.Z.Item,{label:"App Key",children:(0,j.jsx)(vn,{copyable:!0,children:n.appKey})}),"android"===n.appPlatform&&n.appPackage&&(0,j.jsx)(ke.Z.Item,{label:"Package Name",children:n.appPackage}),n.description&&(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(jn,{children:n.description})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:n.createdAt})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(jn,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的应用凭证（App Key 等），避免泄露"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先选择或创建一个应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},bn=t(69079),An=t(72608),Mn=ye.Z.Title,Cn=ye.Z.Paragraph,In=ye.Z.Text,Sn=(ye.Z.Link,Z.Z.TabPane,{ANDROID:"https://github.com/Bytedesk/bytedesk-android",IOS:"https://github.com/Bytedesk/bytedesk-swift",FLUTTER:"https://github.com/Bytedesk/bytedesk-flutter",UNIAPP:"https://github.com/Bytedesk/bytedesk-uniapp"}),En=function(){(0,b.useIntl)();var e=pn().currentApp,n=(0,_.u)((function(e){return e.currentOrg}));if(null==e||!e.uid)return(0,j.jsx)(ve.Z,{bordered:!1,children:(0,j.jsx)(je.Z,{description:"请先选择或创建一个应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})});return(0,j.jsxs)(ve.Z,{title:"集成指南",bordered:!1,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(bn.Z,{}),onClick:function(){var n=e.appPlatform,t=Sn[n];t?window.open(t,"_blank"):An.ZP.info("该平台暂无GitHub仓库链接")},children:"查看源码"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Xe.Z,{}),onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/category/channel","_blank")},children:"查看文档"})]}),children:[(0,j.jsxs)(Mn,{level:4,children:["集成 ",e.name," (",e.appPlatform,")"]}),(0,j.jsxs)(Cn,{children:["以下是将客服功能集成到 ",e.name," 应用的步骤说明。请按照指南完成配置，使用提供的App Key和其他凭证进行初始化。"]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(Mn,{level:5,children:"1. 基本配置"}),(0,j.jsx)(Cn,{children:(0,j.jsxs)("ul",{children:[e.appKey&&(0,j.jsxs)("li",{children:[(0,j.jsx)(In,{strong:!0,children:"App Key:"})," ",(0,j.jsx)(In,{copyable:!0,children:e.appKey})]}),(0,j.jsxs)("li",{children:[(0,j.jsx)(In,{strong:!0,children:"组织ID:"})," ",(0,j.jsx)(In,{copyable:!0,children:null==n?void 0:n.uid})]})]})}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(Cn,{type:"secondary",children:"如果在集成过程中遇到任何问题，请联系技术支持团队：270580156@qq.com"})]})},Tn=function(e){console.log(e)},Rn=[{key:"details",label:"应用详情",children:(0,j.jsx)(Zn,{})},{key:"integration",label:"集成指南",children:(0,j.jsx)(En,{})}],Pn=function(e){e.type;var n=(0,y.useState)([]),t=i()(n,2),r=t[0],a=t[1];pn((function(e){return{currentApp:e.currentApp}})).currentApp;return(0,y.useEffect)((function(){var e=[].concat(Rn);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"details",items:r,onChange:Tn})})},Wn=a.Z.Sider,Fn=a.Z.Content,qn=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Wn,{width:i,style:s,children:(0,j.jsx)(mn,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Fn,{children:(0,j.jsx)(Pn,{type:n})})})]})};function Ln(e){return Dn.apply(this,arguments)}function Dn(){return(Dn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zn(e){return Vn.apply(this,arguments)}function Vn(){return Vn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Vn.apply(this,arguments)}function Un(e){return Nn.apply(this,arguments)}function Nn(){return(Nn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function On(e){return Kn.apply(this,arguments)}function Kn(){return Kn=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/email/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Kn.apply(this,arguments)}var _n="WORK",Bn=function(e){var n,t=e.isEdit,r=e.email,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:_n,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"Email应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Yn=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{emailResult:{data:{content:[]}},currentEmail:{uid:"",nickname:"",avatar:"",description:""},insertEmail:function(n){e((function(e){e.emailResult.data.content.unshift(n)}))},updateEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Email with uid ".concat(n.uid," not found."))}))},deleteEmail:function(n){e((function(e){var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Email with uid ".concat(n.uid," not found."))}))},setEmailResult:function(t){var r;(e({emailResult:t}),""===n().currentEmail.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentEmail:t.data.content[0]}))},setCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().emailResult),{},{data:{content:s}});e({emailResult:i,currentEmail:t})}else console.warn("Email with the specified uid not found."),e({currentEmail:t})},refreshCurrentEmail:function(n){e((function(e){e.currentEmail=c()(c()({},e.currentEmail),n);var t=e.emailResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentEmail:function(t){var r=n().emailResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({emailResult:c()(c()({},n().emailResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Email not found in cache:",t),n().currentEmail.uid===t&&e({currentEmail:{uid:""}})},deleteEmailCache:function(){return e({},!0)}}})),{name:p.e73}))),Gn=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,_.u)((function(e){return e.currentOrg})),A=Yn((function(e){return{emailResult:e.emailResult,currentEmail:e.currentEmail,setEmailResult:e.setEmailResult,insertEmail:e.insertEmail,setCurrentEmail:e.setCurrentEmail,deleteCurrentEmail:e.deleteCurrentEmail}})),M=A.emailResult,I=A.currentEmail,E=A.setEmailResult,T=A.insertEmail,P=A.setCurrentEmail,W=A.deleteCurrentEmail,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],z=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete email",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,On(n);case 4:r=e.sent,console.log("delete email response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,Ln(n);case 8:t=e.sent,console.log("getEmails response:",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){m(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!h){e.next=8;break}return e.next=6,O(n);case 6:e.next=10;break;case 8:return e.next=10,N(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,zn(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateEmail response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,Un(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateEmail response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:V,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(Bn,{type:n,isEdit:h,open:u,loading:w,email:I,onClose:function(){d(!1)},onSubmit:U}),D]})},Hn=ye.Z.Text,Jn=T()(T()(T()(T()({},p.a4q,"Email公众号"),p.qRy,"Email小程序"),p._oo,"企业Email"),p.rWo,"Email客服"),Xn=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Ae.Z,{})),p.qRy,(0,j.jsx)(Me.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),Qn=function(){var e,n=(0,b.useIntl)(),t=Yn((function(e){return{currentEmail:e.currentEmail,refreshCurrentEmail:e.refreshCurrentEmail}})).currentEmail,r=(0,y.useState)(!1),a=i()(r,2),s=(a[0],a[1],(0,y.useState)(!1)),o=i()(s,2),l=(o[0],o[1],(0,y.useState)(!1)),c=i()(l,2),u=(c[0],c[1],(0,y.useState)(!1)),d=i()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),f=i()(p,2),h=(f[0],f[1],(0,y.useState)(!1)),m=i()(h,2),g=(m[0],m[1],(0,y.useState)(!1)),x=i()(g,2),w=x[0],k=x[1],Z=function(){var e=S()(C()().mark((function e(){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:k(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,j.jsx)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[Xn[t.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:t.name||"Email应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:Jn[t.type]||t.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:Z,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Hn,{copyable:!0,children:t.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:Jn[t.type]||t.type})}),(0,j.jsx)(ke.Z.Item,{label:"URL",children:(0,j.jsx)(Hn,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==t||null===(e=t.type)||void 0===e?void 0:e.toLowerCase())+"/hook/"+t.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?We()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]})}):(0,j.jsx)(ve.Z,{bordered:!1,title:"Email应用详情",extra:(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/email","_blank")},type:"link",children:"文档"}),children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Email应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},$n=function(e){console.log(e)},et=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Qn,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:$n})})},nt=a.Z.Sider,tt=a.Z.Content,rt=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(nt,{width:i,style:s,children:(0,j.jsx)(Gn,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(tt,{children:(0,j.jsx)(et,{type:n})})})]})};function at(e){return st.apply(this,arguments)}function st(){return(st=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function it(e){return ot.apply(this,arguments)}function ot(){return ot=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),ot.apply(this,arguments)}function lt(e){return ct.apply(this,arguments)}function ct(){return(ct=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ut(e){return dt.apply(this,arguments)}function dt(){return dt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/telegram/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),dt.apply(this,arguments)}var pt="MP",ft="MINI",ht="WORK",mt="KEFU",gt=function(e){var n,t=e.isEdit,r=e.telegram,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:ht,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:pt},{label:"微信小程序",value:ft},{label:"企业微信",value:ht},{label:"微信客服",value:mt}],fieldProps:{defaultValue:ht},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===ht?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===ht?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},xt=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{telegramResult:{data:{content:[]}},currentTelegram:{uid:"",nickname:"",avatar:"",description:""},insertTelegram:function(n){e((function(e){e.telegramResult.data.content.unshift(n)}))},updateTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Telegram with uid ".concat(n.uid," not found."))}))},deleteTelegram:function(n){e((function(e){var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Telegram with uid ".concat(n.uid," not found."))}))},setTelegramResult:function(t){var r;(e({telegramResult:t}),""===n().currentTelegram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentTelegram:t.data.content[0]}))},setCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().telegramResult),{},{data:{content:s}});e({telegramResult:i,currentTelegram:t})}else console.warn("Telegram with the specified uid not found."),e({currentTelegram:t})},refreshCurrentTelegram:function(n){e((function(e){e.currentTelegram=c()(c()({},e.currentTelegram),n);var t=e.telegramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentTelegram:function(t){var r=n().telegramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({telegramResult:c()(c()({},n().telegramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Telegram not found in cache:",t),n().currentTelegram.uid===t&&e({currentTelegram:{uid:""}})},deleteTelegramCache:function(){return e({},!0)}}})),{name:p.I2C}))),yt=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,_.u)((function(e){return e.currentOrg})),A=xt((function(e){return{telegramResult:e.telegramResult,currentTelegram:e.currentTelegram,setTelegramResult:e.setTelegramResult,insertTelegram:e.insertTelegram,setCurrentTelegram:e.setCurrentTelegram,deleteCurrentTelegram:e.deleteCurrentTelegram}})),M=A.telegramResult,I=A.currentTelegram,E=A.setTelegramResult,T=A.insertTelegram,P=A.setCurrentTelegram,W=A.deleteCurrentTelegram,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],z=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete telegram",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,ut(n);case 4:r=e.sent,console.log("delete telegram response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,at(n);case 8:t=e.sent,console.log("getTelegrams response",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){m(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!h){e.next=8;break}return e.next=6,O(n);case 6:e.next=10;break;case 8:return e.next=10,N(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,it(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateTelegram response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,lt(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateTelegram response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:V,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]})})})}}),u&&(0,j.jsx)(gt,{type:n,isEdit:h,open:u,loading:w,telegram:I,onClose:function(){d(!1)},onSubmit:U}),D]})},vt=ye.Z.Text,jt=ye.Z.Paragraph,wt=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),kt=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Ae.Z,{})),p.qRy,(0,j.jsx)(Me.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),Zt=function(e){e.type;var n=(0,b.useIntl)(),t=xt((function(e){return{currentTelegram:e.currentTelegram,refreshCurrentTelegram:e.refreshCurrentTelegram}})),r=t.currentTelegram,a=(t.refreshCurrentTelegram,(0,y.useState)(!1)),s=i()(a,2),o=(s[0],s[1],(0,y.useState)(!1)),l=i()(o,2),c=(l[0],l[1],(0,y.useState)(!1)),u=i()(c,2),d=(u[0],u[1],(0,y.useState)(!1)),p=i()(d,2),f=(p[0],p[1],(0,y.useState)(!1)),h=i()(f,2),m=(h[0],h[1],(0,y.useState)(!1)),g=i()(m,2),x=(g[0],g[1],(0,y.useState)(!1)),v=i()(x,2),w=v[0],k=v[1],Z=function(){var e=S()(C()().mark((function e(){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:k(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[kt[r.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:r.name||"Telegram应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:wt[r.type]||r.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/telegram","_blank")},type:"link",children:"文档"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:Z,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(vt,{copyable:!0,children:r.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:wt[r.type]||r.type})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?We()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(jt,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,title:"Telegram应用详情",extra:(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/telegram","_blank")},type:"link",children:"文档"}),children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Telegram应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},bt=function(e){console.log(e)},At=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Zt,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:bt})})},Mt=a.Z.Sider,Ct=a.Z.Content,It=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Mt,{width:i,style:s,children:(0,j.jsx)(yt,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Ct,{children:(0,j.jsx)(At,{type:n})})})]})};function St(e){return Et.apply(this,arguments)}function Et(){return(Et=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Tt(e){return Rt.apply(this,arguments)}function Rt(){return Rt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),Rt.apply(this,arguments)}function Pt(e){return Wt.apply(this,arguments)}function Wt(){return(Wt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ft(e){return qt.apply(this,arguments)}function qt(){return qt=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/line/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)}))),qt.apply(this,arguments)}var Lt="MP",Dt="MINI",zt="WORK",Vt="KEFU",Ut=function(e){var n,t=e.isEdit,r=e.line,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:zt,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:Lt},{label:"微信小程序",value:Dt},{label:"企业微信",value:zt},{label:"微信客服",value:Vt}],fieldProps:{defaultValue:zt},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===zt?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===zt?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},Nt=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{lineResult:{data:{content:[]}},currentLine:{uid:"",nickname:"",avatar:"",description:""},insertLine:function(n){e((function(e){e.lineResult.data.content.unshift(n)}))},updateLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Line with uid ".concat(n.uid," not found."))}))},deleteLine:function(n){e((function(e){var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Line with uid ".concat(n.uid," not found."))}))},setLineResult:function(t){var r;(e({lineResult:t}),""===n().currentLine.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentLine:t.data.content[0]}))},setCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().lineResult),{},{data:{content:s}});e({lineResult:i,currentLine:t})}else console.warn("Line with the specified uid not found."),e({currentLine:t})},refreshCurrentLine:function(n){e((function(e){e.currentLine=c()(c()({},e.currentLine),n);var t=e.lineResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentLine:function(t){var r=n().lineResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({lineResult:c()(c()({},n().lineResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Line not found in cache:",t),n().currentLine.uid===t&&e({currentLine:{uid:""}})},deleteLineCache:function(){return e({},!0)}}})),{name:p.yRi}))),Ot=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,_.u)((function(e){return e.currentOrg})),A=Nt((function(e){return{lineResult:e.lineResult,currentLine:e.currentLine,setLineResult:e.setLineResult,insertLine:e.insertLine,setCurrentLine:e.setCurrentLine,deleteCurrentLine:e.deleteCurrentLine}})),M=A.lineResult,I=A.currentLine,E=A.setLineResult,T=A.insertLine,P=A.setCurrentLine,W=A.deleteCurrentLine,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],z=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete line",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Ft(n);case 4:r=e.sent,console.log("delete line response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,St(n);case 8:t=e.sent,console.log("getLines response:",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){m(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!h){e.next=8;break}return e.next=6,O(n);case 6:e.next=10;break;case 8:return e.next=10,N(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Tt(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateLine response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,Pt(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateLine response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:V,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]})})})}}),u&&(0,j.jsx)(Ut,{type:n,isEdit:h,open:u,loading:w,line:I,onClose:function(){d(!1)},onSubmit:U}),D]})},Kt=ye.Z.Text,_t=ye.Z.Paragraph,Bt=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),Yt=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Ae.Z,{})),p.qRy,(0,j.jsx)(Me.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),Gt=function(e){e.type;var n=(0,b.useIntl)(),t=Nt((function(e){return{currentLine:e.currentLine,refreshCurrentLine:e.refreshCurrentLine}})),r=t.currentLine,a=(t.refreshCurrentLine,(0,y.useState)(!1)),s=i()(a,2),o=s[0],l=s[1],c=function(){var e=S()(C()().mark((function e(){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=r&&r.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:l(!0);case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return null!=r&&r.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[Yt[r.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:r.name||"Line应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:Bt[r.type]||r.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/line","_blank")},type:"link",children:"文档"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:r}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:c,loading:o,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(Kt,{copyable:!0,children:r.uid})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:r.name}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:Bt[r.type]||r.type})}),(0,j.jsx)(ke.Z.Item,{label:n.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:r.createdAt?We()(r.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(_t,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,title:"Line应用详情",extra:(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/line","_blank")},type:"link",children:"文档"}),children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Line应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Ht=function(e){console.log(e)},Jt=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Gt,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Ht})})},Xt=a.Z.Sider,Qt=a.Z.Content,$t=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Xt,{width:i,style:s,children:(0,j.jsx)(Ot,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Qt,{children:(0,j.jsx)(Jt,{type:n})})})]})};function er(e){return nr.apply(this,arguments)}function nr(){return(nr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function tr(e){return rr.apply(this,arguments)}function rr(){return(rr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ar(e){return sr.apply(this,arguments)}function sr(){return(sr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ir(e){return or.apply(this,arguments)}function or(){return(or=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function lr(e){return cr.apply(this,arguments)}function cr(){return(cr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ur(e){return dr.apply(this,arguments)}function dr(){return(dr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/whatsapp/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var pr="MP",fr="MINI",hr="WORK",mr="KEFU",gr=function(e){var n,t=e.isEdit,r=e.whatsApp,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=c()(c()({},e),{},{orgUid:null==h?void 0:h.uid});console.log("submit",n),u(n)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||hr,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.token,encodingAesKey:null==r?void 0:r.encodingAesKey,encryptMode:null==r?void 0:r.encryptMode,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:hr,appId:"",appSecret:"",token:"",encodingAesKey:"",encryptMode:"SAFE",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"微信应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"微信公众号",value:pr},{label:"微信小程序",value:fr},{label:"企业微信",value:hr},{label:"微信客服",value:mr}],fieldProps:{defaultValue:hr},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"企业ID(corpId)/AppID",name:"appId",rules:[{required:!0}],extra:n("type")===hr?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#%E4%BC%81%E4%B8%9Aid-%E6%88%96-corpid",target:"_blank",rel:"noopener noreferrer",children:"查看企业ID(corpId)获取说明"}):void 0})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){var n=e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}],extra:n("type")===hr?(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/wechat_work#appsecret-%E6%88%96-secret",target:"_blank",rel:"noopener noreferrer",children:"查看应用Secret获取说明"}):void 0})}}),(0,j.jsx)(ie.Z,{label:"Token",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"EncodingAESKey",name:"encodingAesKey",rules:[{required:!0}],fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<43;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({encodingAesKey:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("encodingAesKey");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})}}),(0,j.jsx)(oe.Z,{label:"消息加解密方式",name:"encryptMode",options:[{label:"安全模式",value:"SAFE"},{label:"明文模式",value:"PLAINTEXT",disabled:!0},{label:"兼容模式",value:"COMPATIBLE",disabled:!0}],fieldProps:{defaultValue:"SAFE",allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到对应的平台获取相关配置信息"})]})})})},xr=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{whatsAppResult:{data:{content:[]}},currentWhatsApp:{uid:"",nickname:"",avatar:"",description:""},insertWhatsApp:function(n){e((function(e){e.whatsAppResult.data.content.unshift(n)}))},updateWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},deleteWhatsApp:function(n){e((function(e){var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("WhatsApp with uid ".concat(n.uid," not found."))}))},setWhatsAppResult:function(t){var r;(e({whatsAppResult:t}),""===n().currentWhatsApp.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentWhatsApp:t.data.content[0]}))},setCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().whatsAppResult),{},{data:{content:s}});e({whatsAppResult:i,currentWhatsApp:t})}else console.warn("WhatsApp with the specified uid not found."),e({currentWhatsApp:t})},refreshCurrentWhatsApp:function(n){e((function(e){e.currentWhatsApp=c()(c()({},e.currentWhatsApp),n);var t=e.whatsAppResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentWhatsApp:function(t){var r=n().whatsAppResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({whatsAppResult:c()(c()({},n().whatsAppResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("WhatsApp not found in cache:",t),n().currentWhatsApp.uid===t&&e({currentWhatsApp:{uid:""}})},deleteWhatsAppCache:function(){return e({},!0)}}})),{name:p.TvW}))),yr=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,_.u)((function(e){return e.currentOrg})),A=xr((function(e){return{whatsAppResult:e.whatsAppResult,currentWhatsApp:e.currentWhatsApp,setWhatsAppResult:e.setWhatsAppResult,insertWhatsApp:e.insertWhatsApp,setCurrentWhatsApp:e.setCurrentWhatsApp,deleteCurrentWhatsApp:e.deleteCurrentWhatsApp}})),M=A.whatsAppResult,I=A.currentWhatsApp,E=A.setWhatsAppResult,T=A.insertWhatsApp,P=A.setCurrentWhatsApp,W=A.deleteCurrentWhatsApp,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],z=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete whatsApp",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,lr(n);case 4:r=e.sent,console.log("delete whatsApp response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),n={pageNumber:0,pageSize:50,orgUid:null==Z?void 0:Z.uid},e.next=8,er(n);case 8:t=e.sent,console.log("getWhatsApps response",t,n),200===t.code?(R.yw.destroy(),E(t)):(R.yw.destroy(),R.yw.error(t.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){m(!0),d(!0)};return window.addEventListener("wechatapp-edit",e),function(){window.removeEventListener("wechatapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!h){e.next=8;break}return e.next=6,O(n);case 6:e.next=10;break;case 8:return e.next=10,N(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,ar(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateWhatsApp response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,ir(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateWhatsApp response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:V,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return e=I,void L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})});var e}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:I.uid===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",null==e?void 0:e.type,")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(gr,{type:n,isEdit:h,open:u,loading:w,whatsApp:I,onClose:function(){d(!1)},onSubmit:U}),D]})},vr=ye.Z.Text,jr=ye.Z.Paragraph,wr=T()(T()(T()(T()({},p.a4q,"微信公众号"),p.qRy,"微信小程序"),p._oo,"企业微信"),p.rWo,"微信客服"),kr=T()(T()(T()(T()({},p.a4q,(0,j.jsx)(Ae.Z,{})),p.qRy,(0,j.jsx)(Me.Z,{})),p._oo,(0,j.jsx)(Ce.Z,{})),p.rWo,(0,j.jsx)(Ie.Z,{})),Zr={PLAINTEXT:"明文模式",COMPATIBLE:"兼容模式",SAFE:"安全模式"},br={PLAINTEXT:"orange",COMPATIBLE:"blue",SAFE:"green"},Ar=function(e){e.type;var n,t=(0,b.useIntl)(),r=xr((function(e){return{currentWhatsApp:e.currentWhatsApp,refreshCurrentWhatsApp:e.refreshCurrentWhatsApp}})),a=r.currentWhatsApp,s=r.refreshCurrentWhatsApp,o=(0,y.useState)(!1),l=i()(o,2),c=l[0],u=l[1],d=(0,y.useState)(!1),p=i()(d,2),f=p[0],h=p[1],m=(0,y.useState)(!1),g=i()(m,2),x=g[0],w=g[1],k=(0,y.useState)(!1),Z=i()(k,2),A=Z[0],M=Z[1],I=(0,y.useState)(!1),E=i()(I,2),T=E[0],P=E[1],W=(0,y.useState)(!1),F=i()(W,2),q=F[0],L=F[1],D=function(){return u(!c)},z=function(){return h(!f)},V=function(){return w(!x)},U=function(){return M(!A)},N=function(e,n){return e?n?e:"******":"-"},O=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return P(!0),e.prev=4,e.next=7,ur({uid:a.uid});case 7:n=e.sent,console.log("refreshAccessTokenWhatsApp response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),s&&s(n.data),K()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,P(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),K=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=a&&a.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return L(!0),e.prev=4,e.next=7,tr({uid:a.uid});case 7:n=e.sent,console.log("queryWhatsAppByUid refresh detail",n),200===n.code?(t=n.data,R.yw.success("应用详情刷新成功"),s&&s(t)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,L(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return(0,j.jsx)(ve.Z,{title:null!=a&&a.uid?(0,j.jsxs)(ce.Z,{children:[kr[a.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:a.name||"微信应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:wr[a.type]||a.type})]}):"微信应用详情",extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/whatsapp","_blank")},type:"link",children:"文档"}),(null==a?void 0:a.uid)&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("wechatapp-edit",{detail:{app:a}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:K,loading:q,type:"primary",children:"刷新详情"})]})]}),bordered:!1,children:null!=a&&a.uid?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(vr,{copyable:!0,children:a.uid})}),(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:a.name}),(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:wr[a.type]||a.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID/企业ID",children:(0,j.jsx)(vr,{copyable:!0,children:a.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(vr,{copyable:!!f&&{text:a.appSecret||""},children:N(a.appSecret,f)}),(0,j.jsx)(Ze.Z,{title:f?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:f?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:z,size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"加密模式",children:(0,j.jsx)(we.Z,{color:br[a.encryptMode]||"default",children:Zr[a.encryptMode]||a.encryptMode})}),(0,j.jsx)(ke.Z.Item,{label:"URL",children:(0,j.jsx)(vr,{copyable:!0,children:(0,v.kG)()+"/wechat/"+(null==a||null===(n=a.type)||void 0===n?void 0:n.toLowerCase())+"/hook/"+a.uid})}),(0,j.jsx)(ke.Z.Item,{label:"Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(vr,{copyable:!!x&&{text:a.token||""},children:N(a.token,x)}),(0,j.jsx)(Ze.Z,{title:x?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:x?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:V,size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"EncodingAESKey",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(vr,{copyable:!!A&&{text:a.encodingAesKey||""},children:N(a.encodingAesKey,A)}),(0,j.jsx)(Ze.Z,{title:A?"隐藏EncodingAESKey":"显示EncodingAESKey",children:(0,j.jsx)(ee.ZP,{type:"text",icon:A?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:U,size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(vr,{copyable:!!c&&{text:a.accessToken||""},children:N(a.accessToken,c)}),(0,j.jsx)(Ze.Z,{title:c?"隐藏Token":"显示Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:c?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:D,size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Re.Z,{}),onClick:O,size:"small",loading:T,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:a.accessTokenExpiresAt?We()(a.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),a.description&&(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(jr,{children:a.description})}),(0,j.jsx)(ke.Z.Item,{label:t.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:a.createdAt?We()(a.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(jr,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的微信应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"如果使用安全模式，确保 EncodingAESKey 的安全性"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个微信应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},Mr=function(e){console.log(e)},Cr=function(e){var n=e.type,t=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Ar,{type:n})}],r=(0,y.useState)(t),a=i()(r,2),s=a[0],o=a[1];return(0,y.useEffect)((function(){var e=[].concat(t);o(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:s,onChange:Mr})})},Ir=a.Z.Sider,Sr=a.Z.Content,Er=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Ir,{width:i,style:s,children:(0,j.jsx)(yr,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Sr,{children:(0,j.jsx)(Cr,{type:n})})})]})};function Tr(e){return Rr.apply(this,arguments)}function Rr(){return(Rr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Pr(e){return Wr.apply(this,arguments)}function Wr(){return(Wr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Fr(e){return qr.apply(this,arguments)}function qr(){return(qr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Lr(e){return Dr.apply(this,arguments)}function Dr(){return(Dr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function zr(e){return Vr.apply(this,arguments)}function Vr(){return(Vr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ur(e){return Nr.apply(this,arguments)}function Nr(){return(Nr=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Or=t(84176),Kr=t.n(Or),_r=["token"],Br="WEBHOOK",Yr="MESSENGER",Gr="INSTAGRAM",Hr="WHATSAPP",Jr=function(e){var n,t=e.isEdit,r=e.messenger,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=e.token,t=Kr()(e,_r),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==h?void 0:h.uid});console.log("submit",r),u(r)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Yr,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.verifyToken,pageId:null==r?void 0:r.pageId,pageAccessToken:null==r?void 0:r.pageAccessToken,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Yr,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:Br},{label:"Messenger",value:Yr},{label:"Instagram",value:Gr},{label:"Whatsapp",value:Hr}],fieldProps:{defaultValue:Br},rules:[{required:!0}]}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用ID(App ID)",name:"appId",rules:[{required:!0}],extra:(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App ID获取说明"})})}}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"应用Secret(App Secret)",name:"appSecret",rules:[{required:!0}],extra:(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-app-id-%E5%92%8C-app-secret",target:"_blank",rel:"noopener noreferrer",children:"查看App Secret获取说明"})})}}),(0,j.jsx)(ie.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,j.jsx)(se.A.Item,{noStyle:!0,shouldUpdate:function(e,n){return e.type!==n.type},children:function(e){e.getFieldValue;return(0,j.jsx)(ie.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID",extra:(0,j.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook#%E8%8E%B7%E5%8F%96-page-id",target:"_blank",rel:"noopener noreferrer",children:"查看Page ID获取说明"})})}}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Xr=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{messengerResult:{data:{content:[]}},currentMessenger:{uid:"",nickname:"",avatar:"",description:""},insertMessenger:function(n){e((function(e){e.messengerResult.data.content.unshift(n)}))},updateMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Messenger with uid ".concat(n.uid," not found."))}))},deleteMessenger:function(n){e((function(e){var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Messenger with uid ".concat(n.uid," not found."))}))},setMessengerResult:function(t){var r;(e({messengerResult:t}),""===n().currentMessenger.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentMessenger:t.data.content[0]}))},setCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().messengerResult),{},{data:{content:s}});e({messengerResult:i,currentMessenger:t})}else console.warn("Messenger with the specified uid not found."),e({currentMessenger:t})},refreshCurrentMessenger:function(n){e((function(e){e.currentMessenger=c()(c()({},e.currentMessenger),n);var t=e.messengerResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentMessenger:function(t){var r=n().messengerResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({messengerResult:c()(c()({},n().messengerResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Messenger not found in cache:",t),n().currentMessenger.uid===t&&e({currentMessenger:{uid:""}})},deleteMessengerCache:function(){return e({},!0)}}})),{name:p.Gmi}))),Qr=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),$r=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,_.u)((function(e){return e.currentOrg})),A=Xr((function(e){return{messengerResult:e.messengerResult,currentMessenger:e.currentMessenger,setMessengerResult:e.setMessengerResult,insertMessenger:e.insertMessenger,setCurrentMessenger:e.setCurrentMessenger,deleteCurrentMessenger:e.deleteCurrentMessenger}})),M=A.messengerResult,I=A.currentMessenger,E=A.setMessengerResult,T=A.insertMessenger,P=A.setCurrentMessenger,W=A.deleteCurrentMessenger,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],z=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete messenger",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,zr(n);case 4:r=e.sent,console.log("delete messenger response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=S()(C()().mark((function e(){var t,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==Z?void 0:Z.uid},e.next=8,Tr(t);case 8:a=e.sent,console.log("getMessengers response",a,t),200===a.code?(R.yw.destroy(),E(a)):(R.yw.destroy(),R.yw.error(a.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){m(!0),d(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!h){e.next=8;break}return e.next=6,O(n);case 6:e.next=10;break;case 8:return e.next=10,N(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,Fr(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateMessenger response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,Lr(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateMessenger response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:V,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:(null==I?void 0:I.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",Qr[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(Jr,{isEdit:h,open:u,loading:w,messenger:I,onClose:function(){d(!1)},onSubmit:U}),D]})},ea=ye.Z.Text,na=ye.Z.Paragraph,ta=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),ra=T()(T()(T()(T()({},p.Iap,(0,j.jsx)(Te.Z,{})),p.Ff2,(0,j.jsx)(Ae.Z,{})),p.cRk,(0,j.jsx)(Me.Z,{})),p.SbP,(0,j.jsx)(Ce.Z,{})),aa="appSecret",sa="verifyToken",ia="accessToken",oa="pageAccessToken",la=function(){var e=(0,b.useIntl)(),n=Xr((function(e){return{currentMessenger:e.currentMessenger,refreshCurrentMessenger:e.refreshCurrentMessenger}})),t=n.currentMessenger,r=n.refreshCurrentMessenger,a=(0,y.useState)(T()(T()(T()(T()({},aa,!1),sa,!1),ia,!1),oa,!1)),s=i()(a,2),o=s[0],l=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),x=i()(g,2),w=x[0],k=x[1],Z=function(e){l((function(n){return c()(c()({},n),{},T()({},e,!n[e]))}))},A=function(e,n){return e?n?e:"******":"-"},M=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return m(!0),e.prev=4,e.next=7,Ur({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenMessenger response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),r&&r(n.data),I()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,m(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=S()(C()().mark((function e(){var n,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return k(!0),e.prev=4,e.next=7,Pr({uid:t.uid});case 7:n=e.sent,console.log("queryMessengerByUid refresh detail",n),200===n.code?(a=n.data,R.yw.success("应用详情刷新成功"),r&&r(a)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,k(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return(0,j.jsx)(ve.Z,{title:null!=t&&t.uid?(0,j.jsxs)(ce.Z,{children:[ra[t.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:t.name||"Messenger应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:ta[t.type]||t.type})]}):"Messenger应用详情",extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/facebook","_blank")},type:"link",children:"文档"}),(null==t?void 0:t.uid)&&(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:I,loading:w,type:"primary",children:"刷新详情"})]})]}),bordered:!1,children:null!=t&&t.uid?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(ea,{copyable:!0,children:t.uid})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:ta[t.type]||t.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID",children:(0,j.jsx)(ea,{copyable:!0,children:t.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ea,{copyable:!!o[aa]&&{text:t.appSecret||""},children:A(t.appSecret,o[aa])}),(0,j.jsx)(Ze.Z,{title:o[aa]?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[aa]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(aa)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"回调网址",children:(0,j.jsx)(ea,{copyable:!0,children:(0,v.kG)()+"/meta/webhooks/"+t.uid})}),(0,j.jsx)(ke.Z.Item,{label:"验证口令",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ea,{copyable:!!o[sa]&&{text:t.verifyToken||""},children:A(t.verifyToken,o[sa])}),(0,j.jsx)(Ze.Z,{title:o[sa]?"隐藏Verify Token":"显示Verify Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[sa]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(sa)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page Access Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ea,{copyable:!!o[oa]&&{text:t.pageAccessToken||""},children:A(t.pageAccessToken,o[oa])}),(0,j.jsx)(Ze.Z,{title:o[oa]?"隐藏Page Access Token":"显示Page Access Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[oa]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(oa)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page ID",children:(0,j.jsx)(ea,{copyable:!0,children:t.pageId||"-"})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ea,{copyable:!!o[ia]&&{text:t.accessToken||""},children:A(t.accessToken,o[ia])}),(0,j.jsx)(Ze.Z,{title:o[ia]?"隐藏AccessToken":"显示AccessToken",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[ia]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(ia)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Re.Z,{}),onClick:M,size:"small",loading:h,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?We()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(na,{children:t.description})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?We()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(na,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的Messenger应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Messenger应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},ca=function(e){console.log(e)},ua=[{key:"detail",label:"应用详情",children:(0,j.jsx)(la,{})}],da=function(e){e.type;var n=(0,y.useState)(ua),t=i()(n,2),r=t[0],a=t[1];return(0,y.useEffect)((function(){var e=[].concat(ua);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:ca})})},pa=a.Z.Sider,fa=a.Z.Content,ha=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(pa,{width:i,style:s,children:(0,j.jsx)($r,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(fa,{children:(0,j.jsx)(da,{type:n})})})]})};function ma(e){return ga.apply(this,arguments)}function ga(){return(ga=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/org",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function xa(e){return ya.apply(this,arguments)}function ya(){return(ya=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/query/uid",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function va(e){return ja.apply(this,arguments)}function ja(){return(ja=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/create",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wa(e){return ka.apply(this,arguments)}function ka(){return(ka=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/update",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Za(e){return ba.apply(this,arguments)}function ba(){return(ba=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/delete",{method:"POST",data:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Aa(e){return Ma.apply(this,arguments)}function Ma(){return(Ma=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,b.request)("/api/v1/meta/app/refreshToken",{method:"GET",params:c()(c()({},n),{},{client:p.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var Ca=["token"],Ia="WEBHOOK",Sa="MESSENGER",Ea="INSTAGRAM",Ta="WHATSAPP",Ra=function(e){var n,t=e.isEdit,r=e.instagram,a=e.open,s=e.loading,o=void 0!==s&&s,l=e.onClose,u=e.onSubmit,d=se.A.useForm(),p=i()(d,1)[0],f=(0,te.Z)().translateStringTranct,h=(0,_.u)((function(e){return e.currentOrg})),m=(0,y.useState)(!1),g=i()(m,2),x=g[0],v=g[1],w=(0,ae.$)((function(e){return{workgroupResult:e.workgroupResult,setWorkgroupResult:e.setWorkgroupResult}})),k=w.workgroupResult,Z=w.setWorkgroupResult,b=function(){console.log("handleSubmit"),v(!0),p.validateFields().then((function(e){var n=e.token,t=Kr()(e,Ca),r=c()(c()({},t),{},{verifyToken:n,orgUid:null==h?void 0:h.uid});console.log("submit",r),u(r)})).catch((function(){v(!1)}))};(0,y.useEffect)((function(){if(t)p.setFieldsValue({name:null==r?void 0:r.name,description:null==r?void 0:r.description,type:(null==r?void 0:r.type)||Sa,appId:null==r?void 0:r.appId,appSecret:null==r?void 0:r.appSecret,token:null==r?void 0:r.verifyToken,pageId:null==r?void 0:r.pageId,pageAccessToken:null==r?void 0:r.pageAccessToken,workgroupUid:null==r?void 0:r.workgroupUid});else{var e,n=(null==k||null===(e=k.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.length)>0?k.data.content[0].uid:"";p.setFieldsValue({name:"",description:"",type:Sa,appId:"",appSecret:"",token:"",pageId:"",pageAccessToken:"",workgroupUid:n})}}),[t,r,p,k]);var A=function(){var e=S()(C()().mark((function e(){var n,t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),n={pageNumber:0,pageSize:50,sortDirection:"ascend",orgUid:null==h?void 0:h.uid},e.next=4,(0,re.LE)(n);case 4:t=e.sent,console.log("getWorkgroups",t),200===t.code?(R.yw.destroy(),Z(t)):(R.yw.destroy(),R.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){A()}),[]);return(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(le.Z,{title:"Meta应用配置",onClose:l,open:a,width:600,extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{onClick:l,children:"取消"}),(0,j.jsx)(ee.ZP,{type:"primary",onClick:b,loading:x||o,children:x||o?"保存中...":"保存"})]}),children:(0,j.jsxs)(se.A,{form:p,name:"wechatWorkForm",onFinish:b,submitter:!1,children:[(0,j.jsx)(ie.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"描述",name:"description",placeholder:"请输入应用描述"}),(0,j.jsx)(oe.Z,{label:"应用类型",name:"type",options:[{label:"Webhook",value:Ia},{label:"Messenger",value:Sa},{label:"Instagram",value:Ea},{label:"Whatsapp",value:Ta}],fieldProps:{defaultValue:Ia},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"应用ID",name:"appId",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"应用Secret",name:"appSecret",rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"验证令牌(Verify Token)",name:"token",fieldProps:{addonAfter:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",t=0;t<32;t++){var r=Math.floor(Math.random()*e.length);n+=e.charAt(r)}p.setFieldsValue({token:n})},children:"随机生成"}),(0,j.jsx)(ee.ZP,{size:"small",onClick:function(){var e=p.getFieldValue("token");if(e){var n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),R.yw.success("已复制到剪切板")}},children:"复制"})]})},rules:[{required:!0}]}),(0,j.jsx)(ie.Z,{label:"页面访问令牌(Page Access Token)",name:"pageAccessToken",placeholder:"请输入Meta Page Access Token"}),(0,j.jsx)(ie.Z,{label:"页面ID(Page ID)",name:"pageId",placeholder:"请输入Meta Page ID"}),(0,j.jsx)(oe.Z,{label:"客服技能组",name:"workgroupUid",options:null==k||null===(n=k.data)||void 0===n||null===(n=n.content)||void 0===n?void 0:n.map((function(e){return{label:f(e.nickname),value:e.uid}})),fieldProps:{allowClear:!0},rules:[{required:!0}]}),(0,j.jsx)("p",{children:"注：根据应用类型，到Meta开发者平台获取相关配置信息"})]})})})},Pa=(0,f.Ue)()((0,h.mW)((0,h.tJ)((0,m.n)((function(e,n){return{instagramResult:{data:{content:[]}},currentInstagram:{uid:"",nickname:"",avatar:"",description:""},insertInstagram:function(n){e((function(e){e.instagramResult.data.content.unshift(n)}))},updateInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Instagram with uid ".concat(n.uid," not found."))}))},deleteInstagram:function(n){e((function(e){var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t.splice(r,1):console.warn("Instagram with uid ".concat(n.uid," not found."))}))},setInstagramResult:function(t){var r;(e({instagramResult:t}),""===n().currentInstagram.uid)&&((null===(r=t.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&e({currentInstagram:t.data.content[0]}))},setCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==a){var s=[].concat(d()(r.slice(0,a)),[t],d()(r.slice(a+1))),i=c()(c()({},n().instagramResult),{},{data:{content:s}});e({instagramResult:i,currentInstagram:t})}else console.warn("Instagram with the specified uid not found."),e({currentInstagram:t})},refreshCurrentInstagram:function(n){e((function(e){e.currentInstagram=c()(c()({},e.currentInstagram),n);var t=e.instagramResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r&&(t[r]=c()(c()({},t[r]),n))}))},deleteCurrentInstagram:function(t){var r=n().instagramResult.data.content,a=r.findIndex((function(e){return e.uid===t}));-1!==a?e({instagramResult:c()(c()({},n().instagramResult),{},{data:{content:[].concat(d()(r.slice(0,a)),d()(r.slice(a+1)))}})}):console.warn("Instagram not found in cache:",t),n().currentInstagram.uid===t&&e({currentInstagram:{uid:""}})},deleteInstagramCache:function(){return e({},!0)}}})),{name:p.S6e}))),Wa=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),Fa=function(e){var n=e.type,t=(0,b.useIntl)(),r=(0,y.useRef)(!1),a=(0,te.Z)().translateStringTranct,s=(0,o.Z)().isDarkMode,l=(0,y.useState)(!1),c=i()(l,2),u=c[0],d=c[1],p=(0,y.useState)(!1),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),v=i()(g,2),w=v[0],k=v[1],Z=(0,_.u)((function(e){return e.currentOrg})),A=Pa((function(e){return{instagramResult:e.instagramResult,currentInstagram:e.currentInstagram,setInstagramResult:e.setInstagramResult,insertInstagram:e.insertInstagram,setCurrentInstagram:e.setCurrentInstagram,deleteCurrentInstagram:e.deleteCurrentInstagram}})),M=A.instagramResult,I=A.currentInstagram,E=A.setInstagramResult,T=A.insertInstagram,P=A.setCurrentInstagram,W=A.deleteCurrentInstagram,F=Q.Z.useModal(),q=i()(F,2),L=q[0],D=q[1],z=function(){var e=S()(C()().mark((function e(n){var r;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete instagram",n),R.yw.loading(t.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,Za(n);case 4:r=e.sent,console.log("delete instagram response",r),200===r.code?(R.yw.destroy(),R.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),W(n.uid)):(R.yw.destroy(),R.yw.error(r.message));case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),V=function(){var e=S()(C()().mark((function e(){var t,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!r.current){e.next=3;break}return console.log("isLoading: 1",r.current),e.abrupt("return");case 3:return r.current=!0,R.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==Z?void 0:Z.uid},e.next=8,ma(t);case 8:a=e.sent,console.log("getInstagram response",a,t),200===a.code?(R.yw.destroy(),E(a)):(R.yw.destroy(),R.yw.error(a.message)),r.current=!1;case 12:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,y.useEffect)((function(){V();var e=function(e){m(!0),d(!0)};return window.addEventListener("metaapp-edit",e),function(){window.removeEventListener("metaapp-edit",e)}}),[]);var U=function(){var e=S()(C()().mark((function e(n){return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("onDrawerSubmit:",n),k(!0),e.prev=2,!h){e.next=8;break}return e.next=6,O(n);case 6:e.next=10;break;case 8:return e.next=10,N(n);case 10:return e.prev=10,k(!1),e.finish(10);case 13:case"end":return e.stop()}}),e,null,[[2,,10,13]])})));return function(n){return e.apply(this,arguments)}}(),N=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("正在创建..."),e.next=3,va(n);case 3:t=e.sent,R.yw.destroy(),console.log("handleCreateInstagram response:",t),200===t.code?(T(t.data),P(t.data),d(!1),R.yw.success("创建成功")):R.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),O=function(){var e=S()(C()().mark((function e(n){var t;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.uid=null==I?void 0:I.uid,R.yw.loading("正在更新..."),e.next=4,wa(n);case 4:t=e.sent,R.yw.destroy(),console.log("handleUpdateInstagram response:",t),200===t.code?(P(t.data),d(!1),R.yw.success("更新成功")):R.yw.error(t.message);case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}();return(0,j.jsxs)(j.Fragment,{children:[(0,j.jsxs)($.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,j.jsxs)($.Z,{gap:"small",children:[(0,j.jsx)(ee.ZP,{type:"primary",size:"small",icon:(0,j.jsx)(Y.Z,{}),onClick:function(){d(!0),m(!1)},children:t.formatMessage({id:"bind",defaultMessage:"Bind"})}),(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(G.Z,{}),onClick:V,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==I?void 0:I.uid)&&(0,j.jsx)(ne.Z,{menu:{items:[{key:"edit",icon:(0,j.jsx)(H.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:function(){m(!0),d(!0)}},{key:"delete",icon:(0,j.jsx)(J.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){L.confirm({title:t.formatMessage({id:"deleteTip"}),icon:(0,j.jsx)(B.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(e.name,"】？"),onOk:function(){z(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(I)}}]},children:(0,j.jsx)(ee.ZP,{size:"small",icon:(0,j.jsx)(X.Z,{})})})]}),(0,j.jsx)(x.Z,{itemLayout:"horizontal",dataSource:M.data.content,renderItem:function(e,n){return(0,j.jsx)(x.Z.Item,{style:(null==I?void 0:I.uid)===(null==e?void 0:e.uid)?{backgroundColor:s?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){P(e)},children:(0,j.jsx)(x.Z.Item.Meta,{style:{marginLeft:"10px"},title:(0,j.jsxs)(j.Fragment,{children:[a(null==e?void 0:e.name)," ",(0,j.jsxs)("span",{style:{color:"#1677ff"},children:["(",Wa[null==e?void 0:e.type]||(null==e?void 0:e.type),")"]})]}),description:a(null==e?void 0:e.description)})})}}),u&&(0,j.jsx)(Ra,{isEdit:h,open:u,loading:w,instagram:I,onClose:function(){d(!1)},onSubmit:U}),D]})},qa=ye.Z.Text,La=ye.Z.Paragraph,Da=T()(T()(T()(T()({},p.Iap,"Webhook"),p.Ff2,"Messenger"),p.cRk,"Instagram"),p.SbP,"Whatsapp"),za=T()(T()(T()(T()({},p.Iap,(0,j.jsx)(Te.Z,{})),p.Ff2,(0,j.jsx)(Ae.Z,{})),p.cRk,(0,j.jsx)(Me.Z,{})),p.SbP,(0,j.jsx)(Ce.Z,{})),Va="appSecret",Ua="verifyToken",Na="accessToken",Oa="pageAccessToken",Ka=function(){var e=(0,b.useIntl)(),n=Pa((function(e){return{currentInstagram:e.currentInstagram,refreshCurrentInstagram:e.refreshCurrentInstagram}})),t=n.currentInstagram,r=n.refreshCurrentInstagram,a=(0,y.useState)(T()(T()(T()(T()({},Va,!1),Ua,!1),Na,!1),Oa,!1)),s=i()(a,2),o=s[0],l=s[1],u=(0,y.useState)(!1),d=i()(u,2),p=(d[0],d[1],(0,y.useState)(!1)),f=i()(p,2),h=f[0],m=f[1],g=(0,y.useState)(!1),x=i()(g,2),w=x[0],k=x[1],Z=function(e){l((function(n){return c()(c()({},n),{},T()({},e,!n[e]))}))},A=function(e,n){return e?n?e:"******":"-"},M=function(){var e=S()(C()().mark((function e(){var n;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新Token，应用信息不完整"),e.abrupt("return");case 3:return m(!0),e.prev=4,e.next=7,Aa({uid:t.uid});case 7:n=e.sent,console.log("refreshAccessTokenInstagram response",n),200===n.code?(R.yw.success("AccessToken 刷新成功"),r&&r(n.data),I()):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,m(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}(),I=function(){var e=S()(C()().mark((function e(){var n,a;return C()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=t&&t.uid){e.next=3;break}return R.yw.error("无法刷新详情，应用信息不完整"),e.abrupt("return");case 3:return k(!0),e.prev=4,e.next=7,xa({uid:t.uid});case 7:n=e.sent,console.log("queryInstagramByUid refresh detail",n),200===n.code?(a=n.data,R.yw.success("应用详情刷新成功"),r&&r(a)):R.yw.error("刷新失败: ".concat(n.message||"未知错误")),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(4),R.yw.error("刷新出错: ".concat(e.t0 instanceof Error?e.t0.message:"未知错误"));case 15:return e.prev=15,k(!1),e.finish(15);case 18:case"end":return e.stop()}}),e,null,[[4,12,15,18]])})));return function(){return e.apply(this,arguments)}}();return null!=t&&t.uid?(0,j.jsxs)(ve.Z,{title:(0,j.jsxs)(ce.Z,{children:[za[t.type]||(0,j.jsx)(Ae.Z,{}),(0,j.jsx)("span",{children:t.name||"Instagram应用详情"}),(0,j.jsx)(we.Z,{color:"blue",children:Da[t.type]||t.type})]}),extra:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(H.Z,{}),onClick:function(){var e=new CustomEvent("metaapp-edit",{detail:{app:t}});window.dispatchEvent(e)},type:"default",children:"编辑"}),(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(G.Z,{}),onClick:I,loading:w,type:"primary",children:"刷新详情"})]}),bordered:!1,children:[(0,j.jsxs)(ke.Z,{bordered:!0,column:1,children:[(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.uid",defaultMessage:"应用UID"}),children:(0,j.jsx)(qa,{copyable:!0,children:t.uid})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.name",defaultMessage:"应用名称"}),children:t.name}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"app.type",defaultMessage:"应用类型"}),children:(0,j.jsx)(we.Z,{color:"blue",children:Da[t.type]||t.type})}),(0,j.jsx)(ke.Z.Item,{label:"AppID",children:(0,j.jsx)(qa,{copyable:!0,children:t.appId})}),(0,j.jsx)(ke.Z.Item,{label:"AppSecret",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(qa,{copyable:!!o[Va]&&{text:t.appSecret||""},children:A(t.appSecret,o[Va])}),(0,j.jsx)(Ze.Z,{title:o[Va]?"隐藏AppSecret":"显示AppSecret",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Va]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(Va)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"回调网址",children:(0,j.jsx)(qa,{copyable:!0,children:(0,v.kG)()+"/meta/webhooks/"+t.uid})}),(0,j.jsx)(ke.Z.Item,{label:"验证口令",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(qa,{copyable:!!o[Ua]&&{text:t.verifyToken||""},children:A(t.verifyToken,o[Ua])}),(0,j.jsx)(Ze.Z,{title:o[Ua]?"隐藏Verify Token":"显示Verify Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Ua]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(Ua)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page Access Token",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(qa,{copyable:!!o[Oa]&&{text:t.pageAccessToken||""},children:A(t.pageAccessToken,o[Oa])}),(0,j.jsx)(Ze.Z,{title:o[Oa]?"隐藏Page Access Token":"显示Page Access Token",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Oa]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(Oa)},size:"small"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Page ID",children:(0,j.jsx)(qa,{copyable:!0,children:t.pageId||"-"})}),(0,j.jsx)(ke.Z.Item,{label:"AccessToken",children:(0,j.jsxs)(ce.Z,{children:[(0,j.jsx)(qa,{copyable:!!o[Na]&&{text:t.accessToken||""},children:A(t.accessToken,o[Na])}),(0,j.jsx)(Ze.Z,{title:o[Na]?"隐藏AccessToken":"显示AccessToken",children:(0,j.jsx)(ee.ZP,{type:"text",icon:o[Na]?(0,j.jsx)(Ee.Z,{}):(0,j.jsx)(Te.Z,{}),onClick:function(){return Z(Na)},size:"small"})}),(0,j.jsx)(Ze.Z,{title:"刷新AccessToken",children:(0,j.jsx)(ee.ZP,{type:"primary",icon:(0,j.jsx)(Re.Z,{}),onClick:M,size:"small",loading:h,children:"刷新Token"})})]})}),(0,j.jsx)(ke.Z.Item,{label:"Token过期时间",children:t.accessTokenExpiresAt?We()(t.accessTokenExpiresAt).format("YYYY-MM-DD HH:mm:ss"):"-"}),t.description&&(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"description",defaultMessage:"描述"}),children:(0,j.jsx)(La,{children:t.description})}),(0,j.jsx)(ke.Z.Item,{label:e.formatMessage({id:"createdAt",defaultMessage:"创建时间"}),children:t.createdAt?We()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"})]}),(0,j.jsx)(be.Z,{}),(0,j.jsx)(ye.Z.Title,{level:5,children:"安全说明"}),(0,j.jsx)(La,{children:(0,j.jsxs)("ul",{children:[(0,j.jsx)("li",{children:"请保管好您的Meta应用凭证，避免泄露"}),(0,j.jsx)("li",{children:"请妥善保存 Verify Token 和 App Secret，这些信息不应公开"}),(0,j.jsx)("li",{children:"建议定期检查应用访问日志，确保没有异常访问"}),(0,j.jsx)("li",{children:"如发现安全问题，请立即更新凭证并联系我们的支持团队"})]})})]}):(0,j.jsx)(ve.Z,{bordered:!1,title:"Instagram应用详情",extra:(0,j.jsx)(ee.ZP,{icon:(0,j.jsx)(Se.Z,{}),onClick:function(){return window.open("https://www.weiyuai.cn/docs/zh-CN/docs/channel/instagram","_blank")},type:"link",children:"文档"}),children:(0,j.jsx)(je.Z,{description:"请先在左侧列表选择一个Instagram应用",image:je.Z.PRESENTED_IMAGE_SIMPLE})})},_a=function(e){console.log(e)},Ba=[{key:"detail",label:"应用详情",children:(0,j.jsx)(Ka,{})}],Ya=function(e){e.type;var n=(0,y.useState)(Ba),t=i()(n,2),r=t[0],a=t[1];return(0,y.useEffect)((function(){var e=[].concat(Ba);a(e)}),[]),(0,j.jsx)(j.Fragment,{children:(0,j.jsx)(Z.Z,{defaultActiveKey:"agent",items:r,onChange:_a})})},Ga=a.Z.Sider,Ha=a.Z.Content,Ja=function(e){var n=e.type,t=(0,r.Z)(),s=t.leftSiderStyle,i=t.leftSiderWidth;return(0,j.jsxs)(a.Z,{children:[(0,j.jsx)(Ga,{width:i,style:s,children:(0,j.jsx)(Fa,{type:n})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(Ha,{children:(0,j.jsx)(Ya,{type:n})})})]})},Xa=function(e){var n=e.channel,t="web"===(null==n?void 0:n.name)||"npm"===(null==n?void 0:n.name);return(0,j.jsxs)("div",{children:[t&&(0,j.jsx)(tn,{channel:n}),"app"===(null==n?void 0:n.name)&&(0,j.jsx)(qn,{type:null==n?void 0:n.name}),"wechat-app"===(null==n?void 0:n.name)&&(0,j.jsx)(Ye,{type:null==n?void 0:n.name}),"messenger"===(null==n?void 0:n.name)&&(0,j.jsx)(ha,{type:p.Ff2}),"instagram"===(null==n?void 0:n.name)&&(0,j.jsx)(Ja,{type:p.cRk}),"whatsapp"===(null==n?void 0:n.name)&&(0,j.jsx)(Er,{type:p.SbP}),"telegram"===(null==n?void 0:n.name)&&(0,j.jsx)(It,{type:null==n?void 0:n.name}),"line"===(null==n?void 0:n.name)&&(0,j.jsx)($t,{type:null==n?void 0:n.name}),"email"===(null==n?void 0:n.name)&&(0,j.jsx)(rt,{type:null==n?void 0:n.name}),"douyin"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"xiaohongshu"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"baidu"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"weibo"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"pdd"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"jd"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"qianniu"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"doudian"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"whatsapp"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"telegram"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"facebook"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"line"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"shopify"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"lazada"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"wordpress"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"woocommerce"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"opencart"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"magento"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"prestashop"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"dify"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{}),"coze"===(null==n?void 0:n.name)&&(0,j.jsx)(A,{})]})},Qa=function(){var e=(0,y.useState)(""),n=i()(e,2),t=n[0],r=n[1],a=(0,y.useState)([]),s=i()(a,2),o=s[0],l=s[1],c=g().currentChannel;(0,y.useEffect)((function(){c&&u(c)}),[c]);var u=function(e){var n=e.name;-1===o.findIndex((function(e){return e.key===n}))&&l([].concat(d()(o),[{label:e.nickname,key:n,children:(0,j.jsx)(Xa,{channel:e}),channelInfo:e,closable:!0}])),r(n)};return(0,j.jsx)(Z.Z,{hideAdd:!0,onChange:function(e){r(e)},activeKey:t,type:"editable-card",onEdit:function(e,n){"remove"===n&&function(e){var n=o.findIndex((function(n){return n.key===e})),a=o.filter((function(n){return n.key!==e}));if(a.length&&e===t){var s=a[n===a.length?n-1:n].key;r(s)}l(a)}(e)},items:o})},$a=a.Z.Sider,es=a.Z.Content,ns=function(){var e=(0,r.Z)(),n=e.leftSiderStyle,t=e.contentStyle;return(0,j.jsx)(j.Fragment,{children:(0,j.jsxs)(a.Z,{children:[(0,j.jsx)($a,{style:n,children:(0,j.jsx)(k,{})}),(0,j.jsx)(a.Z,{children:(0,j.jsx)(es,{style:t,children:(0,j.jsx)(Qa,{})})})]})})}}}]);