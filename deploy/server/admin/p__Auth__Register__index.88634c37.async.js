"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[1730],{98899:function(e,t,a){a.d(t,{Z:function(){return M}});var r=a(90819),s=a.n(r),n=a(89933),o=a.n(n),i=a(45332),c=a.n(i),u=a(31756),l=a(25191),d=a(75699);function g(){return p.apply(this,arguments)}function p(){return(p=o()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t){return h.apply(this,arguments)}function h(){return(h=o()(s()().mark((function e(t,a){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:t,captchaCode:a,channel:l.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=a(80597),x=a(16799),v=a(44194),w=a(31549),M=function(e){var t=e.onKaptchaChange,a=e.onKaptchaCheck,r=(0,d.useIntl)(),n=(0,v.useState)(),i=c()(n,2),l=i[0],p=i[1],h=(0,v.useState)(),M=c()(h,2),y=M[0],j=M[1],k=function(){var e=o()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:200===(t=e.sent).code?(p(t.data.captchaUid),j(t.data.captchaImage)):u.yw.error(r.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),b=function(){var e=o()(s()().mark((function e(t,r){var n;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,r);case 2:n=e.sent,console.log("checkCaptcha response",n),200===n.code?a&&a(!0):a&&a(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}();(0,v.useEffect)((function(){k()}),[]);return(0,w.jsx)(w.Fragment,{children:y&&(0,w.jsxs)(w.Fragment,{children:[(0,w.jsx)(x.Z,{onChange:function(e){t&&(t(l,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?b(l,e.target.value):a&&a(!1))},prefix:(0,w.jsx)(m.Z,{}),placeholder:r.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,w.jsx)("img",{src:y,alt:"captcha",onClick:k})]})})}},26776:function(e,t,a){a.r(t);var r=a(73193),s=a.n(r),n=a(90819),o=a.n(n),i=a(89933),c=a.n(i),u=a(45332),l=a.n(u),d=a(14163),g=a(37890),p=a(57039),f=a(76630),h=a(82325),m=a(6373),x=a(20984),v=a(91285),w=a(22766),M=a(97913),y=a(92728),j=a(75699),k=a(57880),b=a(79105),C=a(95054),Z=a(4363),S=a(48595),q=a(91259),T=a(44194),A=a(52544),F=a(31756),z=a(25191),P=a(40039),I=a(56321),L=a(76790),R=a(32057),U=a(98899),B=a(32597),N=a(31549),E=k.Z.defaultAlgorithm,K=k.Z.darkAlgorithm,V=function(){var e=(0,y.l)((function(e){var t=e.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:t.borderRadius,":hover":{backgroundColor:t.colorBgTextHover}}}));return(0,N.jsx)("div",{className:e,"data-lang":!0,children:j.SelectLang&&(0,N.jsx)(j.SelectLang,{})})},$=function(e){var t=e.content;return(0,N.jsx)(b.Z,{style:{marginBottom:24},message:t,type:"error",showIcon:!0})},_=function(){var e=m.A.useForm(),t=l()(e,1)[0],a=k.Z.useToken().token,r=(0,A.Z)().isDarkMode,n=(0,T.useRef)(),i=(0,T.useState)(!1),u=l()(i,2),y=u[0],b=u[1],S=(0,j.useModel)("@@initialState"),q=(S.initialState,S.loading,S.refresh,S.setInitialState),E=(0,T.useState)(!1),K=l()(E,2),_=K[0],D=K[1],G=(0,P.t)((function(e){return e.setAccessToken})),H=(0,L.L)((function(e){return e.setUserInfo})),J=(0,j.getLocale)();console.log("register page locale:",J);var W=(0,j.useIntl)(),X=(0,T.useState)(""),Y=l()(X,2),O=Y[0],Q=Y[1],ee=(0,T.useState)(""),te=l()(ee,2),ae=te[0],re=te[1],se=function(){var e=c()(o()().mark((function e(a,r){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:Q(a),re(r),t.setFieldValue("captchaCode",r);case 3:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),ne=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:b(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,T.useEffect)((function(){(0,B.ME)(),(0,R.Bc)()&&D(!0),(0,R.pr)()}),[]);var oe=function(){var e=c()(o()().mark((function e(t){return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(0,I.flushSync)((function(){q((function(e){return s()(s()({},e),{},{userInfo:t})}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ie=function(){var e=c()(o()().mark((function e(t){var a,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("values:",t),F.yw.loading(W.formatMessage({id:"registering",defaultMessage:"registering..."})),e.next=5,(0,d.z2)(s()({},t));case 5:if(a=e.sent,console.log("registerResult:",a),200!==a.code){e.next=15;break}return F.yw.destroy(),F.yw.success(a.message),r={username:t.email,password:t.password,captchaUid:O,captchaCode:t.captchaCode,platform:z.iw8},ce(r),e.abrupt("return");case 15:F.yw.destroy(),F.yw.error(a.message);case 17:e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.log(e.t0),F.yw.error(W.formatMessage({id:"register.error",defaultMessage:"register failed"}));case 23:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),ce=function(){var e=c()(o()().mark((function e(t){var a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("handleSubmit values: ",t),F.yw.loading(W.formatMessage({id:"logging",defaultMessage:"logging..."})),e.next=5,(0,d.x4)(s()({},t));case 5:a=e.sent,console.log("LoginResult:",a),200===a.code?(F.yw.destroy(),F.yw.success(W.formatMessage({id:"login.success",defaultMessage:"login success"})),oe(a.data.user),H(a.data.user),G(a.data.accessToken),j.history.push("/")):(F.yw.destroy(),F.yw.error(a.message)),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(0),console.log(e.t0),F.yw.error(W.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 14:case"end":return e.stop()}}),e,null,[[0,10]])})));return function(t){return e.apply(this,arguments)}}();return(0,N.jsxs)(x._Y,{hashed:!1,dark:r,children:[(0,N.jsx)(V,{}),(0,N.jsx)("div",{style:{backgroundColor:a.colorBgContainer,textAlign:"center",height:"100vh",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:_?(0,N.jsxs)(v.U,{form:t,contentStyle:{minWidth:280,maxWidth:"75vw"},logo:(0,N.jsx)("img",{alt:"logo",src:"/admin/logo.png"}),title:(0,N.jsx)(j.FormattedMessage,{id:"app.title"}),subTitle:W.formatMessage({id:"pages.login.registerAccount"}),initialValues:{autoLogin:!0},submitter:{searchConfig:{submitText:W.formatMessage({id:"pages.login.register"})}},onFinish:function(){var e=c()(o()().mark((function e(t){var a;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("login values:",t),a={email:t.username,password:t.password,mobile:t.mobile,code:t.code,captchaUid:O,captchaCode:t.captchaCode,platform:z.iw8},console.log("register info:",a),e.next=5,ie(a);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:["error"===status&&(0,N.jsx)($,{content:W.formatMessage({id:"pages.login.accountLogin.errorMessage",defaultMessage:"账户或密码错误"})}),(0,N.jsx)(w.Z,{name:"username",fieldProps:{size:"large",prefix:(0,N.jsx)(p.Z,{})},placeholder:W.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"邮箱"}),rules:[{required:!0,message:(0,N.jsx)(j.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"请输入邮箱!"})},{pattern:/^[a-zA-Z0-9_.-]+@[a-zA-Z0-9-]+(\.[a-zA-Z0-9-]+)*\.[a-zA-Z0-9]{2,6}$/,message:"邮箱格式不正确"},{max:50,message:"邮箱不得超过50字符"}]}),(0,N.jsx)(w.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,N.jsx)(f.Z,{})},placeholder:W.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"密码"}),rules:[{required:!0,message:(0,N.jsx)(j.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"请输入密码！"})}]}),(0,N.jsx)(w.Z,{fieldProps:{size:"large",prefix:(0,N.jsx)(h.Z,{})},name:"mobile",placeholder:W.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,N.jsx)(j.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,N.jsx)(j.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]}),(0,N.jsx)(m.A.Item,{name:"captchaCode",rules:[{required:!0,message:W.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,N.jsx)(U.Z,{onKaptchaChange:se,onKaptchaCheck:ne})}),(0,N.jsx)(M.Z,{fieldProps:{size:"large",prefix:(0,N.jsx)(f.Z,{})},captchaProps:{size:"large",disabled:!y},placeholder:W.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,t){return e?"".concat(t," ").concat(W.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):W.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,N.jsx)(j.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:n,onGetCaptcha:function(){var e=c()(o()().mark((function e(t){var a,r;return o()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t||11!==t.length){e.next=13;break}return a={mobile:t,type:z.zgb,captchaUid:O,captchaCode:ae,platform:z.iw8},e.next=4,(0,d.Y7)(a);case 4:if(r=e.sent,console.log("sendMobileCodeResult:",r),200===r.code){e.next=10;break}return F.yw.error(r.message),setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=n.current)||void 0===e||e.endTiming()}),2),e.abrupt("return");case 10:F.yw.success(r.message),e.next=14;break;case 13:F.yw.error("手机号格式错误");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),"error"===status&&(0,N.jsx)($,{content:"验证码错误"}),(0,N.jsx)("div",{style:{marginBottom:64},children:(0,N.jsx)("div",{style:{float:"right"},children:(0,N.jsx)(j.Link,{to:"/auth/login",children:(0,N.jsx)(j.FormattedMessage,{id:"pages.login.submit",defaultMessage:"登录 "})})})})]}):(0,N.jsx)("div",{style:{textAlign:"center",margin:"0 auto"},children:(0,N.jsx)(C.Z,{description:"only for vip users, please contact: 270580156@qq.com",children:(0,N.jsx)(Z.ZP,{type:"primary",onClick:function(){window.open("https://www.weiyuai.cn")},children:"open weiyuai.cn"})})})}),(0,N.jsx)(g.$_,{})]})};t.default=function(){var e=(0,A.Z)().isDarkMode;return(0,N.jsx)(S.ZP,{theme:{algorithm:e?K:E},children:(0,N.jsxs)(q.Z,{children:[(0,N.jsx)(F.ZP,{}),(0,N.jsx)(_,{})]})})}}}]);