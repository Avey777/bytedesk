"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[6892],{58275:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(11757),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"defs",attrs:{},children:[{tag:"style",attrs:{}}]},{tag:"path",attrs:{d:"M899.1 869.6l-53-305.6H864c14.4 0 26-11.6 26-26V346c0-14.4-11.6-26-26-26H618V138c0-14.4-11.6-26-26-26H432c-14.4 0-26 11.6-26 26v182H160c-14.4 0-26 11.6-26 26v192c0 14.4 11.6 26 26 26h17.9l-53 305.6a25.95 25.95 0 0025.6 30.4h723c1.5 0 3-.1 4.4-.4a25.88 25.88 0 0021.2-30zM204 390h272V182h72v208h272v104H204V390zm468 440V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H416V674c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v156H202.8l45.1-260H776l45.1 260H672z"}}]},name:"clear",theme:"outlined"},s=r(54183),l=function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var i=a.forwardRef(l)},15722:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(11757),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M512 64C264.6 64 64 264.6 64 512s200.6 448 448 448 448-200.6 448-448S759.4 64 512 64zm0 820c-205.4 0-372-166.6-372-372s166.6-372 372-372 372 166.6 372 372-166.6 372-372 372z"}},{tag:"path",attrs:{d:"M464 688a48 48 0 1096 0 48 48 0 10-96 0zm24-112h48c4.4 0 8-3.6 8-8V296c0-4.4-3.6-8-8-8h-48c-4.4 0-8 3.6-8 8v272c0 4.4 3.6 8 8 8z"}}]},name:"exclamation-circle",theme:"outlined"},s=r(54183),l=function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var i=a.forwardRef(l)},2484:function(e,t,r){r.d(t,{Z:function(){return i}});var n=r(11757),a=r(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},s=r(54183),l=function(e,t){return a.createElement(s.Z,(0,n.Z)({},e,{ref:t,icon:o}))};var i=a.forwardRef(l)},84881:function(e,t,r){var n=r(17082),a=r(73457),o=r(82308),s=r(44194),l=r(63653),i=r(35175),u=r(31549),c=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],p=function(e,t){var r=e.fieldProps,d=e.children,p=e.params,f=e.proFieldProps,h=e.mode,g=e.valueEnum,m=e.request,v=e.showSearch,x=e.options,b=(0,a.Z)(e,c),w=(0,s.useContext)(l.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,o.h)(g),request:m,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({options:x,mode:h,showSearch:v,getPopupContainer:w.getPopupContainer},r),ref:t,proFieldProps:f},b),{},{children:d}))},f=s.forwardRef((function(e,t){var r=e.fieldProps,c=e.children,p=e.params,f=e.proFieldProps,h=e.mode,g=e.valueEnum,m=e.request,v=e.options,x=(0,a.Z)(e,d),b=(0,n.Z)({options:v,mode:h||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},r),w=(0,s.useContext)(l.Z);return(0,u.jsx)(i.Z,(0,n.Z)((0,n.Z)({valueEnum:(0,o.h)(g),request:m,params:p,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,n.Z)({getPopupContainer:w.getPopupContainer},b),ref:t,proFieldProps:f},x),{},{children:c}))})),h=s.forwardRef(p);h.SearchSelect=f,h.displayName="ProFormComponent",t.Z=h},4499:function(e,t,r){var n=r(42601),a=r(17082),o=r(73457),s=r(46015),l=r(16309),i=r(98036),u=r(36490),c=r(44194),d=r(35175),p=r(31549),f=["fieldProps","proFieldProps"],h=["fieldProps","proFieldProps"],g="text",m=function(e){var t=(0,s.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),r=(0,n.Z)(t,2),o=r[0],u=r[1];return(0,p.jsx)(l.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var r,n=t.getFieldValue(e.name||[]);return(0,p.jsx)(i.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return u(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(r=e.statusRender)||void 0===r?void 0:r.call(e,n),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:o,children:e.children}))}})},v=function(e){var t=e.fieldProps,r=e.proFieldProps,n=(0,o.Z)(e,f);return(0,p.jsx)(d.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:r},n))};v.Password=function(e){var t=e.fieldProps,r=e.proFieldProps,s=(0,o.Z)(e,h),l=(0,c.useState)(!1),i=(0,n.Z)(l,2),f=i[0],v=i[1];return null!=t&&t.statusRender&&s.name?(0,p.jsx)(m,{name:s.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:f,onOpenChange:v,children:(0,p.jsx)("div",{children:(0,p.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,u.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var r;null==t||null===(r=t.onBlur)||void 0===r||r.call(t,e),v(!1)},onClick:function(e){var r;null==t||null===(r=t.onClick)||void 0===r||r.call(t,e),v(!0)}}),proFieldProps:r,filedConfig:{valueType:g}},s))})}):(0,p.jsx)(d.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:r,filedConfig:{valueType:g}},s))},v.displayName="ProFormComponent",t.Z=v},32350:function(e,t,r){var n=r(17082),a=r(73457),o=r(44194),s=r(35175),l=r(31549),i=["fieldProps","proFieldProps"],u=function(e,t){var r=e.fieldProps,o=e.proFieldProps,u=(0,a.Z)(e,i);return(0,l.jsx)(s.Z,(0,n.Z)({ref:t,valueType:"textarea",fieldProps:r,proFieldProps:o},u))};t.Z=o.forwardRef(u)},76750:function(e,t,r){var n=r(55735),a=r(65461),o=r(41159);t.Z=function(){var e=(0,o.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(n.VoP)||null!=t&&t.startsWith("ROLE_")?(0,a.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,a.aS)(t,10)}}}},72469:function(e,t,r){r.r(t),r.d(t,{default:function(){return Q}});var n=r(73193),a=r.n(n),o=r(84176),s=r.n(o),l=r(86222),i=r.n(l),u=r(90819),c=r.n(u),d=r(89933),p=r.n(d),f=r(45332),h=r.n(f),g=r(86803),m=r(55735),v=r(41159);function x(e){return b.apply(this,arguments)}function b(){return(b=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/webhook/query/org",{method:"GET",params:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return y.apply(this,arguments)}function y(){return(y=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/webhook/create",{method:"POST",data:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function M(e){return Z.apply(this,arguments)}function Z(){return(Z=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/webhook/update",{method:"POST",data:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return P.apply(this,arguments)}function P(){return(P=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/webhook/delete",{method:"POST",data:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return S.apply(this,arguments)}function S(){return(S=p()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,v.request)("/api/v1/webhook/delete/all",{method:"POST",data:a()(a()({},t),{},{client:m.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var C=r(40612),T=r(15722),F=r(10162),A=r(54881),R=r(58275),V=r(2484),E=r(48524),q=r(53530),O=r(29266),z=r(61355),I=r(75365),W=r(96485),B=r(44194),H=r(69169),N=r(4499),D=r(84881),L=r(32350),U=r(73442),K=r(31549),_=function(e){var t=e.isEdit,r=e.webhook,n=e.open,o=e.onClose,s=e.onSubmit,l=H.A.useForm(),i=h()(l,1)[0],u=(0,C.u)((function(e){return e.currentOrg}));return(0,B.useEffect)((function(){t?i.setFieldsValue({uid:null==r?void 0:r.uid,name:null==r?void 0:r.name,type:null==r?void 0:r.type,color:null==r?void 0:r.color}):i.setFieldsValue({name:"",type:"",color:"blue"})}),[t,r,i]),(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(U.Z,{title:"Webhook",width:600,onClose:o,open:n,children:(0,K.jsxs)(H.A,{form:i,name:"webhookForm",onFinish:function(){console.log("handleSubmit"),i.validateFields().then((function(e){var t=a()(a()({},e),{},{orgUid:null==u?void 0:u.uid});console.log("submit",t),s(t)}))},children:[(0,K.jsx)(N.Z,{label:"名称",name:"name",rules:[{required:!0}]}),(0,K.jsx)(D.Z,{name:"type",label:"类型",width:"md",options:[{label:"消息通知",value:"message"},{label:"事件通知",value:"event"},{label:"状态通知",value:"status"}],rules:[{required:!0}]}),(0,K.jsx)(D.Z,{name:"color",label:"颜色",width:"md",options:[{label:"red",value:"red"},{label:"magenta",value:"magenta"},{label:"volcano",value:"volcano"},{label:"orange",value:"orange"},{label:"gold",value:"gold"},{label:"lime",value:"lime"},{label:"green",value:"green"},{label:"cyan",value:"cyan"},{label:"blue",value:"blue"},{label:"geekblue",value:"geekblue"},{label:"purple",value:"purple"}],rules:[{required:!0}]}),(0,K.jsx)(L.Z,{label:"描述",name:"description"})]})})})},G=r(76750),J=["current","pageSize"],Q=function(){var e=(0,v.useIntl)(),t=(0,B.useRef)(),r=(0,G.Z)().translateString,n=(0,B.useState)(1),o=h()(n,2),l=(o[0],o[1]),u=(0,B.useState)(10),d=h()(u,2),f=(d[0],d[1]),m=(0,C.u)((function(e){return e.currentOrg})),b=(0,B.useState)(!1),y=h()(b,2),Z=y[0],P=y[1],S=(0,B.useState)({}),H=h()(S,2),N=H[0],D=H[1],L=(0,B.useState)(!1),U=h()(L,2),Q=U[0],X=U[1],Y=q.Z.useModal(),$=h()(Y,2),ee=$[0],te=$[1],re=(0,B.useState)([]),ne=h()(re,2),ae=ne[0],oe=ne[1],se=(0,B.useState)([]),le=h()(se,2),ie=le[0],ue=le[1],ce=(0,B.useState)(0),de=h()(ce,2),pe=de[0],fe=de[1],he=(0,B.useState)({}),ge=h()(he,2),me=(ge[0],ge[1]),ve=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,K.jsx)(v.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,K.jsx)(v.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",hideInSearch:!0,width:120,render:function(e,t){return(0,K.jsx)(K.Fragment,{children:(0,K.jsx)(O.Z,{color:"blue",children:t.type})})}},{title:(0,K.jsx)(v.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,width:180},{title:(0,K.jsx)(v.FormattedMessage,{id:"updatedAt",defaultMessage:"updatedAt"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,width:180}],xe=[].concat(ve,[{title:e.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:120,render:function(t,n,a,o){return[(0,K.jsx)("a",{onClick:function(){D(n),X(!0),P(!0)},children:e.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,K.jsx)(z.Z,{title:e.formatMessage({id:"deleteTip"}),description:"".concat(e.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(r(n.name),"】？"),onConfirm:function(){return be(n)},okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"}),icon:(0,K.jsx)(T.Z,{style:{color:"red"}}),children:(0,K.jsx)(I.ZP,{type:"link",danger:!0,children:e.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")]}}]),be=function(){var r=p()(c()().mark((function r(n){var a;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return console.log("deleteWebhook:",n),r.next=3,k(n);case 3:a=r.sent,console.log("deleteWebhook:",a),200===a.code?(g.yw.success(e.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),t.current.reload()):g.yw.error(a.message);case 6:case"end":return r.stop()}}),r)})));return function(e){return r.apply(this,arguments)}}(),we=function(){var e=p()(c()().mark((function e(r){var n,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,w(r);case 2:n=e.sent,console.log("handleCreateWebhook response:",n),200===n.code?(null===(a=t.current)||void 0===a||a.reload(),P(!1)):g.yw.error(n.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ye=function(){var e=p()(c()().mark((function e(r){var n,a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r.uid=null==N?void 0:N.uid,e.next=3,M(r);case 3:n=e.sent,console.log("handleUpdateWebhook response:",n),200===n.code?(null===(a=t.current)||void 0===a||a.reload(),P(!1)):g.yw.error(n.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){P(!0),X(!1),D({})},Ze=function(){var r=p()(c()().mark((function r(){var n,a,o,s,l,u;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==ie.length){r.next=3;break}return g.yw.warning(e.formatMessage({id:"batch.delete.noselection",defaultMessage:"请选择要删除的项目"})),r.abrupt("return");case 3:g.yw.loading(e.formatMessage({id:"deleting",defaultMessage:"正在删除..."})),a=0,o=0,s=i()(ie),r.prev=7,s.s();case 9:if((l=s.n()).done){r.next=23;break}return u=l.value,r.prev=11,r.next=14,k(u);case 14:200===r.sent.code?a++:o++,r.next=21;break;case 18:r.prev=18,r.t0=r.catch(11),o++;case 21:r.next=9;break;case 23:r.next=28;break;case 25:r.prev=25,r.t1=r.catch(7),s.e(r.t1);case 28:return r.prev=28,s.f(),r.finish(28);case 31:g.yw.destroy(),0===o?g.yw.success(e.formatMessage({id:"batch.delete.success",defaultMessage:"成功删除 {count} 条记录"},{count:a})):g.yw.warning(e.formatMessage({id:"batch.delete.partial",defaultMessage:"删除了 {success} 条记录，{fail} 条记录删除失败"},{success:a,fail:o})),oe([]),ue([]),null===(n=t.current)||void 0===n||n.reloadAndRest();case 36:case"end":return r.stop()}}),r,null,[[7,25,28,31],[11,18]])})));return function(){return r.apply(this,arguments)}}(),ke=function(){var r=p()(c()().mark((function r(){var n,a,o;return c()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(0!==pe){r.next=3;break}return g.yw.warning(e.formatMessage({id:"deleteAll.nodata",defaultMessage:"没有数据可删除"})),r.abrupt("return");case 3:return g.yw.loading(e.formatMessage({id:"deleting.all",defaultMessage:"正在删除所有数据..."})),r.prev=4,n={orgUid:null==m?void 0:m.uid},r.next=8,j(n);case 8:200===(a=r.sent).code?(g.yw.destroy(),g.yw.success(e.formatMessage({id:"deleteAll.success",defaultMessage:"成功删除所有数据"})),null===(o=t.current)||void 0===o||o.reloadAndRest()):(g.yw.destroy(),g.yw.error(a.message||e.formatMessage({id:"deleteAll.failed",defaultMessage:"删除失败"}))),r.next=17;break;case 12:r.prev=12,r.t0=r.catch(4),g.yw.destroy(),g.yw.error(e.formatMessage({id:"deleteAll.error",defaultMessage:"删除过程发生错误"})),console.error("删除全部数据错误:",r.t0);case 17:case"end":return r.stop()}}),r,null,[[4,12]])})));return function(){return r.apply(this,arguments)}}(),Pe={selectedRowKeys:ae,onChange:function(e,t){oe(e),ue(t)}},je=function(){var e=p()(c()().mark((function e(t,r,n){var o,i,u,d,p;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=t.current,i=t.pageSize,u=s()(t,J),l(o),f(i),me(u),d=a()({pageNumber:o-1,pageSize:i,orgUid:null==m?void 0:m.uid},u),e.next=7,x(d);case 7:return p=e.sent,console.log("queryWebhooksByOrg response:",p,d),200===p.code?fe(p.data.totalElements):g.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,r,n){return e.apply(this,arguments)}}();return(0,K.jsxs)(K.Fragment,{children:[Z&&(0,K.jsx)(_,{isEdit:Q,open:Z,webhook:N,onClose:function(){P(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),Q?ye(e):we(e)}}),(0,K.jsx)(E.Z,{columns:xe,actionRef:t,cardBordered:!0,rowSelection:Pe,request:je,scroll:{x:1e3},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),f(t)}},dateFormatter:"string",headerTitle:"Webhook列表",toolBarRender:function(){return t=[(0,K.jsx)(I.ZP,{type:"primary",icon:(0,K.jsx)(F.Z,{}),onClick:Me,children:e.formatMessage({id:"create",defaultMessage:"Create"})},"create")],r=[],ae.length>0&&r.push({key:"batchDelete",icon:(0,K.jsx)(A.Z,{}),danger:!0,label:e.formatMessage({id:"batch.delete"})+" (".concat(ae.length,")"),onClick:function(){ee.confirm({title:e.formatMessage({id:"batch.deleteTip"}),content:"".concat(e.formatMessage({id:"batch.deleteAffirm"})," ").concat(ae.length," ").concat(e.formatMessage({id:"items"}),"?"),onOk:Ze,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.push({key:"deleteAll",icon:(0,K.jsx)(R.Z,{}),danger:!0,label:e.formatMessage({id:"deleteAll",defaultMessage:"删除所有"}),onClick:function(){ee.confirm({title:e.formatMessage({id:"deleteAll.tip",defaultMessage:"删除确认"}),content:e.formatMessage({id:"deleteAll.confirm",defaultMessage:"确定要删除所有Webhook数据吗？此操作不可恢复!"}),onOk:ke,okText:e.formatMessage({id:"ok"}),cancelText:e.formatMessage({id:"cancel"})})}}),r.length>0&&t.push((0,K.jsx)(W.Z,{menu:{items:r},placement:"bottom",children:(0,K.jsxs)(I.ZP,{type:ae.length>0?"primary":"default",danger:ae.length>0,children:[ae.length>0?e.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(ae.length,")"):e.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,K.jsx)(V.Z,{})]})},"batchOperations")),t;var t,r}}),te]})}}}]);