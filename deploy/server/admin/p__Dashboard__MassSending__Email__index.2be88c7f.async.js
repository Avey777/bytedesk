"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[3900],{85030:function(e,t,a){a.r(t),a.d(t,{default:function(){return K}});var o=a(44194),r=a(90962),n=a(75699),s=a(84176),i=a.n(s),l=a(73193),d=a.n(l),c=a(90819),u=a.n(c),f=a(89933),g=a.n(f),p=a(45332),w=a.n(p),m=a(81213),M=a(30024),y=a(4363),v=a(42119),x=a(31756),h=a(90296),k=a(25191),b=a(65105),j=a(83381),S=a(32164),C=a(6992),Z=a(28031),I=a(80503),A=a(30234),U=a(31881),z=a(24418),B=a(28977),T=a.n(B),P=a(32597),D=a(6373),E=a(31051),O=a(22766),F=a(12581),H=a(65318),R=a(81020),Y=a(31549),q=function(e){var t,a,r=e.isEdit,s=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,c=D.A.useForm(),u=w()(c,1)[0],f=(0,n.useIntl)(),g=(0,U.u)((function(e){return e.currentOrg})),p=(0,o.useState)(),m=w()(p,2),M=m[0],v=m[1],x=(0,b.v)((function(e){return e.categoryResult})),h=(0,A.Z)().translateString;(0,o.useEffect)((function(){if(r&&s&&u){var e;u.setFieldsValue({uid:null==s?void 0:s.uid,name:null==s?void 0:s.name,type:null==s?void 0:s.type,content:null==s?void 0:s.content,description:null==s?void 0:s.description,categoryUid:null==s?void 0:s.categoryUid});var t=null==x||null===(e=x.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==s?void 0:s.categoryUid)}));v(t)}else console.log("form resetFields"),u.resetFields()}),[s,u,r,null==x||null===(t=x.data)||void 0===t?void 0:t.content]);return(0,Y.jsx)("div",{children:(0,Y.jsx)(H.Z,{title:r?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,Y.jsxs)(R.Z,{children:[(0,Y.jsx)(y.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,Y.jsx)(y.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:r?null==s?void 0:s.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,Y.jsxs)(D.A,{form:u,name:"workflow",submitter:!1,children:[(0,Y.jsx)(E.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==x||null===(a=x.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),v(null==x||null===(t=x.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},W=["current","pageSize","content"],N=function(e){var t=e.level,a=(e.type,(0,o.useRef)()),r=(0,n.useIntl)(),s=(0,o.useState)(!0),l=w()(s,2),c=l[0],f=l[1],p=(0,A.Z)().translateString,B=(0,o.useState)(1),D=w()(B,2),E=D[0],O=D[1],F=(0,o.useState)(10),H=w()(F,2),R=H[0],N=H[1],L=(0,o.useState)(!1),_=w()(L,2),J=_[0],K=_[1],G=(0,o.useState)([]),Q=w()(G,2),V=(Q[0],Q[1]),$=(0,o.useState)({}),X=w()($,2),ee=X[0],te=X[1],ae=(0,b.v)((function(e){return e.currentCategory})),oe=(0,U.u)((function(e){return e.currentOrg})),re=m.Z.useModal(),ne=w()(re,2),se=ne[0],ie=ne[1],le=(0,o.useState)(0),de=w()(le,2),ce=de[0],ue=de[1],fe=(0,o.useState)({}),ge=w()(fe,2),pe=ge[0],we=ge[1],me=function(){var e=g()(u()().mark((function e(t){var o,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h._I)(t);case 3:200===(o=e.sent).code?(x.yw.destroy(),x.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=a.current)||void 0===n||n.reload()):(x.yw.destroy(),x.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=g()(u()().mark((function e(t){var o,n,s,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=8;break}return x.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.rI)(t);case 4:200===(o=e.sent).code?(x.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(n=a.current)||void 0===n||n.reload(),K(!1)):x.yw.error(o.message),e.next=13;break;case 8:return x.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.$B)(t);case 11:200===(s=e.sent).code?(x.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),K(!1)):x.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[ae]);var ye=function(){var e=g()(u()().mark((function e(a,o,r){var n,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,o,r),n=localStorage.getItem(k.LA8),s=d()({categoryUid:(null==ae?void 0:ae.uid)===k.zBg?"":null==ae?void 0:ae.uid,orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,level:t,accessToken:n||"",exportType:a},pe),"current"===a?(s.pageNumber=String(E-1),s.pageSize=String(R)):"all"===a?(s.pageNumber="0",s.pageSize="1000"):"range"===a&&void 0!==o&&void 0!==r&&(s.pageNumber=String(o),s.pageSize=String(r)),window.open((0,P.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}(),ve=function(e){for(var t=[],a=1e3,o=Math.ceil(e/a),r=function(){var o=n,r=n*a+1,s=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(s," (").concat(s-r+1,"条)"),onClick:function(){return ye("range",o,a)}})},n=0;n<o;n++)r();return t},xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:r.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:r.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:r.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:r.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-";return(0,Y.jsx)(M.Z,{content:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,Y.jsx)("span",{children:r.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,Y.jsx)(y.ZP,{type:"text",icon:(0,Y.jsx)(S.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=a,navigator.clipboard.writeText(t).then((function(){x.yw.success(r.formatMessage({id:"copy.success",defaultMessage:"复制成功"}))}),(function(e){console.error("复制失败: ",e),x.yw.error(r.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}))}))},title:r.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,Y.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,Y.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:r.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?T()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?T()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,Y.jsx)("a",{onClick:function(){return function(e){f(!0),te(e),K(!0)}(t)},children:r.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,Y.jsx)("a",{onClick:function(){return e=t,void se.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,Y.jsx)(j.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(e.name),"】？"),onOk:function(){me(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],he=function(){var e=g()(u()().mark((function e(a,o,n){var s,l,c,f,g,p,w,m,M;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,c=a.content,f=i()(a,W),O(s),N(l),we(d()(d()({},f),{},{content:c})),g=void 0,p=void 0,o&&Object.keys(o).length>0&&(w=Object.keys(o)[0],g=w,p="ascend"===o[w]?"ascend":"descend"),m=d()(d()({pageNumber:s-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,categoryUid:(null==ae?void 0:ae.uid)===k.zBg?"":null==ae?void 0:ae.uid,level:t},f),{},{content:c,sortBy:g,sortDirection:p}),e.next=11,(0,h.Au)(m);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,m),200!==M.code){e.next=20;break}return x.yw.destroy(),V(M.data.content),ue(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return x.yw.destroy(),x.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(z.Z,{columns:xe,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){O(e),N(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,Y.jsx)(y.ZP,{type:"primary",onClick:function(){window.open((0,P.HU)(),"_blank")},icon:(0,Y.jsx)(C.Z,{}),children:r.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ye("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return ye("all")}}):t.push({key:"export-range",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:ve(ce)})),e.push((0,Y.jsx)(v.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(y.ZP,{type:"primary",icon:(0,Y.jsx)(Z.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,Y.jsx)(I.Z,{})]})},"export")),e},request:he}),J&&(0,Y.jsx)(q,{isEdit:c,workflow:ee,level:t,open:J,onClose:function(){return K(!1)},onSubmit:Me}),ie]})},L=function(e){var t,a,r=e.isEdit,s=e.workflow,i=e.open,l=(e.level,e.onClose),d=e.onSubmit,c=D.A.useForm(),u=w()(c,1)[0],f=(0,n.useIntl)(),g=(0,U.u)((function(e){return e.currentOrg})),p=(0,o.useState)(),m=w()(p,2),M=m[0],v=m[1],x=(0,b.v)((function(e){return e.categoryResult})),h=(0,A.Z)().translateString;(0,o.useEffect)((function(){if(r&&s&&u){var e;u.setFieldsValue({uid:null==s?void 0:s.uid,name:null==s?void 0:s.name,type:null==s?void 0:s.type,content:null==s?void 0:s.content,description:null==s?void 0:s.description,categoryUid:null==s?void 0:s.categoryUid});var t=null==x||null===(e=x.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.find((function(e){return e.uid===(null==s?void 0:s.categoryUid)}));v(t)}else console.log("form resetFields"),u.resetFields()}),[s,u,r,null==x||null===(t=x.data)||void 0===t?void 0:t.content]);return(0,Y.jsx)("div",{children:(0,Y.jsx)(H.Z,{title:r?f.formatMessage({id:"pages.workflow.drawer.edit",defaultMessage:"编辑工作流"}):f.formatMessage({id:"pages.workflow.drawer.create",defaultMessage:"新建工作流"}),width:650,onClose:l,open:i,extra:(0,Y.jsxs)(R.Z,{children:[(0,Y.jsx)(y.ZP,{onClick:l,children:f.formatMessage({id:"pages.workflow.drawer.cancel",defaultMessage:"取消"})}),(0,Y.jsx)(y.ZP,{onClick:function(){console.log("handleSubmit"),u.validateFields().then((function(e){console.log("Form values:",e);var t={uid:r?null==s?void 0:s.uid:"",name:e.name,type:e.type,content:e.content,description:e.description,categoryUid:null==M?void 0:M.uid,orgUid:null==g?void 0:g.uid};console.log("workflowObject:",t),d(t)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:f.formatMessage({id:"pages.workflow.drawer.save",defaultMessage:"保存"})})]}),children:(0,Y.jsxs)(D.A,{form:u,name:"workflow",submitter:!1,children:[(0,Y.jsx)(E.Z,{label:f.formatMessage({id:"pages.workflow.drawer.category",defaultMessage:"类别"}),name:"categoryUid",required:!0,options:null==x||null===(a=x.data)||void 0===a||null===(a=a.content)||void 0===a||null===(a=a.filter((function(e){return e.uid!==k.zBg})))||void 0===a?void 0:a.map((function(e){return{label:h(null==e?void 0:e.name),value:null==e?void 0:e.uid}})),fieldProps:{allowClear:!0,onChange:function(e){var t;console.log("handleChange:",e),v(null==x||null===(t=x.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.find((function(t){return t.uid===e})))}}}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.name",defaultMessage:"名称"}),name:"name",required:!0,tooltip:f.formatMessage({id:"pages.workflow.drawer.name.tooltip",defaultMessage:"工作流名称"})}),(0,Y.jsx)(O.Z,{label:f.formatMessage({id:"pages.workflow.drawer.type",defaultMessage:"类型"}),name:"type",tooltip:f.formatMessage({id:"pages.workflow.drawer.type.tooltip",defaultMessage:"工作流类型"}),fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.type.placeholder",defaultMessage:"请输入工作流类型"})}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.content",defaultMessage:"内容"}),name:"content",required:!0,fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.content.placeholder",defaultMessage:"请输入工作流内容"}),rows:10}}),(0,Y.jsx)(F.Z,{label:f.formatMessage({id:"pages.workflow.drawer.description",defaultMessage:"描述"}),name:"description",fieldProps:{placeholder:f.formatMessage({id:"pages.workflow.drawer.description.placeholder",defaultMessage:"请输入工作流描述"}),rows:4}})]})})})},_=["current","pageSize","content"],J=function(e){var t=e.level,a=(e.type,(0,o.useRef)()),r=(0,n.useIntl)(),s=(0,o.useState)(!0),l=w()(s,2),c=l[0],f=l[1],p=(0,A.Z)().translateString,B=(0,o.useState)(1),D=w()(B,2),E=D[0],O=D[1],F=(0,o.useState)(10),H=w()(F,2),R=H[0],q=H[1],W=(0,o.useState)(!1),N=w()(W,2),J=N[0],K=N[1],G=(0,o.useState)([]),Q=w()(G,2),V=(Q[0],Q[1]),$=(0,o.useState)({}),X=w()($,2),ee=X[0],te=X[1],ae=(0,b.v)((function(e){return e.currentCategory})),oe=(0,U.u)((function(e){return e.currentOrg})),re=m.Z.useModal(),ne=w()(re,2),se=ne[0],ie=ne[1],le=(0,o.useState)(0),de=w()(le,2),ce=de[0],ue=de[1],fe=(0,o.useState)({}),ge=w()(fe,2),pe=ge[0],we=ge[1],me=function(){var e=g()(u()().mark((function e(t){var o,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(r.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=3,(0,h._I)(t);case 3:200===(o=e.sent).code?(x.yw.destroy(),x.yw.success(r.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),null===(n=a.current)||void 0===n||n.reload()):(x.yw.destroy(),x.yw.error(o.message));case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){var e=g()(u()().mark((function e(t){var o,n,s,i;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!c){e.next=8;break}return x.yw.loading(r.formatMessage({id:"updating",defaultMessage:"Updating"})),e.next=4,(0,h.rI)(t);case 4:200===(o=e.sent).code?(x.yw.success(r.formatMessage({id:"update.success",defaultMessage:"update success"})),null===(n=a.current)||void 0===n||n.reload(),K(!1)):x.yw.error(o.message),e.next=13;break;case 8:return x.yw.loading(r.formatMessage({id:"creating",defaultMessage:"Creating"})),e.next=11,(0,h.$B)(t);case 11:200===(s=e.sent).code?(x.yw.success(r.formatMessage({id:"create.success",defaultMessage:"create success"})),null===(i=a.current)||void 0===i||i.reload(),K(!1)):x.yw.error(s.message);case 13:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,o.useEffect)((function(){var e;null===(e=a.current)||void 0===e||e.reload()}),[ae]);var ye=function(){var e=g()(u()().mark((function e(a,o,r){var n,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,o,r),n=localStorage.getItem(k.LA8),s=d()({categoryUid:(null==ae?void 0:ae.uid)===k.zBg?"":null==ae?void 0:ae.uid,orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,level:t,accessToken:n||"",exportType:a},pe),"current"===a?(s.pageNumber=String(E-1),s.pageSize=String(R)):"all"===a?(s.pageNumber="0",s.pageSize="1000"):"range"===a&&void 0!==o&&void 0!==r&&(s.pageNumber=String(o),s.pageSize=String(r)),window.open((0,P.kG)()+"/api/v1/workflow/export?"+new URLSearchParams(s).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}(),ve=function(e){for(var t=[],a=1e3,o=Math.ceil(e/a),r=function(){var o=n,r=n*a+1,s=Math.min((n+1)*a,e);t.push({key:"export-".concat(n),label:"".concat(r,"-").concat(s," (").concat(s-r+1,"条)"),onClick:function(){return ye("range",o,a)}})},n=0;n<o;n++)r();return t},xe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:r.formatMessage({id:"pages.workflow.name",defaultMessage:"名称"}),dataIndex:"name",hideInSearch:!1,fixed:"left",width:150,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.name.tooltip",defaultMessage:"工作流名称"})},{title:r.formatMessage({id:"pages.workflow.type",defaultMessage:"类型"}),dataIndex:"type",width:120,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.type.tooltip",defaultMessage:"工作流类型"})},{title:r.formatMessage({id:"pages.workflow.category",defaultMessage:"分类"}),dataIndex:"categoryUid",copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.category.tooltip",defaultMessage:"工作流所属分类"})},{title:r.formatMessage({id:"pages.workflow.description",defaultMessage:"描述"}),dataIndex:"description",width:200,copyable:!0,ellipsis:!0,tooltip:r.formatMessage({id:"pages.workflow.description.tooltip",defaultMessage:"工作流功能描述"})},{title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),dataIndex:"content",ellipsis:!0,hideInSearch:!1,copyable:!0,width:250,tooltip:r.formatMessage({id:"pages.workflow.content.tooltip",defaultMessage:"工作流内容"}),render:function(e,t){var a=t.content||"-";return(0,Y.jsx)(M.Z,{content:(0,Y.jsxs)("div",{children:[(0,Y.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"8px"},children:[(0,Y.jsx)("span",{children:r.formatMessage({id:"pages.workflow.content.detail",defaultMessage:"内容详情"})}),(0,Y.jsx)(y.ZP,{type:"text",icon:(0,Y.jsx)(S.Z,{}),onClick:function(e){var t;e.stopPropagation(),t=a,navigator.clipboard.writeText(t).then((function(){x.yw.success(r.formatMessage({id:"copy.success",defaultMessage:"复制成功"}))}),(function(e){console.error("复制失败: ",e),x.yw.error(r.formatMessage({id:"copy.failed",defaultMessage:"复制失败"}))}))},title:r.formatMessage({id:"copy.to.clipboard",defaultMessage:"复制到剪贴板"})})]}),(0,Y.jsx)("div",{style:{maxWidth:"600px",maxHeight:"400px",overflow:"auto",whiteSpace:"pre-wrap"},children:a})]}),title:r.formatMessage({id:"pages.workflow.content",defaultMessage:"内容"}),trigger:"hover",overlayStyle:{maxWidth:"800px"},children:(0,Y.jsx)("span",{style:{cursor:"pointer"},children:a})})}},{title:r.formatMessage({id:"pages.workflow.createdAt",defaultMessage:"创建时间"}),dataIndex:"createdAt",valueType:"dateTime",sorter:!0,width:160,hideInSearch:!0,tooltip:r.formatMessage({id:"pages.workflow.createdAt.tooltip",defaultMessage:"工作流创建时间"}),render:function(e,t){return t.createdAt?T()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"pages.workflow.updatedAt",defaultMessage:"更新时间"}),dataIndex:"updatedAt",valueType:"dateTime",sorter:!0,hideInSearch:!0,width:160,tooltip:r.formatMessage({id:"pages.workflow.updatedAt.tooltip",defaultMessage:"工作流最后更新时间"}),render:function(e,t){return t.updatedAt?T()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:r.formatMessage({id:"actions",defaultMessage:"操作"}),dataIndex:"option",valueType:"option",width:120,fixed:"right",tooltip:r.formatMessage({id:"pages.workflow.actions.tooltip",defaultMessage:"可进行的操作"}),render:function(e,t){return[(0,Y.jsx)("a",{onClick:function(){return function(e){f(!0),te(e),K(!0)}(t)},children:r.formatMessage({id:"pages.workflow.edit",defaultMessage:"Edit"})},"edit"),(0,Y.jsx)("a",{onClick:function(){return e=t,void se.confirm({title:r.formatMessage({id:"deleteTip"}),icon:(0,Y.jsx)(j.Z,{}),content:"".concat(r.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(p(e.name),"】？"),onOk:function(){me(e)},okText:r.formatMessage({id:"ok"}),cancelText:r.formatMessage({id:"cancel"})});var e},children:r.formatMessage({id:"pages.workflow.delete",defaultMessage:"Delete"})},"delete")]}}],he=function(){var e=g()(u()().mark((function e(a,o,n){var s,l,c,f,g,p,w,m,M;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return x.yw.loading(r.formatMessage({id:"loading",defaultMessage:"Loading"})),s=a.current,l=a.pageSize,c=a.content,f=i()(a,_),O(s),q(l),we(d()(d()({},f),{},{content:c})),g=void 0,p=void 0,o&&Object.keys(o).length>0&&(w=Object.keys(o)[0],g=w,p="ascend"===o[w]?"ascend":"descend"),m=d()(d()({pageNumber:s-1,pageSize:l,name:"",orgUid:t===k.Hxq?"":null==oe?void 0:oe.uid,categoryUid:(null==ae?void 0:ae.uid)===k.zBg?"":null==ae?void 0:ae.uid,level:t},f),{},{content:c,sortBy:g,sortDirection:p}),e.next=11,(0,h.Au)(m);case 11:if(M=e.sent,console.log("queryWorkflowsByOrg response:",M,m),200!==M.code){e.next=20;break}return x.yw.destroy(),V(M.data.content),ue(M.data.totalElements),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 20:return x.yw.destroy(),x.yw.error(M.message),e.abrupt("return",{data:[],success:!1,total:0});case 23:case"end":return e.stop()}}),e)})));return function(t,a,o){return e.apply(this,arguments)}}();return(0,Y.jsxs)(Y.Fragment,{children:[(0,Y.jsx)(z.Z,{columns:xe,actionRef:a,cardBordered:!0,rowKey:"uid",scroll:{x:1e3},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,pageSize:10,onChange:function(e,t){O(e),q(t)}},dateFormatter:"string",headerTitle:r.formatMessage({id:"pages.workflow.list",defaultMessage:"工作流列表"}),toolBarRender:function(){var e=[(0,Y.jsx)(y.ZP,{type:"primary",onClick:function(){window.open((0,P.HU)(),"_blank")},icon:(0,Y.jsx)(C.Z,{}),children:r.formatMessage({id:"pages.workflow.create",defaultMessage:"添加工作流"})},"create")],t=[{key:"export-current",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ye("current")}}];return ce>0&&(ce<=1e3?t.push({key:"export-all",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(ce,"条)"),onClick:function(){return ye("all")}}):t.push({key:"export-range",icon:(0,Y.jsx)(Z.Z,{}),label:r.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(ce,"条)"),children:ve(ce)})),e.push((0,Y.jsx)(v.Z,{menu:{items:t},placement:"bottom",children:(0,Y.jsxs)(y.ZP,{type:"primary",icon:(0,Y.jsx)(Z.Z,{}),children:[r.formatMessage({id:"export",defaultMessage:"导出"}),(0,Y.jsx)(I.Z,{})]})},"export")),e},request:he}),J&&(0,Y.jsx)(L,{isEdit:c,workflow:ee,level:t,open:J,onClose:function(){return K(!1)},onSubmit:Me}),ie]})},K=function(e){var t=e.level,a=void 0===t?"org":t,o=(0,n.useIntl)(),s=[{key:"template",label:o.formatMessage({id:"pages.email.template.tab",defaultMessage:"邮件模板"}),children:(0,Y.jsx)(N,{level:a,type:"email"})},{key:"send",label:o.formatMessage({id:"pages.email.send.tab",defaultMessage:"发送记录"}),children:(0,Y.jsx)(J,{level:a,type:"email"})}];return(0,Y.jsx)("div",{children:(0,Y.jsx)(r.Z,{defaultActiveKey:"template",items:s,style:{padding:"10px"}})})}},65105:function(e,t,a){a.d(t,{v:function(){return u}});var o=a(76711),r=a.n(o),n=a(73193),s=a.n(n),i=a(25191),l=a(16894),d=a(45034),c=a(47401);var u=(0,l.Ue)()((0,d.mW)((0,d.tJ)((0,c.n)((function(e,t){return{categoryResult:{data:{content:[]}},categoryTreeOptions:[],categorySelectOptions:[],currentCategory:{uid:i.zBg,name:i.zBg},setCategoryResult:function(t){var a=function(e){var t=[];return e.data.content.forEach((function(e){var a={label:e.name,value:e.uid};t.push(a)})),t}(t),o={uid:i.zBg,name:i.zBg},n=s()(s()({},t),{},{data:s()(s()({},t.data),{},{content:[o].concat(r()(t.data.content))})}),l=function(e){var t=[];return e.data.content.forEach((function(e){var a={title:e.name,key:e.uid,children:[]};e.children&&Array.isArray(e.children)&&(a.children=e.children.map((function(e){return{title:e.name,key:e.uid,children:[]}}))),t.push(a)})),t}(n);e({categoryResult:n,categoryTreeOptions:l,categorySelectOptions:a}),0===t.data.content.length&&e({currentCategory:{uid:i.zBg,name:i.zBg}})},insertCategory:function(t){e((function(e){e.categoryResult.data.content.unshift(t)}))},upgradeCategory:function(t){e((function(e){var a=e.categoryResult.data.content,o=a.findIndex((function(e){return e.uid===t.uid}));-1!==o?a[o]=t:console.warn("Category with uid ".concat(t.uid," not found."))}))},setCurrentCategory:function(t){e({currentCategory:t})},resetDefaultCategory:function(){console.log("resetDefaultCategory"),e({currentCategory:{uid:i.zBg,name:i.zBg}})},setCurrentCategoryUid:function(a){var o=t().categoryResult.data.content.find((function(e){return e.uid===a}));e({currentCategory:o})},deleteCategoryCache:function(){return e({},!0)}}})),{name:i.OMm})))}}]);