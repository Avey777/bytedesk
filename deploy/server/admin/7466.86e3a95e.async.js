"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7466],{58069:function(e,t,a){var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(55567),h=a(25270),x=a(28619),M=a(9942),y=a(18232),v=a(81343),j=a(10266),w=a(54881),k=a(11090),b=a(2484),S=a(46336),F=a(43906),I=a(30915),C=a(39686),T=a(41994),Z=a(34353),A=a(44194),D=a(31549),U=["current","pageSize"];t.Z=function(e){var t=e.type,a=e.isSuperUser,s=(0,F.useIntl)(),r=(0,A.useRef)(),i=(0,x.Z)().translateString,d=(0,M.u)((function(e){return e.currentOrg})),u=(0,A.useState)(1),f=p()(u,2),E=f[0],R=f[1],O=(0,A.useState)(10),B=p()(O,2),N=B[0],P=B[1],q=(0,A.useState)([]),z=p()(q,2),L=z[0],Y=z[1],H=(0,A.useState)([]),K=p()(H,2),_=K[0],G=K[1],W=(0,A.useState)(0),J=p()(W,2),Q=J[0],V=J[1],X=(0,A.useState)({}),$=p()(X,2),ee=$[0],te=$[1],ae=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,D.jsx)(D.Fragment,{children:i(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,D.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,D.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,j.ng)(null==t?void 0:t.status)}},{title:(0,D.jsx)(F.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,j.OI)(t.type)}},{title:(0,D.jsx)(F.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,j.YG)(t.channel)}},{title:(0,D.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:s.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,n){return[(0,D.jsx)("a",{onClick:function(){se(t)},children:s.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,D.jsx)(I.Z,{title:s.formatMessage({id:"deleteTip"}),description:"".concat(s.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ne(t)},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"}),children:(0,D.jsx)("a",{style:{color:"red",marginLeft:8},children:s.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],se=function(e){var t,a;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==d?void 0:d.uid,t:y.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(s)},ne=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(a=r.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(s.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=g()(c()().mark((function e(){var t,a,n,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==_.length){e.next=3;break}return m.yw.warning(s.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,n=l()(_);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}m.yw.destroy(),0===a?m.yw.success(s.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(s.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),Y([]),G([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=g()(c()().mark((function e(a,s,n){var r,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,s,n),r=localStorage.getItem(y.LA8),i=o()({componentType:t,orgUid:(null==d?void 0:d.uid)||"",accessToken:r||"",exportType:a,threadType:y.H_O},ee),"current"===a?(i.pageNumber=String(E-1),i.pageSize=String(N)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==s&&void 0!==n&&(i.pageNumber=String(s),i.pageSize=String(n)),window.open((0,v.kG)()+"/api/v1/message/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ie=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return oe("range",s,a)}})},r=0;r<s;r++)n();return t},le={selectedRowKeys:L,onChange:function(e,t){Y(e),G(t)}};return(0,D.jsx)(S.Z,{columns:ae,actionRef:r,cardBordered:!0,rowSelection:le,scroll:{x:1500},request:function(){var e=g()(c()().mark((function e(t,s,r){var i,l,u,g,f,p,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,s,r),i=t.current,l=t.pageSize,u=n()(t,U),R(i),P(l),te(u),g=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],g=p,f="ascend"===s[p]?"ascend":"descend"),x=o()(o()({pageNumber:i-1,pageSize:l,threadType:y.H_O,orgUid:null==d?void 0:d.uid,isSuperUser:a},u),{},{sortBy:g,sortDirection:f}),e.next=11,(0,h.W5)(x);case 11:return M=e.sent,console.log("getAllMessages response:",x,M),200===M.code?V(M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:s.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];L.length>0&&t.push({key:"batchDelete",icon:(0,D.jsx)(w.Z,{}),danger:!0,label:s.formatMessage({id:"batch.delete"})+" (".concat(L.length,")"),onClick:function(){C.Z.confirm({title:s.formatMessage({id:"batch.deleteTip"}),content:"".concat(s.formatMessage({id:"batch.deleteAffirm"})," ").concat(L.length," ").concat(s.formatMessage({id:"items"}),"?"),onOk:re,okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,D.jsx)(k.Z,{}),label:s.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return oe("current")}}];return Q>0&&(Q<=1e3?a.push({key:"export-all",icon:(0,D.jsx)(k.Z,{}),label:s.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Q,"条)"),onClick:function(){return oe("all")}}):a.push({key:"export-range",icon:(0,D.jsx)(k.Z,{}),label:s.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Q,"条)"),children:ie(Q)})),e.push((0,D.jsx)(T.Z,{menu:{items:a},placement:"bottom",children:(0,D.jsxs)(Z.ZP,{icon:(0,D.jsx)(k.Z,{}),type:"primary",children:[s.formatMessage({id:"export",defaultMessage:"Export"}),(0,D.jsx)(b.Z,{})]},"button")},"export")),t.length>0&&e.push((0,D.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,D.jsxs)(Z.ZP,{type:L.length>0?"primary":"default",danger:L.length>0,children:[L.length>0?s.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(L.length,")"):s.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,D.jsx)(b.Z,{})]})},"batchOperations")),e}()}})}},42291:function(e,t,a){var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(55567),h=a(25270),x=a(28619),M=a(9942),y=a(18232),v=a(81343),j=a(10266),w=a(54881),k=a(11090),b=a(2484),S=a(46336),F=a(43906),I=a(30915),C=a(39686),T=a(41994),Z=a(34353),A=a(44194),D=a(31549),U=["current","pageSize"];t.Z=function(e){var t=e.type,a=e.isSuperUser,s=(0,F.useIntl)(),r=(0,A.useRef)(),i=(0,x.Z)().translateString,d=(0,M.u)((function(e){return e.currentOrg})),u=(0,A.useState)(1),f=p()(u,2),E=f[0],R=f[1],O=(0,A.useState)(10),B=p()(O,2),N=B[0],P=B[1],q=(0,A.useState)([]),z=p()(q,2),L=z[0],Y=z[1],H=(0,A.useState)([]),K=p()(H,2),_=K[0],G=K[1],W=(0,A.useState)(0),J=p()(W,2),Q=J[0],V=J[1],X=(0,A.useState)({}),$=p()(X,2),ee=$[0],te=$[1],ae=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,D.jsx)(F.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,D.jsx)(F.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",width:120,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.nickname.tooltip"}),render:function(e,t){var a;return(0,D.jsx)(D.Fragment,{children:i(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)})}},{title:(0,D.jsx)(F.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",width:300,ellipsis:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.content.tooltip"})},{title:(0,D.jsx)(F.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",width:100,hideInSearch:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.status.tooltip"}),render:function(e,t){return(0,j.ng)(null==t?void 0:t.status)}},{title:(0,D.jsx)(F.FormattedMessage,{id:"type",defaultMessage:"Type"}),dataIndex:"type",width:120,copyable:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.type.tooltip"}),render:function(e,t){return(0,j.OI)(t.type)}},{title:(0,D.jsx)(F.FormattedMessage,{id:"channel"}),dataIndex:"channel",width:120,copyable:!0,hideInSearch:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.channel.tooltip"}),render:function(e,t){return(0,j.YG)(t.channel)}},{title:(0,D.jsx)(F.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",width:180,sorter:!0,hideInSearch:!0,tooltip:(0,D.jsx)(F.FormattedMessage,{id:"message.createdAt.tooltip"})},{title:s.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,a,n){return[(0,D.jsx)("a",{onClick:function(){se(t)},children:s.formatMessage({id:"view",defaultMessage:"View"})},"editable"),(0,D.jsx)(I.Z,{title:s.formatMessage({id:"deleteTip"}),description:"".concat(s.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ne(t)},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"}),children:(0,D.jsx)("a",{style:{color:"red",marginLeft:8},children:s.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}],se=function(e){var t,a;console.log("handleShowChatHistory",e);var s={chatConfig:{org:null==d?void 0:d.uid,t:y.IUl,sid:null==e||null===(t=e.thread)||void 0===t?void 0:t.uid}};null===(a=window.bytedesk)||void 0===a||a.showChat(s)},ne=function(){var e=g()(c()().mark((function e(t){var a;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==r||null===(a=r.current)||void 0===a||a.reload()}catch(e){m.yw.destroy(),m.yw.error(s.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),re=function(){var e=g()(c()().mark((function e(){var t,a,n,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==_.length){e.next=3;break}return m.yw.warning(s.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,a=0,n=l()(_);try{for(n.s();!(o=n.n()).done;)o.value}catch(e){n.e(e)}finally{n.f()}m.yw.destroy(),0===a?m.yw.success(s.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(s.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:a})),Y([]),G([]),null===(t=r.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),oe=function(){var e=g()(c()().mark((function e(a,s,n){var r,i;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",a,s,n),r=localStorage.getItem(y.LA8),i=o()({componentType:t,orgUid:(null==d?void 0:d.uid)||"",accessToken:r||"",exportType:a,threadType:y.n4F},ee),"current"===a?(i.pageNumber=String(E-1),i.pageSize=String(N)):"all"===a?(i.pageNumber="0",i.pageSize="1000"):"range"===a&&void 0!==s&&void 0!==n&&(i.pageNumber=String(s),i.pageSize=String(n)),window.open((0,v.kG)()+"/api/v1/message/export?"+new URLSearchParams(i).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ie=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return oe("range",s,a)}})},r=0;r<s;r++)n();return t},le={selectedRowKeys:L,onChange:function(e,t){Y(e),G(t)}};return(0,D.jsx)(S.Z,{columns:ae,actionRef:r,cardBordered:!0,rowSelection:le,scroll:{x:1500},request:function(){var e=g()(c()().mark((function e(t,s,r){var i,l,u,g,f,p,x,M;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("request:",t,s,r),i=t.current,l=t.pageSize,u=n()(t,U),R(i),P(l),te(u),g=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],g=p,f="ascend"===s[p]?"ascend":"descend"),x=o()(o()({pageNumber:i-1,pageSize:l,threadType:y.n4F,orgUid:null==d?void 0:d.uid,isSuperUser:a},u),{},{sortBy:g,sortDirection:f}),e.next=11,(0,h.W5)(x);case 11:return M=e.sent,console.log("getAllMessages response:",x,M),200===M.code?V(M.data.totalElements):m.yw.error(M.message),e.abrupt("return",{data:M.data.content,success:!0,total:M.data.totalElements});case 15:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:s.formatMessage({id:"message",defaultMessage:"Message"}),toolBarRender:function(){return function(){var e=[],t=[];L.length>0&&t.push({key:"batchDelete",icon:(0,D.jsx)(w.Z,{}),danger:!0,label:s.formatMessage({id:"batch.delete"})+" (".concat(L.length,")"),onClick:function(){C.Z.confirm({title:s.formatMessage({id:"batch.deleteTip"}),content:"".concat(s.formatMessage({id:"batch.deleteAffirm"})," ").concat(L.length," ").concat(s.formatMessage({id:"items"}),"?"),onOk:re,okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}});var a=[{key:"export-current",icon:(0,D.jsx)(k.Z,{}),label:s.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return oe("current")}}];return Q>0&&(Q<=1e3?a.push({key:"export-all",icon:(0,D.jsx)(k.Z,{}),label:s.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(Q,"条)"),onClick:function(){return oe("all")}}):a.push({key:"export-range",icon:(0,D.jsx)(k.Z,{}),label:s.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(Q,"条)"),children:ie(Q)})),e.push((0,D.jsx)(T.Z,{menu:{items:a},placement:"bottom",children:(0,D.jsxs)(Z.ZP,{icon:(0,D.jsx)(k.Z,{}),type:"primary",children:[s.formatMessage({id:"export",defaultMessage:"Export"}),(0,D.jsx)(b.Z,{})]},"button")},"export")),t.length>0&&e.push((0,D.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,D.jsxs)(Z.ZP,{type:L.length>0?"primary":"default",danger:L.length>0,children:[L.length>0?s.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(L.length,")"):s.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,D.jsx)(b.Z,{})]})},"batchOperations")),e}()}})}},48593:function(e,t,a){a.d(t,{Z:function(){return re}});var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(10154),h=a.n(m),x=a(55567),M=a(18232),y=a(43906);function v(e){return j.apply(this,arguments)}function j(){return(j=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.request)("/api/v1/message/leave/query/org",{method:"GET",params:o()(o()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return k.apply(this,arguments)}function k(){return(k=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,y.request)("/api/v1/message/leave/reply",{method:"POST",data:o()(o()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var b=a(9942),S=a(81343),F=a(54881),I=a(11090),C=a(2484),T=a(46336),Z=a(30915),A=a(39686),D=a(41994),U=a(34353),E=a(28977),R=a.n(E),O=a(44194),B=a(10266),N=a(76711),P=a.n(N),q=a(10162),z=a(36693),L=a(48792),Y=a(44517),H=a(68060),K=a(88638),_=a(75843),G=a(99898),W=a(64827),J=a(64890),Q=a(50220),V=a(52433),X=a(31549),$=H.Z.Title,ee=H.Z.Paragraph,te=H.Z.Text,ae=function(e){var t,a=e.visible,s=e.onClose,n=e.messageLeave,r=e.onSuccess,i=(0,y.useIntl)(),l=K.Z.useForm(),d=p()(l,1)[0],u=(0,O.useState)(!1),f=p()(u,2),m=f[0],h=f[1],v=(0,O.useState)(!1),j=p()(v,2),k=j[0],b=j[1],F=(0,O.useState)([]),I=p()(F,2),C=I[0],T=I[1],Z=(0,O.useState)([]),D=p()(Z,2),E=D[0],N=D[1],H=(0,O.useState)(!1),ae=p()(H,2),se=ae[0],ne=ae[1],re=(0,O.useState)(""),oe=p()(re,2),ie=oe[0],le=oe[1],de=(0,O.useState)(""),ce=p()(de,2),ue=ce[0],ge=ce[1];(0,O.useEffect)((function(){if(n&&n.replyContent)if(d.setFieldsValue({replyContent:n.replyContent}),b(!0),n.replyImages&&n.replyImages.length>0){var e=n.replyImages.filter((function(e){return""!==e}));N(e),T(e.map((function(e,t){return{uid:"-".concat(t),name:"image-".concat(t,".png"),status:"done",url:e,thumbUrl:e}})))}else N([]),T([]);else d.resetFields(),b(!1),N([]),T([])}),[n,d]);var fe=function(){var e=g()(c()().mark((function e(t){var a,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n){e.next=2;break}return e.abrupt("return");case 2:return e.prev=2,h(!0),a={uid:n.uid,replyContent:t.replyContent,replyImages:E,orgUid:n.orgUid},e.next=7,w(a);case 7:o=e.sent,console.log("回复留言:",o.data),200===o.code?(x.yw.success(i.formatMessage({id:"replyContent.success",defaultMessage:"回复成功"})),d.resetFields(),N([]),T([]),r(),s()):x.yw.error(o.message||i.formatMessage({id:"replyContent.failed",defaultMessage:"回复失败"})),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(2),console.error("回复留言出错:",e.t0),x.yw.error(i.formatMessage({id:"replyContent.error",defaultMessage:"回复出错"}));case 16:return e.prev=16,h(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[2,12,16,19]])})));return function(t){return e.apply(this,arguments)}}(),pe=function(e){return!e||0===e.length||1===e.length&&""===e[0]?null:(0,X.jsxs)("div",{style:{marginTop:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"images",defaultMessage:"图片"}),":"]}),(0,X.jsx)("div",{style:{display:"flex",flexWrap:"wrap",gap:"8px",marginTop:"8px"},children:e.map((function(e,t){return e?(0,X.jsx)("img",{src:e,alt:"留言图片",style:{width:"100px",height:"100px",objectFit:"cover",cursor:"pointer"},onClick:function(){return me({url:e,uid:"img-".concat(t),name:"图片 ".concat(t+1)})}},t):null}))})]})},me=function(){var e=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:le(t.url||t.thumbUrl),ne(!0),ge(t.name||t.url.substring(t.url.lastIndexOf("/")+1));case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=(0,X.jsx)(U.ZP,{icon:(0,X.jsx)(q.Z,{}),children:(0,X.jsx)(y.FormattedMessage,{id:"upload",defaultMessage:"上传"})}),xe={name:"file",accept:"image/*",action:(0,S.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(M.LA8)},listType:"picture-card",fileList:C,onPreview:me,onChange:function(e){var t=P()(e.fileList);if("done"===e.file.status)if(200===e.file.response.code){var a=e.file.response.data.fileUrl;E.includes(a)||N((function(e){return[].concat(P()(e),[a])})),x.yw.success(i.formatMessage({id:"upload.success",defaultMessage:"上传 {filename} 成功"},{filename:e.file.name}))}else x.yw.error(i.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name})+": ".concat(e.file.response.message));else"error"===e.file.status&&x.yw.error(i.formatMessage({id:"upload.failed",defaultMessage:"上传 {filename} 失败"},{filename:e.file.name}));t=t.map((function(e){return e.response&&200===e.response.code?o()(o()({},e),{},{url:e.response.data.fileUrl,thumbUrl:e.response.data.fileUrl}):e})),T(t)},data:function(e){var t=R()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return console.log("uploadProps",t),{file:e,fileName:t,fileType:e.type,isAvatar:"false",kbType:M.IrL,categoryUid:"",kbUid:"",channel:M.XtJ}},onRemove:function(e){if(console.log("onRemove",e),"done"===e.status&&e.response&&e.response.data){var t=e.response.data.fileUrl;N((function(e){return e.filter((function(e){return e!==t}))}))}return e.url&&N((function(t){return t.filter((function(t){return t!==e.url}))})),!0}};return(0,X.jsx)(_.Z,{title:i.formatMessage({id:"leave.message.replyContent",defaultMessage:"回复留言"}),width:600,placement:"right",onClose:s,open:a,styles:{body:{paddingBottom:80}},extra:(0,X.jsx)(G.Z,{children:(0,X.jsx)(U.ZP,{onClick:s,children:(0,X.jsx)(y.FormattedMessage,{id:"cancel",defaultMessage:"取消"})})}),children:n&&(0,X.jsxs)(X.Fragment,{children:[(0,X.jsxs)(W.Z,{variant:"borderless",style:{marginBottom:"20px"},children:[(0,X.jsx)($,{level:5,children:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.details",defaultMessage:"留言详情"})}),(0,X.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",(null===(t=n.user)||void 0===t?void 0:t.nickname)||"-"]}),(0,X.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"contact",defaultMessage:"联系方式"}),":"]})," ",n.contact||"-"]}),(0,X.jsxs)("div",{style:{marginBottom:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"content",defaultMessage:"内容"}),":"]}),(0,X.jsx)(ee,{style:{marginTop:"8px"},children:n.content})]}),pe(n.images||[]),n.replyContent&&(0,X.jsxs)("div",{style:{marginTop:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"replied.content",defaultMessage:"回复内容"}),":"]}),(0,X.jsx)(ee,{style:{marginTop:"8px"},children:n.replyContent})]}),n.replyImages&&n.replyImages.length>0&&(0,X.jsxs)("div",{style:{marginTop:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"replyContent.images",defaultMessage:"回复图片"}),":"]}),pe(n.replyImages||[])]}),(0,X.jsxs)("div",{style:{marginTop:"10px"},children:[(0,X.jsxs)(te,{strong:!0,children:[(0,X.jsx)(y.FormattedMessage,{id:"status",defaultMessage:"状态"}),":"]})," ",(0,B.It)(n.status)]})]}),k&&(0,X.jsx)(J.Z,{type:"warning",showIcon:!0,message:i.formatMessage({id:"replyContent.exists.warning",defaultMessage:"已回复，继续回复仅更新已有回复"}),style:{marginBottom:"16px"}}),(0,X.jsxs)(L.A,{form:d,onFinish:fe,submitter:{render:function(e,t){return(0,X.jsx)("div",{style:{textAlign:"right",marginTop:"24px"},children:(0,X.jsx)(U.ZP,{type:"primary",icon:(0,X.jsx)(z.Z,{}),loading:m,onClick:function(){return d.submit()},children:(0,X.jsx)(y.FormattedMessage,{id:"replyContent",defaultMessage:"回复"})})})}},children:[(0,X.jsx)(Y.Z,{name:"replyContent",label:i.formatMessage({id:"replyContent.content",defaultMessage:"回复内容"}),placeholder:i.formatMessage({id:"please.enter.replyContent",defaultMessage:"请输入回复内容"}),rules:[{required:!0,message:i.formatMessage({id:"replyContent.content.required",defaultMessage:"请输入回复内容"})}],fieldProps:{rows:6}}),(0,X.jsxs)(K.Z.Item,{label:i.formatMessage({id:"replyContent.images",defaultMessage:"回复图片"}),children:[(0,X.jsx)(Q.Z,o()(o()({},xe),{},{children:he})),(0,X.jsx)(A.Z,{open:se,title:ue,footer:null,onCancel:function(){return ne(!1)},children:(0,X.jsx)(V.Z,{alt:"预览图片",style:{width:"100%"},src:ie})})]})]})]})})},se=["current","pageSize"],ne=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,X.jsx)(y.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,X.jsx)(y.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"userNickname",hideInSearch:!0,width:300,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.userNickname.tooltip"}),render:function(e,t){var a;return(0,X.jsx)(X.Fragment,{children:null==t||null===(a=t.user)||void 0===a?void 0:a.nickname})}},{title:(0,X.jsx)(y.FormattedMessage,{id:"contact",defaultMessage:"Contact"}),dataIndex:"contact",copyable:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.contact.tooltip"})},{title:(0,X.jsx)(y.FormattedMessage,{id:"content",defaultMessage:"Content"}),dataIndex:"content",copyable:!0,ellipsis:!0,width:300,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.content.tooltip"})},{title:(0,X.jsx)(y.FormattedMessage,{id:"images",defaultMessage:"Images"}),dataIndex:"images",copyable:!0,hideInSearch:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.images.tooltip"}),render:function(e,t,a,s){return!t.images||0===t.images.length||1===t.images.length&&""===t.images[0]?(0,X.jsx)("span",{children:"-"}):t.images.map((function(e,t){return e?(0,X.jsx)("img",{src:e,alt:"image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,X.jsx)(y.FormattedMessage,{id:"status",defaultMessage:"Status"}),dataIndex:"status",copyable:!0,width:120,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.status.tooltip"}),valueType:"select",valueEnum:h()(h()(h()(h()(h()(h()(h()(h()(h()({},M.d23,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.pending",defaultMessage:"待处理"}),status:"default"}),M.m7i,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.processing",defaultMessage:"处理中"}),status:"processing"}),M.d3_,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.read",defaultMessage:"已读"}),status:"default"}),M.oLW,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.replied",defaultMessage:"已回复"}),status:"success"}),M.KBB,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.transferred",defaultMessage:"已转接"}),status:"warning"}),M.v3R,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.escalated",defaultMessage:"已升级"}),status:"warning"}),M.uke,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.closed",defaultMessage:"已关闭"}),status:"success"}),M.fEl,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.spam",defaultMessage:"垃圾留言"}),status:"error"}),M.K0y,{text:(0,X.jsx)(y.FormattedMessage,{id:"leave.msg.status.invalid",defaultMessage:"无效留言"}),status:"error"}),render:function(e,t){return(0,B.It)(t.status)}},{title:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.replyContent",defaultMessage:"Reply"}),dataIndex:"replyContent",copyable:!0,hideInSearch:!0,ellipsis:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.replyContent.tooltip"})},{title:(0,X.jsx)(y.FormattedMessage,{id:"reply.images",defaultMessage:"回复图片"}),dataIndex:"replyImages",copyable:!0,hideInSearch:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.replyImages.tooltip"}),render:function(e,t,a,s){return!t.replyImages||0===t.replyImages.length||1===t.replyImages.length&&""===t.replyImages[0]?(0,X.jsx)("span",{children:"-"}):t.replyImages.map((function(e,t){return e?(0,X.jsx)("img",{src:e,alt:"reply image",style:{width:"60px",height:"60px",objectFit:"cover",cursor:"pointer"},onClick:function(){return function(e){window.open(e,"_blank")}(e)}},t):null}))}},{title:(0,X.jsx)(y.FormattedMessage,{id:"reply.user",defaultMessage:"回复人员"}),dataIndex:"replyUserNickname",hideInSearch:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.replyUser.tooltip"}),render:function(e,t){var a;return(0,X.jsx)(X.Fragment,{children:(null==t||null===(a=t.replyUser)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,X.jsx)(y.FormattedMessage,{id:"repliedAt",defaultMessage:"回复时间"}),key:"repliedAt",dataIndex:"repliedAt",sorter:!0,hideInSearch:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.repliedAt.tooltip"}),render:function(e,t,a,s){return t.repliedAt?R()(t.repliedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}},{title:(0,X.jsx)(y.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.createdAt.tooltip"}),render:function(e,t,a,s){return R()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}},{title:(0,X.jsx)(y.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),key:"updatedAt",dataIndex:"updatedAt",sorter:!0,hideInSearch:!0,tooltip:(0,X.jsx)(y.FormattedMessage,{id:"leave.message.updatedAt.tooltip"}),render:function(e,t,a,s){return t.updatedAt?R()(t.updatedAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],re=function(e){var t=e.isSuperUser,a=(0,y.useIntl)(),s=(0,O.useRef)(),r=(0,O.useState)(1),i=p()(r,2),d=i[0],u=i[1],f=(0,O.useState)(10),m=p()(f,2),h=m[0],j=m[1],w=(0,b.u)((function(e){return e.currentOrg})),k=(0,O.useState)(!1),E=p()(k,2),R=E[0],B=E[1],N=(0,O.useState)(),P=p()(N,2),q=P[0],z=P[1],L=(0,O.useState)([]),Y=p()(L,2),H=Y[0],K=Y[1],_=(0,O.useState)([]),G=p()(_,2),W=G[0],J=G[1],Q=(0,O.useState)(0),V=p()(Q,2),$=V[0],ee=V[1],te=(0,O.useState)({}),re=p()(te,2),oe=re[0],ie=re[1],le=[].concat(ne,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:150,fixed:"right",render:function(e,t,s,n){return[(0,X.jsx)("a",{onClick:function(){de(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,X.jsx)("a",{onClick:function(){ce(t)},children:a.formatMessage({id:"handle",defaultMessage:"Handle"})},"handle"),(0,X.jsx)(Z.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return ue(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,X.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),de=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==w?void 0:w.uid,t:M.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},ce=function(e){console.log("handleProcess",e),z(e),B(!0)},ue=function(){var e=g()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),x.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{x.yw.destroy(),x.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(n=s.current)||void 0===n||n.reload()}catch(e){x.yw.destroy(),x.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=g()(c()().mark((function e(){var t,n,r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==W.length){e.next=3;break}return x.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:x.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,n=0,r=l()(W);try{for(r.s();!(o=r.n()).done;)o.value}catch(e){r.e(e)}finally{r.f()}x.yw.destroy(),0===n?x.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):x.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:n})),K([]),J([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),fe=function(){var e=g()(c()().mark((function e(t,a,s){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),n=localStorage.getItem(M.LA8),r=o()({orgUid:(null==w?void 0:w.uid)||"",accessToken:n||"",exportType:t},oe),"current"===t?(r.pageNumber=String(d-1),r.pageSize=String(h)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,S.kG)()+"/api/v1/message/leave/export?"+new URLSearchParams(r).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),pe=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return fe("range",s,a)}})},r=0;r<s;r++)n();return t},me={selectedRowKeys:H,onChange:function(e,t){K(e),J(t)}};return(0,X.jsxs)(X.Fragment,{children:[(0,X.jsx)(T.Z,{columns:le,actionRef:s,cardBordered:!0,rowSelection:me,scroll:{x:2500},request:function(){var e=g()(c()().mark((function e(a,s,r){var i,l,d,g,f,p,m,h;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,l=a.pageSize,d=n()(a,se),u(i),j(l),ie(d),g=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],g=p,f="ascend"===s[p]?"ascend":"descend"),m=o()(o()({pageNumber:i-1,pageSize:l,orgUid:null==w?void 0:w.uid,isSuperUser:t},d),{},{sortBy:g,sortDirection:f}),e.next=10,v(m);case 10:return h=e.sent,console.log("queryLeaveMsgsByOrg response:",h,m),200===h.code?ee(h.data.totalElements):x.yw.error(h.message),e.abrupt("return",{data:h.data.content,success:!0,total:h.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:"留言记录",toolBarRender:function(){return function(){var e=[],t=[];H.length>0&&t.push({key:"batchDelete",icon:(0,X.jsx)(F.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(H.length,")"),onClick:function(){A.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(H.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ge,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,X.jsx)(I.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return fe("current")}}];return $>0&&($<=1e3?s.push({key:"export-all",icon:(0,X.jsx)(I.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat($,"条)"),onClick:function(){return fe("all")}}):s.push({key:"export-range",icon:(0,X.jsx)(I.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat($,"条)"),children:pe($)})),e.push((0,X.jsx)(D.Z,{menu:{items:s},placement:"bottom",children:(0,X.jsxs)(U.ZP,{icon:(0,X.jsx)(I.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,X.jsx)(C.Z,{})]},"button")},"export")),t.length>0&&e.push((0,X.jsx)(D.Z,{menu:{items:t},placement:"bottom",children:(0,X.jsxs)(U.ZP,{type:H.length>0?"primary":"default",danger:H.length>0,children:[H.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(H.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,X.jsx)(C.Z,{})]})},"batchOperations")),e}()}}),(0,X.jsx)(ae,{visible:R,onClose:function(){B(!1)},messageLeave:q,onSuccess:function(){var e;null===(e=s.current)||void 0===e||e.reload()}})]})}},51660:function(e,t,a){a.d(t,{Z:function(){return P}});var s=a(84176),n=a.n(s),r=a(73193),o=a.n(r),i=a(86222),l=a.n(i),d=a(90819),c=a.n(d),u=a(89933),g=a.n(u),f=a(45332),p=a.n(f),m=a(55567),h=a(18232),x=a(43906);function M(e){return y.apply(this,arguments)}function y(){return(y=g()(c()().mark((function e(t){return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,x.request)("/api/v1/message/rating/query/org",{method:"GET",params:o()(o()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var v=a(9942),j=a(81343),w=a(54881),k=a(11090),b=a(2484),S=a(46336),F=a(41313),I=a(30915),C=a(39686),T=a(41994),Z=a(34353),A=a(28977),D=a.n(A),U=a(44194),E=a(31549),R=["current","pageSize"],O={ROBOT:{text:"机器人",color:"blue"},AGENT:{text:"人工客服",color:"green"},FAQ:{text:"常见问题",color:"purple"}},B={RATE_UP:{text:"点赞",color:"success"},RATE_DOWN:{text:"点踩",color:"error"},RATE_FEEDBACK:{text:"反馈意见",color:"warning"},RATE_TRANSFER:{text:"转人工",color:"processing"}},N=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,E.jsx)(x.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left"},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.answer"}),dataIndex:"answer",copyable:!0,ellipsis:!0,hideInSearch:!0,width:400,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.answer.tooltip"})},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.question"}),dataIndex:"question",copyable:!0,ellipsis:!0,hideInSearch:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.question.tooltip"})},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.fromType"}),dataIndex:"fromType",ellipsis:!0,hideInSearch:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.fromType.tooltip"}),render:function(e,t){var a=t.fromType||"",s=O[a]||{text:a,color:"default"};return(0,E.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.rateType"}),dataIndex:"rateType",ellipsis:!0,hideInSearch:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.rateType.tooltip"}),render:function(e,t){var a=t.rateType||"",s=B[a]||{text:a,color:"default"};return(0,E.jsx)(F.Z,{color:s.color,children:s.text||a})}},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.rating.tags",defaultMessage:"反馈标签"}),dataIndex:"rateDownTagList",hideInSearch:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.tags.tooltip"}),render:function(e,t){return t.rateDownTagList&&0!==t.rateDownTagList.length?(0,E.jsx)(E.Fragment,{children:t.rateDownTagList.map((function(e){return(0,E.jsx)(F.Z,{color:"blue",children:e},e)}))}):"-"}},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.rating.reason",defaultMessage:"反馈原因"}),dataIndex:"rateDownReason",ellipsis:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.reason.tooltip"})},{title:(0,E.jsx)(x.FormattedMessage,{id:"faq.rating.user",defaultMessage:"用户"}),dataIndex:"userNickname",hideInSearch:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.user.tooltip"}),render:function(e,t){var a;return(0,E.jsx)(E.Fragment,{children:(null==t||null===(a=t.user)||void 0===a?void 0:a.nickname)||"-"})}},{title:(0,E.jsx)(x.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,E.jsx)(x.FormattedMessage,{id:"rating.createdAt.tooltip"}),render:function(e,t,a,s){return t.createdAt?D()(t.createdAt).format("YYYY-MM-DD HH:mm:ss"):"-"}}],P=function(e){var t=e.isSuperUser,a=(0,x.useIntl)(),s=(0,U.useRef)(),r=(0,U.useState)(1),i=p()(r,2),d=i[0],u=i[1],f=(0,U.useState)(10),y=p()(f,2),F=y[0],A=y[1],D=(0,v.u)((function(e){return e.currentOrg})),O=(0,U.useState)([]),B=p()(O,2),P=B[0],q=B[1],z=(0,U.useState)([]),L=p()(z,2),Y=L[0],H=L[1],K=(0,U.useState)(0),_=p()(K,2),G=_[0],W=_[1],J=(0,U.useState)({}),Q=p()(J,2),V=Q[0],X=Q[1],$=[].concat(N,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:100,fixed:"right",render:function(e,t,s,n){return[(0,E.jsx)("a",{onClick:function(){ee(t)},children:a.formatMessage({id:"view",defaultMessage:"View"})},"view"),(0,E.jsx)(I.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm"}),"【").concat(null==t?void 0:t.uid,"】？"),onConfirm:function(){return te(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),children:(0,E.jsx)("a",{style:{color:"red",marginLeft:8},children:a.formatMessage({id:"delete",defaultMessage:"删除"})})},"delete")]}}]),ee=function(e){var t;console.log("handleShowChatHistory",e);var a={chatConfig:{org:null==D?void 0:D.uid,t:h.IUl,sid:null==e?void 0:e.threadUid}};null===(t=window.bytedesk)||void 0===t||t.showChat(a)},te=function(){var e=g()(c()().mark((function e(t){var n;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleDeleteConfirm",t),m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."}));try{m.yw.destroy(),m.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete Success"})),null==s||null===(n=s.current)||void 0===n||n.reload()}catch(e){m.yw.destroy(),m.yw.error(a.formatMessage({id:"delete.error",defaultMessage:"Delete Error"}))}case 3:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ae=function(){var e=g()(c()().mark((function e(){var t,n,r,o;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(0!==Y.length){e.next=3;break}return m.yw.warning(a.formatMessage({id:"batch.delete.noselection",defaultMessage:"Please select items to delete"})),e.abrupt("return");case 3:m.yw.loading(a.formatMessage({id:"deleting",defaultMessage:"Deleting..."})),0,n=0,r=l()(Y);try{for(r.s();!(o=r.n()).done;)o.value}catch(e){r.e(e)}finally{r.f()}m.yw.destroy(),0===n?m.yw.success(a.formatMessage({id:"batch.delete.success",defaultMessage:"Successfully deleted {count} items"},{count:0})):m.yw.warning(a.formatMessage({id:"batch.delete.partial",defaultMessage:"Deleted {success} items, failed to delete {fail} items"},{success:0,fail:n})),q([]),H([]),null===(t=s.current)||void 0===t||t.reloadAndRest();case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),se=function(){var e=g()(c()().mark((function e(t,a,s){var n,r;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,a,s),n=localStorage.getItem(h.LA8),r=o()({orgUid:(null==D?void 0:D.uid)||"",accessToken:n||"",exportType:t},V),"current"===t?(r.pageNumber=String(d-1),r.pageSize=String(F)):"all"===t?(r.pageNumber="0",r.pageSize="1000"):"range"===t&&void 0!==a&&void 0!==s&&(r.pageNumber=String(a),r.pageSize=String(s)),window.open((0,j.kG)()+"/api/v1/message/rating/export?"+new URLSearchParams(r).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),ne=function(e){for(var t=[],a=1e3,s=Math.ceil(e/a),n=function(){var s=r,n=r*a+1,o=Math.min((r+1)*a,e);t.push({key:"export-".concat(r),label:"".concat(n,"-").concat(o," (").concat(o-n+1,"条)"),onClick:function(){return se("range",s,a)}})},r=0;r<s;r++)n();return t},re={selectedRowKeys:P,onChange:function(e,t){q(e),H(t)}};return(0,E.jsx)(S.Z,{columns:$,actionRef:s,cardBordered:!0,rowSelection:re,scroll:{x:2e3},request:function(){var e=g()(c()().mark((function e(a,s,r){var i,l,d,g,f,p,h,x;return c()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return i=a.current,l=a.pageSize,d=n()(a,R),u(i),A(l),X(d),g=void 0,f=void 0,s&&Object.keys(s).length>0&&(p=Object.keys(s)[0],g=p,f="ascend"===s[p]?"ascend":"descend"),h=o()(o()({pageNumber:i-1,pageSize:l,orgUid:null==D?void 0:D.uid,isSuperUser:t},d),{},{sortBy:g,sortDirection:f}),e.next=10,M(h);case 10:return x=e.sent,console.log("queryMessageRatingsByOrg response:",x,h),200===x.code?W(x.data.totalElements):m.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}(),rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e){console.log("page:",e)}},dateFormatter:"string",headerTitle:a.formatMessage({id:"message.tab.rating"}),toolBarRender:function(){return function(){var e=[],t=[];P.length>0&&t.push({key:"batchDelete",icon:(0,E.jsx)(w.Z,{}),danger:!0,label:a.formatMessage({id:"batch.delete"})+" (".concat(P.length,")"),onClick:function(){C.Z.confirm({title:a.formatMessage({id:"batch.deleteTip"}),content:"".concat(a.formatMessage({id:"batch.deleteAffirm"})," ").concat(P.length," ").concat(a.formatMessage({id:"items"}),"?"),onOk:ae,okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"})})}});var s=[{key:"export-current",icon:(0,E.jsx)(k.Z,{}),label:a.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return se("current")}}];return G>0&&(G<=1e3?s.push({key:"export-all",icon:(0,E.jsx)(k.Z,{}),label:a.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return se("all")}}):s.push({key:"export-range",icon:(0,E.jsx)(k.Z,{}),label:a.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:ne(G)})),e.push((0,E.jsx)(T.Z,{menu:{items:s},placement:"bottom",children:(0,E.jsxs)(Z.ZP,{icon:(0,E.jsx)(k.Z,{}),type:"primary",children:[a.formatMessage({id:"export",defaultMessage:"Export"}),(0,E.jsx)(b.Z,{})]},"button")},"export")),t.length>0&&e.push((0,E.jsx)(T.Z,{menu:{items:t},placement:"bottom",children:(0,E.jsxs)(Z.ZP,{type:P.length>0?"primary":"default",danger:P.length>0,children:[P.length>0?a.formatMessage({id:"batch.operations",defaultMessage:"批量操作"})+" (".concat(P.length,")"):a.formatMessage({id:"more.operations",defaultMessage:"更多操作"}),(0,E.jsx)(b.Z,{})]})},"batchOperations")),e}()}})}}}]);