"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[950],{41282:function(e,r,t){t.d(r,{Jr:function(){return f},LF:function(){return u},Oh:function(){return h},WS:function(){return g}});var a=t(90819),n=t.n(a),l=t(73193),o=t.n(l),i=t(89933),s=t.n(i),d=t(5488),c=t(14870);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/query/org",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/create",{method:"POST",data:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/update",{method:"POST",data:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/model/delete",{method:"POST",data:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},52202:function(e,r,t){t.d(r,{G9:function(){return b},J$:function(){return k},N6:function(){return j},VM:function(){return u},c8:function(){return f},gF:function(){return h},rg:function(){return g},sF:function(){return y}});var a=t(90819),n=t.n(a),l=t(73193),o=t.n(l),i=t(89933),s=t.n(i),d=t(5488),c=t(14870);function u(e){return m.apply(this,arguments)}function m(){return(m=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/ping",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e){return p.apply(this,arguments)}function p(){return(p=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/local-models",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return v.apply(this,arguments)}function v(){return(v=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function h(e){return x.apply(this,arguments)}function x(){return(x=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/library/models/details",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return M.apply(this,arguments)}function M(){return(M=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/details",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function j(e){return w.apply(this,arguments)}function w(){return(w=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/pull",{method:"POST",data:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return P.apply(this,arguments)}function P(){return(P=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/ollama4j/models/delete",{method:"POST",data:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return Z.apply(this,arguments)}function Z(){return(Z=s()(n()().mark((function e(r){return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/springai/ollama/embedding-model/exists",{method:"GET",params:o()(o()({},r),{},{channel:d.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},92023:function(e,r,t){t.d(r,{G:function(){return f}});var a=t(73193),n=t.n(a),l=(t(44194),t(15435)),o=t(5488),i=t(28977),s=t.n(i),d=t(95660),c=t(5025),u=t(18580),m=t(31549),f=function(e){var r=e.children,t=e.onSuccess,a=e.onError,i={file:null,fileName:"test.png",fileType:"image/png",isAvatar:"true",kbType:o.IrL,categoryUid:"",kbUid:"",channel:o.XtJ},f={name:"file",accept:"image/*",action:(0,u.M$)(),headers:{Authorization:"Bearer "+localStorage.getItem(o.LA8)},data:i,showUploadList:!1,beforeUpload:function(e){d.Z.log("beforeUpload",e);var r=s()(new Date).format("YYYYMMDDHHmmss")+"_"+e.name;return i.file=e,i.fileName=r,i.fileType=e.type,d.Z.log("beforeUpload",i),!0},onChange:function(e){if("uploading"!==e.file.status&&d.Z.log("not uploading:",e.file),"done"===e.file.status)if(d.Z.log("response: ",e.file.response),200===e.file.response.code){var r=e.file.response.data.fileUrl;t(r),c.yw.success("".concat(e.file.name," 上传成功"))}else a(e.file),c.yw.error("".concat(e.file.name," 上传失败"));else"error"===e.file.status&&(c.yw.error("".concat(e.file.name," 上传失败")),a(e.file))}};return(0,m.jsx)(l.Z,n()(n()({},f),{},{children:r}))}},74424:function(e,r,t){var a=t(24522);r.Z=function(){var e=(0,a.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},71503:function(e,r,t){t.r(r),t.d(r,{default:function(){return ze}});var a=t(44194),n=t(74424),l=t(93322),o=t(90819),i=t.n(o),s=t(89933),d=t.n(s),c=t(45332),u=t.n(c),m=t(91221),f=t(5025),p=t(24522),g=t(18751),v=t(14870),h=t(68349),x=t(90317),y=t(5780),M=t(96501),j=t(45681),w=t(88344),b=t(34599),P=t(5488),k=t(15722),Z=t(10162),C=t(46747),L=t(32394),S=t(48821),D=t(16331),U=t(47783),I=t(11137),z=t(20903),T=t(68724),E=t(92023),q=t(59908),N=t(31549),R=function(e){var r=e.open,t=e.isEdit,n=e.llmProvider,l=e.level,o=e.onCancel,s=e.onSubmit,c=(0,v.useIntl)(),m=z.Z.useForm(),p=u()(m,1)[0],g=(0,b.u)((function(e){return e.currentOrg})),h=(0,a.useState)(),x=u()(h,2),M=x[0],w=x[1],k=(0,a.useState)(""),Z=u()(k,2),C=Z[0],R=Z[1],F=t&&["ollama","zhipuai","deepseek","dashscope","silicon","gitee","tencent","baidu","volcengine","minimax","xinghuo","moonshot","baichuan","yi","stepfun","openrouter","groq","anthropic","openai","gemini","aihubmix"].includes((null==n?void 0:n.name)||"");(0,a.useEffect)((function(){var e;t?(w(n),R((null==n?void 0:n.logo)||""),p.setFieldsValue({logo:null==n?void 0:n.logo,name:null==n?void 0:n.name,nickname:null==n?void 0:n.nickname,description:null==n?void 0:n.description,webUrl:null==n?void 0:n.webUrl,status:null==n?void 0:n.status,apiUrl:null==n?void 0:n.apiUrl,apiKey:null==n?void 0:n.apiKey,enabled:null===(e=null==n?void 0:n.enabled)||void 0===e||e})):(p.resetFields(),R(""),p.setFieldsValue({enabled:!0}))}),[t,n]);return(0,N.jsx)("div",{children:(0,N.jsx)(T.Z,{title:t?c.formatMessage({id:"ai.provider.edit"}):c.formatMessage({id:"ai.provider.create"}),open:r,onClose:o,width:500,extra:(0,N.jsx)(y.ZP,{type:"primary",onClick:function(){p.validateFields().then(function(){var e=d()(i()().mark((function e(r){var a,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:o={uid:t?null==n?void 0:n.uid:"",name:null==r?void 0:r.name,nickname:null==r?void 0:r.nickname,logo:C||(null==M?void 0:M.logo),description:null==r?void 0:r.description,webUrl:null==r?void 0:r.webUrl,status:(null==r?void 0:r.status)||P.L2A,apiUrl:null==r?void 0:r.apiUrl,apiKey:null==r?void 0:r.apiKey,enabled:null===(a=null==r?void 0:r.enabled)||void 0===a||a,level:l,orgUid:null==g?void 0:g.uid},console.log("handleSaveLlmProvider:",r,o),s(o);case 3:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),f.yw.error(t?c.formatMessage({id:"ai.provider.update.failed"}):c.formatMessage({id:"ai.provider.create.failed"}))}))},children:t?c.formatMessage({id:"ai.provider.update"}):c.formatMessage({id:"ai.provider.confirm"})}),children:(0,N.jsxs)(L.A,{form:p,name:"form",style:{maxWidth:400},submitter:{render:function(){return null}},children:[(0,N.jsx)(L.A.Item,{name:"logo",valuePropName:"fileList",getValueFromEvent:function(e){return Array.isArray(e)?e:null==e?void 0:e.fileList},label:c.formatMessage({id:"ai.provider.logo"}),children:(0,N.jsxs)(E.G,{onSuccess:function(e){console.log("handleUploadSuccess:",e),R(e)},onError:function(e){console.log("handleUploadError:",e),f.yw.error(c.formatMessage({id:"ai.provider.upload.failed"}))},children:[(0,N.jsx)(j.Z,{src:C,size:64}),(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(q.Z,{}),style:{marginLeft:8},children:c.formatMessage({id:"ai.provider.uploadLogo"})})]})}),(0,N.jsx)(S.Z,{width:"md",name:"name",label:c.formatMessage({id:"ai.provider.uniqueId"}),placeholder:c.formatMessage({id:"ai.provider.uniqueId.placeholder"}),disabled:F,rules:[{required:!0,message:c.formatMessage({id:"ai.provider.uniqueId.required"})},{pattern:/^[a-zA-Z0-9]+$/,message:c.formatMessage({id:"ai.provider.uniqueId.pattern"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}},tooltip:F?c.formatMessage({id:"ai.provider.uniqueId.system.tooltip"}):void 0}),(0,N.jsx)(S.Z,{label:c.formatMessage({id:"ai.provider.nickname"}),name:"nickname",rules:[{required:!0,message:c.formatMessage({id:"ai.provider.nickname.required"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,N.jsx)(D.Z,{label:c.formatMessage({id:"ai.provider.description"}),name:"description",fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,N.jsx)(S.Z,{label:c.formatMessage({id:"ai.provider.webUrl"}),name:"webUrl",placeholder:c.formatMessage({id:"ai.provider.webUrl.placeholder"}),rules:[{type:"url",message:c.formatMessage({id:"ai.provider.webUrl.invalid"})}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,N.jsx)(U.Z,{label:c.formatMessage({id:"ai.provider.status"}),name:"status",options:[{label:c.formatMessage({id:"ai.provider.status.development"}),value:P.L2A},{label:c.formatMessage({id:"ai.provider.status.production"}),value:P.KY}],rules:[{required:!0,message:c.formatMessage({id:"ai.provider.status.required"})}],fieldProps:{placeholder:c.formatMessage({id:"ai.provider.status.placeholder"})}}),(0,N.jsx)(S.Z,{label:c.formatMessage({id:"ai.provider.apiUrl"}),name:"apiUrl",placeholder:c.formatMessage({id:"ai.provider.apiUrl.placeholder"}),rules:[{required:!0,message:c.formatMessage({id:"ai.provider.apiUrl.required"})},{validator:function(e,r){return r&&r.endsWith("/")?Promise.reject(new Error(c.formatMessage({id:"ai.provider.apiUrl.noTrailingSlash"}))):Promise.resolve()}}],fieldProps:{onPressEnter:function(e){console.log("onPressEnter:",e)}},extra:c.formatMessage({id:"ai.provider.apiUrl.extra"})}),"ollama"!==(null==M?void 0:M.name)&&(0,N.jsx)(S.Z.Password,{label:c.formatMessage({id:"ai.provider.apiKey"}),name:"apiKey",fieldProps:{placeholder:c.formatMessage({id:"ai.provider.apiKey.placeholder"}),allowClear:!0,visibilityToggle:!0,onPressEnter:function(e){console.log("onPressEnter:",e)}}}),(0,N.jsx)(I.Z,{label:c.formatMessage({id:"ai.provider.enabled"}),name:"enabled",tooltip:c.formatMessage({id:"ai.provider.enabled.tooltip"}),checkedChildren:c.formatMessage({id:"ai.provider.enabled.checked"}),unCheckedChildren:c.formatMessage({id:"ai.provider.enabled.unchecked"})})]})})})},F=t(73193),O=t.n(F),A=t(76711),K=t.n(A),J=t(16894),B=t(45034),_=t(47401),V=(0,J.Ue)()((0,B.mW)((0,B.tJ)((0,_.n)((function(e,r){return{llmproviderResultPlatform:{data:{content:[]}},currentLlmProviderPlatform:{uid:"",nickname:""},insertLlmProviderPlatform:function(r){e((function(e){e.llmproviderResultPlatform.data.content.unshift(r)}))},upgradeLlmProviderPlatform:function(r){e((function(e){var t=e.llmproviderResultPlatform.data.content,a=t.findIndex((function(e){return e.uid===r.uid}));-1!==a?t[a]=r:console.warn("LlmProvider with uid ".concat(r.uid," not found."))}))},setLlmProviderResultPlatform:function(t){e({llmproviderResultPlatform:t});var a,n=r().currentLlmProviderPlatform;""!==n.uid&&void 0!==n||(null===(a=t.data)||void 0===a||null===(a=a.content)||void 0===a?void 0:a.length)>0&&e({currentLlmProviderPlatform:t.data.content[0]})},setCurrentLlmProviderPlatform:function(t){var a=r().llmproviderResultPlatform.data.content,n=a.findIndex((function(e){return e.uid===t.uid}));if(-1!==n){var l=[].concat(K()(a.slice(0,n)),[t],K()(a.slice(n+1))),o=O()(O()({},r().llmproviderResultPlatform),{},{data:{content:l}});e({llmproviderResultPlatform:o,currentLlmProviderPlatform:t})}else e({currentLlmProviderPlatform:t})},deleteCurrentLlmProviderPlatform:function(t){var a=r().llmproviderResultPlatform.data.content,n=a.findIndex((function(e){return e.uid===t}));-1!==n?e({llmproviderResultPlatform:O()(O()({},r().llmproviderResultPlatform),{},{data:{content:[].concat(K()(a.slice(0,n)),K()(a.slice(n+1)))}})}):console.warn("LlmProvider not found in cache:",t),r().currentLlmProviderPlatform.uid===t&&e({currentLlmProviderPlatform:{uid:""}})},deleteLlmProviderCachePlatform:function(){return e({},!0)}}})),{name:P.dNm}))),G=function(e){var r,t,n=e.level,l=e.superUser,o=(0,p.Z)().isDarkMode,s=(0,v.useIntl)(),c=(0,g.Z)(),L=c.translateString,S=c.translateStringTranct,D=(0,b.u)((function(e){return e.currentOrg})),U=(0,a.useState)(!1),I=u()(U,2),z=I[0],T=I[1],E=(0,a.useState)(!1),q=u()(E,2),F=q[0],O=q[1],A=(0,C.A)((function(e){return{llmproviderResult:e.llmproviderResult,currentLlmProvider:e.currentLlmProvider,setLlmProviderResult:e.setLlmProviderResult,insertLlmProvider:e.insertLlmProvider,setCurrentLlmProvider:e.setCurrentLlmProvider,upgradeLlmProvider:e.upgradeLlmProvider,deleteCurrentLlmProvider:e.deleteCurrentLlmProvider}})),K=A.llmproviderResult,J=A.currentLlmProvider,B=A.setLlmProviderResult,_=A.insertLlmProvider,G=A.setCurrentLlmProvider,X=A.upgradeLlmProvider,H=A.deleteCurrentLlmProvider,W=V((function(e){return{llmproviderResultPlatform:e.llmproviderResultPlatform,currentLlmProviderPlatform:e.currentLlmProviderPlatform,setLlmProviderResultPlatform:e.setLlmProviderResultPlatform,insertLlmProviderPlatform:e.insertLlmProviderPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform,upgradeLlmProviderPlatform:e.upgradeLlmProviderPlatform,deleteCurrentLlmProviderPlatform:e.deleteCurrentLlmProviderPlatform}})),Y=W.llmproviderResultPlatform,Q=W.currentLlmProviderPlatform,$=W.setLlmProviderResultPlatform,ee=W.insertLlmProviderPlatform,re=W.setCurrentLlmProviderPlatform,te=W.upgradeLlmProviderPlatform,ae=W.deleteCurrentLlmProviderPlatform,ne=(0,a.useState)(n===P.Hxq),le=u()(ne,1)[0],oe=le?Q:J,ie=h.Z.useModal(),se=u()(ie,2),de=se[0],ce=se[1],ue=function(){var e=d()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),f.yw.loading(s.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,m.HH)(r);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(f.yw.destroy(),f.yw.success(s.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),le?ae(r.uid):H(r.uid)):(f.yw.destroy(),f.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),me=function(){var e=d()(i()().mark((function e(){var r,t,a,l,o,s;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("getLlmProviders"),r={pageNumber:0,pageSize:50,sortBy:"createdAt",sortDirection:"ascend",status:n===P.Hxq?"":P.KY,orgUid:n===P.Hxq?"":null==D?void 0:D.uid,level:n},e.next=4,(0,m.mK)(r);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t),200===t.code?le?($(t),(null==t||null===(a=t.data)||void 0===a?void 0:a.content.length)>0&&re(null==t||null===(l=t.data)||void 0===l?void 0:l.content[0])):(B(t),(null==t||null===(o=t.data)||void 0===o?void 0:o.content.length)>0&&G(null==t||null===(s=t.data)||void 0===s?void 0:s.content[0])):f.yw.error(t.message);case 7:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){me()}),[]);var fe=function(){var e=d()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("createLlmProvider",r),f.yw.loading(s.formatMessage({id:"creating"})),e.next=4,(0,m.T)(r);case 4:t=e.sent,console.log("createLlmProvider:",t),200===t.code?(f.yw.destroy(),f.yw.success(s.formatMessage({id:"create.success",defaultMessage:"create success"})),le?ee(t.data):_(t.data),T(!1)):(f.yw.destroy(),f.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),pe=function(){var e=d()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.yw.loading(s.formatMessage({id:"updating"})),e.next=3,(0,m.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(f.yw.destroy(),f.yw.success(s.formatMessage({id:"update.success",defaultMessage:"update success"})),le?te(t.data):X(t.data),T(!1)):(f.yw.destroy(),f.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}();return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)("div",{style:{margin:10},children:(0,N.jsxs)(x.Z,{gap:"small",align:"flex-start",children:[(0,N.jsx)(y.ZP,{size:"small",type:"primary",icon:(0,N.jsx)(Z.Z,{}),onClick:function(){console.log("new llmProvider"),O(!1),T(!0)},children:s.formatMessage({id:"pages.robot.new",defaultMessage:"New"})}),(0,N.jsx)(y.ZP,{size:"small",onClick:function(){console.log("edit llmProvider"),O(!0),T(!0)},disabled:""===(null==oe?void 0:oe.uid),children:s.formatMessage({id:"edit",defaultMessage:"Edit"})}),(0,N.jsx)(y.ZP,{onClick:function(){return function(e){de.confirm({title:s.formatMessage({id:"deleteTip"}),icon:(0,N.jsx)(k.Z,{}),content:"".concat(s.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(L(e.nickname),"】？"),onOk:function(){ue(e)},onCancel:function(){},okText:s.formatMessage({id:"ok"}),cancelText:s.formatMessage({id:"cancel"})})}(oe)},size:"small",style:{float:"right"},danger:!0,disabled:""===(null==oe?void 0:oe.uid),children:s.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})})]})}),(0,N.jsx)(M.Z,{itemLayout:"horizontal",dataSource:le?(null==Y||null===(r=Y.data)||void 0===r?void 0:r.content)||[]:(null==K||null===(t=K.data)||void 0===t?void 0:t.content)||[],renderItem:function(e,r){return(0,N.jsx)(M.Z.Item,{style:(null==oe?void 0:oe.uid)===e.uid?{backgroundColor:o?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){return r=e,void(le?re(r):G(r));var r},children:(0,N.jsx)(M.Z.Item.Meta,{style:{marginLeft:"10px"},avatar:(0,N.jsx)(j.Z,{src:e.logo}),title:(0,N.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,N.jsx)("span",{children:S(null==e?void 0:e.nickname)}),(0,N.jsx)(w.Z,{color:null!=e&&e.enabled?"green":"red",children:null!=e&&e.enabled?"启用":"禁用"})]}),description:(0,N.jsxs)("div",{children:[l&&(0,N.jsx)("div",{children:(null==e?void 0:e.status)===P.KY?"上线发布":"未上线"}),(null==e?void 0:e.description)&&(0,N.jsx)("div",{style:{marginTop:l?"4px":"0",color:"#666"},children:e.description})]})})})}}),z&&(0,N.jsx)(R,{open:z,isEdit:F,level:n,llmProvider:oe,onCancel:function(){T(!1)},onSubmit:function(e){F?pe(e):fe(e)}}),ce]})},X=t(37963),H=t(86222),W=t.n(H),Y=t(41282),Q=t(13775),$=t(8340),ee=t(93892),re=t(49616),te=t(82373),ae=t(85817),ne=function(e){var r=e.isEdit,t=e.llmmodel,n=e.provider,l=e.open,o=e.level,i=e.onClose,s=e.onSubmit,d=L.A.useForm(),c=u()(d,1)[0],m=(0,v.useIntl)(),f=(0,b.u)((function(e){return e.currentOrg})),p=[{label:m.formatMessage({id:"model.type.text"}),value:P.l55},{label:m.formatMessage({id:"model.type.embedding"}),value:P.xTq},{label:m.formatMessage({id:"model.type.rerank"}),value:P.SeQ},{label:m.formatMessage({id:"model.type.vision"}),value:P.xZ8},{label:m.formatMessage({id:"model.type.code"}),value:P.rrk},{label:m.formatMessage({id:"model.type.reasoning"}),value:P.GNM},{label:m.formatMessage({id:"model.type.text2image"}),value:P.eQL},{label:m.formatMessage({id:"model.type.image2text"}),value:P.ztv},{label:m.formatMessage({id:"model.type.audio2text"}),value:P._D8},{label:m.formatMessage({id:"model.type.text2audio"}),value:P.YNO},{label:m.formatMessage({id:"model.type.text2video"}),value:P.GZK},{label:m.formatMessage({id:"model.type.video2text"}),value:P.B6M}];(0,a.useEffect)((function(){var e;r&&t&&c?c.setFieldsValue({uid:null==t?void 0:t.uid,name:null==t?void 0:t.name,nickname:null==t?void 0:t.nickname,description:null==t?void 0:t.description,type:null==t?void 0:t.type,enabled:null!==(e=null==t?void 0:t.enabled)&&void 0!==e&&e}):(console.log("form resetFields"),c.resetFields(),c.setFieldValue("type",P.l55),c.setFieldValue("enabled",!0))}),[t]);return(0,a.useEffect)((function(){}),[t]),(0,N.jsx)("div",{children:(0,N.jsx)(T.Z,{title:r?m.formatMessage({id:"model.edit"}):m.formatMessage({id:"model.create"}),width:600,onClose:i,open:l,extra:(0,N.jsxs)(re.Z,{children:[(0,N.jsx)(y.ZP,{onClick:i,children:m.formatMessage({id:"cancel"})}),(0,N.jsx)(y.ZP,{onClick:function(){console.log("handleSubmit"),c.validateFields().then((function(e){var a;console.log("Form values:",e);var l={uid:r?null==t?void 0:t.uid:"",name:e.name,nickname:e.nickname,description:e.description,type:e.type,enabled:null===(a=e.enabled)||void 0===a||a,providerUid:null==n?void 0:n.uid,providerName:null==n?void 0:n.name,level:o,orgUid:null==f?void 0:f.uid};console.log("llmmodelObject:",l),s(l)})).catch((function(e){console.log("Form errors:",e)}))},type:"primary",children:m.formatMessage({id:"ok"})})]}),children:(0,N.jsxs)(L.A,{form:c,name:"model",submitter:!1,children:[(0,N.jsx)(S.Z,{label:m.formatMessage({id:"model.name"}),name:"name"}),(0,N.jsx)(S.Z,{label:m.formatMessage({id:"model.nickname"}),name:"nickname"}),(0,N.jsx)(D.Z,{label:m.formatMessage({id:"model.description"}),name:"description",placeholder:m.formatMessage({id:"model.description.placeholder"}),fieldProps:{rows:3,maxLength:500,showCount:!0}}),(0,N.jsx)(U.Z,{label:m.formatMessage({id:"model.type"}),name:"type",options:p,placeholder:m.formatMessage({id:"model.type.placeholder"}),rules:[{required:!0,message:m.formatMessage({id:"model.type.required"})}]}),(0,N.jsx)(I.Z,{label:m.formatMessage({id:"model.enabled",defaultMessage:"启用状态"}),name:"enabled",tooltip:m.formatMessage({id:"model.enabled.tooltip",defaultMessage:"是否启用该大模型"}),checkedChildren:m.formatMessage({id:"enabled",defaultMessage:"启用"}),unCheckedChildren:m.formatMessage({id:"disabled",defaultMessage:"禁用"})})]})})})},le=t(11090),oe=t(59304),ie=t(80556),se=t(30617),de=t(53504),ce=t(61155),ue=ae.Z.Text,me=function(e){var r=e.provider,t=e.open,n=(e.level,e.onClose),l=e.onSubmit,o=e.existingModels,s=void 0===o?[]:o,c=(0,v.useIntl)(),m=(0,a.useState)(!1),p=u()(m,2),g=p[0],h=p[1],x=(0,a.useState)([]),M=u()(x,2),j=M[0],b=M[1],k=(0,a.useState)([]),Z=u()(k,2),C=Z[0],L=Z[1],S=function(e){return s.some((function(r){return r.name===e.name}))},D=function(){var e=d()(i()().mark((function e(){var t,a,n,l;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return h(!0),e.prev=1,t={pageNumber:0,pageSize:100,level:P.Hxq,providerName:r.name},e.next=5,(0,Y.LF)(t);case 5:a=e.sent,console.log("获取平台模型列表:",a),200===a.code?(n=a.data.content||[],b(n),l=n.filter((function(e){return S(e)})).map((function(e){return e.uid})),L(l)):f.yw.error(a.message||c.formatMessage({id:"ai.model.import.fetchFailed"})),e.next=14;break;case 10:e.prev=10,e.t0=e.catch(1),console.error("获取平台模型异常:",e.t0),f.yw.error(c.formatMessage({id:"ai.model.import.fetchError"}));case 14:return e.prev=14,h(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,10,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){t&&D()}),[t]);var U=[{title:c.formatMessage({id:"ai.model.import.modelName"}),dataIndex:"name",key:"name",render:function(e,r){return(0,N.jsxs)(re.Z,{children:[e,S(r)&&(0,N.jsx)(w.Z,{color:"green",children:c.formatMessage({id:"ai.model.import.alreadyExists"})})]})}},{title:c.formatMessage({id:"ai.model.import.modelNickname"}),dataIndex:"nickname",key:"nickname"},{title:c.formatMessage({id:"ai.model.import.modelDescription"}),dataIndex:"description",key:"description",ellipsis:!0}],I={selectedRowKeys:C,onChange:function(e){L(e)}};return(0,N.jsxs)(T.Z,{title:c.formatMessage({id:"ai.model.import.title"},{provider:r.nickname}),width:700,open:t,onClose:n,destroyOnClose:!0,footer:(0,N.jsxs)(re.Z,{children:[(0,N.jsx)(y.ZP,{onClick:n,children:c.formatMessage({id:"ai.model.import.cancel"})}),(0,N.jsx)(y.ZP,{type:"primary",onClick:function(){if(0!==C.length){var e=j.filter((function(e){return C.includes(e.uid)}));l(e)}else f.yw.warning(c.formatMessage({id:"ai.model.import.noSelection"}))},disabled:0===C.length,children:c.formatMessage({id:"ai.model.import.importSelected"},{count:C.length})})]}),children:[(0,N.jsxs)(ue,{type:"secondary",children:[c.formatMessage({id:"ai.model.import.description"},{provider:r.nickname}),s.length>0&&(0,N.jsx)(ue,{type:"secondary",style:{marginLeft:8},children:c.formatMessage({id:"ai.model.import.existingTip"})})]}),(0,N.jsx)("div",{style:{marginTop:16},children:(0,N.jsx)(de.Z,{spinning:g,children:(0,N.jsx)(ce.Z,{rowKey:"uid",columns:U,dataSource:j,pagination:{pageSize:10},rowSelection:I,size:"small"})})}),0===j.length&&!g&&(0,N.jsx)("div",{style:{textAlign:"center",margin:"20px 0"},children:(0,N.jsx)(ue,{type:"secondary",children:c.formatMessage({id:"ai.model.import.noPlatformModels"})})})]})},fe=function(e){var r=e.provider,t=e.level,n=(0,v.useIntl)(),l=(0,p.Z)().isDarkMode,o=(0,a.useState)(!0),s=u()(o,2),c=s[0],x=s[1],w=(0,a.useState)(!0),L=u()(w,2),S=L[0],D=L[1],U=(0,g.Z)(),I=U.translateString,z=(U.translateStringTranct,(0,a.useState)()),T=u()(z,2),E=T[0],q=T[1],F=(0,a.useState)(!1),A=u()(F,2),K=A[0],J=A[1],B=(0,a.useState)(!1),_=u()(B,2),V=_[0],G=_[1],X=(0,b.u)((function(e){return e.currentOrg})),H=(0,a.useState)([]),de=u()(H,2),ce=de[0],ue=de[1],fe=(0,C.A)((function(e){return e.upgradeLlmProvider})),pe=h.Z.useModal(),ge=u()(pe,2),ve=ge[0],he=ge[1],xe=(0,a.useState)(!1),ye=u()(xe,2),Me=ye[0],je=ye[1],we=(0,a.useState)(!1),be=u()(we,2),Pe=be[0],ke=be[1],Ze=(0,a.useState)({current:1,pageSize:10,total:0,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,r){return"".concat(r[0],"-").concat(r[1]," / ").concat(e)},pageSizeOptions:["10","20","50","100"]}),Ce=u()(Ze,2),Le=Ce[0],Se=Ce[1],De=(0,C.A)((function(e){var r;return(null===(r=e.llmproviderResult)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.content)||[]})).find((function(e){return e.uid===(null==r?void 0:r.uid)}))||r,Ue=function(){var e=d()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("delete robot",r),f.yw.loading(n.formatMessage({id:"deleting",defaultMessage:"Deleting"})),e.next=4,(0,Y.Oh)(r);case 4:t=e.sent,console.log("delete robot response",t),200===t.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),Ie(Le.current,Le.pageSize)):(f.yw.destroy(),f.yw.error(t.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ie=function(){var e=d()(i()().mark((function e(){var r,a,n,l,o=arguments;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=o.length>0&&void 0!==o[0]?o[0]:1,a=o.length>1&&void 0!==o[1]?o[1]:10,console.log("requestModels",{page:r,size:a}),ke(!0),n={pageNumber:r-1,pageSize:a,providerUid:null==De?void 0:De.uid,orgUid:null==X?void 0:X.uid,level:t},e.next=7,(0,Y.LF)(n);case 7:l=e.sent,console.log("queryLlmModelsByOrg: ",l,n),200===l.code?(ue(l.data.content),Se((function(e){return O()(O()({},e),{},{current:r,pageSize:a,total:l.data.totalElements||0})})),ke(!1)):(ke(!1),f.yw.error(l.message));case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),ze=function(){var e=d()(i()().mark((function e(){var r,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("refreshProvider"),null!=De&&De.uid){e.next=4;break}return f.yw.error(n.formatMessage({id:"provider.uid.notexist"})),e.abrupt("return");case 4:return f.yw.loading(n.formatMessage({id:"loading",defaultMessage:"Loading"})),r={uid:De.uid,orgUid:null==X?void 0:X.uid,level:t},e.prev=6,e.next=9,(0,m.N0)(r);case 9:a=e.sent,console.log("queryLlmProviderByUid: ",a,r),200===a.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"provider.refresh.success"})),fe(a.data)):(f.yw.destroy(),f.yw.error(a.message)),e.next=19;break;case 14:e.prev=14,e.t0=e.catch(6),f.yw.destroy(),f.yw.error(n.formatMessage({id:"provider.refresh.failed"})),console.error("refreshProvider error:",e.t0);case 19:case"end":return e.stop()}}),e,null,[[6,14]])})));return function(){return e.apply(this,arguments)}}();(0,a.useEffect)((function(){Ie(1,10)}),[]);var Te=function(){J(!1)},Ee=function(){G(!1)},qe=function(){var e=d()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleSubmitDrawer:",r),!c){e.next=9;break}return e.next=4,(0,Y.WS)(r);case 4:t=e.sent,console.log("updateLlmModel:",t.data),200===t.code?(f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),Ie(Le.current,Le.pageSize),Te()):f.yw.error(t.message),e.next=14;break;case 9:return e.next=11,(0,Y.Jr)(r);case 11:a=e.sent,console.log("createLlmModel:",a.data),200===a.code?(f.yw.success(n.formatMessage({id:"create.success",defaultMessage:"create success"})),Ie(1,Le.pageSize),Te()):f.yw.error(a.message);case 14:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ne=function(){var e=d()(i()().mark((function e(r){var a,l,o,s,d,c,u,m;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("导入选中的模型:",r),r&&0!==r.length){e.next=5;break}return f.yw.warning(n.formatMessage({id:"model.import.none.selected"})),Ee(),e.abrupt("return");case 5:if(a=ce.map((function(e){return e.name})),l=r.filter((function(e){return!a.includes(e.name)})),0!==l.length){e.next=11;break}return f.yw.info(n.formatMessage({id:"model.import.already.exist"})),Ee(),e.abrupt("return");case 11:f.yw.loading("".concat(n.formatMessage({id:"loading"})).concat(l.length).concat(n.formatMessage({id:"model.add"}),"...")),e.prev=12,o=0,s=W()(l),e.prev=15,s.s();case 17:if((d=s.n()).done){e.next=27;break}return c=d.value,u={name:c.name,nickname:c.nickname,description:c.description,type:c.type,enabled:!0,providerUid:De.uid,providerName:De.name,orgUid:null==X?void 0:X.uid,level:t},e.next=22,(0,Y.Jr)(u);case 22:m=e.sent,console.log("createLlmModel:",m,u),200===m.code&&o++;case 25:e.next=17;break;case 27:e.next=32;break;case 29:e.prev=29,e.t0=e.catch(15),s.e(e.t0);case 32:return e.prev=32,s.f(),e.finish(32);case 35:f.yw.destroy(),o>0?(f.yw.success(n.formatMessage({id:"model.import.success"},{count:o})),Ie(1,Le.pageSize)):f.yw.warning(n.formatMessage({id:"model.import.none.success"})),e.next=44;break;case 39:e.prev=39,e.t1=e.catch(12),console.error("导入模型出错:",e.t1),f.yw.destroy(),f.yw.error(n.formatMessage({id:"model.import.failed"}));case 44:Ee();case 45:case"end":return e.stop()}}),e,null,[[12,39],[15,29,32,35]])})));return function(r){return e.apply(this,arguments)}}(),Re=function(){var e=d()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleUpdateProvider:",De),t=O()(O()({},De),{},{status:r?P.KY:P.L2A}),e.next=4,(0,m.fx)(t);case 4:a=e.sent,console.log("updateLlmProvider:",t,a),200===a.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),fe(a.data)):(f.yw.destroy(),f.yw.error(a.message));case 7:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Fe=function(e){var r;console.log("list on delete",e),r=e,ve.confirm({title:n.formatMessage({id:"deleteTip"}),icon:(0,N.jsx)(k.Z,{}),content:"".concat(n.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(I(r.nickname),"】？"),onOk:function(){Ue(r)},onCancel:function(){},okText:n.formatMessage({id:"ok"}),cancelText:n.formatMessage({id:"cancel"})})},Oe=function(){var e=d()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch enabled to ".concat(r)),t=O()(O()({},De),{},{enabled:r}),f.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,m.fx)(t);case 5:a=e.sent,console.log("updateLlmProvider enabled:",t,a),200===a.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),fe(a.data)):(f.yw.destroy(),f.yw.error(a.message));case 8:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ae=function(){var e=d()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.yw.loading(n.formatMessage({id:"updating"})),e.next=3,(0,m.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),fe(t.data),je(!1)):(f.yw.destroy(),f.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ke=function(){var e=d()(i()().mark((function e(r,a){var l,o;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("switch model enabled to ".concat(r),a),l=O()(O()({},a),{},{enabled:r,providerUid:null==De?void 0:De.uid,orgUid:null==X?void 0:X.uid,level:t}),f.yw.loading(n.formatMessage({id:"updating"})),e.next=5,(0,Y.WS)(l);case 5:o=e.sent,console.log("updateLlmModel enabled:",l,o),200===o.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),ue((function(e){return e.map((function(e){return e.uid===a.uid?O()(O()({},e),{},{enabled:r}):e}))}))):(f.yw.destroy(),f.yw.error(o.message));case 8:case"end":return e.stop()}}),e)})));return function(r,t){return e.apply(this,arguments)}}();return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("h1",{children:[(0,N.jsx)(j.Z,{src:null==De?void 0:De.logo}),(0,N.jsx)("span",{style:{marginLeft:"12px"},children:null==De?void 0:De.nickname}),(0,N.jsx)($.Z,{checked:null==De?void 0:De.enabled,onChange:Oe,checkedChildren:n.formatMessage({id:"provider.enabled"}),unCheckedChildren:n.formatMessage({id:"provider.disabled"}),style:{marginLeft:"8px"}}),(0,N.jsx)(y.ZP,{type:"text",icon:(0,N.jsx)(le.Z,{}),onClick:function(){window.open(null==De?void 0:De.webUrl,"_blank")}}),(0,N.jsx)(y.ZP,{type:"text",icon:(0,N.jsx)(oe.Z,{}),onClick:function(){D(!0),je(!0)}}),(0,N.jsx)(y.ZP,{type:"text",icon:(0,N.jsx)(ie.Z,{}),onClick:ze})]}),(null==De?void 0:De.description)&&(0,N.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:De.description}),(0,N.jsx)(ee.Z,{message:n.formatMessage({id:"provider.config.alert"}),type:null!=De&&De.enabled?"success":"warning",showIcon:!0,style:{marginBottom:"16px"}}),(0,N.jsx)("div",{style:{marginBottom:"16px"},children:(0,N.jsxs)(re.Z,{direction:"vertical",style:{width:"100%"},children:[(0,N.jsxs)("div",{children:[(0,N.jsxs)("span",{children:["apiUrl: ",null==De?void 0:De.apiUrl]}),(0,N.jsx)(y.ZP,{type:"link",size:"small",icon:(0,N.jsx)(oe.Z,{}),onClick:function(){D(!0),je(!0)},children:n.formatMessage({id:"provider.edit"})})]}),(0,N.jsxs)("div",{children:[(0,N.jsxs)("span",{children:["apiKey: ",null!=De&&De.apiKey?"".concat(De.apiKey.slice(0,3)).concat("*".repeat(20)):""]}),(0,N.jsx)(y.ZP,{type:"link",size:"small",icon:(0,N.jsx)(oe.Z,{}),onClick:function(){D(!0),je(!0)},children:n.formatMessage({id:"provider.edit"})})]})]})}),t===P.Hxq&&(0,N.jsx)($.Z,{checkedChildren:n.formatMessage({id:"provider.online"}),unCheckedChildren:n.formatMessage({id:"provider.offline"}),defaultChecked:(null==De?void 0:De.status)===P.KY,onChange:function(e){console.log("switch to ".concat(e)),Re(e)}}),(0,N.jsx)(te.Z,{orientation:"left",children:n.formatMessage({id:"model.list"})}),(0,N.jsxs)(re.Z,{children:[(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(Z.Z,{}),type:"primary",onClick:function(){x(!1),J(!0)},children:n.formatMessage({id:"model.add"})}),"ollama"!==De.name&&t===P.whQ&&(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(se.Z,{}),onClick:function(){return G(!0)},children:n.formatMessage({id:"model.import"})}),(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(ie.Z,{}),onClick:function(){return Ie(Le.current,Le.pageSize)},children:n.formatMessage({id:"model.refresh"})})]}),(0,N.jsx)(M.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:Pe,dataSource:ce,pagination:O()(O()({},Le),{},{onChange:function(e,r){console.log("Pagination onChange:",{page:e,pageSize:r}),Ie(e,r)},onShowSizeChange:function(e,r){console.log("Pagination onShowSizeChange:",{current:e,size:r}),Ie(1,r)}}),renderItem:function(e,r){return(0,N.jsx)(M.Z.Item,{style:(null==E?void 0:E.uid)===e.uid?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){q(e)},actions:[(0,N.jsx)(y.ZP,{type:"link",onClick:function(){return r=e,console.log("list on edit",r),q(r),x(!0),void J(!0);var r},children:n.formatMessage({id:"edit",defaultMessage:"Edit"})},"edit"),(0,N.jsx)(y.ZP,{type:"link",onClick:function(){return Fe(e)},children:n.formatMessage({id:"pages.robot.delete",defaultMessage:"Delete"})},"delete")],children:(0,N.jsx)(M.Z.Item.Meta,{style:{marginLeft:"15px"},title:(0,N.jsxs)(re.Z,{children:[(0,N.jsxs)("span",{style:{color:"#999",fontWeight:"normal",minWidth:"30px",fontSize:"14px"},children:[(Le.current-1)*Le.pageSize+r+1,"."]}),(0,N.jsx)("span",{children:e.nickname}),(0,Q.Rb)(e.type),(0,N.jsx)($.Z,{size:"small",checked:e.enabled,onChange:function(r){return Ke(r,e)},checkedChildren:n.formatMessage({id:"model.enabled"}),unCheckedChildren:n.formatMessage({id:"model.disabled"})},"enabled")]}),description:(0,N.jsxs)("div",{children:[(0,N.jsx)(ae.Z.Text,{type:"secondary",children:e.name}),e.description&&(0,N.jsx)("div",{style:{marginTop:"4px"},children:(0,N.jsx)(ae.Z.Text,{type:"secondary",ellipsis:{tooltip:e.description},children:e.description})})]})})})}}),K&&(0,N.jsx)(ne,{isEdit:c,llmmodel:E,provider:De,open:K,level:t,onClose:Te,onSubmit:qe}),V&&(0,N.jsx)(me,{provider:De,open:V,level:t,onClose:Ee,onSubmit:Ne,existingModels:ce}),Me&&(0,N.jsx)(R,{open:Me,isEdit:S,level:t,llmProvider:De,onCancel:function(){return je(!1)},onSubmit:Ae}),he]})},pe=t(52202),ge=t(77274),ve=t(82690),he=t(54881),xe=t(67652),ye=t(27473),Me=t(33363),je=t(34042),we=t(27259),be=t(90727),Pe=t(93689),ke=t(54495),Ze=function(e,r,t){var a=function(e,r,t){var a=e.toLowerCase(),n=(null==r?void 0:r.toLowerCase())||"",l=(null==t?void 0:t.toLowerCase())||"";return a.includes("llama")||a.includes("mistral")||a.includes("gemma")||a.includes("phi")?"chat":a.includes("embedding")||a.includes("embed")||a.includes("instructor")?"embedding":a.includes("vision")||a.includes("llava")||a.includes("bakllava")||a.includes("qwen-vl")?"vision":a.includes("code")||a.includes("codellama")||a.includes("wizardcoder")?"code":a.includes("rerank")||a.includes("bge-rerank")?"rerank":a.includes("audio")||a.includes("whisper")?"audio2text":a.includes("text2image")||a.includes("stable-diffusion")?"text2image":n.includes("llama")||n.includes("mistral")||n.includes("gemma")?"chat":n.includes("embedding")?"embedding":n.includes("vision")||n.includes("multimodal")?"vision":n.includes("code")?"code":(l.includes("gguf")||l.includes("ggml"),"chat")}(e,r,t),n="default",l=a;switch(a){case"chat":n="blue",l="对话";break;case"embedding":n="purple",l="向量嵌入";break;case"vision":n="green",l="视觉";break;case"code":n="cyan",l="代码";break;case"rerank":n="cyan",l="排序";break;case"audio2text":n="volcano",l="语音转文本";break;case"text2image":n="magenta",l="文本生成图像";break;default:n="default",l=a}return(0,N.jsx)(w.Z,{color:n,children:l})},Ce=function(e){var r,t,n,l,o,i,s,d,c,m,f,p,g,h=e.visible,x=e.onClose,j=e.modelName,b=e.modelDetails,P=e.loading,k=e.onRefresh,Z=e.onPull,C=e.onDelete,L=(e.isRemoteModel,e.isLocalModel),S=e.pullingModelName,D=e.localModelNames,U=void 0===D?[]:D,I=(0,v.useIntl)(),z=(0,a.useState)(""),E=u()(z,2),q=E[0],R=E[1],F=b&&"model"in b&&"tags"in b,O=b&&"license"in b&&"modelfile"in b,A=U.includes(j);return(0,N.jsxs)(T.Z,{title:I.formatMessage({id:"ai.ollama.modelDetails.title"},{modelName:j}),width:600,placement:"right",onClose:x,open:h,zIndex:1002,children:[P?(0,N.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"80%"},children:(0,N.jsx)(de.Z,{tip:I.formatMessage({id:"ai.ollama.modelDetails.loading"}),spinning:!0,children:(0,N.jsx)("div",{style:{padding:"50px",backgroundColor:"rgba(0, 0, 0, 0.05)",borderRadius:"4px",minHeight:"200px"}})})}):b?(0,N.jsxs)(N.Fragment,{children:[F&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)(je.Z,{bordered:!0,column:1,title:I.formatMessage({id:"ai.ollama.modelDetails.basicInfo"}),styles:{label:{width:"120px"}},children:[(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.name"}),children:(0,N.jsxs)(re.Z,{children:[(null===(r=b.model)||void 0===r?void 0:r.name)||j,A&&(0,N.jsx)(w.Z,{color:"success",children:I.formatMessage({id:"ai.ollama.modelDetails.installed"})})]})}),(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Ze(j)}),(null===(t=b.model)||void 0===t?void 0:t.description)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.description"}),children:b.model.description}),(null===(n=b.model)||void 0===n?void 0:n.lastUpdated)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),children:b.model.lastUpdated}),(null===(l=b.model)||void 0===l?void 0:l.pullCount)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.pullCount"}),children:b.model.pullCount}),(null===(o=b.model)||void 0===o?void 0:o.totalTags)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.totalTags"}),children:b.model.totalTags}),(null===(i=b.model)||void 0===i?void 0:i.popularTags)&&b.model.popularTags.length>0&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.popularTags"}),children:(0,N.jsx)(re.Z,{wrap:!0,children:b.model.popularTags.map((function(e,r){return(0,N.jsx)(w.Z,{color:"blue",children:e},r)}))})}),(null===(s=b.model)||void 0===s?void 0:s.modified_at)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.modifiedAt"}),children:(0,Me.mr)(b.model.modified_at.toString())})]}),b.tags&&b.tags.length>0&&(0,N.jsxs)(N.Fragment,{children:[(0,N.jsx)(te.Z,{orientation:"left",children:I.formatMessage({id:"ai.ollama.modelDetails.availableVersions"})}),(0,N.jsx)(we.Z,{placeholder:I.formatMessage({id:"ai.ollama.modelDetails.searchVersions"}),prefix:(0,N.jsx)(be.Z,{}),value:q,onChange:function(e){return R(e.target.value)},style:{marginBottom:16},allowClear:!0}),(0,N.jsx)(M.Z,{itemLayout:"horizontal",dataSource:function(){if(!F||!b.tags)return[];var e=b.tags;if(!q)return e;var r=q.toLowerCase();return e.filter((function(e){return e.tag.toLowerCase().includes(r)||e.name.toLowerCase().includes(r)}))}(),renderItem:function(e){var r=function(e,r){var t="".concat(e,":").concat(r);return U.includes(t)}(j,e.tag),t="".concat(j,":").concat(e.tag);return(0,N.jsxs)(M.Z.Item,{children:[(0,N.jsx)(M.Z.Item.Meta,{title:(0,N.jsxs)(re.Z,{children:[(0,N.jsx)("span",{children:e.name}),(0,N.jsx)(w.Z,{color:"green",children:e.tag}),Ze(j),e.size&&(0,N.jsx)(w.Z,{color:"orange",children:e.size}),r&&(0,N.jsx)(w.Z,{color:"success",children:I.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,N.jsxs)("span",{children:[I.formatMessage({id:"ai.ollama.modelDetails.lastUpdated"}),": ",e.lastUpdated]})}),(0,N.jsx)(re.Z,{children:(0,N.jsx)(ye.Z,{title:r?I.formatMessage({id:"ai.ollama.modelDetails.versionExists"}):I.formatMessage({id:"ai.ollama.modelDetails.pullThisVersion"}),children:(0,N.jsx)(y.ZP,{type:"primary",size:"small",icon:r?(0,N.jsx)(Pe.Z,{}):(0,N.jsx)(ke.Z,{}),loading:S===t,onClick:function(){Z(t)},disabled:r,children:r?I.formatMessage({id:"ai.ollama.modelDetails.installed"}):I.formatMessage({id:"ai.ollama.modelDetails.pullVersion"})})})})]})}})]})]}),O&&(0,N.jsxs)(je.Z,{bordered:!0,column:1,title:I.formatMessage({id:"ai.ollama.modelDetails.localModel"}),styles:{label:{width:"120px"}},children:[(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.type"}),children:Ze(j,null===(d=b.details)||void 0===d?void 0:d.family,null===(c=b.details)||void 0===c?void 0:c.format)}),(null===(m=b.details)||void 0===m?void 0:m.format)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.modelFormat"}),children:b.details.format}),(null===(f=b.details)||void 0===f?void 0:f.family)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.modelFamily"}),children:b.details.family}),(null===(p=b.details)||void 0===p?void 0:p.parameter_size)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.parameterSize"}),children:b.details.parameter_size}),(null===(g=b.details)||void 0===g?void 0:g.quantization_level)&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.quantizationLevel"}),children:b.details.quantization_level}),b.system&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.systemInfo"}),children:b.system}),b.template&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.template"}),children:(0,N.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:b.template})}),b.modelfile&&(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.modelfile"}),children:(0,N.jsx)("pre",{style:{whiteSpace:"pre-wrap",wordBreak:"break-word"},children:b.modelfile})}),(0,N.jsx)(je.Z.Item,{label:I.formatMessage({id:"ai.ollama.modelDetails.license"}),children:b.license})]})]}):(0,N.jsx)(ee.Z,{message:I.formatMessage({id:"ai.ollama.modelDetails.error"}),type:"warning"}),(0,N.jsx)(te.Z,{}),(0,N.jsxs)(re.Z,{children:[!P&&(0,N.jsx)(y.ZP,{type:"primary",onClick:function(){return k(j)},icon:(0,N.jsx)(ie.Z,{}),children:I.formatMessage({id:"ai.ollama.modelDetails.refresh"})}),L&&(0,N.jsx)(xe.Z,{title:I.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:I.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:j}),onConfirm:function(){C(j),x()},okText:I.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:I.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),children:(0,N.jsx)(y.ZP,{type:"primary",danger:!0,icon:(0,N.jsx)(he.Z,{}),children:I.formatMessage({id:"ai.ollama.modelDetails.delete"})})})]})]})},Le=function(e){var r=e.visible,t=e.onClose,n=e.models,l=e.loading,o=e.onRefresh,i=e.onModelDetails,s=e.onPull,d=e.pullingModelName,c=e.localModelNames,m=void 0===c?[]:c,f=(0,v.useIntl)(),p=(0,a.useState)(""),g=u()(p,2),h=g[0],x=g[1],j=n.filter((function(e){var r=h.toLowerCase();return e.name.toLowerCase().includes(r)||e.description&&e.description.toLowerCase().includes(r)||e.popularTags&&e.popularTags.some((function(e){return e.toLowerCase().includes(r)}))}));return(0,N.jsxs)(T.Z,{title:f.formatMessage({id:"ai.ollama.title"}),width:600,placement:"right",onClose:t,open:r,zIndex:1001,children:[(0,N.jsxs)(re.Z,{direction:"vertical",style:{width:"100%",marginBottom:16},children:[(0,N.jsxs)(re.Z,{style:{width:"100%",justifyContent:"space-between"},children:[(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(ie.Z,{}),loading:l,onClick:o,children:f.formatMessage({id:"ai.ollama.refreshRemote"})}),(0,N.jsx)("span",{style:{color:"#999",fontSize:"14px"},children:f.formatMessage({id:"ai.ollama.modelDetails.modelCount"},{filteredCount:j.length,totalCount:n.length})})]}),(0,N.jsx)(we.Z,{placeholder:f.formatMessage({id:"ai.ollama.modelDetails.searchModels"}),prefix:(0,N.jsx)(be.Z,{}),onChange:function(e){return x(e.target.value)},allowClear:!0})]}),(0,N.jsx)(M.Z,{itemLayout:"vertical",loading:l,dataSource:j,renderItem:function(e){var r,t,a=(t=e.name,m.includes(t));return(0,N.jsx)(M.Z.Item,{extra:(0,N.jsxs)(re.Z,{children:[(0,N.jsx)(y.ZP,{type:"default",icon:(0,N.jsx)(ve.Z,{}),onClick:function(){return i(e.name)},style:{marginRight:8},children:f.formatMessage({id:"ai.ollama.modelDetails.details"})}),(0,N.jsx)(ye.Z,{title:a?f.formatMessage({id:"ai.ollama.modelDetails.modelExistsTooltip"}):f.formatMessage({id:"ai.ollama.modelDetails.modelNotExistsTooltip"}),children:(0,N.jsx)(y.ZP,{type:"primary",icon:a?(0,N.jsx)(Pe.Z,{}):(0,N.jsx)(ke.Z,{}),loading:d===e.name,onClick:function(){return s(e.name)},disabled:a,children:a?f.formatMessage({id:"ai.ollama.modelDetails.installed"}):f.formatMessage({id:"ai.ollama.modelDetails.pullModel"})})})]}),children:(0,N.jsx)(M.Z.Item.Meta,{title:(0,N.jsxs)(re.Z,{children:[(0,N.jsx)("strong",{children:e.name}),Ze(e.name),a&&(0,N.jsx)(w.Z,{color:"success",children:f.formatMessage({id:"ai.ollama.modelDetails.installed"})})]}),description:(0,N.jsxs)(re.Z,{direction:"vertical",style:{width:"100%"},children:[(0,N.jsxs)(re.Z,{children:[e.pullCount&&(0,N.jsx)(w.Z,{color:"cyan",children:f.formatMessage({id:"ai.ollama.modelDetails.downloads"},{count:e.pullCount})}),e.lastUpdated&&(0,N.jsx)(w.Z,{color:"orange",children:f.formatMessage({id:"ai.ollama.modelDetails.updated"},{time:e.lastUpdated})})]}),(0,N.jsx)("div",{children:e.description||f.formatMessage({id:"ai.ollama.modelDetails.noDescription"})}),(0,N.jsx)(re.Z,{style:{marginTop:8},children:null===(r=e.popularTags)||void 0===r?void 0:r.map((function(e,r){return(0,N.jsx)(w.Z,{color:"blue",children:e},r)}))})]})})})}})]})},Se=function(e){var r=e.provider,t=e.level,n=(0,v.useIntl)(),l=(0,p.Z)().isDarkMode,o=(0,a.useState)(!1),s=u()(o,2),c=s[0],g=s[1],h=(0,a.useState)(!1),x=u()(h,2),b=x[0],P=x[1],k=(0,a.useState)([]),Z=u()(k,2),L=Z[0],S=Z[1],D=(0,a.useState)(!1),U=u()(D,2),I=U[0],z=U[1],T=(0,C.A)((function(e){return e.upgradeLlmProvider})),E=(0,a.useState)(),q=u()(E,2),F=q[0],A=q[1],K=(0,C.A)((function(e){var r;return(null===(r=e.llmproviderResult)||void 0===r||null===(r=r.data)||void 0===r?void 0:r.content)||[]})).find((function(e){return e.uid===(null==r?void 0:r.uid)}))||r,J=(0,a.useState)(!1),B=u()(J,2),_=B[0],V=B[1],G=(0,a.useState)([]),X=u()(G,2),H=X[0],W=X[1],Y=(0,a.useState)(!1),Q=u()(Y,2),ae=Q[0],ne=Q[1],se=(0,a.useState)(""),de=u()(se,2),ce=de[0],ue=de[1],me=(0,a.useState)(""),fe=u()(me,2),je=fe[0],we=fe[1],be=(0,a.useState)(!1),Pe=u()(be,2),ke=Pe[0],Se=Pe[1],De=(0,a.useState)(!1),Ue=u()(De,2),Ie=Ue[0],ze=Ue[1],Te=(0,a.useState)(null),Ee=u()(Te,2),qe=Ee[0],Ne=Ee[1],Re=(0,a.useState)(""),Fe=u()(Re,2),Oe=Fe[0],Ae=Fe[1],Ke=function(){var e=d()(i()().mark((function e(){var r,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=K&&K.apiUrl){e.next=5;break}return f.yw.error(n.formatMessage({id:"ai.ollama.apiUrlNotConfigured"})),P(!1),g(!1),e.abrupt("return");case 5:return g(!0),console.log("pingOllama",null==K?void 0:K.apiUrl),r={apiUrl:null==K?void 0:K.apiUrl},e.next=10,(0,pe.VM)(r);case 10:t=e.sent,console.log("getOllamaServerStatus: ",t,r),200===t.code?(P(t.data),g(!1)):(P(!1),g(!1));case 13:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Je=function(){var e=d()(i()().mark((function e(){var r,t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("requestLocalModels"),g(!0),r={apiUrl:null==K?void 0:K.apiUrl},e.next=5,(0,pe.c8)(r);case 5:t=e.sent,console.log("getOllamaLocalModels: ",t,r),200===t.code&&(a=t.data.map((function(e){var r=e.name.split(":"),t=r[0]||e.name,a=r.length>1?r[1]:"default";return O()(O()({},e),{},{modelName:t,modelVersion:a})})),S(a)),g(!1);case 9:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Be=function(){var e=d()(i()().mark((function e(){var r,t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ne(!0),r={apiUrl:null==K?void 0:K.apiUrl},e.next=4,(0,pe.rg)(r);case 4:t=e.sent,console.log("getOllamaLibraryModels: ",t,r),200===t.code?W(t.data):f.yw.error(t.message||n.formatMessage({id:"ai.ollama.remoteModels.fetchFailed"})),ne(!1);case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),_e=function(){Ke(),Je()};(0,a.useEffect)((function(){_e()}),[]);var Ve=function(){var e=d()(i()().mark((function e(r){var t;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return f.yw.loading(n.formatMessage({id:"updating"})),e.next=3,(0,m.fx)(r);case 3:t=e.sent,console.log("updateLlmProvider:",r,t),200===t.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),T(t.data),z(!1)):(f.yw.destroy(),f.yw.error(t.message));case 6:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Ge=function(){var e=d()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("switch enabled to ".concat(r)),!r||b){e.next=4;break}return f.yw.error(n.formatMessage({id:"ai.ollama.startFirst"})),e.abrupt("return");case 4:return t=O()(O()({},K),{},{enabled:r}),f.yw.loading(n.formatMessage({id:"updating"})),e.next=8,(0,m.fx)(t);case 8:a=e.sent,console.log("updateLlmProvider enabled:",t,a),200===a.code?(f.yw.destroy(),f.yw.success(n.formatMessage({id:"update.success",defaultMessage:"update success"})),T(a.data)):(f.yw.destroy(),f.yw.error(a.message));case 11:case"end":return e.stop()}}),e)})));return function(r){return e.apply(this,arguments)}}(),Xe=function(){var e=d()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=3;break}return f.yw.error(n.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return ue(r),f.yw.loading(n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.loading"},{modelName:r})),e.prev=5,t={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=9,(0,pe.G9)(t);case 9:a=e.sent,console.log("deleteOllamaModel:",a.data,r),200===a.code&&a.data?(f.yw.success(n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.success"},{modelName:r})),Je()):f.yw.error(a.message||n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.failed"},{modelName:r})),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(5),console.error("删除模型出错:",e.t0),f.yw.error(n.formatMessage({id:"ai.ollama.modelDetails.deleteModel.error"},{error:e.t0}));case 18:return e.prev=18,ue(""),e.finish(18);case 21:case"end":return e.stop()}}),e,null,[[5,14,18,21]])})));return function(r){return e.apply(this,arguments)}}(),He=function(){var e=d()(i()().mark((function e(r){var t,a;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(b){e.next=3;break}return f.yw.error(n.formatMessage({id:"ai.ollama.notRunning"})),e.abrupt("return");case 3:return we(r),f.yw.loading(n.formatMessage({id:"ai.ollama.modelDetails.pulling"},{modelName:r})),e.prev=5,t={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=9,(0,pe.N6)(t);case 9:200===(a=e.sent).code&&a.data?(f.yw.success(n.formatMessage({id:"ai.ollama.modelDetails.pullSuccess"},{modelName:r})),V(!1),Je()):f.yw.error(a.message||n.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:r})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(5),console.error("拉取模型出错:",e.t0),f.yw.error(n.formatMessage({id:"ai.ollama.modelDetails.pullFailed"},{modelName:r}));case 17:return e.prev=17,we(""),e.finish(17);case 20:case"end":return e.stop()}}),e,null,[[5,13,17,20]])})));return function(r){return e.apply(this,arguments)}}(),We=function(){var e=d()(i()().mark((function e(r){var t,a,l,o,s,d;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(ze(!0),Ae(r),Se(!0),e.prev=3,t=L.some((function(e){return e.name===r})),a=H.some((function(e){return e.name===r})),!t){e.next=14;break}return o={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=10,(0,pe.sF)(o);case 10:l=e.sent,console.log("getOllamaModelDetails (local):",l),e.next=27;break;case 14:if(!a){e.next=22;break}return s={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=18,(0,pe.gF)(s);case 18:l=e.sent,console.log("getOllamaLibraryModelDetails (remote):",l),e.next=27;break;case 22:return d={apiUrl:null==K?void 0:K.apiUrl,model:r},e.next=25,(0,pe.gF)(d);case 25:l=e.sent,console.log("getOllamaLibraryModelDetails (default):",l);case 27:200===l.code?Ne(l.data):(f.yw.error(l.message||n.formatMessage({id:"ai.ollama.modelDetails.fetchFailed"},{modelName:r})),Ne(null)),e.next=35;break;case 30:e.prev=30,e.t0=e.catch(3),console.error("获取模型详情出错:",e.t0),f.yw.error(n.formatMessage({id:"ai.ollama.modelDetails.fetchError"},{error:e.t0})),Ne(null);case 35:return e.prev=35,ze(!1),e.finish(35);case 38:case"end":return e.stop()}}),e,null,[[3,30,35,38]])})));return function(r){return e.apply(this,arguments)}}();return(0,N.jsxs)(N.Fragment,{children:[(0,N.jsxs)("h1",{children:[(0,N.jsx)(j.Z,{src:null==K?void 0:K.logo}),(0,N.jsx)("span",{style:{marginLeft:"12px"},children:null==K?void 0:K.nickname}),(0,N.jsx)($.Z,{checked:null==K?void 0:K.enabled,onChange:Ge,checkedChildren:n.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.checked"}),unCheckedChildren:n.formatMessage({id:"ai.ollama.modelDetails.enableSwitch.unchecked"}),style:{marginLeft:"8px"}}),(0,N.jsx)(y.ZP,{type:"text",icon:(0,N.jsx)(le.Z,{}),onClick:function(){window.open(null==K?void 0:K.webUrl,"_blank")}}),(0,N.jsx)(y.ZP,{type:"text",icon:(0,N.jsx)(oe.Z,{}),onClick:function(){return z(!0)}})]}),(null==K?void 0:K.description)&&(0,N.jsx)("div",{style:{marginBottom:"16px",color:"#666",fontSize:"14px"},children:K.description}),(0,N.jsxs)("div",{style:{marginBottom:"16px"},children:[(0,N.jsxs)("span",{children:["apiUrl: ",null==K?void 0:K.apiUrl]}),(0,N.jsx)(y.ZP,{type:"link",size:"small",icon:(0,N.jsx)(oe.Z,{}),onClick:function(){return z(!0)},children:n.formatMessage({id:"ai.ollama.modelDetails.edit"})})]}),(0,N.jsxs)(re.Z,{children:[(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(ie.Z,{}),loading:c,type:"primary",onClick:_e,children:n.formatMessage({id:"ai.ollama.refresh"})}),(0,N.jsx)(y.ZP,{icon:(0,N.jsx)(ge.Z,{}),type:"primary",onClick:function(){V(!0),Be()},children:n.formatMessage({id:"ai.ollama.remoteModels"})})]}),(0,N.jsx)("br",{}),(0,N.jsx)("br",{}),b?(0,N.jsx)(ee.Z,{message:n.formatMessage({id:"ai.ollama.running"}),type:"success"}):(0,N.jsx)(ee.Z,{message:n.formatMessage({id:"ai.ollama.notRunning"}),type:"error"}),(0,N.jsx)(te.Z,{orientation:"left",children:n.formatMessage({id:"ai.ollama.localModels"})}),(0,N.jsx)(M.Z,{itemLayout:"horizontal",style:{marginTop:10},loading:c,dataSource:L,renderItem:function(e,r){return(0,N.jsx)(M.Z.Item,{style:(null==F?void 0:F.name)===(null==e?void 0:e.name)?{backgroundColor:l?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){A(e)},actions:[(0,N.jsx)(y.ZP,{type:"text",icon:(0,N.jsx)(ve.Z,{}),onClick:function(r){r.stopPropagation(),We(null==e?void 0:e.name)},children:n.formatMessage({id:"ai.ollama.modelDetails.details"})},"details"),(0,N.jsx)(xe.Z,{title:n.formatMessage({id:"ai.ollama.modelDetails.delete.confirm"}),description:n.formatMessage({id:"ai.ollama.modelDetails.delete.description"},{modelName:null==e?void 0:e.name}),onConfirm:function(r){null==r||r.stopPropagation(),Xe(null==e?void 0:e.modelName)},okText:n.formatMessage({id:"ai.ollama.modelDetails.delete.ok"}),cancelText:n.formatMessage({id:"ai.ollama.modelDetails.delete.cancel"}),onCancel:function(e){return null==e?void 0:e.stopPropagation()},children:(0,N.jsx)(y.ZP,{type:"text",danger:!0,icon:(0,N.jsx)(he.Z,{}),loading:ce===(null==e?void 0:e.modelName),onClick:function(e){return e.stopPropagation()},children:n.formatMessage({id:"ai.ollama.modelDetails.deleteModel"})})},"delete")],children:(0,N.jsx)(M.Z.Item.Meta,{title:(0,N.jsxs)(re.Z,{children:[(0,N.jsx)("span",{children:null==e?void 0:e.modelName}),(0,N.jsx)(w.Z,{color:"blue",children:null==e?void 0:e.modelVersion}),Ze(null==e?void 0:e.modelName,null==e?void 0:e.family,null==e?void 0:e.format),(null==e?void 0:e.size)&&(0,N.jsx)(w.Z,{color:"green",children:(0,Me.sS)(null==e?void 0:e.size)}),(null==e?void 0:e.parameter_size)&&(0,N.jsx)(ye.Z,{title:"参数大小",children:(0,N.jsx)(w.Z,{color:"purple",children:null==e?void 0:e.parameter_size})})]}),description:(0,N.jsxs)(re.Z,{direction:"vertical",children:[(0,N.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.fullName"},{name:null==e?void 0:e.name})}),(0,N.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.digest"},{digest:null==e?void 0:e.digest})}),(null==e?void 0:e.family)&&(0,N.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.family"},{family:null==e?void 0:e.family})}),(null==e?void 0:e.quantization_level)&&(0,N.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.quantization"},{level:null==e?void 0:e.quantization_level})}),(0,N.jsx)("div",{children:n.formatMessage({id:"ai.ollama.modelDetails.updateTime"},{time:(0,Me.mr)(null==e?void 0:e.modified_at.toString())})})]}),style:{marginLeft:"15px"}})})}}),(0,N.jsx)(Le,{visible:_,onClose:function(){return V(!1)},models:H,loading:ae,onRefresh:Be,onModelDetails:We,onPull:He,pullingModelName:je,localModelNames:L.map((function(e){return e.modelName}))}),(0,N.jsx)(Ce,{visible:ke,onClose:function(){return Se(!1)},modelName:Oe,modelDetails:qe,loading:Ie,onRefresh:We,onPull:He,onDelete:Xe,isRemoteModel:H.some((function(e){return e.name===Oe})),isLocalModel:L.some((function(e){return e.name===Oe})),pullingModelName:je,localModelNames:L.map((function(e){return e.name}))}),I&&(0,N.jsx)(R,{open:I,isEdit:!0,level:t,llmProvider:K,onCancel:function(){return z(!1)},onSubmit:Ve})]})},De=function(e){var r=e.level,t=(0,a.useState)(""),n=u()(t,2),l=n[0],o=n[1],i=(0,a.useState)([]),s=u()(i,2),d=s[0],c=s[1],m=(0,C.A)((function(e){return{currentLlmProvider:e.currentLlmProvider,llmproviderResult:e.llmproviderResult,setCurrentLlmProvider:e.setCurrentLlmProvider}})),f=m.currentLlmProvider,p=m.llmproviderResult,g=m.setCurrentLlmProvider,v=V((function(e){return{currentLlmProviderPlatform:e.currentLlmProviderPlatform,llmproviderResultPlatform:e.llmproviderResultPlatform,setCurrentLlmProviderPlatform:e.setCurrentLlmProviderPlatform}})),h=v.currentLlmProviderPlatform,x=v.llmproviderResultPlatform,y=v.setCurrentLlmProviderPlatform,M=(0,a.useState)(r===P.Hxq),j=u()(M,1)[0],w=j?h:f;(0,a.useEffect)((function(){if(w&&w.name)if(console.log("llmProvider: ",w),d.find((function(e){return e.key===w.name})))o(w.name);else{var e=K()(d);"ollama"===w.name?e.push({label:w.nickname||w.name,children:(0,N.jsx)(Se,{provider:w,level:r}),key:w.name,closable:!0}):e.push({label:w.nickname||w.name,children:(0,N.jsx)(fe,{provider:w,level:r}),key:w.name,closable:!0}),c(e),o(w.name)}}),[w,d]);return 0===d.length?null:(0,N.jsx)(X.Z,{type:"editable-card",onChange:function(e){var r,t;o(e);var a=(j?(null==x||null===(r=x.data)||void 0===r?void 0:r.content)||[]:(null==p||null===(t=p.data)||void 0===t?void 0:t.content)||[]).find((function(r){return r.name===e}));a&&(j?y(a):g(a))},activeKey:l,onEdit:function(e,r){"remove"===r&&function(e){var r=l,t=-1;d.forEach((function(r,a){r.key===e&&(t=a-1)}));var a=d.filter((function(r){return r.key!==e}));if(a.length&&r===e){var n,i;r=t>=0?a[t].key:a[0].key;var s=(j?(null==x||null===(n=x.data)||void 0===n?void 0:n.content)||[]:(null==p||null===(i=p.data)||void 0===i?void 0:i.content)||[]).find((function(e){return e.name===r}));s&&(j?y(s):g(s))}c(a),o(r)}(e)},items:d})},Ue=l.Z.Sider,Ie=l.Z.Content,ze=function(){var e=(0,n.Z)(),r=e.leftSiderStyle,t=e.leftSiderWidth,a=e.contentStyle;return(0,N.jsx)(N.Fragment,{children:(0,N.jsxs)(l.Z,{children:[(0,N.jsx)(Ue,{style:r,width:t,children:(0,N.jsx)(G,{level:P.whQ,superUser:!1})}),(0,N.jsx)(l.Z,{children:(0,N.jsx)(Ie,{style:a,children:(0,N.jsx)(De,{level:P.whQ,superUser:!1})})})]})})}}}]);