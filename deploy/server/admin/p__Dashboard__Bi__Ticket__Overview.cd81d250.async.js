"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4577],{73119:function(e,t,i){i.r(t);var s=i(90819),n=i.n(s),a=i(89933),r=i.n(a),l=i(45332),o=i.n(l),c=i(44194),d=i(41123),u=i(34251),f=i(71373),g=i(63065),k=i(43413),m=i(10337),v=i(77407),h=i(5858),p=i(9248),x=i(14318),y=i(68525),j=i(35911),T=i(33e3),b=i(14546),M=i(16829),w=i(83381),Z=i(75699),Y=i(61628),R=i(31756),D=i(31881),S=i(76001),C=i(7999),I=i(30234),O=i(25191),z=i(28977),F=i.n(z),B=i(89295),E=i(54693),P=i(31549),U=d.default.RangePicker,W=u.Z.Option;t.default=function(){var e,t,i=(0,Z.useIntl)(),s=(0,I.Z)().translateStringTranct,a=(0,c.useState)(F()().startOf("day")),l=o()(a,2),d=l[0],z=l[1],A=(0,c.useState)(F()().endOf("day")),H=o()(A,2),L=H[0],N=H[1],Q=(0,c.useState)("today"),q=o()(Q,2),G=q[0],_=q[1],J=(0,c.useState)(O.whQ),K=o()(J,2),V=K[0],X=K[1],$=(0,c.useState)(),ee=o()($,2),te=ee[0],ie=ee[1],se=(0,c.useState)(),ne=o()(se,2),ae=ne[0],re=ne[1],le=(0,D.u)((function(e){return e.currentOrg})),oe=(0,S.E)((function(e){return e})),ce=oe.agentResult,de=oe.setAgentResult,ue=(0,E.H)((function(e){return e})),fe=ue.departmentResult,ge=ue.setDepartmentResult,ke=(0,c.useState)(),me=o()(ke,2),ve=me[0],he=me[1],pe=(0,c.useState)(!1),xe=o()(pe,2),ye=(xe[0],xe[1]),je=[{label:(0,P.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.today"}),value:"today"},{label:(0,P.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.yesterday"}),value:"yesterday"},{label:(0,P.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.week"}),value:"week"},{label:(0,P.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,P.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.month"}),value:"month"},{label:(0,P.jsx)(Z.FormattedMessage,{id:"bi.ticket.timeRange.custom"}),value:"custom"}];(0,c.useEffect)((function(){if("custom"===G)z(d),N(L);else{var e=F()();"today"===G?(z(e),N(e)):"yesterday"===G?(z(e.subtract(1,"day")),N(e.subtract(1,"day"))):"week"===G?(z(e.startOf("week")),N(e.endOf("week"))):"lastWeek"===G?(z(e.subtract(1,"week").startOf("week")),N(e.subtract(1,"week").endOf("week"))):"month"===G&&(z(e.startOf("month")),N(e.endOf("month")))}}),[G]);var Te=function(){var e=r()(n()().mark((function e(){var t,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:100,orgUid:null==le?void 0:le.uid},e.next=4,(0,B.dF)(t);case 4:200===(i=e.sent).code?(R.yw.destroy(),ge(i),i.data.content.length>0&&re(i.data.content[0].uid)):(R.yw.destroy(),R.yw.error(i.message));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),be=function(){var e=r()(n()().mark((function e(){var t,i;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return R.yw.loading("loading"),t={pageNumber:0,pageSize:50,orgUid:null==le?void 0:le.uid},e.next=4,(0,C._t)(t);case 4:200===(i=e.sent).code?(R.yw.destroy(),de(i),i.data.content.length>0&&ie(i.data.content[0].uid)):(R.yw.destroy(),R.yw.error(s(i.message)));case 6:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Me=function(){var e=r()(n()().mark((function e(){var t,s;return n()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ye(!0),e.prev=1,R.yw.loading("loading"),t={type:V,startDate:null==d?void 0:d.format("YYYY-MM-DD"),endDate:null==L?void 0:L.format("YYYY-MM-DD"),departmentUid:ae,assigneeUid:te,orgUid:null==le?void 0:le.uid},e.next=6,(0,Y.AD)(t);case 6:s=e.sent,console.log("queryStatisticTicketByDate response:",s.data,t),200===s.code?(R.yw.destroy(),he(s.data)):(R.yw.destroy(),R.yw.error(s.message)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(1),R.yw.error(i.formatMessage({id:"ticket.message.operation.failed"}));case 14:return e.prev=14,ye(!1),e.finish(14);case 17:case"end":return e.stop()}}),e,null,[[1,11,14,17]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){Te(),be()}),[]),(0,c.useEffect)((function(){Me()}),[V,te,ae]),(0,c.useEffect)((function(){Me()}),[d,L]);var we=[{status:"新建",count:(null==ve?void 0:ve.newTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.newTickets/ve.totalTickets*100):0,color:"#1890ff"},{status:"处理中",count:(null==ve?void 0:ve.processingTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.processingTickets/ve.totalTickets*100):0,color:"#faad14"},{status:"已解决",count:(null==ve?void 0:ve.resolvedTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.resolvedTickets/ve.totalTickets*100):0,color:"#52c41a"},{status:"已关闭",count:(null==ve?void 0:ve.closedTickets)||0,percentage:null!=ve&&ve.totalTickets?Math.round(ve.closedTickets/ve.totalTickets*100):0,color:"#666"}].filter((function(e){return e.count>0})),Ze=[{key:"1",date:null==d?void 0:d.format("YYYY-MM-DD"),totalTickets:(null==ve?void 0:ve.totalTickets)||0,newTickets:(null==ve?void 0:ve.newTickets)||0,inProgress:(null==ve?void 0:ve.processingTickets)||0,resolved:(null==ve?void 0:ve.resolvedTickets)||0,closed:(null==ve?void 0:ve.closedTickets)||0,avgResolutionTime:"".concat((null==ve?void 0:ve.averageResolutionTime)||0,"小时"),priority:(null==ve?void 0:ve.criticalTickets)>0?"高":(null==ve?void 0:ve.highTickets)>0?"中":"低"}],Ye=[{title:i.formatMessage({id:"bi.ticket.table.date"}),dataIndex:"date",key:"date"},{title:i.formatMessage({id:"bi.ticket.table.totalTickets"}),dataIndex:"totalTickets",key:"totalTickets"},{title:i.formatMessage({id:"bi.ticket.table.processingTickets"}),dataIndex:"processingTickets",key:"processingTickets",render:function(e,t){return(0,P.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:i.formatMessage({id:"bi.ticket.table.resolvedTickets"}),dataIndex:"resolvedTickets",key:"resolvedTickets",render:function(e,t){return(0,P.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:i.formatMessage({id:"bi.ticket.table.closedTickets"}),dataIndex:"closedTickets",key:"closedTickets",render:function(e,t){return(0,P.jsx)(f.Z,{percent:t.totalTickets>0?Math.round(e/t.totalTickets*100):0,size:"small",format:function(t){return"".concat(e," (").concat(t,"%)")}})}},{title:i.formatMessage({id:"bi.ticket.table.resolutionRate"}),dataIndex:"resolutionRate",key:"resolutionRate",render:function(e){return"".concat(e,"%")}},{title:i.formatMessage({id:"bi.ticket.table.avgResolutionTime"}),dataIndex:"avgResolutionTime",key:"avgResolutionTime",render:function(e){return"".concat(e).concat(i.formatMessage({id:"bi.ticket.unit.minute"}))}}];return(0,P.jsxs)("div",{style:{padding:"24px"},children:[(0,P.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,P.jsx)("h2",{children:i.formatMessage({id:"bi.ticket.title.overview"})}),(0,P.jsxs)("p",{children:[i.formatMessage({id:"bi.ticket.description.overview"}),"today"===G&&(0,P.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD"),")"]}),"yesterday"===G&&(0,P.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD"),")"]}),("week"===G||"lastWeek"===G||"month"===G||"custom"===G)&&(0,P.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",d.format("YYYY-MM-DD")," ~ ",L.format("YYYY-MM-DD"),")"]})]})]}),(0,P.jsx)(g.Z,{style:{marginBottom:16},children:(0,P.jsx)(k.Z,{direction:"vertical",style:{width:"100%"},children:(0,P.jsxs)(k.Z,{wrap:!0,style:{width:"100%",justifyContent:"space-between"},children:[(0,P.jsxs)(k.Z,{wrap:!0,children:[(0,P.jsx)(m.ZP.Group,{value:G,onChange:function(e){return _(e.target.value)},children:je.map((function(e){return(0,P.jsx)(m.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===G&&(0,P.jsx)(U,{value:[d,L],onChange:function(e){z(e[0]),N(e[1])}})]}),(0,P.jsxs)(k.Z,{wrap:!0,children:[(0,P.jsxs)(u.Z,{value:V,onChange:X,style:{width:120},placeholder:i.formatMessage({id:"bi.ticket.filter.type"}),children:[(0,P.jsx)(W,{value:O.whQ,children:i.formatMessage({id:"bi.ticket.filterType.organization"})}),(0,P.jsx)(W,{value:O.fyH,children:i.formatMessage({id:"bi.ticket.filterType.agent"})}),(0,P.jsx)(W,{value:O.nYM,children:i.formatMessage({id:"bi.ticket.filterType.department"})})]}),V===O.fyH&&(0,P.jsx)(u.Z,{value:te,onChange:ie,style:{width:150},placeholder:i.formatMessage({id:"bi.ticket.filter.agent"}),allowClear:!0,children:null===(e=ce.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(e){return(0,P.jsx)(W,{value:e.uid,children:s(e.nickname)},e.uid)}))}),V===O.nYM&&(0,P.jsx)(u.Z,{value:ae,onChange:re,style:{width:150},placeholder:i.formatMessage({id:"bi.ticket.filter.department"}),allowClear:!0,children:null===(t=fe.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(e){return(0,P.jsx)(W,{value:e.uid,children:s(e.name)},e.uid)}))}),(0,P.jsx)(v.ZP,{type:"primary",icon:(0,P.jsx)(j.Z,{}),onClick:function(){return Me()},children:(0,P.jsx)(Z.FormattedMessage,{id:"bi.common.refresh"})})]})]})})}),(0,P.jsxs)(h.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,P.jsx)(p.Z,{span:6,children:(0,P.jsx)(g.Z,{children:(0,P.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.totalTickets"}),value:(null==ve?void 0:ve.totalTickets)||0,prefix:(0,P.jsx)(T.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,P.jsx)(p.Z,{span:6,children:(0,P.jsx)(g.Z,{children:(0,P.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.processingTickets"}),value:(null==ve?void 0:ve.processingTickets)||0,prefix:(0,P.jsx)(b.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,P.jsx)(p.Z,{span:6,children:(0,P.jsx)(g.Z,{children:(0,P.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.resolvedTickets"}),value:(null==ve?void 0:ve.resolvedTickets)||0,prefix:(0,P.jsx)(M.Z,{}),valueStyle:{color:"#722ed1"}})})}),(0,P.jsx)(p.Z,{span:6,children:(0,P.jsx)(g.Z,{children:(0,P.jsx)(x.Z,{title:i.formatMessage({id:"bi.ticket.card.avgResolutionTime"}),value:(null==ve?void 0:ve.averageResolutionTime)||0,prefix:(0,P.jsx)(w.Z,{}),valueStyle:{color:"#eb2f96"},suffix:i.formatMessage({id:"bi.ticket.unit.minute"})})})})]}),(0,P.jsxs)(h.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,P.jsx)(p.Z,{span:12,children:(0,P.jsx)(g.Z,{title:i.formatMessage({id:"bi.ticket.statusDistribution"}),children:(0,P.jsx)("div",{style:{height:300},children:we.map((function(e,t){return(0,P.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:12},children:[(0,P.jsx)("span",{children:e.status}),(0,P.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,P.jsx)("div",{style:{width:12,height:12,backgroundColor:e.color,marginRight:8,borderRadius:2}}),(0,P.jsx)("span",{style:{marginRight:8},children:e.count}),(0,P.jsxs)("span",{style:{color:"#666"},children:["(",e.percentage,"%)"]})]})]},t)}))})})}),(0,P.jsx)(p.Z,{span:12,children:(0,P.jsx)(g.Z,{title:i.formatMessage({id:"bi.ticket.resolutionTrend"}),children:(0,P.jsx)("div",{style:{height:300,display:"flex",justifyContent:"center",alignItems:"center"},children:(0,P.jsxs)("div",{style:{textAlign:"center"},children:[(0,P.jsxs)("div",{style:{fontSize:"24px",fontWeight:"bold",color:"#52c41a"},children:[null!=ve&&ve.totalTickets?Math.round(ve.resolvedTickets/ve.totalTickets*100):0,"%"]}),(0,P.jsx)("div",{style:{color:"#666"},children:"今日解决率"}),(0,P.jsxs)("div",{style:{marginTop:16,color:"#999"},children:["客户满意度: ",(null==ve?void 0:ve.customerSatisfactionRate)||0,"%"]})]})})})})]}),(0,P.jsx)(g.Z,{title:i.formatMessage({id:"bi.ticket.statusDistribution"}),children:(0,P.jsx)(y.Z,{columns:Ye,dataSource:Ze,pagination:!1,size:"middle"})})]})}}}]);