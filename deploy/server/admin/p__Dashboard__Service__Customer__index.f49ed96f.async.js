"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9555],{48821:function(e,t,s){var r=s(76285),a=s(39328),n=s(17323),i=s(81424),o=s(20903),d=s(26411),l=s(34573),u=s(44194),c=s(64665),p=s(31549),m=["fieldProps","proFieldProps"],f=["fieldProps","proFieldProps"],g="text",x=function(e){var t=(0,i.Z)(e.open||!1,{value:e.open,onChange:e.onOpenChange}),s=(0,r.Z)(t,2),n=s[0],l=s[1];return(0,p.jsx)(o.Z.Item,{shouldUpdate:!0,noStyle:!0,children:function(t){var s,r=t.getFieldValue(e.name||[]);return(0,p.jsx)(d.Z,(0,a.Z)((0,a.Z)({getPopupContainer:function(e){return e&&e.parentNode?e.parentNode:e},onOpenChange:function(e){return l(e)},content:(0,p.jsxs)("div",{style:{padding:"4px 0"},children:[null===(s=e.statusRender)||void 0===s?void 0:s.call(e,r),e.strengthText?(0,p.jsx)("div",{style:{marginTop:10},children:(0,p.jsx)("span",{children:e.strengthText})}):null]}),overlayStyle:{width:240},placement:"rightTop"},e.popoverProps),{},{open:n,children:e.children}))}})},h=function(e){var t=e.fieldProps,s=e.proFieldProps,r=(0,n.Z)(e,m);return(0,p.jsx)(c.Z,(0,a.Z)({valueType:g,fieldProps:t,filedConfig:{valueType:g},proFieldProps:s},r))};h.Password=function(e){var t=e.fieldProps,s=e.proFieldProps,i=(0,n.Z)(e,f),o=(0,u.useState)(!1),d=(0,r.Z)(o,2),m=d[0],h=d[1];return null!=t&&t.statusRender&&i.name?(0,p.jsx)(x,{name:i.name,statusRender:null==t?void 0:t.statusRender,popoverProps:null==t?void 0:t.popoverProps,strengthText:null==t?void 0:t.strengthText,open:m,onOpenChange:h,children:(0,p.jsx)("div",{children:(0,p.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:(0,a.Z)((0,a.Z)({},(0,l.Z)(t,["statusRender","popoverProps","strengthText"])),{},{onBlur:function(e){var s;null==t||null===(s=t.onBlur)||void 0===s||s.call(t,e),h(!1)},onClick:function(e){var s;null==t||null===(s=t.onClick)||void 0===s||s.call(t,e),h(!0)}}),proFieldProps:s,filedConfig:{valueType:g}},i))})}):(0,p.jsx)(c.Z,(0,a.Z)({valueType:"password",fieldProps:t,proFieldProps:s,filedConfig:{valueType:g}},i))},h.displayName="ProFormComponent",t.Z=h},16331:function(e,t,s){var r=s(39328),a=s(17323),n=s(44194),i=s(64665),o=s(31549),d=["fieldProps","proFieldProps"],l=function(e,t){var s=e.fieldProps,n=e.proFieldProps,l=(0,a.Z)(e,d);return(0,o.jsx)(i.Z,(0,r.Z)({ref:t,valueType:"textarea",fieldProps:s,proFieldProps:n},l))};t.Z=n.forwardRef(l)},66712:function(e,t,s){s.r(t),s.d(t,{default:function(){return re}});var r=s(37963),a=s(14870),n=s(84176),i=s.n(n),o=s(73193),d=s.n(o),l=s(90819),u=s.n(l),c=s(89933),p=s.n(c),m=s(45332),f=s.n(m),g=s(5025),x=s(68349),h=s(5488);function M(e){return j.apply(this,arguments)}function j(){return(j=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/query/org",{method:"GET",params:d()(d()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return y.apply(this,arguments)}function y(){return(y=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/create",{method:"POST",data:d()(d()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return Z.apply(this,arguments)}function Z(){return(Z=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/update",{method:"POST",data:d()(d()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function k(e){return F.apply(this,arguments)}function F(){return(F=p()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,a.request)("/api/v1/customer/delete",{method:"POST",data:d()(d()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var w=s(34599),P=s(18580),S=s(15722),C=s(5321),T=s(59304),I=s(54881),A=s(11090),B=s(10162),O=s(2484),U=s(81084),R=s(49616),E=s(27473),q=s(5780),N=s(78359),z=s(28977),J=s.n(z),D=s(44194),X=s(32394),Y=s(48821),K=s(16331),G=s(85817),H=s(68724),L=s(31549),V=function(e){var t=e.isEdit,s=e.customer,r=e.open,n=e.onClose,i=e.onSubmit,o=(0,a.useIntl)(),l=X.A.useForm(),u=f()(l,1)[0],c=G.Z.Text;(0,D.useEffect)((function(){r&&(t&&s?u.setFieldsValue({nickname:s.nickname||"",email:s.email||"",mobile:s.mobile||"",description:s.description||"",notes:s.notes||"",extra:s.extra||"",channel:s.channel||""}):u.resetFields())}),[r,t,s,u]);var p=t?o.formatMessage({id:"customer.edit",defaultMessage:"编辑客户"}):o.formatMessage({id:"customer.create",defaultMessage:"新增客户"}),m=s&&!t,g=m?null:(0,L.jsxs)(R.Z,{children:[(0,L.jsx)(q.ZP,{onClick:n,children:(0,L.jsx)(a.FormattedMessage,{id:"cancel",defaultMessage:"取消"})}),(0,L.jsx)(q.ZP,{type:"primary",onClick:function(){u.validateFields().then((function(e){var r=d()(d()({},e),t&&s?{uid:s.uid}:{});i(r)}))},children:(0,L.jsx)(a.FormattedMessage,{id:"submit",defaultMessage:"提交"})})]});return(0,L.jsx)(L.Fragment,{children:(0,L.jsx)(H.Z,{title:p,onClose:n,open:r,width:500,extra:g,children:m&&s?(0,L.jsxs)("div",{children:[(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),":"]})," ",s.nickname||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),":"]})," ",s.email||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"mobile",defaultMessage:"手机"}),":"]})," ",s.mobile||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"}),":"]})," ",s.description||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"notes",defaultMessage:"备注"}),":"]})," ",s.notes||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"extra",defaultMessage:"额外信息"}),":"]})," ",s.extra||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"createdAt",defaultMessage:"创建时间"}),":"]})," ",s.createdAt||"-"]}),(0,L.jsxs)("div",{style:{marginBottom:16},children:[(0,L.jsxs)(c,{strong:!0,children:[(0,L.jsx)(a.FormattedMessage,{id:"updatedAt",defaultMessage:"更新时间"}),":"]})," ",s.updatedAt||"-"]})]}):(0,L.jsxs)(X.A,{form:u,name:"customerForm",submitter:!1,children:[(0,L.jsx)(Y.Z,{name:"nickname",label:(0,L.jsx)(a.FormattedMessage,{id:"nickname",defaultMessage:"昵称"}),rules:[{required:!0,message:"请输入客户昵称"}]}),(0,L.jsx)(Y.Z,{name:"email",label:(0,L.jsx)(a.FormattedMessage,{id:"email",defaultMessage:"邮箱"}),rules:[{type:"email",message:"请输入有效的邮箱地址"}]}),(0,L.jsx)(Y.Z,{name:"mobile",label:(0,L.jsx)(a.FormattedMessage,{id:"mobile",defaultMessage:"手机"})}),(0,L.jsx)(K.Z,{name:"description",label:(0,L.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"描述"})}),(0,L.jsx)(K.Z,{name:"notes",label:(0,L.jsx)(a.FormattedMessage,{id:"notes",defaultMessage:"备注"})}),(0,L.jsx)(K.Z,{name:"extra",label:(0,L.jsx)(a.FormattedMessage,{id:"extra",defaultMessage:"额外信息"})})]})})})},Q=["current","pageSize"],W=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,L.jsx)(a.FormattedMessage,{id:"uid",defaultMessage:"Uid"}),dataIndex:"uid",hideInSearch:!0,fixed:"left",ellipsis:!0},{title:(0,L.jsx)(a.FormattedMessage,{id:"nickname",defaultMessage:"Nickname"}),dataIndex:"nickname",copyable:!0,tooltip:(0,L.jsx)(a.FormattedMessage,{id:"customer.nickname.tooltip"})},{title:(0,L.jsx)(a.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",hideInSearch:!0,tooltip:(0,L.jsx)(a.FormattedMessage,{id:"customer.email.tooltip"})},{title:(0,L.jsx)(a.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",copyable:!0,tooltip:(0,L.jsx)(a.FormattedMessage,{id:"customer.mobile.tooltip"})},{title:(0,L.jsx)(a.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",hideInSearch:!0,tooltip:(0,L.jsx)(a.FormattedMessage,{id:"customer.description.tooltip"})},{title:(0,L.jsx)(a.FormattedMessage,{id:"createdAt",defaultMessage:"createdAt"}),key:"createdAt",dataIndex:"createdAt",sorter:!0,hideInSearch:!0,tooltip:(0,L.jsx)(a.FormattedMessage,{id:"customer.createdAt.tooltip"}),render:function(e,t,s,r){return J()(t.createdAt).format("YYYY-MM-DD HH:mm:ss")}}],$=function(e){e.superUser;var t=(0,a.useIntl)(),s=(0,D.useRef)(),r=(0,D.useState)(1),n=f()(r,2),o=n[0],l=n[1],c=(0,D.useState)(10),m=f()(c,2),j=m[0],y=m[1],Z=(0,w.u)((function(e){return e.currentOrg})),F=(0,D.useState)({}),z=f()(F,2),J=z[0],X=z[1],Y=(0,D.useState)(0),K=f()(Y,2),G=K[0],H=K[1],$=(0,D.useState)([]),_=f()($,2),ee=_[0],te=_[1],se=(0,D.useState)([]),re=f()(se,2),ae=(re[0],re[1]),ne=(0,D.useState)(!1),ie=f()(ne,2),oe=ie[0],de=ie[1],le=(0,D.useState)(!1),ue=f()(le,2),ce=ue[0],pe=ue[1],me=(0,D.useState)(),fe=f()(me,2),ge=fe[0],xe=fe[1],he=function(){var e=p()(u()().mark((function e(r){var a,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!ce||!ge){e.next=7;break}return e.next=4,b(d()(d()({},r),{},{uid:ge.uid,orgUid:null==Z?void 0:Z.uid}));case 4:a=e.sent,e.next=10;break;case 7:return e.next=9,v(d()(d()({},r),{},{orgUid:null==Z?void 0:Z.uid}));case 9:a=e.sent;case 10:200===a.code?(g.yw.success(ce?t.formatMessage({id:"update.success",defaultMessage:"更新成功！"}):t.formatMessage({id:"create.success",defaultMessage:"创建成功！"})),de(!1),null===(n=s.current)||void 0===n||n.reload()):g.yw.error(a.message||t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"})),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(0),console.error("提交客户表单出错:",e.t0),g.yw.error(t.formatMessage({id:"operation.failed",defaultMessage:"操作失败！"}));case 17:case"end":return e.stop()}}),e,null,[[0,13]])})));return function(t){return e.apply(this,arguments)}}(),Me=function(){xe(void 0),pe(!1),de(!0)},je=[].concat(W,[{title:t.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",width:180,fixed:"right",render:function(e,r){return(0,L.jsxs)(R.Z,{children:[(0,L.jsx)(E.Z,{title:t.formatMessage({id:"view",defaultMessage:"查看"}),children:(0,L.jsx)(q.ZP,{type:"text",icon:(0,L.jsx)(C.Z,{}),onClick:function(){return function(e){xe(e),pe(!1),de(!0)}(r)}})}),(0,L.jsx)(E.Z,{title:t.formatMessage({id:"edit",defaultMessage:"编辑"}),children:(0,L.jsx)(q.ZP,{type:"text",icon:(0,L.jsx)(T.Z,{}),onClick:function(){return function(e){xe(e),pe(!0),de(!0)}(r)}})}),(0,L.jsx)(E.Z,{title:t.formatMessage({id:"delete",defaultMessage:"删除"}),children:(0,L.jsx)(q.ZP,{type:"text",danger:!0,icon:(0,L.jsx)(I.Z,{}),onClick:function(){return function(e){var r;x.Z.confirm({title:t.formatMessage({id:"customer.delete.confirm",defaultMessage:"确定要删除该客户吗？"}),icon:(0,L.jsx)(S.Z,{}),content:t.formatMessage({id:"customer.delete.confirm.content",defaultMessage:"删除后将无法恢复，请谨慎操作！"}),onOk:(r=p()(u()().mark((function r(){var a,n;return u()().wrap((function(r){for(;;)switch(r.prev=r.next){case 0:return r.prev=0,r.next=3,k({uid:e.uid,orgUid:null==Z?void 0:Z.uid});case 3:200===(a=r.sent).code?(g.yw.success(t.formatMessage({id:"delete.success",defaultMessage:"删除成功！"})),null===(n=s.current)||void 0===n||n.reload()):g.yw.error(a.message||t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"})),r.next=11;break;case 7:r.prev=7,r.t0=r.catch(0),console.error("删除客户出错:",r.t0),g.yw.error(t.formatMessage({id:"delete.failed",defaultMessage:"删除失败！"}));case 11:case"end":return r.stop()}}),r,null,[[0,7]])}))),function(){return r.apply(this,arguments)})})}(r)}})})]})}}]),ve=function(){var e=p()(u()().mark((function e(t,s,r){var a,n;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleExportExcel",t,s,r),a=localStorage.getItem(h.LA8),n=d()({orgUid:(null==Z?void 0:Z.uid)||"",accessToken:a||"",exportType:t},J),"current"===t?(n.pageNumber=String(o-1),n.pageSize=String(j)):"all"===t?(n.pageNumber="0",n.pageSize="1000"):"range"===t&&void 0!==s&&void 0!==r&&(n.pageNumber=String(s),n.pageSize=String(r)),window.open((0,P.kG)()+"/api/v1/customer/export?"+new URLSearchParams(n).toString());case 5:case"end":return e.stop()}}),e)})));return function(t,s,r){return e.apply(this,arguments)}}(),ye=function(e){for(var t=[],s=1e3,r=Math.ceil(e/s),a=function(){var r=n,a=n*s+1,i=Math.min((n+1)*s,e);t.push({key:"export-".concat(n),label:"".concat(a,"-").concat(i," (").concat(i-a+1,"条)"),onClick:function(){return ve("range",r,s)}})},n=0;n<r;n++)a();return t},be={selectedRowKeys:ee,onChange:function(e,t){te(e),ae(t)}};return(0,L.jsxs)(L.Fragment,{children:[(0,L.jsx)(U.Z,{columns:je,actionRef:s,cardBordered:!0,rowSelection:be,scroll:{x:1300},request:function(){var e=p()(u()().mark((function e(t,s,r){var a,n,o,c,p,m,f,x;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=t.current,n=t.pageSize,o=i()(t,Q),l(a),y(n),X(o),c=void 0,p=void 0,s&&Object.keys(s).length>0&&(m=Object.keys(s)[0],c=m,p="ascend"===s[m]?"ascend":"descend"),f=d()(d()({pageNumber:a-1,pageSize:n,orgUid:null==Z?void 0:Z.uid},o),{},{sortBy:c,sortDirection:p}),e.next=10,M(f);case 10:return x=e.sent,console.log("queryCustomersByOrg response:",x,f),200===x.code?H(x.data.totalElements):g.yw.error(x.message),e.abrupt("return",{data:x.data.content,success:!0,total:x.data.totalElements});case 14:case"end":return e.stop()}}),e)})));return function(t,s,r){return e.apply(this,arguments)}}(),editable:{type:"multiple"},rowKey:"uid",search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),y(t),console.log("page:",e,"size:",t)}},dateFormatter:"string",headerTitle:"客户列表",toolBarRender:function(){return e=[{key:"export-current",icon:(0,L.jsx)(A.Z,{}),label:t.formatMessage({id:"export.current",defaultMessage:"导出当前页"}),onClick:function(){return ve("current")}}],G>0&&(G<=1e3?e.push({key:"export-all",icon:(0,L.jsx)(A.Z,{}),label:t.formatMessage({id:"export.all",defaultMessage:"导出全部"})+" (".concat(G,"条)"),onClick:function(){return ve("all")}}):e.push({key:"export-range",icon:(0,L.jsx)(A.Z,{}),label:t.formatMessage({id:"export.range",defaultMessage:"分段导出"})+" (".concat(G,"条)"),children:ye(G)})),[(0,L.jsx)(q.ZP,{type:"primary",icon:(0,L.jsx)(B.Z,{}),onClick:Me,children:t.formatMessage({id:"add",defaultMessage:"新增"})},"add"),(0,L.jsx)(N.Z,{menu:{items:e},placement:"bottom",children:(0,L.jsxs)(q.ZP,{type:"primary",icon:(0,L.jsx)(A.Z,{}),children:[t.formatMessage({id:"export",defaultMessage:"导出"}),(0,L.jsx)(O.Z,{})]})},"exportOperations")];var e}}),(0,L.jsx)(V,{isEdit:ce,customer:ge,open:oe,onClose:function(){return de(!1)},onSubmit:he})]})},_=s(20797),ee=s(34174),te=s(53701),se=s(95030),re=function(){var e=(0,a.useIntl)(),t=[{key:"visitor",label:e.formatMessage({id:"visitor.tab.all"}),children:(0,L.jsx)(te.Z,{superUser:!1})},{key:"black",label:e.formatMessage({id:"visitor.tab.black"}),children:(0,L.jsx)(_.Z,{superUser:!1})},{key:"customer",label:e.formatMessage({id:"customer"}),children:(0,L.jsx)($,{superUser:!1})},{key:"browse",label:e.formatMessage({id:"browse.tab.all"}),children:(0,L.jsx)(se.Z,{superUser:!1})}];return!(0,P.Ox)()&&(0,P.OJ)()&&t.splice(2,0,{key:"blackIp",label:e.formatMessage({id:"visitor.tab.blackIp"}),children:(0,L.jsx)(ee.Z,{superUser:!1})}),(0,L.jsx)(r.Z,{defaultActiveKey:"visitor",items:t,style:{margin:10}})}}}]);