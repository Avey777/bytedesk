"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[8987],{2484:function(e,n,t){t.d(n,{Z:function(){return u}});var r=t(11757),a=t(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},i=t(54183),o=function(e,n){return a.createElement(i.Z,(0,r.Z)({},e,{ref:n,icon:s}))};var u=a.forwardRef(o)},27522:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return v},t5:function(){return g},v_:function(){return p}});var r=t(90819),a=t.n(r),s=t(73193),i=t.n(s),o=t(89933),u=t.n(o),l=t(55735),c=t(41159);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:i()(i()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:i()(i()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:i()(i()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:i()(i()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},96865:function(e,n,t){var r=t(23864);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},58384:function(e,n,t){t.d(n,{Z:function(){return U}});var r=t(90819),a=t.n(r),s=t(89933),i=t.n(s),o=t(45332),u=t.n(o),l=t(53530),c=t(27487),d=t(75365),f=t(96485),p=t(9452),b=t(44194),g=t(10154),m=t.n(g),v=t(73193),h=t.n(v),x=t(86803),y=t(76750),k=t(40612),w=t(55735),j=t(69169),K=t(84881),Z=t(4499),M=t(32350),C=t(32327),P=t(62673),S=t(40679),R=t(36605),F=t(31549),H=function(e){var n,t=e.open,r=e.isEdit,s=e.type,o=e.kbase,c=e.onCancel,d=e.onSubmit,f=j.A.useForm(),p=u()(f,1)[0],g=(0,y.Z)().translateString,v=(0,k.u)((function(e){return e.currentOrg})),H=(0,b.useRef)(null),T=(0,b.useState)([]),E=u()(T,2),V=E[0],q=E[1],O=(0,b.useState)({}),z=u()(O,2),L=z[0],I=z[1],Q=(0,b.useState)(!1),_=u()(Q,2),D=_[0],U=_[1],A="ollama",N="bge-m3:latest",B=(0,b.useState)((null==o?void 0:o.embeddingProvider)||A),J=u()(B,2),W=J[0],G=J[1],X=(0,b.useState)((null==o?void 0:o.embeddingModel)||N),Y=u()(X,2),$=Y[0],ee=Y[1],ne=(0,b.useState)(""),te=u()(ne,2),re=te[0],ae=te[1];(0,b.useEffect)((function(){r?(p.setFieldsValue({name:g(null==o?void 0:o.name)}),p.setFieldsValue({headline:g(null==o?void 0:o.headline)}),p.setFieldsValue({footerHtml:g(null==o?void 0:o.footerHtml)}),p.setFieldsValue({descriptionHtml:g(null==o?void 0:o.descriptionHtml)}),p.setFieldsValue({language:null==o?void 0:o.language}),null!=o&&o.embeddingProvider&&(G(o.embeddingProvider),p.setFieldsValue({embeddingProvider:o.embeddingProvider})),null!=o&&o.embeddingModel&&(ee(o.embeddingModel),p.setFieldsValue({embeddingModel:o.embeddingModel}))):(p.resetFields(),p.setFieldsValue({language:"ZH_CN"}),p.setFieldsValue({embeddingProvider:A,embeddingModel:N})),t&&setTimeout((function(){var e;null===(e=H.current)||void 0===e||e.focus()}),100)}),[t,r,o]),(0,b.useEffect)((function(){t&&s===w.QPQ&&se()}),[t,s]),(0,b.useEffect)((function(){if(W&&$&&L[W]){var e=L[W].find((function(e){return e.value===$}));e&&ae(e.label)}}),[L,W,$]);var se=function(){var e=i()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==v?void 0:v.uid,level:w.whQ},e.next=4,(0,R.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t.data,n),200===t.code?(r=t.data.content||[],q(r)):x.yw.error(t.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),ie=(0,b.useCallback)((function(){}),[]),oe=(0,b.useCallback)((function(){U(!1)}),[]),ue=(0,b.useCallback)((function(e,n,t){G(e),ee(n),ae(t),p.setFieldValue("embeddingProvider",e),p.setFieldValue("embeddingModel",n),U(!1)}),[p]),le=(0,b.useCallback)((function(e,n){I((function(t){return h()(h()({},t),{},m()({},e,n))}))}),[]),ce=function(){p.validateFields().then(function(){var e=i()(a()().mark((function e(n){var t;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),t={uid:r?null==o?void 0:o.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:s,language:n.language,embeddingProvider:n.embeddingProvider||A,embeddingModel:n.embeddingModel||N,orgUid:null==v?void 0:v.uid},d(t);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),x.yw.error("创建知识库失败")}))},de=function(e){"Enter"===e.key&&ce()};return(0,F.jsxs)("div",{children:[(0,F.jsx)(l.Z,{title:"新建知识库",open:t,forceRender:!0,onOk:ce,onCancel:c,children:(0,F.jsxs)(j.A,{form:p,submitter:!1,children:[(0,F.jsx)(K.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,F.jsx)(Z.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:de,placeholder:"请输入名称",ref:H}}),s===w.VX&&(0,F.jsxs)(F.Fragment,{children:[(0,F.jsx)(Z.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:de,placeholder:"请输入名称"}}),(0,F.jsx)(M.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,F.jsx)(M.Z,{label:"描述",name:"descriptionHtml"}),s===w.QPQ&&(0,F.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,F.jsx)(C.Z.Text,{strong:!0,style:{marginRight:"8px"},children:"嵌入模型选择："}),(0,F.jsx)("div",{style:{display:"flex",alignItems:"center",marginTop:"8px"},children:(0,F.jsx)(P.Z,{size:"small",style:{width:"100%",cursor:"pointer",border:"1px solid #d9d9d9"},onClick:ie,children:W&&$?(0,F.jsx)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:(0,F.jsxs)("div",{children:[(0,F.jsx)(C.Z.Text,{type:"secondary",children:"供应商："}),(0,F.jsx)(C.Z.Text,{strong:!0,children:g((null===(n=V.find((function(e){return e.name===W})))||void 0===n?void 0:n.nickname)||W)}),(0,F.jsx)("br",{}),(0,F.jsx)(C.Z.Text,{type:"secondary",children:"模型："}),(0,F.jsx)(C.Z.Text,{strong:!0,children:re||$})]})}):(0,F.jsx)("div",{style:{textAlign:"center"}})})}),(0,F.jsxs)("div",{style:{display:"none"},children:[(0,F.jsx)(K.Z,{name:"embeddingProvider",width:"lg"}),(0,F.jsx)(K.Z,{name:"embeddingModel",width:"lg"})]})]})]})}),s===w.QPQ&&(0,F.jsx)(S.Z,{visible:D,onCancel:oe,onOk:ue,initialProvider:W,initialModel:$,initialModelLabel:re,providers:V,currentOrgUid:null==v?void 0:v.uid,existingProviderModels:L,onModelsLoaded:le,allowedModelTypes:[w.xTq]})]})},T=t(27522),E=t(6397),V=t(23864),q=t(41159),O=t(15722),z=t(82669),L=t(80556),I=t(59304),Q=t(54881),_=t(2484),D=l.Z.confirm,U=function(e){var n=e.type,t=(0,q.useIntl)(),r=(0,b.useState)(!1),s=u()(r,2),o=s[0],l=s[1],g=(0,b.useRef)(!1),m=(0,b.useState)(!1),v=u()(m,2),h=v[0],j=v[1],K=(0,V.Z)().isDarkMode,Z=(0,y.Z)().translateString,M=(0,k.u)((function(e){return e.currentOrg})),C=(0,b.useState)(!0),P=u()(C,2),S=P[0],R=P[1],U=(0,E.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),A=U.kbaseResult,N=U.currentKbase,B=U.insertKbase,J=U.updateLocalKbase,W=U.setKbaseResult,G=U.setCurrentKbase,X=U.removeKbase,Y=function(){var e=i()(a()().mark((function e(){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g.current){e.next=3;break}return console.log("isLoading: 1",g.current),e.abrupt("return");case 3:return g.current=!0,l(!0),x.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==M?void 0:M.uid},e.next=9,(0,T.AP)(t);case 9:r=e.sent,console.log("queryKbasesByOrg: ",r),200===r.code?(x.yw.destroy(),W(r)):(x.yw.destroy(),x.yw.error(r.message)),g.current=!1,l(!1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,b.useEffect)((function(){console.log("useEffect"),Y()}),[]);var $=function(){var e=i()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",x.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,T.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(B(r.data),G(r.data),x.yw.success({content:"创建成功！",key:t,duration:2}),j(!1)):(console.log("create kb failed",r),x.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ee=function(){var e=i()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",x.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,T.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(J(r.data),G(r.data),x.yw.success({content:"更新成功！",key:t,duration:2}),j(!1)):(console.log("update kb failed",r),x.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ne=function(){var e=i()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",N),R(!0),j(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=i()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S?ee(n):$(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=i()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==A.data.content.length){e.next=4;break}return x.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,T._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(X(n.uid),Y()):(console.log("handleDeleteKbase: ",r),x.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(e){return n!==w._FS?Z(e.descriptionHtml):e.level===w.Hxq?"全平台客服可见":e.level===w.whQ?"本组织客服可见":e.level===w.fyH?"本客服可见":Z(e.descriptionHtml)};return(0,F.jsxs)(F.Fragment,{children:[(0,F.jsxs)(c.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,F.jsxs)(c.Z,{gap:"small",children:[(0,F.jsx)(d.ZP,{type:"primary",size:"small",icon:(0,F.jsx)(z.Z,{}),onClick:function(){console.log("new kb"),R(!1),j(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,F.jsx)(d.ZP,{size:"small",icon:(0,F.jsx)(L.Z,{spin:o}),onClick:Y,loading:o,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==N?void 0:N.uid)&&(0,F.jsx)(f.Z,{menu:{items:[{key:"edit",icon:(0,F.jsx)(I.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ne},{key:"delete",icon:(0,F.jsx)(Q.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){D({title:t.formatMessage({id:"deleteTip"}),icon:(0,F.jsx)(O.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(Z(e.name),"】？"),onOk:function(){re(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(N)}}]},children:(0,F.jsx)(d.ZP,{size:"small",icon:(0,F.jsx)(_.Z,{})})})]}),(0,F.jsx)(p.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,F.jsx)(p.Z.Item,{style:N.uid===e.uid?{backgroundColor:K?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){G(e)},children:(0,F.jsx)(p.Z.Item.Meta,{style:{marginLeft:"10px"},title:Z(e.name),description:ae(e)})})}}),h&&(0,F.jsx)(H,{open:h,isEdit:S,type:n,kbase:N,onSubmit:te,onCancel:function(){j(!1)}})]})}},6397:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),s=t(76711),i=t.n(s),o=t(55735),u=t(44435),l=t(83642),c=t(83890),d=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==s){var o=[].concat(i()(r.slice(0,s)),[t],i()(r.slice(s+1))),u=a()(a()({},n().kbaseResult),{},{data:{content:o}});e({kbaseResult:u,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,s=r.findIndex((function(e){return e.uid===t}));-1!==s?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(i()(r.slice(0,s)),i()(r.slice(s+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:o.wKE})))}}]);