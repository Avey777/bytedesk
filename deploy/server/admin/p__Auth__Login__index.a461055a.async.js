"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[9368],{80556:function(e,t,n){n.d(t,{Z:function(){return c}});var a=n(77260),r=n(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},s=n(54183),i=function(e,t){return r.createElement(s.Z,(0,a.Z)({},e,{ref:t,icon:o}))};var c=r.forwardRef(i)},29591:function(e,t,n){var a=n(39328),r=n(17323),o=n(55824),s=n(84244),i=n(44194),c=n(72870),l=n(64665),u=n(31549),d=["options","fieldProps","proFieldProps","valueEnum"],g=i.forwardRef((function(e,t){var n=e.options,s=e.fieldProps,i=e.proFieldProps,c=e.valueEnum,g=(0,r.Z)(e,d);return(0,u.jsx)(l.Z,(0,a.Z)({ref:t,valueType:"checkbox",valueEnum:(0,o.h)(c,void 0),fieldProps:(0,a.Z)({options:n},s),lightProps:(0,a.Z)({labelFormatter:function(){return(0,u.jsx)(l.Z,(0,a.Z)({ref:t,valueType:"checkbox",mode:"read",valueEnum:(0,o.h)(c,void 0),filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:n},s),proFieldProps:i},g))}},g.lightProps),proFieldProps:i},g))})),p=i.forwardRef((function(e,t){var n=e.fieldProps,r=e.children;return(0,u.jsx)(s.Z,(0,a.Z)((0,a.Z)({ref:t},n),{},{children:r}))})),f=(0,c.G)(p,{valuePropName:"checked"});f.Group=g,t.Z=f},47783:function(e,t,n){var a=n(39328),r=n(17323),o=n(55824),s=n(44194),i=n(32871),c=n(64665),l=n(31549),u=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","showSearch","options"],d=["fieldProps","children","params","proFieldProps","mode","valueEnum","request","options"],g=function(e,t){var n=e.fieldProps,d=e.children,g=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,m=e.request,v=e.showSearch,x=e.options,y=(0,r.Z)(e,u),w=(0,s.useContext)(i.Z);return(0,l.jsx)(c.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(h),request:m,params:g,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({options:x,mode:f,showSearch:v,getPopupContainer:w.getPopupContainer},n),ref:t,proFieldProps:p},y),{},{children:d}))},p=s.forwardRef((function(e,t){var n=e.fieldProps,u=e.children,g=e.params,p=e.proFieldProps,f=e.mode,h=e.valueEnum,m=e.request,v=e.options,x=(0,r.Z)(e,d),y=(0,a.Z)({options:v,mode:f||"multiple",labelInValue:!0,showSearch:!0,suffixIcon:null,autoClearSearchValue:!0,optionLabelProp:"label"},n),w=(0,s.useContext)(i.Z);return(0,l.jsx)(c.Z,(0,a.Z)((0,a.Z)({valueEnum:(0,o.h)(h),request:m,params:g,valueType:"select",filedConfig:{customLightMode:!0},fieldProps:(0,a.Z)({getPopupContainer:w.getPopupContainer},y),ref:t,proFieldProps:p},x),{},{children:u}))})),f=s.forwardRef(g);f.SearchSelect=p,f.displayName="ProFormComponent",t.Z=f},86985:function(e,t,n){n.d(t,{Z:function(){return w}});var a=n(90819),r=n.n(a),o=n(89933),s=n.n(o),i=n(45332),c=n.n(i),l=n(5025),u=n(5488),d=n(14870);function g(){return p.apply(this,arguments)}function p(){return(p=s()(r()().mark((function e(){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/get",{method:"GET",params:{channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function f(e,t){return h.apply(this,arguments)}function h(){return(h=s()(r()().mark((function e(t,n){return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,d.request)("/kaptcha/api/v1/check",{method:"POST",data:{captchaUid:t,captchaCode:n,channel:u.XtJ}}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var m=n(58087),v=n(27259),x=n(44194),y=n(31549),w=function(e){var t=e.onKaptchaChange,n=e.onKaptchaCheck,a=(0,d.useIntl)(),o=(0,x.useState)(),i=c()(o,2),u=i[0],p=i[1],h=(0,x.useState)(),w=c()(h,2),M=w[0],k=w[1],b=function(){var e=s()(r()().mark((function e(){var t;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g();case 2:200===(t=e.sent).code?(p(t.data.captchaUid),k(t.data.captchaImage)):l.yw.error(a.formatMessage({id:"kaptcha.get.error",defaultMessage:"获取验证码失败"}));case 4:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),C=function(){var e=s()(r()().mark((function e(t,a){var o;return r()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,f(t,a);case 2:o=e.sent,console.log("checkCaptcha response",o),200===o.code?n&&n(!0):n&&n(!1);case 5:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}();(0,x.useEffect)((function(){b()}),[]);return(0,y.jsx)(y.Fragment,{children:M&&(0,y.jsxs)(y.Fragment,{children:[(0,y.jsx)(v.Z,{onChange:function(e){t&&(t(u,e.target.value),e.target.value&&""!==e.target.value&&4===e.target.value.trim().length?C(u,e.target.value):n&&n(!1))},prefix:(0,y.jsx)(m.Z,{}),placeholder:a.formatMessage({id:"captcha",defaultMessage:"captcha"}),style:{width:"65%",float:"left",height:40},allowClear:!0}),(0,y.jsx)("img",{src:M,alt:"captcha",onClick:b})]})})}},73361:function(e,t,n){n.r(t),n.d(t,{default:function(){return de}});var a=n(73193),r=n.n(a),o=n(90819),s=n.n(o),i=n(89933),c=n.n(i),l=n(45332),u=n.n(l),d=n(16843),g=n(32394),p=n(55684),f=n(76527),h=n(55757),m=n(4610),v=n(14870),x=n(12667),y=n(82908),w=n(5780),M=n(37963),k=n(54436),b=n(44194),C=n(56321),j=n(90033),Z=n(5025),S=n(92729),P=n(24522),U=n(5488),T=n(86985),F=n(10022),I=n(26978),L=n(48821),E=n(31549),R=function(e){var t=e.loginType,n=e.onKaptchaChange,a=e.onKaptchaCheck,r=(0,v.useIntl)(),o=function(){var e=c()(s()().mark((function e(t,a){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n&&n(t,a);case 1:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),i=function(){var e=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a&&a(t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,E.jsx)(E.Fragment,{children:"account"===t&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(L.Z,{name:"username",fieldProps:{size:"large",prefix:(0,E.jsx)(F.Z,{})},placeholder:r.formatMessage({id:"pages.login.username.placeholder",defaultMessage:"用户名/邮箱"}),rules:[{required:!0,message:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.username.required",defaultMessage:"请输入用户名/邮箱!"})}]}),(0,E.jsx)(L.Z.Password,{name:"password",fieldProps:{size:"large",prefix:(0,E.jsx)(I.Z,{})},placeholder:r.formatMessage({id:"pages.login.password.placeholder",defaultMessage:"密码"}),rules:[{required:!0,message:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.password.required",defaultMessage:"请输入密码！"})}]}),(0,E.jsx)(g.A.Item,{name:"captchaCode",rules:[{required:!0,message:r.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,E.jsx)(T.Z,{onKaptchaChange:o,onKaptchaCheck:i})})]})})},A=n(18751),q=n(33363),K=n(40795),D=n(47783),N=n(71017),z=n(78875),V=n(20228),B=n(93892),H=function(e){var t=e.loginType,n=e.onKaptchaChange,a=e.onKaptchaCheck,r=(0,v.useIntl)(),o=(0,A.Z)().translateString,i=(0,b.useRef)(),l=(0,b.useState)(""),p=u()(l,2),f=p[0],h=p[1],m=(0,b.useState)(""),x=u()(m,2),y=x[0],w=x[1],M=(0,b.useState)(!1),k=u()(M,2),C=k[0],S=k[1],P=(0,j.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid}})),F=P.deviceUid,R=P.setDeviceUid,H=function(){var e=c()(s()().mark((function e(t,a){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:h(t),w(a),n&&n(t,a);case 3:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Q=function(){var e=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:S(t),a&&a(t);case 2:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();(0,b.useEffect)((function(){void 0!==F&&""!==F||R((0,q.Zx)())}),[]);var O=[{label:r.formatMessage({id:"pages.login.country.china"}),value:"86",icon:"🇨🇳",code:"CN"},{label:r.formatMessage({id:"pages.login.country.hongkong"}),value:"852",icon:"🇭🇰",code:"HK"},{label:r.formatMessage({id:"pages.login.country.taiwan"}),value:"886",icon:"🇹🇼",code:"TW"},{label:r.formatMessage({id:"pages.login.country.macao"}),value:"853",icon:"🇲🇴",code:"MO"},{label:r.formatMessage({id:"pages.login.country.japan"}),value:"81",icon:"🇯🇵",code:"JP"},{label:r.formatMessage({id:"pages.login.country.korea"}),value:"82",icon:"🇰🇷",code:"KR"},{label:r.formatMessage({id:"pages.login.country.singapore"}),value:"65",icon:"🇸🇬",code:"SG"},{label:r.formatMessage({id:"pages.login.country.malaysia"}),value:"60",icon:"🇲🇾",code:"MY"},{label:r.formatMessage({id:"pages.login.country.thailand"}),value:"66",icon:"🇹🇭",code:"TH"},{label:r.formatMessage({id:"pages.login.country.vietnam"}),value:"84",icon:"🇻🇳",code:"VN"},{label:r.formatMessage({id:"pages.login.country.philippines"}),value:"63",icon:"🇵🇭",code:"PH"},{label:r.formatMessage({id:"pages.login.country.indonesia"}),value:"62",icon:"🇮🇩",code:"ID"},{label:r.formatMessage({id:"pages.login.country.usa"}),value:"1-us",icon:"🇺🇸",code:"US"},{label:r.formatMessage({id:"pages.login.country.canada"}),value:"1-ca",icon:"🇨🇦",code:"CA"},{label:r.formatMessage({id:"pages.login.country.uk"}),value:"44",icon:"🇬🇧",code:"GB"},{label:r.formatMessage({id:"pages.login.country.germany"}),value:"49",icon:"🇩🇪",code:"DE"},{label:r.formatMessage({id:"pages.login.country.france"}),value:"33",icon:"🇫🇷",code:"FR"},{label:r.formatMessage({id:"pages.login.country.italy"}),value:"39",icon:"🇮🇹",code:"IT"},{label:r.formatMessage({id:"pages.login.country.spain"}),value:"34",icon:"🇪🇸",code:"ES"},{label:r.formatMessage({id:"pages.login.country.russia"}),value:"7",icon:"🇷🇺",code:"RU"},{label:r.formatMessage({id:"pages.login.country.australia"}),value:"61",icon:"🇦🇺",code:"AU"},{label:r.formatMessage({id:"pages.login.country.newzealand"}),value:"64",icon:"🇳🇿",code:"NZ"}];return(0,E.jsx)(E.Fragment,{children:"mobile"===t&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsxs)(z.Z,{gutter:16,children:[(0,E.jsx)(V.Z,{span:10,children:(0,E.jsx)(D.Z,{name:"country",options:O,fieldProps:{size:"large",placeholder:r.formatMessage({id:"pages.login.country.placeholder",defaultMessage:"选择国家/地区"}),optionLabelProp:"label",optionItemRender:function(e){var t=e.value.includes("-")?e.value.split("-")[0]:e.value;return(0,E.jsxs)("div",{children:[(0,E.jsx)("span",{role:"img","aria-label":e.label,style:{marginRight:8},children:e.icon}),e.label," (+",t,")"]})}},initialValue:"86"})}),(0,E.jsx)(V.Z,{span:14,children:(0,E.jsx)(L.Z,{fieldProps:{size:"large",prefix:(0,E.jsx)(K.Z,{})},name:"mobile",placeholder:r.formatMessage({id:"pages.login.phoneNumber.placeholder",defaultMessage:"手机号"}),rules:[{required:!0,message:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.phoneNumber.required",defaultMessage:"请输入手机号！"})},{pattern:/^1\d{10}$/,message:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.phoneNumber.invalid",defaultMessage:"手机号格式错误！"})}]})})]}),(0,E.jsx)(g.A.Item,{name:"captchaCode",rules:[{required:!0,message:r.formatMessage({id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],children:(0,E.jsx)(T.Z,{onKaptchaChange:H,onKaptchaCheck:Q})}),(0,E.jsx)(N.Z,{fieldProps:{size:"large",prefix:(0,E.jsx)(I.Z,{})},captchaProps:{size:"large",disabled:!C},placeholder:r.formatMessage({id:"pages.login.captcha.placeholder",defaultMessage:"请输入验证码"}),captchaTextRender:function(e,t){return e?"".concat(t," ").concat(r.formatMessage({id:"pages.getCaptchaSecondText",defaultMessage:"获取验证码"})):r.formatMessage({id:"pages.login.phoneLogin.getVerificationCode",defaultMessage:"获取验证码"})},phoneName:"mobile",name:"code",rules:[{required:!0,message:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.captcha.required",defaultMessage:"请输入验证码！"})}],fieldRef:i,onGetCaptcha:function(){var e=c()(s()().mark((function e(t){var n,a;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("mobile:",t),!t||11!==t.length){e.next=13;break}return n={mobile:t,type:U.UUF,captchaUid:f,captchaCode:y,deviceUid:F,platform:U.iw8},e.next=5,(0,d.Y7)(n);case 5:if(200===(a=e.sent).code){e.next=10;break}return Z.yw.error(o(a.message)),setTimeout((function(){var e;console.log("endCaptchaTiming"),null===(e=i.current)||void 0===e||e.endTiming()}),2),e.abrupt("return");case 10:Z.yw.success(o(a.message)),e.next=14;break;case 13:Z.yw.error("手机号格式错误");case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()}),(0,E.jsx)(B.Z,{message:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.auto.register",defaultMessage:"Mobile will auto register"}),type:"info"})]})})},Q=n(44482),O=function(e){var t=e.loginType,n=(0,v.useIntl)(),a=(0,S.t)((function(e){return e.setAccessToken})),o=(0,j.L)((function(e){return e.setUserInfo})),i=(0,v.useModel)("@@initialState").setInitialState,l=(0,j.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid}})),g=l.deviceUid,p=l.setDeviceUid,f=(0,b.useState)("login"),h=u()(f,2),m=h[0],x=h[1],y=(0,b.useState)("loading"),w=u()(y,2),M=w[0],k=w[1],P=function(){var e=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(0,C.flushSync)((function(){i((function(e){return r()(r()({},e),{},{userInfo:t})}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),T=function(){var e=c()(s()().mark((function e(t){var i,c,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("handleScanLogin values: ",t),Z.yw.loading(n.formatMessage({id:"logging",defaultMessage:"logging..."})),e.next=4,(0,d.kZ)(r()({},t));case 4:i=e.sent,console.log("LoginMobileResult scanLogin:",i.data),200===i.code?(Z.yw.destroy(),Z.yw.success(n.formatMessage({id:"login.success",defaultMessage:"login success"})),a(null==i?void 0:i.data.accessToken),P(null==i||null===(c=i.data)||void 0===c?void 0:c.user),o(null==i||null===(l=i.data)||void 0===l?void 0:l.user),v.history.push("/")):(Z.yw.destroy(),Z.yw.error(i.message));case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),F=function(){var e=c()(s()().mark((function e(n){var a,r,o;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if("scan"===t){e.next=2;break}return e.abrupt("return");case 2:return e.next=4,(0,d.Tm)(g,n);case 4:if(200!==(a=e.sent).code){e.next=30;break}if(r=a.data,console.log("handleScanQuery status: ",r.status),r.status!==U.C20){e.next=13;break}k("active"),x("deviceUid="+r.deviceUid+"&code="+r.content),e.next=28;break;case 13:if(r.status!==U.FM$){e.next=17;break}k("scanned"),e.next=28;break;case 17:if(r.status!==U.PhI){e.next=21;break}k("expired"),e.next=28;break;case 21:if(r.status!==U.Cml){e.next=28;break}if(void 0!==r.receiver&&""!==r.receiver){e.next=24;break}return e.abrupt("return");case 24:return o={mobile:r.receiver,code:r.content,platform:U.iw8},console.log("login scan info:",o),e.next=28,T(o);case 28:e.next=31;break;case 30:Z.yw.error(a.message);case 31:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}();return(0,b.useEffect)((function(){console.log("scan deviceUid:",g),void 0!==g&&""!==g||p((0,q.Zx)()),F(!1);var e=setInterval((function(){F(!1)}),3e3);return function(){clearInterval(e)}}),[t,g]),(0,E.jsx)(E.Fragment,{children:"scan"===t&&(0,E.jsx)(E.Fragment,{children:(0,E.jsx)(Q.Z,{style:{margin:"auto"},value:m,status:M,onRefresh:function(){console.log("onRefresh"),F(!0)}})})})},G=n(75831),W=n(18580),J=n(84244),X=n(77260),Y={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M872 474H286.9l350.2-304c5.6-4.9 2.2-14-5.2-14h-88.5c-3.9 0-7.6 1.4-10.5 3.9L155 487.8a31.96 31.96 0 000 48.3L535.1 866c1.5 1.3 3.3 2 5.2 2h91.5c7.4 0 10.8-9.2 5.2-14L286.9 550H872c4.4 0 8-3.6 8-8v-60c0-4.4-3.6-8-8-8z"}}]},name:"arrow-left",theme:"outlined"},$=n(54183),_=function(e,t){return b.createElement($.Z,(0,X.Z)({},e,{ref:t,icon:Y}))};var ee=b.forwardRef(_),te=n(29591),ne=function(){var e=x.Z.useToken().token,t=(0,b.useContext)(G.I),n=t.isCustomServer,a=t.setIsCustomServer,r=g.A.useForm(),o=u()(r,1)[0],s=(0,b.useState)(!1),i=u()(s,2),c=i[0],l=i[1],d=(0,b.useState)(""),p=u()(d,2),f=p[0],h=p[1],m=(0,b.useState)(""),v=u()(m,2),y=(v[0],v[1]);(0,b.useEffect)((function(){f&&f.length>0&&(o.setFieldsValue({apiUrl:f}),console.log("apiUrl:",f))}),[f]),(0,b.useEffect)((function(){if(n){var e=localStorage.getItem(U.Ss2);"true"===e&&(l(!0),o.setFieldsValue({isCustomServerEnabled:!0})),console.log("isCustomServer customEnabled:",e);var t=localStorage.getItem(U.DuM);t&&o.setFieldsValue({apiUrl:(0,q.Qj)(t)});var a=localStorage.getItem(U.sZT);a&&o.setFieldsValue({websocketUrl:(0,q.Qj)(a)})}}),[n]);return(0,E.jsx)("div",{className:"ant-pro-form-server-container",style:{backgroundColor:e.colorBgContainer,display:"flex",justifyContent:"center",flexDirection:"column",height:"100%",width:"80%",marginLeft:"10%"},children:(0,E.jsxs)(g.A,{className:"ant-pro-form-server-main",form:o,submitter:{render:function(e,t){return console.log("props:",e,t),(0,E.jsxs)("div",{style:{display:"flex",justifyContent:"center",gap:"8px"},children:[(0,E.jsx)(w.ZP,{icon:(0,E.jsx)(ee,{}),onClick:function(){console.log("switch server"),a((function(e){return!e}))},children:"返回"},"back"),(0,E.jsx)(w.ZP,{type:"primary",onClick:function(){var t=e.form.getFieldValue("apiUrl");t=(0,q.Qj)(t.trim());var n=e.form.getFieldValue("websocketUrl");n=(0,q.Qj)(n.trim()),t&&t.trim().length>0&&n&&n.trim().length>0?(localStorage.setItem(U.DuM,t),localStorage.setItem(U.sZT,n),localStorage.setItem(U.Ss2,"true"),Z.yw.success("保存成功")):Z.yw.error("请输入正确的服务器地址")},children:"保存"},"submit"),(0,E.jsx)(w.ZP,{onClick:function(){var t;null===(t=e.form)||void 0===t||t.resetFields(),h(""),localStorage.setItem(U.Ss2,"false"),localStorage.setItem(U.DuM,""),localStorage.setItem(U.sZT,""),Z.yw.success("重置成功，已恢复默认云服务器")},children:"重置"},"reset"),(0,E.jsx)(w.ZP,{onClick:function(){window.open("https://www.weiyuai.cn/docs/zh-CN/docs/manual/agent/auth/login")},children:"帮助"},"help")]})}},children:[(0,E.jsx)(te.Z,{name:"isCustomServerEnabled",fieldProps:{onChange:function(e){console.log("e:",e),function(e){if(console.log("handleCustomServerChange e:",e),l(e.target.checked),e.target.checked){var t=localStorage.getItem(U.DuM);t&&o.setFieldsValue({apiUrl:(0,q.Qj)(t)});var n=localStorage.getItem(U.sZT);n&&o.setFieldsValue({websocketUrl:(0,q.Qj)(n)}),console.log("initData apiUrl:",t,"websocketUrl:",n)}else localStorage.setItem(U.Ss2,"false")}(e)}},children:"是否启用自定义服务器"}),c&&(0,E.jsxs)(E.Fragment,{children:[(0,E.jsx)(L.Z,{name:"apiUrl",label:"API 服务器地址（例如：http://127.0.0.1:9003 或 https://api.bytedesk.com）",fieldProps:{disabled:!c,placeholder:"http://127.0.0.1:9003",onChange:function(e){return h(e.target.value)}}}),(0,E.jsx)(L.Z,{name:"websocketUrl",label:"WebSocket 服务器地址（例如：ws://127.0.0.1:9885/websocket 或 wss://api.bytedesk.com/websocket）",fieldProps:{disabled:!c,placeholder:"ws://127.0.0.1:9885/websocket",onChange:function(e){return y(e.target.value)}}})]})]})})},ae=n(97180),re=n(37926),oe=n(63327),se=n(95660),ie=x.Z.defaultAlgorithm,ce=x.Z.darkAlgorithm,le=function(){var e=(0,m.l)((function(e){var t=e.token;return{width:42,height:42,lineHeight:"42px",position:"fixed",right:16,borderRadius:t.borderRadius,":hover":{backgroundColor:t.colorBgTextHover}}}));return(0,E.jsx)("div",{className:e,"data-lang":!0,children:v.SelectLang&&(0,E.jsx)(v.SelectLang,{})})},ue=function(){var e=y.Z.useApp(),t=e.modal,n=e.message,a=(0,v.useIntl)(),o=(0,A.Z)().translateString,i=g.A.useForm(),l=u()(i,1)[0],m=x.Z.useToken().token,k=(0,P.Z)().isDarkMode,Z=(0,ae.M)(),T=Z.config,F=Z.updateConfig,I=(0,b.useState)("https://www.weiyuai.cn/logo.png"),L=u()(I,2),K=L[0],D=L[1],N=(0,b.useState)(""),z=u()(N,2),V=z[0],B=z[1],Q=(0,b.useState)(""),X=u()(Q,2),Y=X[0],$=X[1],_=(0,S.t)((function(e){return e.setAccessToken})),ee=(0,b.useContext)(G.I),te=ee.isCustomServer,ie=(ee.setIsCustomServer,(0,b.useState)("mobile")),ce=u()(ie,2),ue=ce[0],de=ce[1],ge=(0,v.useModel)("@@initialState").setInitialState,pe=(0,b.useState)(!1),fe=u()(pe,2),he=fe[0],me=(fe[1],(0,j.L)((function(e){return{deviceUid:e.deviceUid,setDeviceUid:e.setDeviceUid,setUserInfo:e.setUserInfo}}))),ve=me.deviceUid,xe=me.setDeviceUid,ye=me.setUserInfo,we=(0,b.useState)(!1),Me=u()(we,2),ke=Me[0],be=Me[1],Ce=(0,b.useState)(),je=u()(Ce,2),Ze=je[0],Se=je[1],Pe=(0,b.useState)("https://www.weiyuai.cn/privacy.html"),Ue=u()(Pe,2),Te=Ue[0],Fe=Ue[1],Ie=(0,b.useState)("https://www.weiyuai.cn/terms.html"),Le=u()(Ie,2),Ee=Le[0],Re=Le[1],Ae=function(){window.open(Te)},qe=function(){window.open(Ee)},Ke=(0,b.useState)(""),De=u()(Ke,2),Ne=De[0],ze=De[1],Ve=function(){var e=c()(s()().mark((function e(t,n){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:ze(t),l.setFieldValue("captchaCode",n);case 2:case"end":return e.stop()}}),e)})));return function(t,n){return e.apply(this,arguments)}}(),Be=function(){var e=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleKaptchaCheck:",t);case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),He=function(e){t.confirm({title:a.formatMessage({id:"pages.login.privacyModal.title",defaultMessage:"隐私协议确认"}),content:(0,E.jsxs)("div",{children:[(0,E.jsx)("p",{children:a.formatMessage({id:"pages.login.privacyModal.description",defaultMessage:"为了保护您的个人信息安全，请您阅读并同意以下协议："})}),(0,E.jsxs)("p",{children:[(0,E.jsx)(w.ZP,{size:"small",type:"link",onClick:Ae,style:{padding:0,height:"auto"},children:a.formatMessage({id:"pages.login.privacyModal.privacyPolicy",defaultMessage:"《用户隐私协议》"})}),a.formatMessage({id:"pages.login.privacyModal.and",defaultMessage:"和"}),(0,E.jsx)(w.ZP,{size:"small",type:"link",onClick:qe,style:{padding:0,height:"auto"},children:a.formatMessage({id:"pages.login.privacyModal.termsOfService",defaultMessage:"《服务条款》"})})]}),(0,E.jsx)("p",{children:a.formatMessage({id:"pages.login.privacyModal.confirmText",defaultMessage:"是否同意以上协议并继续登录？"})})]}),okText:a.formatMessage({id:"pages.login.privacyModal.agreeAndLogin",defaultMessage:"同意并登录"}),cancelText:a.formatMessage({id:"pages.login.privacyModal.cancel",defaultMessage:"取消"}),onOk:function(){be(!0),e()}})},Qe=function(){var e,t,n,r=[];return!1!==(null==Ze||null===(e=Ze.custom)||void 0===e?void 0:e.loginUsernameEnable)&&r.push({key:"account",label:a.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"账户密码登录"}),children:(0,E.jsx)(R,{loginType:ue,onKaptchaChange:Ve,onKaptchaCheck:Be})}),!1!==(null==Ze||null===(t=Ze.custom)||void 0===t?void 0:t.loginMobileEnable)&&r.push({key:"mobile",label:a.formatMessage({id:"pages.login.phoneLogin.tab",defaultMessage:"手机号登录"}),children:(0,E.jsx)(H,{loginType:ue,onKaptchaChange:Ve,onKaptchaCheck:Be})}),!1!==(null==Ze||null===(n=Ze.custom)||void 0===n?void 0:n.loginScanEnable)&&r.push({key:"scan",label:a.formatMessage({id:"pages.login.scanLogin.tab",defaultMessage:"扫码登录"}),children:(0,E.jsx)(O,{loginType:ue})}),0===r.length&&r.push({key:"account",label:a.formatMessage({id:"pages.login.accountLogin.tab",defaultMessage:"账户密码登录"}),children:(0,E.jsx)(R,{loginType:ue,onKaptchaChange:Ve,onKaptchaCheck:Be})}),r},Oe=((0,p.uK)(m.colorTextBase,.2),function(e){var t=document.querySelector("link[rel*='icon']");t||((t=document.createElement("link")).type="image/x-icon",t.rel="shortcut icon",document.getElementsByTagName("head")[0].appendChild(t)),t.href=e}),Ge=function(e){document.title=e||a.formatMessage({id:"app.title"})},We=function(e){var t;if(!e)return D("https://www.weiyuai.cn/logo.png"),Oe("https://www.weiyuai.cn/logo.png"),B(a.formatMessage({id:"app.title"})),$(a.formatMessage({id:"pages.layouts.userLayout.title"})),void Ge(a.formatMessage({id:"app.title"}));if(Se(e),null!=e&&null!==(t=e.custom)&&void 0!==t&&t.enabled&&!(0,W._p)()){var n,r,o,s,i,c,l,u,d;if(null!=e&&null!==(n=e.custom)&&void 0!==n&&n.logo){var g,p=null==e||null===(g=e.custom)||void 0===g?void 0:g.logo;D(p),Oe(p)}else D("https://www.weiyuai.cn/logo.png"),Oe("https://www.weiyuai.cn/logo.png");if(null!=e&&null!==(r=e.custom)&&void 0!==r&&r.name)B(null==e||null===(l=e.custom)||void 0===l?void 0:l.name),Ge(null==e||null===(u=e.custom)||void 0===u?void 0:u.name);else B(a.formatMessage({id:"app.title"})),Ge(a.formatMessage({id:"app.title"}));if(null!=e&&null!==(o=e.custom)&&void 0!==o&&o.description)$(null==e||null===(d=e.custom)||void 0===d?void 0:d.description);else $(a.formatMessage({id:"pages.layouts.userLayout.title"}));null!=e&&null!==(s=e.custom)&&void 0!==s&&s.showRightCornerChat||F({bubbleConfig:{show:!1},buttonConfig:{show:!1}}),null!=e&&null!==(i=e.custom)&&void 0!==i&&i.privacyPolicyUrl&&Fe(e.custom.privacyPolicyUrl),null!=e&&null!==(c=e.custom)&&void 0!==c&&c.termsOfServiceUrl&&Re(e.custom.termsOfServiceUrl)}else D("https://www.weiyuai.cn/logo.png"),Oe("https://www.weiyuai.cn/logo.png"),B(a.formatMessage({id:"app.title"})),$(a.formatMessage({id:"pages.layouts.userLayout.title"})),Ge(a.formatMessage({id:"app.title"}))},Je=function(e){var t=e.detail.config;console.log("Config updated from server, updating login UI:",t),We(t)},Xe=function(){var e=c()(s()().mark((function e(){var t;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return void 0!==ve&&""!==ve||xe((0,q.Zx)()),e.prev=1,console.log("执行 loadConfig..."),e.next=5,(0,W.ME)();case 5:return console.log("loadConfig 执行完毕"),console.log("执行 getConfigProperties..."),e.next=9,(0,W.Xs)();case 9:t=e.sent,console.log("getConfig login config (after loadConfig): ",t),We(t),window.addEventListener("config-updated",Je),e.next=19;break;case 15:e.prev=15,e.t0=e.catch(1),console.error("Error loading config:",e.t0),We(null);case 19:case"end":return e.stop()}}),e,null,[[1,15]])})));return function(){return e.apply(this,arguments)}}();(0,b.useEffect)((function(){var e=function(){var e=c()(s()().mark((function e(){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(0,q.pr)(),e.next=3,Xe();case 3:return e.next=5,et();case 5:if(!e.sent){e.next=8;break}return e.abrupt("return");case 8:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();return e(),function(){window.removeEventListener("config-updated",Je)}}),[]),(0,b.useEffect)((function(){if(Ze){var e=Qe();if(e.length>0){var t=e[0].key;t&&t!==ue&&de(t)}}}),[Ze]);var Ye=function(){var e=c()(s()().mark((function e(t){return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t&&(0,C.flushSync)((function(){ge((function(e){return r()(r()({},e),{},{userInfo:t})}))}));case 1:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),$e=function(){var e=c()(s()().mark((function e(t){var i,c,l,u=arguments;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=u.length>1&&void 0!==u[1]&&u[1],e.prev=1,i||ke){e.next=5;break}return He((function(){$e(t,!0)})),e.abrupt("return");case 5:return c="loginLoading",n.loading({content:a.formatMessage({id:"logging",defaultMessage:"logging..."}),key:c}),e.next=9,(0,d.x4)(r()({},t));case 9:l=e.sent,console.log("LoginResult:",l),200===l.code?(n.success({content:a.formatMessage({id:"login.success",defaultMessage:"login success"}),key:c}),_(l.data.accessToken),Ye(l.data.user),ye(l.data.user),v.history.push("/")):n.error({content:o(l.message),key:c}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0),n.error(a.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),_e=function(){var e=c()(s()().mark((function e(t){var o,i,c,l,u,g=arguments;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=g.length>1&&void 0!==g[1]&&g[1],e.prev=1,o||ke){e.next=5;break}return He((function(){_e(t,!0)})),e.abrupt("return");case 5:return i="mobileLoginLoading",n.loading({content:a.formatMessage({id:"logging",defaultMessage:"logging..."}),key:i}),e.next=9,(0,d.N9)(r()({},t));case 9:c=e.sent,console.log("LoginMobileResult:",c),200===c.code?(n.success({content:a.formatMessage({id:"login.success",defaultMessage:"login success"}),key:i}),_(null==c?void 0:c.data.accessToken),Ye(null==c||null===(l=c.data)||void 0===l?void 0:l.user),ye(null==c||null===(u=c.data)||void 0===u?void 0:u.user),v.history.push("/")):n.error({content:a.formatMessage({id:c.message,defaultMessage:c.message}),key:i}),e.next=18;break;case 14:e.prev=14,e.t0=e.catch(1),console.log(e.t0),n.error(a.formatMessage({id:"login.error",defaultMessage:"login failed"}));case 18:case"end":return e.stop()}}),e,null,[[1,14]])})));return function(t){return e.apply(this,arguments)}}(),et=function(){var e=c()(s()().mark((function e(){var t,r,i,c,l;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,t=new URLSearchParams(window.location.search),r=t.get("accessToken"),console.log("Login page - accessToken:",r),!r){e.next=25;break}return console.log("Login page - Found accessToken in URL, validating..."),i="accessTokenValidation",n.loading({content:a.formatMessage({id:"validating",defaultMessage:"验证中..."}),key:i}),e.next=10,(0,d.bf)(r);case 10:if(c=e.sent,console.log("Login page - LoginAccessTokenResult:",c),200!==c.code){e.next=24;break}return n.success({content:a.formatMessage({id:"login.success",defaultMessage:"login success"}),key:i}),_(c.data.accessToken),Ye(c.data.user),ye(c.data.user),t.delete("accessToken"),l=window.location.pathname+(t.toString()?"?".concat(t.toString()):""),window.history.replaceState({},"",l),v.history.push("/"),e.abrupt("return",!0);case 24:n.error({content:o(c.message),key:i});case 25:return e.abrupt("return",!1);case 28:return e.prev=28,e.t0=e.catch(0),console.error("Login page - Error validating accessToken:",e.t0),n.error(a.formatMessage({id:"pages.login.validationError",defaultMessage:"验证访问令牌时出错"})),e.abrupt("return",!1);case 33:case"end":return e.stop()}}),e,null,[[0,28]])})));return function(){return e.apply(this,arguments)}}();return(0,E.jsxs)(f._Y,{hashed:!1,dark:k,children:[(0,E.jsx)(le,{}),(0,E.jsxs)("div",{style:{backgroundColor:m.colorBgContainer,textAlign:"center",height:"100%",backgroundImage:"url('/admin/assets/images/bg-wide.png')"},children:[!te&&(0,E.jsxs)(h.U,{form:l,contentStyle:{minWidth:400,maxWidth:"75vw"},logo:(0,E.jsx)("img",{alt:"logo",src:K}),title:V,subTitle:Y,actions:he&&!1,onFinish:function(){var e=c()(s()().mark((function e(t){var n,a,o,i;return s()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("login values:",t),"account"!==ue){e.next=10;break}return n=(0,oe.N9)(),a=(0,oe.vC)(t.password,n),o={username:t.username,passwordHash:a,passwordSalt:n,captchaUid:Ne,captchaCode:t.captchaCode,deviceUid:ve,platform:U.iw8},se.Z.debug("login info:",r()({},o)),e.next=8,$e(o);case 8:e.next=14;break;case 10:return i={mobile:t.mobile,code:t.code,captchaUid:Ne,captchaCode:t.captchaCode,deviceUid:ve,platform:U.iw8},se.Z.debug("login mobile info:",i),e.next=14,_e(i);case 14:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),children:[(0,E.jsx)(M.Z,{activeKey:ue,onChange:de,centered:!0,items:Qe()}),(0,E.jsx)("div",{style:{marginTop:14,marginBottom:14},children:(0,E.jsxs)("div",{style:{float:"right",marginBottom:24},children:[(0,E.jsx)(J.Z,{checked:ke,onChange:function(e){console.log("checked = ".concat(e.target.checked)),be(e.target.checked)},children:(0,E.jsxs)("span",{children:[a.formatMessage({id:"pages.login.privacy.agree",defaultMessage:"同意"}),(0,E.jsx)(w.ZP,{size:"small",type:"link",onClick:Ae,style:{padding:0,height:"auto"},children:a.formatMessage({id:"pages.login.privacy.privacyPolicy",defaultMessage:"《用户隐私协议》"})}),a.formatMessage({id:"pages.login.privacy.and",defaultMessage:"和"}),(0,E.jsx)(w.ZP,{size:"small",type:"link",onClick:qe,style:{padding:0,height:"auto"},children:a.formatMessage({id:"pages.login.privacy.termsOfService",defaultMessage:"《服务条款》"})})]})}),he&&(0,E.jsx)(v.Link,{to:"/auth/register",children:(0,E.jsx)(v.FormattedMessage,{id:"pages.login.registerAccount",defaultMessage:"注册 "})}),!1]})})]}),te&&(0,E.jsx)(ne,{}),(0,E.jsx)(re.Q,r()(r()({},T),{},{onInit:function(){console.log("ByteDesk initialized admin")}}))]})]})},de=function(){var e=(0,P.Z)().isDarkMode;return(0,E.jsx)(G.w,{children:(0,E.jsx)(k.ZP,{theme:{algorithm:e?ce:ie},children:(0,E.jsxs)(y.Z,{style:{height:"100%"},children:[(0,E.jsx)(Z.ZP,{}),(0,E.jsx)(ue,{})]})})})}},63327:function(e,t,n){n.d(t,{$g:function(){return u},N9:function(){return c},Qc:function(){return l},vC:function(){return i}});var a=n(46803),r=n.n(a),o=n(95660);function s(e){return"bytedesk_salt"!==e&&e?r().SHA256(e).toString().substring(0,16):"bytedesk_license"}function i(e,t){if(!e)throw new Error("密码不能为空");if(!t)throw new Error("盐值不能为空");try{var n=s(t),a=r().enc.Utf8.parse(n);return r().AES.encrypt(e,a,{mode:r().mode.ECB,padding:r().pad.Pkcs7}).toString()}catch(e){throw o.Z.error("密码加密失败:",e),new Error("密码加密失败: "+e.message)}}function c(){for(var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",n="",a=0;a<e;a++)n+=t.charAt(Math.floor(Math.random()*t.length));return n}function l(e){var t=0;return e?(e.length>=8&&(t+=20),e.length>=12&&(t+=10),/\d/.test(e)&&(t+=20),/[a-z]/.test(e)&&(t+=20),/[A-Z]/.test(e)&&(t+=20),/[!@#$%^&*(),.?":{}|<>]/.test(e)&&(t+=10),Math.min(t,100)):0}function u(e){return e>=80?"强":e>=60?"中":e>=40?"弱":"很弱"}}}]);