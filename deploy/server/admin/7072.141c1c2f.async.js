"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7072],{17115:function(e,t,a){a.d(t,{Z:function(){return Z}});var r=a(39328),s=a(17323),n=a(44194),i=a(17881),o=a(8598),d=a(31549),l=["proFieldProps","fieldProps"],u="date",c=n.forwardRef((function(e,t){var a=e.proFieldProps,c=e.fieldProps,f=(0,s.Z)(e,l),p=(0,n.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)({ref:t,valueType:u,fieldProps:(0,r.Z)({getPopupContainer:p.getPopupContainer},c),proFieldProps:a,filedConfig:{valueType:u,customLightMode:!0}},f))})),f=["proFieldProps","fieldProps"],p="dateMonth",m=n.forwardRef((function(e,t){var a=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,f),c=(0,n.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)({ref:t,valueType:p,fieldProps:(0,r.Z)({getPopupContainer:c.getPopupContainer},l),proFieldProps:a,filedConfig:{valueType:p,customLightMode:!0}},u))})),g=["fieldProps"],h="dateQuarter",M=n.forwardRef((function(e,t){var a=e.fieldProps,l=(0,s.Z)(e,g),u=(0,n.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)({ref:t,valueType:h,fieldProps:(0,r.Z)({getPopupContainer:u.getPopupContainer},a),filedConfig:{valueType:h,customLightMode:!0}},l))})),v=["proFieldProps","fieldProps"],x="dateWeek",y=n.forwardRef((function(e,t){var a=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,v),c=(0,n.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)({ref:t,valueType:x,fieldProps:(0,r.Z)({getPopupContainer:c.getPopupContainer},l),proFieldProps:a,filedConfig:{valueType:x,customLightMode:!0}},u))})),P=["proFieldProps","fieldProps"],b="dateYear",w=n.forwardRef((function(e,t){var a=e.proFieldProps,l=e.fieldProps,u=(0,s.Z)(e,P),c=(0,n.useContext)(i.Z);return(0,d.jsx)(o.Z,(0,r.Z)({ref:t,valueType:b,fieldProps:(0,r.Z)({getPopupContainer:c.getPopupContainer},l),proFieldProps:a,filedConfig:{valueType:b,customLightMode:!0}},u))})),C=c;C.Week=y,C.Month=m,C.Quarter=M,C.Year=w,C.displayName="ProFormComponent";var Z=C},3e3:function(e,t,a){var r=a(39328),s=a(17323),n=a(44194),i=a(8598),o=a(31549),d=["fieldProps","unCheckedChildren","checkedChildren","proFieldProps"],l=n.forwardRef((function(e,t){var a=e.fieldProps,n=e.unCheckedChildren,l=e.checkedChildren,u=e.proFieldProps,c=(0,s.Z)(e,d);return(0,o.jsx)(i.Z,(0,r.Z)({valueType:"switch",fieldProps:(0,r.Z)({unCheckedChildren:n,checkedChildren:l},a),ref:t,valuePropName:"checked",proFieldProps:u,filedConfig:{valuePropName:"checked",ignoreWidth:!0,customLightMode:!0}},c))}));t.Z=l},30234:function(e,t,a){var r=a(25191),s=a(32057),n=a(75699);t.Z=function(){var e=(0,n.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(r.VoP)||null!=t&&t.startsWith("ROLE_")?(0,s.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,s.aS)(t,10)}}}},67072:function(e,t,a){a.d(t,{Z:function(){return $}});var r=a(73193),s=a.n(r),n=a(84176),i=a.n(n),o=a(86222),d=a.n(o),l=a(90819),u=a.n(l),c=a(89933),f=a.n(c),p=a(45332),m=a.n(p),g=a(31756),h=a(25191),M=a(75699);function v(e){return x.apply(this,arguments)}function x(){return(x=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/license/query/org",{method:"GET",params:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return P.apply(this,arguments)}function P(){return(P=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/license/create",{method:"POST",data:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function b(e){return w.apply(this,arguments)}function w(){return(w=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/license/update",{method:"POST",data:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function C(e){return Z.apply(this,arguments)}function Z(){return(Z=f()(u()().mark((function e(t){return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,M.request)("/api/v1/license/delete",{method:"POST",data:s()(s()({},t),{},{channel:h.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var j=a(31881),F=a(83381),S=a(6992),E=a(79148),I=a(35129),k=a(44532),T=a(77407),D=a(44194),L=a(6373),A=a(22766),R=a(12581),Y=a(31051),B=a(17115),O=a(3e3),q=a(8957),K=a(24418),U=a(43413),N=a(76790),z=a(28977),W=a.n(z),_=a(31549),J=function(e){var t=e.isEdit,a=e.license,r=e.open,n=e.isSuperUser,i=e.onClose,o=e.onSubmit,l=(0,M.useIntl)(),u=L.A.useForm(),c=m()(u,1)[0],f=(0,N.L)((function(e){return e.userInfo})),p=(0,j.u)((function(e){return e.currentOrg})),g=(0,D.useState)(""),v=m()(g,2);v[0],v[1];return(0,D.useEffect)((function(){if(t)c.setFieldsValue({uid:null==a?void 0:a.uid,name:null==a?void 0:a.name,description:null==a?void 0:a.description,mobile:null==a?void 0:a.mobile,email:null==a?void 0:a.email,userType:null==a?void 0:a.userType,expiryDate:null==a?void 0:a.expiryDate,edition:null==a?void 0:a.edition,serverIps:null==a?void 0:a.serverIps,serverDomains:null==a?void 0:a.serverDomains,enabled:null==a?void 0:a.enabled,activatedAt:null==a?void 0:a.activatedAt,lastCheckedAt:null==a?void 0:a.lastCheckedAt});else{var e=W()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");c.setFieldsValue({mobile:null==f?void 0:f.mobile,email:null==f?void 0:f.email,userType:h.Bv_,edition:h.dbF,expiryDate:e})}}),[t,a,c,f]),(0,_.jsx)(_.Fragment,{children:(0,_.jsx)(K.Z,{title:l.formatMessage({id:"license.title",defaultMessage:"License"}),width:600,onClose:i,open:r,extra:(0,_.jsxs)(U.Z,{children:[(0,_.jsx)(T.ZP,{onClick:i,children:l.formatMessage({id:"cancel",defaultMessage:"Cancel"})}),(0,_.jsx)(T.ZP,{type:"primary",onClick:function(){return c.submit()},children:l.formatMessage({id:"submit",defaultMessage:"Submit"})})]}),children:(0,_.jsxs)(L.A,{form:c,name:"licenseForm",onFinish:function(){console.log("handleSubmit"),null!=f&&f.mobileVerified||null!=f&&f.emailVerified?c.validateFields().then((function(e){var t=s()({},e),a=s()(s()({},t),{},{orgUid:null==p?void 0:p.uid});console.log("submit",a),o(a)})):q.ZP.error(l.formatMessage({id:"license.verification.required",defaultMessage:"请先完成手机或邮箱验证后再创建License"}))},submitter:!1,children:[(0,_.jsx)(A.Z,{label:l.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0},{validator:function(e,t){return"string"==typeof t&&t.toLowerCase().includes("weiyu")?Promise.reject(new Error(l.formatMessage({id:"license.name.weiyu.forbidden",defaultMessage:"名称不能包含 weiyu"}))):Promise.resolve()}}]}),(0,_.jsx)(R.Z,{label:l.formatMessage({id:"description",defaultMessage:"Description"}),name:"description",placeholder:l.formatMessage({id:"license.description.placeholder",defaultMessage:"Optional, license usage description"})}),(0,_.jsx)(A.Z,{label:l.formatMessage({id:"mobile",defaultMessage:"Mobile"}),name:"mobile",disabled:!0}),(0,_.jsx)(A.Z,{label:l.formatMessage({id:"email",defaultMessage:"Email"}),name:"email",disabled:!0}),(0,_.jsx)(Y.Z,{label:l.formatMessage({id:"userType",defaultMessage:"User Type"}),name:"userType",options:[{label:l.formatMessage({id:"license.user.type.free",defaultMessage:"Free"}),value:h.Bv_},{label:l.formatMessage({id:"license.user.type.paid",defaultMessage:"Paid"}),value:h.u0z,disabled:!n}],extra:(0,_.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/payment#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer",style:{color:"#1677ff"},children:l.formatMessage({id:"license.userType.paid.tip",defaultMessage:"购买付费版请访问微语官网-版本与价格"})})}),(0,_.jsx)(B.Z,{label:l.formatMessage({id:"expiryDate",defaultMessage:"Expiry Date"}),name:"expiryDate",fieldProps:{format:"YYYY-MM-DD"},rules:[{required:!0,message:l.formatMessage({id:"license.expiryDate.required",defaultMessage:"Please select expiry date"})}]}),(0,_.jsx)(Y.Z,{label:l.formatMessage({id:"edition",defaultMessage:"Edition"}),name:"edition",options:[{label:l.formatMessage({id:"license.edition.community",defaultMessage:"Community Edition"}),value:h.dbF},{label:l.formatMessage({id:"license.edition.enterprise",defaultMessage:"Enterprise Edition"}),value:h.hj_},{label:l.formatMessage({id:"license.edition.platform",defaultMessage:"Platform Edition"}),value:h.tmZ}]}),(0,_.jsx)(A.Z,{label:l.formatMessage({id:"serverIps",defaultMessage:"Authorized IPs"}),name:"serverIps",placeholder:l.formatMessage({id:"license.comma.separated",defaultMessage:"Comma separated"}),extra:l.formatMessage({id:"license.serverIps.format",defaultMessage:"Format: 192.168.1.1, 10.0.0.1, 2001:db8::1"}),rules:[{validator:function(e,t){if(!t)return Promise.resolve();var a,r=t.split(",").map((function(e){return e.trim()})).filter(Boolean),s=/^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/,n=/^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}$/,i=d()(r);try{for(i.s();!(a=i.n()).done;){var o=a.value;if(!s.test(o)&&!n.test(o))return Promise.reject(new Error(l.formatMessage({id:"license.serverIps.error",defaultMessage:"Please enter valid IP addresses, separated by commas"})))}}catch(e){i.e(e)}finally{i.f()}return Promise.resolve()}}]}),(0,_.jsx)(A.Z,{label:l.formatMessage({id:"serverDomains",defaultMessage:"Authorized Domains"}),name:"serverDomains",placeholder:l.formatMessage({id:"license.comma.separated",defaultMessage:"Comma separated"}),extra:l.formatMessage({id:"license.serverDomains.format",defaultMessage:"Format: example.com, sub.example.com:8080, *.example.com"}),rules:[{validator:function(e,t){if(!t)return Promise.resolve();var a,r=t.split(",").map((function(e){return e.trim()})).filter(Boolean),s=d()(r);try{for(s.s();!(a=s.n()).done;){var n=a.value;if(!/^([A-Za-z0-9-]{1,63}\.)+[A-Za-z]{2,}(:\d{1,5})?$/.test(n))return Promise.reject(new Error(l.formatMessage({id:"license.serverDomains.error",defaultMessage:"Please enter valid domains, separated by commas"})))}}catch(e){s.e(e)}finally{s.f()}return Promise.resolve()}}]}),(0,_.jsx)(O.Z,{label:l.formatMessage({id:"enabled",defaultMessage:"Enabled"}),name:"enabled",fieldProps:{checkedChildren:l.formatMessage({id:"license.enabled",defaultMessage:"Enabled"}),unCheckedChildren:l.formatMessage({id:"license.disabled",defaultMessage:"Disabled"})}})]})})})},V=a(30234),X=a(223),Q=["current","pageSize"],$=function(e){var t=e.isSuperUser,a=(0,M.useIntl)(),r=(0,D.useRef)(),n=(0,V.Z)().translateString,o=(0,D.useState)(1),d=m()(o,2),l=(d[0],d[1]),c=(0,D.useState)(10),p=m()(c,2),h=(p[0],p[1]),x=(0,j.u)((function(e){return e.currentOrg})),P=(0,D.useState)(!1),w=m()(P,2),Z=w[0],L=w[1],A=(0,D.useState)({}),R=m()(A,2),Y=R[0],B=R[1],O=(0,D.useState)(!1),q=m()(O,2),K=q[0],U=q[1],N=I.Z.useModal(),z=m()(N,2),$=z[0],H=z[1],G=(0,D.useState)([]),ee=m()(G,2),te=ee[0],ae=ee[1],re=(0,D.useState)([]),se=m()(re,2),ne=(se[0],se[1]),ie=(0,D.useState)(0),oe=m()(ie,2),de=(oe[0],oe[1]),le=(0,D.useState)({}),ue=m()(le,2),ce=(ue[0],ue[1]),fe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,_.jsx)(M.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,_.jsx)(M.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",width:150,ellipsis:!0},{title:(0,_.jsx)(M.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",width:120},{title:(0,_.jsx)(M.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",width:180},{title:(0,_.jsx)(M.FormattedMessage,{id:"userType",defaultMessage:"User Type"}),dataIndex:"userType",hideInSearch:!0,width:120,valueEnum:{FREE:{text:(0,_.jsx)(M.FormattedMessage,{id:"license.user.type.free",defaultMessage:"Free"})},PAID:{text:(0,_.jsx)(M.FormattedMessage,{id:"license.user.type.paid",defaultMessage:"Paid"})}}},{title:(0,_.jsx)(M.FormattedMessage,{id:"expiryDate",defaultMessage:"Expiry Date"}),dataIndex:"expiryDate",hideInSearch:!0,width:120,render:function(e){return e?W()(e).format("YYYY-MM-DD"):""}},{title:(0,_.jsx)(M.FormattedMessage,{id:"edition",defaultMessage:"Edition"}),dataIndex:"edition",hideInSearch:!0,width:120,valueEnum:{COMMUNITY:{text:(0,_.jsx)(M.FormattedMessage,{id:"license.edition.community",defaultMessage:"Community Edition"})},ENTERPRISE:{text:(0,_.jsx)(M.FormattedMessage,{id:"license.edition.enterprise",defaultMessage:"Enterprise Edition"})},PLATFORM:{text:(0,_.jsx)(M.FormattedMessage,{id:"license.edition.platform",defaultMessage:"Platform Edition"})}}},{title:(0,_.jsx)(M.FormattedMessage,{id:"serverIps",defaultMessage:"Server IPs"}),dataIndex:"serverIps",hideInSearch:!0,width:180,ellipsis:!0},{title:(0,_.jsx)(M.FormattedMessage,{id:"serverDomains",defaultMessage:"Server Domains"}),dataIndex:"serverDomains",hideInSearch:!0,width:180,ellipsis:!0},{title:(0,_.jsx)(M.FormattedMessage,{id:"licenseKey",defaultMessage:"License Key"}),dataIndex:"licenseKey",width:200,copyable:!0,ellipsis:!0},{title:(0,_.jsx)(M.FormattedMessage,{id:"encryptedLicenseKey",defaultMessage:"Encrypted License Key"}),dataIndex:"encryptedLicenseKey",width:200,copyable:!0,ellipsis:!0},{title:(0,_.jsx)(M.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",hideInSearch:!0,width:100,valueType:"select",valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}}},{title:(0,_.jsx)(M.FormattedMessage,{id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",hideInSearch:!0,width:180,valueType:"dateTime"},{title:(0,_.jsx)(M.FormattedMessage,{id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",hideInSearch:!0,width:180,valueType:"dateTime"}],pe=[].concat(fe,[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:220,render:function(e,t,r,s){return[(0,_.jsx)("a",{onClick:function(){B(t),U(!0),L(!0)},children:a.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,_.jsx)(k.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n(t.name),"】？"),onConfirm:function(){return me(t)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),icon:(0,_.jsx)(F.Z,{style:{color:"red"}}),children:(0,_.jsx)(T.ZP,{type:"link",danger:!0,children:a.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete"),(0,_.jsx)(T.ZP,{type:"link",onClick:function(){return ve(t.encryptedLicenseKey)},children:"测试"},"test-decrypt")]}}]),me=function(){var e=f()(u()().mark((function e(t){var s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteLicense:",t),e.next=3,C(t);case 3:s=e.sent,console.log("deleteLicense:",s),200===s.code?(g.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),r.current.reload()):g.yw.error(s.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ge=function(){var e=f()(u()().mark((function e(t){var a,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:a=e.sent,console.log("handleCreateLicense response:",a),200===a.code?(null===(s=r.current)||void 0===s||s.reload(),L(!1)):g.yw.error(a.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=f()(u()().mark((function e(t){var a,s;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==Y?void 0:Y.uid,e.next=3,b(t);case 3:a=e.sent,console.log("handleUpdateLicense response:",a),200===a.code?(null===(s=r.current)||void 0===s||s.reload(),L(!1)):g.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Me=function(){L(!0),U(!1),B({})},ve=function(e){try{var t=(0,X.K_)(e);$.info({title:"解密结果",content:(0,_.jsx)("div",{style:{wordBreak:"break-all"},children:(0,_.jsx)("pre",{children:JSON.stringify(t,null,2)})}),width:600})}catch(e){$.error({title:"解密失败",content:String(e)})}},xe={selectedRowKeys:te,onChange:function(e,t){ae(e),ne(t)}},ye=function(){var e=f()(u()().mark((function e(a,r,n){var o,d,c,f,p;return u()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return o=a.current,d=a.pageSize,c=i()(a,Q),l(o),h(d),ce(c),f=s()({pageNumber:o-1,pageSize:d,orgUid:null==x?void 0:x.uid,isSuperUser:t},c),e.next=7,v(f);case 7:return p=e.sent,console.log("queryLicensesByOrg response:",p,f),200===p.code?de(p.data.totalElements):g.yw.error(p.message),e.abrupt("return",{data:p.data.content,success:!0,total:p.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,r){return e.apply(this,arguments)}}();return(0,_.jsxs)(_.Fragment,{children:[Z&&(0,_.jsx)(J,{isEdit:K,open:Z,license:Y,isSuperUser:t,onClose:function(){L(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),K?he(e):ge(e)}}),(0,_.jsx)(E.Z,{columns:pe,actionRef:r,cardBordered:!0,rowSelection:xe,request:ye,scroll:{x:1e3},rowKey:function(e){return e.uid||e.licenseKey||e.email||e.name},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){l(e),h(t)}},dateFormatter:"string",headerTitle:"License列表",toolBarRender:function(){return[(0,_.jsx)(T.ZP,{type:"primary",icon:(0,_.jsx)(S.Z,{}),onClick:Me,children:a.formatMessage({id:"create",defaultMessage:"Create"})},"create")]}}),H]})}}}]);