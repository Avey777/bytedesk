"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[23],{94011:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(77260),i=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M505.7 661a8 8 0 0012.6 0l112-141.7c4.1-5.2.4-12.9-6.3-12.9h-74.1V168c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v338.3H400c-6.7 0-10.4 7.7-6.3 12.9l112 141.8zM878 626h-60c-4.4 0-8 3.6-8 8v154H214V634c0-4.4-3.6-8-8-8h-60c-4.4 0-8 3.6-8 8v198c0 17.7 14.3 32 32 32h684c17.7 0 32-14.3 32-32V634c0-4.4-3.6-8-8-8z"}}]},name:"download",theme:"outlined"},r=a(5901),o=function(e,t){return i.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var l=i.forwardRef(o)},60107:function(e,t,a){var n=a(77260),i=a(44194),s=a(20614),r=a(5901),o=function(e,t){return i.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:s.Z}))},l=i.forwardRef(o);t.Z=l},35911:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(77260),i=a(44194),s={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M909.1 209.3l-56.4 44.1C775.8 155.1 656.2 92 521.9 92 290 92 102.3 279.5 102 511.5 101.7 743.7 289.8 932 521.9 932c181.3 0 335.8-115 394.6-276.1 1.5-4.2-.7-8.9-4.9-10.3l-56.7-19.5a8 8 0 00-10.1 4.8c-1.8 5-3.8 10-5.9 14.9-17.3 41-42.1 77.8-73.7 109.4A344.77 344.77 0 01655.9 829c-42.3 17.9-87.4 27-133.8 27-46.5 0-91.5-9.1-133.8-27A341.5 341.5 0 01279 755.2a342.16 342.16 0 01-73.7-109.4c-17.9-42.4-27-87.4-27-133.9s9.1-91.5 27-133.9c17.3-41 42.1-77.8 73.7-109.4 31.6-31.6 68.4-56.4 109.3-73.8 42.3-17.9 87.4-27 133.8-27 46.5 0 91.5 9.1 133.8 27a341.5 341.5 0 01109.3 73.8c9.9 9.9 19.2 20.4 27.8 31.4l-60.2 47a8 8 0 003 14.1l175.6 43c5 1.2 9.9-2.6 9.9-7.7l.8-180.9c-.1-6.6-7.8-10.3-13-6.2z"}}]},name:"reload",theme:"outlined"},r=a(5901),o=function(e,t){return i.createElement(r.Z,(0,n.Z)({},e,{ref:t,icon:s}))};var l=i.forwardRef(o)},15431:function(e,t,a){a.r(t),a.d(t,{default:function(){return q}});var n=a(90819),i=a.n(n),s=a(89933),r=a.n(s),o=a(45332),l=a.n(o),c=a(44194),d=a(70877),u=a(69466),g=a(13252),f=a(49297),m=a(31218),v=a(55599),h=a(12722),x=a(29507),p=a(20374),M=a(4959),y=a(34640),j=a(89323),b=a(23377),Z=a(8421),k=a(48430),S=a(35911),C=a(94011),T=a(57039),w=a(60107),Y=a(14546),R=a(77260),D={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M868 160h-92v-40c0-4.4-3.6-8-8-8H256c-4.4 0-8 3.6-8 8v40h-92a44 44 0 00-44 44v148c0 81.7 60 149.6 138.2 162C265.7 630.2 359 721.7 476 734.5v105.2H280c-17.7 0-32 14.3-32 32V904c0 4.4 3.6 8 8 8h512c4.4 0 8-3.6 8-8v-32.3c0-17.7-14.3-32-32-32H548V734.5C665 721.7 758.3 630.2 773.8 514 852 501.6 912 433.7 912 352V204a44 44 0 00-44-44zM184 352V232h64v207.6a91.99 91.99 0 01-64-87.6zm520 128c0 49.1-19.1 95.4-53.9 130.1-34.8 34.8-81 53.9-130.1 53.9h-16c-49.1 0-95.4-19.1-130.1-53.9-34.8-34.8-53.9-81-53.9-130.1V184h384v296zm136-128c0 41-26.9 75.8-64 87.6V232h64v120z"}}]},name:"trophy",theme:"outlined"},z=a(5901),A=function(e,t){return c.createElement(z.Z,(0,R.Z)({},e,{ref:t,icon:D}))};var U=c.forwardRef(A),F=a(90216),O=a(88633),I=a(97043),P=a(28977),B=a.n(P),H=a(89520),E=a(59318),V=a(2622),L=a(32157),W=a(31549),N=d.default.RangePicker,Q=u.Z.Option,q=function(){var e=(0,E.useIntl)(),t=(0,c.useState)(!1),a=l()(t,2),n=a[0],s=a[1],o=(0,H.u)((function(e){return e.currentOrg})),d=(0,c.useState)([]),R=l()(d,2),D=R[0],z=R[1],A=(0,c.useState)({onlineAgents:0,totalSessions:0,avgResponseTime:0,avgSatisfaction:0,onlineAgentCount:0,offlineAgentCount:0,avgFirstResponseTime:0,avgConversationTime:0}),P=l()(A,2),q=P[0],G=P[1],J=(0,c.useState)(B()().startOf("day")),_=l()(J,2),K=_[0],X=_[1],$=(0,c.useState)(B()().endOf("day")),ee=l()($,2),te=ee[0],ae=ee[1],ne=(0,c.useState)("today"),ie=l()(ne,2),se=ie[0],re=ie[1],oe=(0,c.useState)([B()().startOf("day"),B()().endOf("day")]),le=l()(oe,2),ce=le[0],de=le[1],ue=(0,c.useState)({current:1,pageSize:20,total:0}),ge=l()(ue,2),fe=ge[0],me=ge[1],ve=(0,c.useState)(V.whQ),he=l()(ve,2),xe=he[0],pe=he[1],Me=(0,c.useState)(),ye=l()(Me,2),je=ye[0],be=ye[1],Ze=(0,c.useState)(),ke=l()(Ze,2),Se=ke[0],Ce=ke[1],Te=(0,c.useState)([]),we=l()(Te,2),Ye=we[0],Re=we[1],De=(0,c.useState)([]),ze=l()(De,2),Ae=ze[0],Ue=ze[1],Fe=[{label:(0,W.jsx)(E.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,W.jsx)(E.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,W.jsx)(E.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,W.jsx)(E.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,W.jsx)(E.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,W.jsx)(E.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,c.useEffect)((function(){null!=o&&o.uid&&((0,O.LE)({orgUid:o.uid,pageNumber:0,pageSize:100}).then((function(e){var t;200===e.code&&Re((null===(t=e.data)||void 0===t?void 0:t.content)||[])})),(0,I._t)({orgUid:o.uid,pageNumber:0,pageSize:100}).then((function(e){var t;200===e.code&&Ue((null===(t=e.data)||void 0===t?void 0:t.content)||[])})))}),[o]);var Oe=function(){var e=r()(i()().mark((function e(){var t,a,n,r,l,c,d=arguments;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=d.length>0&&void 0!==d[0]?d[0]:1,a=d.length>1&&void 0!==d[1]?d[1]:20,s(!0),e.prev=3,n={pageNumber:t-1,pageSize:a,orgUid:null==o?void 0:o.uid,startDate:ce[0].format("YYYY-MM-DD"),endDate:ce[1].format("YYYY-MM-DD"),type:xe,workgroupUid:xe===V.v5D?je:void 0,agentUid:xe===V.fyH?Se:void 0},e.next=7,(0,F.RU)(n);case 7:r=e.sent,console.log("queryStatisticServiceByDate response:",r.data,n),200===r.code&&r.data&&(l=r.data,me({current:t,pageSize:a,total:1}),c=[{key:l.agentUid||"unknown",agentUid:l.agentUid||"unknown",nickname:l.agentUid||"Unknown Agent",avatar:"",totalSessions:l.acceptedThreadCount||0,avgResponseTime:l.avgFirstResponseTime?Math.round(l.avgFirstResponseTime/60):0,avgSatisfaction:l.satisfactionRate||0,avgConversationTime:l.avgConversationTime?Math.round(l.avgConversationTime/60):0,onlineTime:l.onlineTime?Math.round(l.onlineTime/3600):0,busyTime:l.busyTime?Math.round(l.busyTime/3600):0,agentMessageCount:l.agentMessageCount||0,visitorMessageCount:l.visitorMessageCount||0,avgMessagePerThread:l.avgMessagePerThread||0}],z(c)),e.next=16;break;case 12:e.prev=12,e.t0=e.catch(3),g.ZP.error("获取客服数据失败"),console.error("获取客服数据失败:",e.t0);case 16:return e.prev=16,s(!1),e.finish(16);case 19:case"end":return e.stop()}}),e,null,[[3,12,16,19]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){if("custom"===se)X(K),ae(te);else{var e=B()();"today"===se?(X(e.startOf("day")),ae(e.endOf("day"))):"yesterday"===se?(X(e.subtract(1,"day").startOf("day")),ae(e.subtract(1,"day").endOf("day"))):"week"===se?(X(e.startOf("week")),ae(e.endOf("week"))):"lastWeek"===se?(X(e.subtract(1,"week").startOf("week")),ae(e.subtract(1,"week").endOf("week"))):"month"===se&&(X(e.startOf("month")),ae(e.endOf("month")))}}),[se]),(0,c.useEffect)((function(){de([K,te])}),[K,te]);var Ie=function(){var e=r()(i()().mark((function e(){var t,a,n;return i()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t={orgUid:null==o?void 0:o.uid,startDate:ce[0].format("YYYY-MM-DD"),endDate:ce[1].format("YYYY-MM-DD"),type:xe,workgroupUid:xe===V.v5D?je:void 0,agentUid:xe===V.fyH?Se:void 0},e.next=4,(0,F.RU)(t);case 4:a=e.sent,console.log("queryStatisticServiceByDate response:",a.data,t),200===a.code&&a.data&&(n=a.data,G({onlineAgents:n.onlineAgentCount||0,totalSessions:n.acceptedThreadCount||0,avgResponseTime:n.avgFirstResponseTime?Math.round(n.avgFirstResponseTime/60):0,avgSatisfaction:n.satisfactionRate||0,onlineAgentCount:n.onlineAgentCount||0,offlineAgentCount:n.offlineAgentCount||0,avgFirstResponseTime:n.avgFirstResponseTime?Math.round(n.avgFirstResponseTime/60):0,avgConversationTime:n.avgConversationTime?Math.round(n.avgConversationTime/60):0})),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("获取统计数据失败:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}();(0,c.useEffect)((function(){Ie(),Oe()}),[ce,xe,je,Se]);var Pe=[{title:e.formatMessage({id:"bi.agent.table.name"}),dataIndex:"nickname",key:"nickname",render:function(e,t){return(0,W.jsxs)("div",{style:{display:"flex",alignItems:"center"},children:[(0,W.jsx)(f.Z,{src:t.avatar,style:{marginRight:8}}),e]})}},{title:e.formatMessage({id:"bi.agent.table.totalSessions"}),dataIndex:"totalSessions",key:"totalSessions",sorter:function(e,t){return e.totalSessions-t.totalSessions}},{title:e.formatMessage({id:"bi.agent.table.avgResponseTime"}),dataIndex:"avgResponseTime",key:"avgResponseTime",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.minute"}))}},{title:e.formatMessage({id:"bi.agent.table.avgConversationTime"}),dataIndex:"avgConversationTime",key:"avgConversationTime",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.minute"}))}},{title:e.formatMessage({id:"bi.agent.table.onlineTime"}),dataIndex:"onlineTime",key:"onlineTime",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.hour"}))}},{title:e.formatMessage({id:"bi.agent.table.busyTime"}),dataIndex:"busyTime",key:"busyTime",render:function(t){return"".concat(t).concat(e.formatMessage({id:"bi.time.hour"}))}},{title:e.formatMessage({id:"bi.agent.table.agentMessageCount"}),dataIndex:"agentMessageCount",key:"agentMessageCount"},{title:e.formatMessage({id:"bi.agent.table.visitorMessageCount"}),dataIndex:"visitorMessageCount",key:"visitorMessageCount"},{title:e.formatMessage({id:"bi.agent.table.avgMessagePerThread"}),dataIndex:"avgMessagePerThread",key:"avgMessagePerThread"},{title:e.formatMessage({id:"bi.agent.table.satisfaction"}),dataIndex:"avgSatisfaction",key:"avgSatisfaction",render:function(t){return(0,W.jsxs)("div",{children:[(0,W.jsx)("span",{style:{marginRight:8},children:t>0?"".concat(t,"%"):e.formatMessage({id:"bi.common.noRating"})}),t>0&&(0,W.jsx)(m.Z,{percent:t,size:"small",showInfo:!1})]})}}];return(0,W.jsxs)("div",{style:{padding:"24px"},children:[(0,W.jsxs)("div",{style:{marginBottom:"24px"},children:[(0,W.jsx)("h2",{children:e.formatMessage({id:"bi.agent.title"})}),(0,W.jsxs)("p",{children:[e.formatMessage({id:"bi.agent.description"}),"today"===se&&(0,W.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",K.format("YYYY-MM-DD"),")"]}),"yesterday"===se&&(0,W.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",K.format("YYYY-MM-DD"),")"]}),("week"===se||"lastWeek"===se||"month"===se||"custom"===se)&&(0,W.jsxs)("span",{style:{color:"#666",marginLeft:8},children:["(",K.format("YYYY-MM-DD")," ~ ",te.format("YYYY-MM-DD"),")"]})]})]}),(0,W.jsx)(v.Z,{style:{marginBottom:"24px"},children:(0,W.jsx)(h.Z,{direction:"vertical",style:{width:"100%"},children:(0,W.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,W.jsxs)(h.Z,{wrap:!0,children:[(0,W.jsx)(x.ZP.Group,{value:se,onChange:function(e){return re(e.target.value)},children:Fe.map((function(e){return(0,W.jsx)(x.ZP.Button,{value:e.value,children:e.label},e.value)}))}),"custom"===se&&(0,W.jsx)(N,{value:[K,te],onChange:function(e){X(e[0]),ae(e[1])}})]}),(0,W.jsxs)(h.Z,{wrap:!0,children:[(0,W.jsxs)(u.Z,{value:xe,style:{width:120},onChange:function(e){pe(e),be(void 0),Ce(void 0)},children:[(0,W.jsx)(Q,{value:V.whQ,children:e.formatMessage({id:"bi.statistic.level.organization"})}),(0,W.jsx)(Q,{value:V.v5D,children:e.formatMessage({id:"bi.statistic.level.workgroup"})}),(0,W.jsx)(Q,{value:V.fyH,children:e.formatMessage({id:"bi.statistic.level.agent"})})]}),xe===V.v5D&&(0,W.jsx)(u.Z,{value:je,style:{width:150},onChange:be,placeholder:e.formatMessage({id:"bi.statistic.level.workgroup"}),allowClear:!0,children:Ye.map((function(e){return(0,W.jsx)(Q,{value:e.uid,children:e.nickname},e.uid)}))}),xe===V.fyH&&(0,W.jsx)(u.Z,{value:Se,style:{width:150},onChange:Ce,placeholder:e.formatMessage({id:"bi.statistic.level.agent"}),allowClear:!0,children:Ae.map((function(e){return(0,W.jsx)(Q,{value:e.uid,children:e.nickname},e.uid)}))}),(0,W.jsx)(p.ZP,{type:"primary",icon:(0,W.jsx)(S.Z,{}),onClick:function(){return Oe()},loading:n,children:e.formatMessage({id:"bi.common.refresh"})}),(0,W.jsx)(M.Z,{title:e.formatMessage({id:"ticket.statistic.filter.export"}),children:(0,W.jsx)(p.ZP,{icon:(0,W.jsx)(C.Z,{}),onClick:function(){var e=localStorage.getItem(V.LA8);window.open((0,L.kG)()+"/api/v1/service/statistic/export?"+new URLSearchParams({type:xe,startDate:ce[0].format("YYYY-MM-DD"),endDate:ce[1].format("YYYY-MM-DD"),workgroupUid:xe===V.v5D?je:"",agentUid:xe===V.fyH?Se:"",orgUid:(null==o?void 0:o.uid)||"",accessToken:e||""}).toString())},children:e.formatMessage({id:"ticket.statistic.filter.export"})})})]})]})})}),(0,W.jsxs)(y.Z,{spinning:n,children:[(0,W.jsxs)(j.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.onlineAgents"}),value:q.onlineAgentCount,prefix:(0,W.jsx)(T.Z,{}),valueStyle:{color:"#3f8600"}})})}),(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.offlineAgents"}),value:q.offlineAgentCount,prefix:(0,W.jsx)(T.Z,{}),valueStyle:{color:"#ff4d4f"}})})}),(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.totalSessions"}),value:q.totalSessions,prefix:(0,W.jsx)(w.Z,{}),valueStyle:{color:"#1890ff"}})})}),(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.avgResponseTime"}),value:q.avgResponseTime,prefix:(0,W.jsx)(Y.Z,{}),valueStyle:{color:"#722ed1"},suffix:e.formatMessage({id:"bi.time.minute"})})})})]}),(0,W.jsxs)(j.Z,{gutter:16,style:{marginBottom:"24px"},children:[(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.avgFirstResponseTime"}),value:q.avgFirstResponseTime,prefix:(0,W.jsx)(Y.Z,{}),valueStyle:{color:"#13c2c2"},suffix:e.formatMessage({id:"bi.time.minute"})})})}),(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.avgConversationTime"}),value:q.avgConversationTime,prefix:(0,W.jsx)(Y.Z,{}),valueStyle:{color:"#fa8c16"},suffix:e.formatMessage({id:"bi.time.minute"})})})}),(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.avgSatisfaction"}),value:q.avgSatisfaction,prefix:(0,W.jsx)(U,{}),valueStyle:{color:"#eb2f96"},suffix:"%"})})}),(0,W.jsx)(b.Z,{span:6,children:(0,W.jsx)(v.Z,{children:(0,W.jsx)(Z.Z,{title:e.formatMessage({id:"bi.agent.card.totalAgents"}),value:q.onlineAgentCount+q.offlineAgentCount,prefix:(0,W.jsx)(T.Z,{}),valueStyle:{color:"#52c41a"}})})})]}),(0,W.jsx)(v.Z,{title:e.formatMessage({id:"bi.agent.ranking"}),style:{marginBottom:"24px"},children:(0,W.jsx)(j.Z,{gutter:16,children:D.sort((function(e,t){return t.totalSessions-e.totalSessions})).slice(0,3).map((function(t,a){return(0,W.jsx)(b.Z,{span:8,children:(0,W.jsxs)(v.Z,{size:"small",style:{textAlign:"center"},children:[(0,W.jsx)(f.Z,{size:64,src:t.avatar}),(0,W.jsxs)("div",{style:{marginTop:8},children:[(0,W.jsx)("div",{style:{fontWeight:"bold"},children:t.nickname}),(0,W.jsxs)("div",{style:{color:"#666"},children:[t.totalSessions,e.formatMessage({id:"bi.time.unit"})]})]})]})},t.key)}))})}),(0,W.jsx)(v.Z,{title:e.formatMessage({id:"bi.agent.detailData"}),children:(0,W.jsx)(k.Z,{columns:Pe,dataSource:D,pagination:{current:fe.current,pageSize:fe.pageSize,total:fe.total,showSizeChanger:!0,showQuickJumper:!0,showTotal:function(e,t){return"".concat(t[0],"-").concat(t[1]," of ").concat(e," items")}},onChange:function(e){Oe(e.current,e.pageSize)},size:"middle"})})]})]})}}}]);