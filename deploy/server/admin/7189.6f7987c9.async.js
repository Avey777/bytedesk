"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7189],{80503:function(e,n,t){t.d(n,{Z:function(){return u}});var r=t(73743),a=t(44194),o={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M456 231a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0zm0 280a56 56 0 10112 0 56 56 0 10-112 0z"}}]},name:"more",theme:"outlined"},s=t(5901),i=function(e,n){return a.createElement(s.Z,(0,r.Z)({},e,{ref:n,icon:o}))};var u=a.forwardRef(i)},62486:function(e,n,t){t.d(n,{AP:function(){return d},_J:function(){return v},t5:function(){return g},v_:function(){return p}});var r=t(90819),a=t.n(r),o=t(73193),s=t.n(o),i=t(89933),u=t.n(i),l=t(63926),c=t(93363);function d(e){return f.apply(this,arguments)}function f(){return(f=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/query/org",{method:"GET",params:s()(s()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function p(e){return b.apply(this,arguments)}function b(){return(b=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/create",{method:"POST",data:s()(s()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function g(e){return m.apply(this,arguments)}function m(){return(m=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/update",{method:"POST",data:s()(s()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function v(e){return h.apply(this,arguments)}function h(){return(h=u()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,c.request)("/api/v1/kbase/delete",{method:"POST",data:s()(s()({},n),{},{client:l.bVn})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}},15913:function(e,n,t){var r=t(84095);n.Z=function(){var e=(0,r.Z)().isDarkMode;return{leftSiderStyle:{borderRight:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"},leftSiderWidth:250,headerStyle:{background:e?"#141414":"#fff"},rightSiderStyle:{borderLeft:e?"1px solid #333":"1px solid #ccc",background:e?"#141414":"#f5f5f5"},contentStyle:{minHeight:120,background:e?"#141414":"#f5f5f5",height:"100vh",overflow:"auto"}}}},16840:function(e,n,t){t.d(n,{Z:function(){return I}});var r=t(90819),a=t.n(r),o=t(89933),s=t.n(o),i=t(45332),u=t.n(i),l=t(76204),c=t(10075),d=t(72244),f=t(73739),p=t(66400),b=t(44194),g=t(10154),m=t.n(g),v=t(73193),h=t.n(v),k=t(28370),y=t(18429),x=t(53067),w=t(63926),K=t(69935),Z=t(38805),M=t(47173),j=t(87587),S=t(86984),C=t(69693),P=t(31549),R=function(e){var n=e.open,t=e.isEdit,r=e.type,o=e.kbase,i=e.onCancel,c=e.onSubmit,d=K.A.useForm(),f=u()(d,1)[0],p=(0,y.Z)().translateString,g=(0,x.u)((function(e){return e.currentOrg})),v=(0,b.useRef)(null),R=(0,b.useState)([]),F=u()(R,2),H=F[0],E=F[1],V=(0,b.useState)({}),q=u()(V,2),T=q[0],O=q[1],L=(0,b.useState)(!1),z=u()(L,2),_=z[0],D=z[1],I="ollama",U="bge-m3:latest",Q=(0,b.useState)((null==o?void 0:o.embeddingProvider)||I),A=u()(Q,2),N=A[0],B=A[1],J=(0,b.useState)((null==o?void 0:o.embeddingModel)||U),W=u()(J,2),G=W[0],X=W[1],Y=(0,b.useState)(""),$=u()(Y,2),ee=$[0],ne=$[1];(0,b.useEffect)((function(){t?(f.setFieldsValue({name:p(null==o?void 0:o.name)}),f.setFieldsValue({headline:p(null==o?void 0:o.headline)}),f.setFieldsValue({footerHtml:p(null==o?void 0:o.footerHtml)}),f.setFieldsValue({descriptionHtml:p(null==o?void 0:o.descriptionHtml)}),f.setFieldsValue({language:null==o?void 0:o.language}),null!=o&&o.embeddingProvider&&(B(o.embeddingProvider),f.setFieldsValue({embeddingProvider:o.embeddingProvider})),null!=o&&o.embeddingModel&&(X(o.embeddingModel),f.setFieldsValue({embeddingModel:o.embeddingModel}))):(f.resetFields(),f.setFieldsValue({language:"ZH_CN"}),f.setFieldsValue({embeddingProvider:I,embeddingModel:U})),n&&setTimeout((function(){var e;null===(e=v.current)||void 0===e||e.focus()}),100)}),[n,t,o]),(0,b.useEffect)((function(){n&&r===w.QPQ&&te()}),[n,r]),(0,b.useEffect)((function(){if(N&&G&&T[N]){var e=T[N].find((function(e){return e.value===G}));e&&ne(e.label)}}),[T,N,G]);var te=function(){var e=s()(a()().mark((function e(){var n,t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n={pageNumber:0,pageSize:100,orgUid:null==g?void 0:g.uid,level:w.whQ},e.next=4,(0,C.mK)(n);case 4:t=e.sent,console.log("queryLlmProvidersByOrg: ",t.data,n),200===t.code?(r=t.data.content||[],E(r)):k.yw.error(t.message),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),console.error("Failed to fetch providers:",e.t0);case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(){return e.apply(this,arguments)}}(),re=((0,b.useCallback)((function(){}),[]),(0,b.useCallback)((function(){D(!1)}),[])),ae=(0,b.useCallback)((function(e,n,t){B(e),X(n),ne(t),f.setFieldValue("embeddingProvider",e),f.setFieldValue("embeddingModel",n),D(!1)}),[f]),oe=(0,b.useCallback)((function(e,n){O((function(t){return h()(h()({},t),{},m()({},e,n))}))}),[]),se=function(){f.validateFields().then(function(){var e=s()(a()().mark((function e(n){var s;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleSaveDep:",n),s={uid:t?null==o?void 0:o.uid:"",name:n.name,headline:n.headline,descriptionHtml:n.descriptionHtml,footerHtml:n.footerHtml,type:r,language:n.language,embeddingProvider:n.embeddingProvider||I,embeddingModel:n.embeddingModel||U,orgUid:null==g?void 0:g.uid},c(s);case 3:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}()).catch((function(e){console.log("Failed:",e),k.yw.error("创建知识库失败")}))},ie=function(e){"Enter"===e.key&&se()};return(0,P.jsxs)("div",{children:[(0,P.jsx)(l.Z,{title:"新建知识库",open:n,forceRender:!0,onOk:se,onCancel:i,children:(0,P.jsxs)(K.A,{form:f,submitter:!1,children:[(0,P.jsx)(Z.Z,{label:"知识库语言",name:"language",rules:[{required:!0,message:"请选择知识库语言!"}],options:[{label:"简体中文",value:"ZH_CN"},{label:"English",value:"EN"},{label:"繁体中文",value:"ZH_TW"}],fieldProps:{onChange:function(e){console.log("handleLanguageSelect:",e)},placeholder:"请选择知识库语言",allowClear:!0}}),(0,P.jsx)(M.Z,{label:"知识库名称",name:"name",rules:[{required:!0,message:"请输入名称!"}],fieldProps:{onPressEnter:ie,placeholder:"请输入名称",ref:v}}),r===w.VX&&(0,P.jsxs)(P.Fragment,{children:[(0,P.jsx)(M.Z,{label:"主标题",name:"headline",rules:[{required:!0,message:"请输入主标题!"}],fieldProps:{onPressEnter:ie,placeholder:"请输入名称"}}),(0,P.jsx)(j.Z,{label:"页脚",name:"footerHtml",rules:[{required:!0,message:"请输入页脚!"}]})]}),(0,P.jsx)(j.Z,{label:"描述",name:"descriptionHtml"})]})}),r===w.QPQ&&(0,P.jsx)(S.Z,{visible:_,onCancel:re,onOk:ae,initialProvider:N,initialModel:G,initialModelLabel:ee,providers:H,currentOrgUid:null==g?void 0:g.uid,existingProviderModels:T,onModelsLoaded:oe,allowedModelTypes:[w.xTq]})]})},F=t(62486),H=t(4643),E=t(84095),V=t(93363),q=t(83381),T=t(90092),O=t(35911),L=t(41881),z=t(91768),_=t(80503),D=l.Z.confirm,I=function(e){var n=e.type,t=(0,V.useIntl)(),r=(0,b.useState)(!1),o=u()(r,2),i=o[0],l=o[1],g=(0,b.useRef)(!1),m=(0,b.useState)(!1),v=u()(m,2),h=v[0],K=v[1],Z=(0,E.Z)().isDarkMode,M=(0,y.Z)().translateString,j=(0,x.u)((function(e){return e.currentOrg})),S=(0,b.useState)(!0),C=u()(S,2),I=C[0],U=C[1],Q=(0,H.j)((function(e){return{kbaseResult:e.kbaseResult,currentKbase:e.currentKbase,insertKbase:e.insertKbase,updateLocalKbase:e.updateKbase,setKbaseResult:e.setKbaseResult,setCurrentKbase:e.setCurrentKbase,removeKbase:e.removeKbase}})),A=Q.kbaseResult,N=Q.currentKbase,B=Q.insertKbase,J=Q.updateLocalKbase,W=Q.setKbaseResult,G=Q.setCurrentKbase,X=Q.removeKbase,Y=function(){var e=s()(a()().mark((function e(){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!g.current){e.next=3;break}return console.log("isLoading: 1",g.current),e.abrupt("return");case 3:return g.current=!0,l(!0),k.yw.loading("loading"),t={pageNumber:0,pageSize:50,type:n,orgUid:null==j?void 0:j.uid},e.next=9,(0,F.AP)(t);case 9:r=e.sent,console.log("queryKbasesByOrg: ",r),200===r.code?(k.yw.destroy(),W(r)):(k.yw.destroy(),k.yw.error(r.message)),g.current=!1,l(!1);case 14:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}();(0,b.useEffect)((function(){console.log("useEffect"),Y()}),[]);var $=function(){var e=s()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("create kb",n),t="createKbase",k.yw.loading({content:"正在创建...",key:t}),e.next=5,(0,F.v_)(n);case 5:r=e.sent,console.log("create kb response",r),200===r.code?(B(r.data),G(r.data),k.yw.success({content:"创建成功！",key:t,duration:2}),K(!1)):(console.log("create kb failed",r),k.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ee=function(){var e=s()(a()().mark((function e(n){var t,r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("update kb",n),t="updateKbase",k.yw.loading({content:"正在更新...",key:t}),e.next=5,(0,F.t5)(n);case 5:r=e.sent,console.log("update kb response",r),200===r.code?(J(r.data),G(r.data),k.yw.success({content:"更新成功！",key:t,duration:2}),K(!1)):(console.log("update kb failed",r),k.yw.error({content:r.message,key:t,duration:2}));case 8:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ne=function(){var e=s()(a()().mark((function e(){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:console.log("handleEditKbase: ",N),U(!0),K(!0);case 3:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),te=function(){var e=s()(a()().mark((function e(n){return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:I?ee(n):$(n);case 1:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),re=function(){var e=s()(a()().mark((function e(n){var r;return a()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log("handleDeleteKbase: ",n),1!==A.data.content.length){e.next=4;break}return k.yw.error(t.formatMessage({id:"deleteKbaseTip"})),e.abrupt("return");case 4:return e.next=6,(0,F._J)(n);case 6:r=e.sent,console.log("handleDeleteKbase: ",r),200===r.code?(X(n.uid),Y()):(console.log("handleDeleteKbase: ",r),k.yw.error(r.message));case 9:case"end":return e.stop()}}),e)})));return function(n){return e.apply(this,arguments)}}(),ae=function(e){return n!==w._FS?M(e.descriptionHtml):e.level===w.Hxq?"全平台客服可见":e.level===w.whQ?"本组织客服可见":e.level===w.fyH?"本客服可见":M(e.descriptionHtml)};return(0,P.jsxs)(P.Fragment,{children:[(0,P.jsxs)(c.Z,{gap:"small",wrap:"nowrap",style:{padding:"10px",justifyContent:"space-between"},children:[(0,P.jsxs)(c.Z,{gap:"small",children:[(0,P.jsx)(d.ZP,{type:"primary",size:"small",icon:(0,P.jsx)(T.Z,{}),onClick:function(){console.log("new kb"),U(!1),K(!0)},children:t.formatMessage({id:"createKb",defaultMessage:"创建知识库"})}),(0,P.jsx)(d.ZP,{size:"small",icon:(0,P.jsx)(O.Z,{spin:i}),onClick:Y,loading:i,children:t.formatMessage({id:"refresh",defaultMessage:"刷新"})})]}),(null==N?void 0:N.uid)&&(0,P.jsx)(f.Z,{menu:{items:[{key:"edit",icon:(0,P.jsx)(L.Z,{}),label:t.formatMessage({id:"edit",defaultMessage:"编辑"}),onClick:ne},{key:"delete",icon:(0,P.jsx)(z.Z,{}),label:t.formatMessage({id:"delete",defaultMessage:"删除"}),danger:!0,onClick:function(){return function(e){D({title:t.formatMessage({id:"deleteTip"}),icon:(0,P.jsx)(q.Z,{}),content:"".concat(t.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(M(e.name),"】？"),onOk:function(){re(e)},onCancel:function(){},okText:t.formatMessage({id:"ok"}),cancelText:t.formatMessage({id:"cancel"})})}(N)}}]},children:(0,P.jsx)(d.ZP,{size:"small",icon:(0,P.jsx)(_.Z,{})})})]}),(0,P.jsx)(p.Z,{itemLayout:"horizontal",dataSource:A.data.content,renderItem:function(e,n){return(0,P.jsx)(p.Z.Item,{style:N.uid===e.uid?{backgroundColor:Z?"#333333":"#dddddd",cursor:"pointer"}:{cursor:"pointer"},onClick:function(){G(e)},children:(0,P.jsx)(p.Z.Item.Meta,{style:{marginLeft:"10px"},title:M(e.name),description:ae(e)})})}}),h&&(0,P.jsx)(R,{open:h,isEdit:I,type:n,kbase:N,onSubmit:te,onCancel:function(){K(!1)}})]})}},4643:function(e,n,t){t.d(n,{j:function(){return d}});var r=t(73193),a=t.n(r),o=t(76711),s=t.n(o),i=t(63926),u=t(66406),l=t(85043),c=t(24291),d=(0,u.Ue)()((0,l.mW)((0,l.tJ)((0,c.n)((function(e,n){return{currentKbase:{uid:"",orgUid:""},kbaseResult:{data:{content:[]}},insertKbase:function(n){e((function(e){e.kbaseResult.data.content.unshift(n)}))},updateKbase:function(n){e((function(e){var t=e.kbaseResult.data.content,r=t.findIndex((function(e){return e.uid===n.uid}));-1!==r?t[r]=n:console.warn("Kbase with uid ".concat(n.uid," not found."))}))},setKbaseResult:function(n){var t;e({kbaseResult:n}),(null===(t=n.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.length)>0&&e({currentKbase:n.data.content[0]})},setCurrentKbase:function(t){var r=n().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===t.uid}));if(-1!==o){var i=[].concat(s()(r.slice(0,o)),[t],s()(r.slice(o+1))),u=a()(a()({},n().kbaseResult),{},{data:{content:i}});e({kbaseResult:u,currentKbase:t})}else console.warn("Kbase with the specified uid not found."),e({currentKbase:t})},removeKbase:function(t){var r=n().kbaseResult.data.content,o=r.findIndex((function(e){return e.uid===t}));-1!==o?e({kbaseResult:a()(a()({},n().kbaseResult),{},{data:{content:[].concat(s()(r.slice(0,o)),s()(r.slice(o+1)))}})}):console.warn("Kbase not found in cache:",t),n().currentKbase.uid===t&&e({currentKbase:{uid:"",orgUid:""}})},deleteKbaseCache:function(){return e({},!0)}}})),{name:i.wKE})))}}]);