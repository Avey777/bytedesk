"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[7072],{30234:function(e,t,a){var s=a(25191),r=a(32057),n=a(75699);t.Z=function(){var e=(0,n.useIntl)();return{translateString:function(t){return null==t?t:t&&(null!=t&&t.startsWith(s.VoP)||null!=t&&t.startsWith("ROLE_"))?e.formatMessage({id:t,defaultMessage:t}):t},translateStringTranct:function(t){return null==t?t:null!=t&&t.startsWith(s.VoP)||null!=t&&t.startsWith("ROLE_")?(0,r.aS)(e.formatMessage({id:t,defaultMessage:t}),10):(0,r.aS)(t,10)}}}},67072:function(e,t,a){a.d(t,{Z:function(){return ee}});var s=a(73193),r=a.n(s),n=a(84176),i=a.n(n),l=a(90819),d=a.n(l),o=a(89933),u=a.n(o),c=a(76711),f=a.n(c),m=a(45332),p=a.n(m),g=a(31756),M=a(25191),h=a(75699);function x(e){return v.apply(this,arguments)}function v(){return(v=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/license/query/org",{method:"GET",params:r()(r()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function y(e){return b.apply(this,arguments)}function b(){return(b=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/license/create",{method:"POST",data:r()(r()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function w(e){return j.apply(this,arguments)}function j(){return(j=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/license/update",{method:"POST",data:r()(r()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function S(e){return E.apply(this,arguments)}function E(){return(E=u()(d()().mark((function e(t){return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(0,h.request)("/api/v1/license/delete",{method:"POST",data:r()(r()({},t),{},{channel:M.XtJ})}));case 1:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var I=a(31881),F=a(83381),D=a(6992),P=a(79148),k=a(35129),C=a(44532),T=a(77407),Z=a(79640),A=a(44194),L=a(86222),B=a.n(L),K=a(6373),Y=a(22766),O=a(12581),q=a(31051),U=a(17115),R=a(3e3),z=a(8957),N=a(24418),_=a(43413),J=a(76790),V=a(28977),W=a.n(V),X=a(31549),$=function(e){var t=e.isEdit,a=e.license,s=e.open,n=e.isSuperUser,i=e.onClose,l=e.onSubmit,d=(0,h.useIntl)(),o=K.A.useForm(),u=p()(o,1)[0],c=(0,J.L)((function(e){return e.userInfo})),f=(0,I.u)((function(e){return e.currentOrg})),m=(0,A.useState)(""),g=p()(m,2);g[0],g[1];return(0,A.useEffect)((function(){if(t)u.setFieldsValue({uid:null==a?void 0:a.uid,name:null==a?void 0:a.name,description:null==a?void 0:a.description,mobile:null==a?void 0:a.mobile,email:null==a?void 0:a.email,userType:null==a?void 0:a.userType,expiryDate:null==a?void 0:a.expiryDate,edition:null==a?void 0:a.edition,serverIps:null==a?void 0:a.serverIps,serverDomains:null==a?void 0:a.serverDomains,enabled:null==a?void 0:a.enabled,activatedAt:null==a?void 0:a.activatedAt,lastCheckedAt:null==a?void 0:a.lastCheckedAt});else{var e=W()().add(30,"day").format("YYYY-MM-DD HH:mm:ss");u.setFieldsValue({mobile:null==c?void 0:c.mobile,email:null==c?void 0:c.email,userType:M.Bv_,edition:M.dbF,expiryDate:e})}}),[t,a,u,c]),(0,X.jsx)(X.Fragment,{children:(0,X.jsx)(N.Z,{title:d.formatMessage({id:"license.title",defaultMessage:"License"}),width:600,onClose:i,open:s,extra:(0,X.jsxs)(_.Z,{children:[(0,X.jsx)(T.ZP,{onClick:i,children:d.formatMessage({id:"cancel",defaultMessage:"Cancel"})}),(0,X.jsx)(T.ZP,{type:"primary",onClick:function(){return u.submit()},children:d.formatMessage({id:"submit",defaultMessage:"Submit"})})]}),children:(0,X.jsxs)(K.A,{form:u,name:"licenseForm",onFinish:function(){console.log("handleSubmit"),null!=c&&c.mobileVerified||null!=c&&c.emailVerified?u.validateFields().then((function(e){var t=r()({},e),a=r()(r()({},t),{},{orgUid:null==f?void 0:f.uid});console.log("submit",a),l(a)})):z.ZP.error(d.formatMessage({id:"license.verification.required",defaultMessage:"请先完成手机或邮箱验证后再创建License"}))},submitter:!1,children:[(0,X.jsx)(Y.Z,{label:d.formatMessage({id:"name",defaultMessage:"Name"}),name:"name",rules:[{required:!0},{validator:function(e,t){return"string"==typeof t&&t.toLowerCase().includes("weiyu")?Promise.reject(new Error(d.formatMessage({id:"license.name.weiyu.forbidden",defaultMessage:"名称不能包含 weiyu"}))):Promise.resolve()}}]}),(0,X.jsx)(O.Z,{label:d.formatMessage({id:"description",defaultMessage:"Description"}),name:"description",placeholder:d.formatMessage({id:"license.description.placeholder",defaultMessage:"Optional, license usage description"})}),(0,X.jsx)(Y.Z,{label:d.formatMessage({id:"mobile",defaultMessage:"Mobile"}),name:"mobile",disabled:!0}),(0,X.jsx)(Y.Z,{label:d.formatMessage({id:"email",defaultMessage:"Email"}),name:"email",disabled:!0}),(0,X.jsx)(q.Z,{label:d.formatMessage({id:"userType",defaultMessage:"User Type"}),name:"userType",options:[{label:d.formatMessage({id:"license.user.type.free",defaultMessage:"Free"}),value:M.Bv_},{label:d.formatMessage({id:"license.user.type.paid",defaultMessage:"Paid"}),value:M.u0z,disabled:!n}],extra:(0,X.jsx)("a",{href:"https://www.weiyuai.cn/docs/zh-CN/docs/payment#%E8%81%94%E7%B3%BB%E6%96%B9%E5%BC%8F",target:"_blank",rel:"noopener noreferrer",style:{color:"#1677ff"},children:d.formatMessage({id:"license.userType.paid.tip",defaultMessage:"购买付费版请访问微语官网-版本与价格"})})}),(0,X.jsx)(U.Z,{label:d.formatMessage({id:"expiryDate",defaultMessage:"Expiry Date"}),name:"expiryDate",fieldProps:{format:"YYYY-MM-DD"},rules:[{required:!0,message:d.formatMessage({id:"license.expiryDate.required",defaultMessage:"Please select expiry date"})}],disabled:!n}),(0,X.jsx)(q.Z,{label:d.formatMessage({id:"edition",defaultMessage:"Edition"}),name:"edition",options:[{label:d.formatMessage({id:"license.edition.community",defaultMessage:"Community Edition"}),value:M.dbF},{label:d.formatMessage({id:"license.edition.enterprise",defaultMessage:"Enterprise Edition"}),value:M.hj_},{label:d.formatMessage({id:"license.edition.platform",defaultMessage:"Platform Edition"}),value:M.tmZ}]}),(0,X.jsx)(Y.Z,{label:d.formatMessage({id:"serverIps",defaultMessage:"Authorized IPs"}),name:"serverIps",placeholder:d.formatMessage({id:"license.comma.separated",defaultMessage:"Comma separated"}),extra:d.formatMessage({id:"license.serverIps.format",defaultMessage:"Format: 192.168.1.1, 10.0.0.1, 2001:db8::1"}),rules:[{validator:function(e,t){if(!t)return Promise.resolve();var a,s=t.split(",").map((function(e){return e.trim()})).filter(Boolean),r=/^(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d{2}|[1-9]?\d)){3}$/,n=/^([\da-fA-F]{1,4}:){7}[\da-fA-F]{1,4}$/,i=B()(s);try{for(i.s();!(a=i.n()).done;){var l=a.value;if(!r.test(l)&&!n.test(l))return Promise.reject(new Error(d.formatMessage({id:"license.serverIps.error",defaultMessage:"Please enter valid IP addresses, separated by commas"})))}}catch(e){i.e(e)}finally{i.f()}return Promise.resolve()}}]}),(0,X.jsx)(Y.Z,{label:d.formatMessage({id:"serverDomains",defaultMessage:"Authorized Domains"}),name:"serverDomains",placeholder:d.formatMessage({id:"license.comma.separated",defaultMessage:"Comma separated"}),extra:d.formatMessage({id:"license.serverDomains.format",defaultMessage:"Format: example.com, sub.example.com:8080, *.example.com"}),rules:[{validator:function(e,t){if(!t)return Promise.resolve();var a,s=t.split(",").map((function(e){return e.trim()})).filter(Boolean),r=B()(s);try{for(r.s();!(a=r.n()).done;){var n=a.value;if(!/^([A-Za-z0-9-]{1,63}\.)+[A-Za-z]{2,}(:\d{1,5})?$/.test(n))return Promise.reject(new Error(d.formatMessage({id:"license.serverDomains.error",defaultMessage:"Please enter valid domains, separated by commas"})))}}catch(e){r.e(e)}finally{r.f()}return Promise.resolve()}}]}),(0,X.jsx)(R.Z,{label:d.formatMessage({id:"enabled",defaultMessage:"Enabled"}),name:"enabled",fieldProps:{checkedChildren:d.formatMessage({id:"license.enabled",defaultMessage:"Enabled"}),unCheckedChildren:d.formatMessage({id:"license.disabled",defaultMessage:"Disabled"})}})]})})})},H=a(30234),G=a(223),Q=["current","pageSize"],ee=function(e){var t=e.isSuperUser,a=(0,h.useIntl)(),s=(0,A.useRef)(),n=(0,H.Z)().translateString,l=(0,A.useState)(1),o=p()(l,2),c=(o[0],o[1]),m=(0,A.useState)(10),M=p()(m,2),v=(M[0],M[1]),b=(0,I.u)((function(e){return e.currentOrg})),j=(0,A.useState)(!1),E=p()(j,2),L=E[0],B=E[1],K=(0,A.useState)({}),Y=p()(K,2),O=Y[0],q=Y[1],U=(0,A.useState)(!1),R=p()(U,2),z=R[0],N=R[1],_=k.Z.useModal(),J=p()(_,2),V=J[0],ee=J[1],te=(0,A.useState)([]),ae=p()(te,2),se=ae[0],re=ae[1],ne=(0,A.useState)([]),ie=p()(ne,2),le=(ie[0],ie[1]),de=(0,A.useState)(0),oe=p()(de,2),ue=(oe[0],oe[1]),ce=(0,A.useState)({}),fe=p()(ce,2),me=(fe[0],fe[1]),pe=[{dataIndex:"index",valueType:"indexBorder",width:48,fixed:"left"},{title:(0,X.jsx)(h.FormattedMessage,{id:"name",defaultMessage:"Name"}),dataIndex:"name",copyable:!0,fixed:"left",width:150},{title:(0,X.jsx)(h.FormattedMessage,{id:"description",defaultMessage:"Description"}),dataIndex:"description",width:150,ellipsis:!0},{title:(0,X.jsx)(h.FormattedMessage,{id:"mobile",defaultMessage:"Mobile"}),dataIndex:"mobile",width:120},{title:(0,X.jsx)(h.FormattedMessage,{id:"email",defaultMessage:"Email"}),dataIndex:"email",width:180},{title:(0,X.jsx)(h.FormattedMessage,{id:"userType",defaultMessage:"User Type"}),dataIndex:"userType",hideInSearch:!0,width:120,valueEnum:{FREE:{text:(0,X.jsx)(h.FormattedMessage,{id:"license.user.type.free",defaultMessage:"Free"})},PAID:{text:(0,X.jsx)(h.FormattedMessage,{id:"license.user.type.paid",defaultMessage:"Paid"})}}},{title:(0,X.jsx)(h.FormattedMessage,{id:"expiryDate",defaultMessage:"Expiry Date"}),dataIndex:"expiryDate",hideInSearch:!0,width:120,render:function(e){return e?W()(e).format("YYYY-MM-DD"):""}},{title:(0,X.jsx)(h.FormattedMessage,{id:"edition",defaultMessage:"Edition"}),dataIndex:"edition",hideInSearch:!0,width:120,valueEnum:{COMMUNITY:{text:(0,X.jsx)(h.FormattedMessage,{id:"license.edition.community",defaultMessage:"Community Edition"})},ENTERPRISE:{text:(0,X.jsx)(h.FormattedMessage,{id:"license.edition.enterprise",defaultMessage:"Enterprise Edition"})},PLATFORM:{text:(0,X.jsx)(h.FormattedMessage,{id:"license.edition.platform",defaultMessage:"Platform Edition"})}}},{title:(0,X.jsx)(h.FormattedMessage,{id:"serverIps",defaultMessage:"Server IPs"}),dataIndex:"serverIps",hideInSearch:!0,width:180,ellipsis:!0},{title:(0,X.jsx)(h.FormattedMessage,{id:"serverDomains",defaultMessage:"Server Domains"}),dataIndex:"serverDomains",hideInSearch:!0,width:180,ellipsis:!0},{title:(0,X.jsx)(h.FormattedMessage,{id:"licenseKey",defaultMessage:"License Key"}),dataIndex:"licenseKey",width:200,copyable:!0,ellipsis:!0}].concat(f()(t?[{title:(0,X.jsx)(h.FormattedMessage,{id:"encryptedLicenseKey",defaultMessage:"Encrypted License Key"}),dataIndex:"encryptedLicenseKey",width:200,copyable:!0,ellipsis:!0}]:[]),[{title:(0,X.jsx)(h.FormattedMessage,{id:"enabled",defaultMessage:"Enabled"}),dataIndex:"enabled",hideInSearch:!0,width:100,valueType:"select",valueEnum:{true:{text:"启用",status:"Success"},false:{text:"禁用",status:"Error"}}},{title:(0,X.jsx)(h.FormattedMessage,{id:"createdAt",defaultMessage:"Created At"}),dataIndex:"createdAt",hideInSearch:!0,width:180,valueType:"dateTime"},{title:(0,X.jsx)(h.FormattedMessage,{id:"updatedAt",defaultMessage:"Updated At"}),dataIndex:"updatedAt",hideInSearch:!0,width:180,valueType:"dateTime"}]),ge=[].concat(f()(pe),[{title:a.formatMessage({id:"actions",defaultMessage:"Actions"}),valueType:"option",key:"option",fixed:"right",width:220,render:function(e,s,r,i){return[(0,X.jsx)("a",{onClick:function(){q(s),N(!0),B(!0)},children:a.formatMessage({id:"edit",defaultMessage:"Edit"})},"editable"),(0,X.jsx)(C.Z,{title:a.formatMessage({id:"deleteTip"}),description:"".concat(a.formatMessage({id:"deleteAffirm",defaultMessage:"Delete"}),"【").concat(n(s.name),"】？"),onConfirm:function(){return Me(s)},okText:a.formatMessage({id:"ok"}),cancelText:a.formatMessage({id:"cancel"}),icon:(0,X.jsx)(F.Z,{style:{color:"red"}}),children:(0,X.jsx)(T.ZP,{type:"link",danger:!0,children:a.formatMessage({id:"delete",defaultMessage:"Delete"})})},"delete")].concat(f()(t?[(0,X.jsx)(T.ZP,{type:"link",onClick:function(){return ye(s.encryptedLicenseKey)},children:"测试"},"test-decrypt")]:[]))}}]),Me=function(){var e=u()(d()().mark((function e(t){var r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.log("deleteLicense:",t),e.next=3,S(t);case 3:r=e.sent,console.log("deleteLicense:",r),200===r.code?(g.yw.success(a.formatMessage({id:"delete.success",defaultMessage:"Delete success"})),s.current.reload()):g.yw.error(r.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),he=function(){var e=u()(d()().mark((function e(t){var a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,y(t);case 2:a=e.sent,console.log("handleCreateLicense response:",a),200===a.code?(null===(r=s.current)||void 0===r||r.reload(),B(!1)):g.yw.error(a.message);case 5:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),xe=function(){var e=u()(d()().mark((function e(t){var a,r;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.uid=null==O?void 0:O.uid,e.next=3,w(t);case 3:a=e.sent,console.log("handleUpdateLicense response:",a),200===a.code?(null===(r=s.current)||void 0===r||r.reload(),B(!1)):g.yw.error(a.message);case 6:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),ve=function(){B(!0),N(!1),q({})},ye=function(e){try{var t=(0,G.K_)(e);V.info({title:"解密结果",content:(0,X.jsx)("div",{style:{wordBreak:"break-all"},children:(0,X.jsx)("pre",{children:JSON.stringify(t,null,2)})}),width:600})}catch(e){V.error({title:"解密失败",content:String(e)})}},be={selectedRowKeys:se,onChange:function(e,t){re(e),le(t)}},we=function(){var e=u()(d()().mark((function e(a,s,n){var l,o,u,f,m;return d()().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return l=a.current,o=a.pageSize,u=i()(a,Q),c(l),v(o),me(u),f=r()({pageNumber:l-1,pageSize:o,orgUid:null==b?void 0:b.uid,isSuperUser:t},u),e.next=7,x(f);case 7:return m=e.sent,console.log("queryLicensesByOrg response:",m,f),200===m.code?ue(m.data.totalElements):g.yw.error(m.message),e.abrupt("return",{data:m.data.content,success:!0,total:m.data.totalElements});case 11:case"end":return e.stop()}}),e)})));return function(t,a,s){return e.apply(this,arguments)}}();return(0,X.jsxs)(X.Fragment,{children:[L&&(0,X.jsx)($,{isEdit:z,open:L,license:O,isSuperUser:t,onClose:function(){B(!1)},onSubmit:function(e){console.log("onDrawerSubmit:",e),z?xe(e):he(e)}}),(0,X.jsx)(P.Z,{columns:ge,actionRef:s,cardBordered:!0,rowSelection:be,request:we,scroll:{x:1e3},rowKey:function(e){return e.uid||e.licenseKey||e.email||e.name},search:{labelWidth:"auto"},pagination:{showQuickJumper:!0,onChange:function(e,t){c(e),v(t)}},dateFormatter:"string",headerTitle:"License列表",toolBarRender:function(){return[(0,X.jsx)(T.ZP,{type:"primary",icon:(0,X.jsx)(D.Z,{}),onClick:ve,children:a.formatMessage({id:"create",defaultMessage:"Create"})},"create")]}}),(0,X.jsx)(Z.Z,{message:"重要说明",description:"为防止客服系统被用于诈骗等非法行为，系统采用licenseKey机制进行授权管理。请妥善保管您的licenseKey，避免泄露或被盗用，确保系统安全使用。",type:"info",showIcon:!0,style:{marginTop:16}}),ee]})}}}]);