"use strict";(self.webpackChunkadmin=self.webpackChunkadmin||[]).push([[4480],{7999:function(t,e,n){n.d(e,{AT:function(){return p},Lr:function(){return R},_t:function(){return l},i8:function(){return w},n1:function(){return x},sE:function(){return v},x_:function(){return g}});var r=n(90819),a=n.n(r),i=n(73193),u=n.n(i),s=n(89933),c=n.n(s),o=n(25191),d=n(75699);function l(t){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/query/org",{method:"GET",params:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/query/uid",{method:"GET",params:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/create",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/update",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function x(t){return k.apply(this,arguments)}function k(){return(k=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/update/avatar",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function w(t){return j.apply(this,arguments)}function j(){return(j=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/update/autoreply",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function R(t){return M.apply(this,arguments)}function M(){return(M=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/agent/delete",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},89295:function(t,e,n){n.d(e,{If:function(){return v},dF:function(){return l},j4:function(){return g},v$:function(){return p}});var r=n(90819),a=n.n(r),i=n(73193),u=n.n(i),s=n(89933),c=n.n(s),o=n(25191),d=n(75699);function l(t){return f.apply(this,arguments)}function f(){return(f=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/query/org",{method:"GET",params:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function p(t){return m.apply(this,arguments)}function m(){return(m=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/create",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function g(t){return h.apply(this,arguments)}function h(){return(h=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/update",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function v(t){return y.apply(this,arguments)}function y(){return(y=c()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,d.request)("/api/v1/department/delete",{method:"POST",data:u()(u()({},e),{},{channel:o.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}},30234:function(t,e,n){var r=n(25191),a=n(32057),i=n(75699);e.Z=function(){var t=(0,i.useIntl)();return{translateString:function(e){return null==e?e:e&&(null!=e&&e.startsWith(r.VoP)||null!=e&&e.startsWith("ROLE_"))?t.formatMessage({id:e,defaultMessage:e}):e},translateStringTranct:function(e){return null==e?e:null!=e&&e.startsWith(r.VoP)||null!=e&&e.startsWith("ROLE_")?(0,a.aS)(t.formatMessage({id:e,defaultMessage:e}),10):(0,a.aS)(e,10)}}}},38699:function(t,e,n){n.r(e),n.d(e,{default:function(){return G}});var r=n(90819),a=n.n(r),i=n(89933),u=n.n(i),s=n(45332),c=n.n(s),o=n(44194),d=n(64024),l=n(49053),f=n(51438),p=n(81020),m=n(65515),g=n(51096),h=n(4363),v=n(19924),y=n(17129),x=n(9110),k=n(13522),w=n(46263),j=n(80090),R=n(74947),M=n(12201),S=n(94011),D=n(35911),Z=n(75699),b=n(45135),O=n(73193),T=n.n(O),A=n(25191);function F(t){return q.apply(this,arguments)}function q(){return(q=u()(a()().mark((function t(e){return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",(0,Z.request)("/api/v1/ticket/statistic/query/date",{method:"GET",params:T()(T()({},e),{},{channel:A.XtJ})}));case 1:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var E=n(31756),Y=n(31881),U=n(76001),C=n(7999),P=n(30234),J=n(28977),X=n.n(J),I=n(89295),B=n(54693),W=n(31549),z=d.default.RangePicker,_=l.Z.Option,G=function(){var t,e,n=(0,Z.useIntl)(),r=(0,P.Z)().translateStringTranct,i=(0,o.useState)(X()().startOf("day")),s=c()(i,2),d=s[0],O=s[1],T=(0,o.useState)(X()().endOf("day")),q=c()(T,2),J=q[0],G=q[1],H=(0,o.useState)("today"),N=c()(H,2),L=N[0],K=N[1],V=(0,o.useState)(A.AOk),$=c()(V,2),Q=$[0],tt=$[1],et=(0,o.useState)(),nt=c()(et,2),rt=nt[0],at=nt[1],it=(0,o.useState)(),ut=c()(it,2),st=ut[0],ct=ut[1],ot=(0,Y.u)((function(t){return t.currentOrg})),dt=(0,U.E)((function(t){return t})),lt=dt.agentResult,ft=dt.setAgentResult,pt=(0,B.H)((function(t){return t})),mt=pt.departmentResult,gt=pt.setDepartmentResult,ht=(0,o.useState)(),vt=c()(ht,2),yt=vt[0],xt=vt[1],kt=(0,o.useState)(A.OwA),wt=c()(kt,2),jt=wt[0],Rt=wt[1],Mt=(0,o.useState)(!1),St=c()(Mt,2),Dt=St[0],Zt=St[1],bt=[{label:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.timeRange.today"}),value:"today"},{label:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.timeRange.yesterday"}),value:"yesterday"},{label:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.timeRange.week"}),value:"week"},{label:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.timeRange.lastWeek"}),value:"lastWeek"},{label:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.timeRange.month"}),value:"month"},{label:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.timeRange.custom"}),value:"custom"}];(0,o.useEffect)((function(){if("custom"===L)O(d),G(J),Rt(A.dd4);else{var t=X()();"today"===L?(O(t),G(t),Rt(A.OwA)):"yesterday"===L?(O(t.subtract(1,"day")),G(t.subtract(1,"day")),Rt(A.OwA)):"week"===L?(O(t.startOf("week")),G(t.endOf("week")),Rt(A.dd4)):"lastWeek"===L?(O(t.subtract(1,"week").startOf("week")),G(t.subtract(1,"week").endOf("week")),Rt(A.dd4)):"month"===L&&(O(t.startOf("month")),G(t.endOf("month")),Rt(A.dd4))}}),[L]);var Ot=function(){var t=u()(a()().mark((function t(){var e,n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E.yw.loading("loading"),e={pageNumber:0,pageSize:100,orgUid:null==ot?void 0:ot.uid},t.next=4,(0,I.dF)(e);case 4:n=t.sent,console.log("queryDepartmentsByOrg:",n,e),200===n.code?(E.yw.destroy(),gt(n),n.data.content.length>0&&ct(n.data.content[0].uid)):(E.yw.destroy(),E.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),Tt=function(){var t=u()(a()().mark((function t(){var e,n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E.yw.loading("loading"),e={pageNumber:0,pageSize:50,orgUid:null==ot?void 0:ot.uid},t.next=4,(0,C._t)(e);case 4:n=t.sent,console.log("fetchAllAgents: ",n),200===n.code?(E.yw.destroy(),ft(n),n.data.content.length>0&&at(n.data.content[0].uid)):(E.yw.destroy(),E.yw.error(r(n.message))),console.log("queryAllAgents response",n);case 8:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}(),At=function(){var t=u()(a()().mark((function t(){var e,r;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Zt(!0),t.prev=1,E.yw.loading("loading"),e={type:Q,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==J?void 0:J.format("YYYY-MM-DD 23:59:59"),departmentUid:st,assigneeUid:rt,orgUid:null==ot?void 0:ot.uid},t.next=6,F(e);case 6:r=t.sent,console.log("queryStatisticTicketByDate response",r,e),200===r.code?(E.yw.destroy(),xt(r.data)):(E.yw.destroy(),E.yw.error(r.message)),t.next=14;break;case 11:t.prev=11,t.t0=t.catch(1),E.yw.error(n.formatMessage({id:"ticket.message.operation.failed"}));case 14:return t.prev=14,Zt(!1),t.finish(14);case 17:case"end":return t.stop()}}),t,null,[[1,11,14,17]])})));return function(){return t.apply(this,arguments)}}(),Ft=function(){var t=u()(a()().mark((function t(){var e,n;return a()().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return E.yw.loading("loading"),e={type:Q,statisticStartTime:null==d?void 0:d.format("YYYY-MM-DD 00:00:00"),statisticEndTime:null==J?void 0:J.format("YYYY-MM-DD 23:59:59"),departmentUid:st,assigneeUid:rt,orgUid:null==ot?void 0:ot.uid},t.next=4,F(e);case 4:n=t.sent,console.log("queryStatisticTicketByDate response",n,e),200===n.code?E.yw.destroy():(E.yw.destroy(),E.yw.error(n.message));case 7:case"end":return t.stop()}}),t)})));return function(){return t.apply(this,arguments)}}();(0,o.useEffect)((function(){Ot(),Tt()}),[]),(0,o.useEffect)((function(){At()}),[Q,rt,st]),(0,o.useEffect)((function(){Ft()}),[jt,Q,rt,st]),(0,o.useEffect)((function(){At()}),[d,J]);var qt=[{title:n.formatMessage({id:"ticket.statistic.total"}),value:(null==yt?void 0:yt.totalTickets)||0,icon:(0,W.jsx)(w.Z,{}),color:"#1890ff"},{title:n.formatMessage({id:"ticket.statistic.resolved"}),value:(null==yt?void 0:yt.resolvedTickets)||0,icon:(0,W.jsx)(j.Z,{}),color:"#52c41a"},{title:n.formatMessage({id:"ticket.statistic.resolution.rate"}),value:"".concat((null==yt?void 0:yt.resolvedTickets)/(null==yt?void 0:yt.totalTickets)||0,"%"),icon:(0,W.jsx)(R.Z,{}),color:"#722ed1"},{title:n.formatMessage({id:"ticket.statistic.satisfaction"}),value:"".concat((null==yt?void 0:yt.customerSatisfactionRate)||0,"%"),icon:(0,W.jsx)(M.Z,{}),color:"#fa8c16"}];return(0,W.jsxs)("div",{style:{padding:16},children:[(0,W.jsx)(f.Z,{style:{marginBottom:16},children:(0,W.jsxs)(p.Z,{direction:"vertical",style:{width:"100%"},children:[(0,W.jsxs)(p.Z,{wrap:!0,children:[(0,W.jsx)(m.ZP.Group,{value:L,onChange:function(t){return K(t.target.value)},children:bt.map((function(t){return(0,W.jsx)(m.ZP.Button,{value:t.value,children:t.label},t.value)}))}),"custom"===L&&(0,W.jsx)(z,{value:[d,J],onChange:function(t){O(t[0]),G(t[1])}})]}),(0,W.jsxs)(p.Z,{wrap:!0,children:[(0,W.jsxs)(l.Z,{placeholder:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.type"}),style:{width:200},value:Q,onChange:function(t){return tt(t)},children:[(0,W.jsx)(_,{value:A.AOk,children:(0,W.jsx)(Z.FormattedMessage,{id:"i18n.all"})}),(0,W.jsx)(_,{value:A.pHh,children:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.agent"})}),(0,W.jsx)(_,{value:A.j0X,children:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.department"})})]}),Q===A.pHh&&(0,W.jsx)(l.Z,{placeholder:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.agent"}),style:{width:200},value:rt,onChange:function(t){return at(t)},children:null===(t=lt.data)||void 0===t||null===(t=t.content)||void 0===t?void 0:t.map((function(t){return(0,W.jsx)(_,{value:null==t?void 0:t.uid,children:r(null==t?void 0:t.nickname)},null==t?void 0:t.uid)}))}),Q===A.j0X&&(0,W.jsx)(l.Z,{placeholder:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.department"}),style:{width:200},value:st,onChange:function(t){return ct(t)},children:null===(e=mt.data)||void 0===e||null===(e=e.content)||void 0===e?void 0:e.map((function(t){return(0,W.jsx)(_,{value:null==t?void 0:t.uid,children:r(null==t?void 0:t.name)},null==t?void 0:t.uid)}))}),(0,W.jsx)(g.Z,{title:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.export"}),children:(0,W.jsx)(h.ZP,{icon:(0,W.jsx)(S.Z,{}),onClick:function(){E.yw.warning("TODO: 待实现")},children:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.export"})})}),(0,W.jsx)(g.Z,{title:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.refresh"}),children:(0,W.jsx)(h.ZP,{icon:(0,W.jsx)(D.Z,{}),onClick:function(){return At()},children:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.filter.refresh"})})}),!1]})]})}),(0,W.jsx)(v.Z,{gutter:16,style:{marginBottom:24},children:qt.map((function(t){return(0,W.jsx)(y.Z,{span:6,children:(0,W.jsx)(f.Z,{loading:Dt,children:(0,W.jsx)(x.Z,{title:t.title,value:t.value,prefix:o.cloneElement(t.icon,{style:{color:t.color}}),valueStyle:{color:t.color}})})},t.title)}))}),(0,W.jsx)(f.Z,{title:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.trend"}),style:{marginBottom:24,height:300},loading:Dt,children:(0,W.jsx)(b.Z,{data:[],xField:"date",yField:"value",seriesField:"type",legend:{position:"top"},meta:{type:{formatter:function(t){return n.formatMessage({id:"ticket.statistic.type.".concat(t)})}}}})}),(0,W.jsx)(f.Z,{title:(0,W.jsx)(Z.FormattedMessage,{id:"ticket.statistic.agent.performance"}),loading:Dt,children:(0,W.jsx)(k.Z,{columns:[{title:n.formatMessage({id:"ticket.statistic.agent.name"}),dataIndex:"assigneeName",key:"assigneeName"},{title:n.formatMessage({id:"ticket.statistic.agent.tickets"}),dataIndex:"assigneeTickets",key:"assigneeTickets",sorter:!0},{title:n.formatMessage({id:"ticket.statistic.agent.resolution"}),dataIndex:"assigneeResolutionRate",key:"assigneeResolutionRate",render:function(t){return"".concat(t,"%")},sorter:!0},{title:n.formatMessage({id:"ticket.statistic.agent.satisfaction"}),dataIndex:"customerSatisfactionRate",key:"customerSatisfactionRate",render:function(t){return"".concat(t,"%")},sorter:!0}],rowKey:"assigneeUid",pagination:!1})})]})}},76001:function(t,e,n){n.d(e,{E:function(){return l}});var r=n(73193),a=n.n(r),i=n(76711),u=n.n(i),s=n(25191),c=n(16894),o=n(45034),d=n(47401),l=(0,c.Ue)()((0,o.mW)((0,o.tJ)((0,d.n)((function(t,e){return{agentResult:{data:{content:[]}},currentAgent:{uid:"",orgUid:""},insertAgent:function(e){t((function(t){t.agentResult.data.content.unshift(e)}))},updateAgent:function(e){t((function(t){var n=t.agentResult.data.content,r=n.findIndex((function(t){return t.uid===e.uid}));-1!==r?n[r]=e:console.warn("Agent with uid ".concat(e.uid," not found."))}))},setAgentResult:function(n){var r;(t({agentResult:n}),""===e().currentAgent.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&t({currentAgent:n.data.content[0]}))},setCurrentAgent:function(n){var r=e().agentResult.data.content,i=r.findIndex((function(t){return t.uid===n.uid}));if(-1!==i){var s=[].concat(u()(r.slice(0,i)),[n],u()(r.slice(i+1))),c=a()(a()({},e().agentResult),{},{data:{content:s}});t({agentResult:c,currentAgent:n})}else console.warn("Agent with the specified uid not found."),t({currentAgent:n})},deleteCurrentAgent:function(n){var r=e().agentResult.data.content,i=r.findIndex((function(t){return t.uid===n}));-1!==i?t({agentResult:a()(a()({},e().agentResult),{},{data:{content:[].concat(u()(r.slice(0,i)),u()(r.slice(i+1)))}})}):console.warn("Agent not found in cache:",n),e().currentAgent.uid===n&&t({currentAgent:{uid:"",orgUid:""}})},deleteAgentCache:function(){return t({},!0)}}})),{name:s.zzK})))},54693:function(t,e,n){n.d(e,{H:function(){return p}});var r=n(86222),a=n.n(r),i=n(76711),u=n.n(i),s=n(73193),c=n.n(s),o=n(25191),d=n(16894),l=n(45034),f=n(47401),p=(0,d.Ue)()((0,l.mW)((0,l.tJ)((0,f.n)((function(t,e){return{departmentResult:{data:{content:[]}},currentDepartment:{uid:o.zBg,nickname:o.zBg},insertDepartment:function(e){t((function(t){var n=t.departmentResult.data.content;if(e.parentUid){var r=n.find((function(t){return t.uid===e.parentUid}));r&&(r.children||(r.children=[]),r.children.push(e))}else n.push(e)}))},upgradeDepartment:function(e){t((function(t){var n=t.departmentResult.data.content,r=n.findIndex((function(t){return t.uid===e.uid}));-1!==r?n[r]=e:n.forEach((function(t){if(t.children){var n=t.children.findIndex((function(t){return t.uid===e.uid}));-1!==n&&(t.children[n]=e)}}))}))},setDepartmentResult:function(n){var r,a={uid:o.zBg,name:o.zBg};(t({departmentResult:c()(c()({},n),{},{data:{content:[a].concat(u()(n.data.content))}})}),""===e().currentDepartment.uid)&&((null===(r=n.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.length)>0&&t({currentDepartment:n.data.content[0]}))},setCurrentDepartment:function(n){var r=e().departmentResult.data.content,a=r.findIndex((function(t){return t.uid===n.uid}));if(-1!==a){var i=[].concat(u()(r.slice(0,a)),[n],u()(r.slice(a+1))),s=c()(c()({},e().departmentResult),{},{data:{content:i}});t({departmentResult:s,currentDepartment:n})}else console.warn("Department with the specified uid not found."),t({currentDepartment:n})},removeDepartment:function(n){t((function(t){var e=t.departmentResult.data.content;t.departmentResult.data.content=function t(e,n){return e.filter((function(e){return e.uid!==n&&(e.children&&(e.children=t(e.children,n)),!0)}))}(e,n)})),e().currentDepartment.uid===n&&t({currentDepartment:{uid:""}})},setCurrentDepUid:function(n){var r,i,u=null===(r=e().departmentResult)||void 0===r||null===(r=r.data)||void 0===r||null===(r=r.content)||void 0===r?void 0:r.find((function(t){return t.uid===n}));if(u)t({currentDepartment:u});else{!function e(r){var i,u=a()(r);try{for(u.s();!(i=u.n()).done;){var s=i.value;if(s.uid===n)return void t({currentDepartment:s});s.children&&s.children.length>0&&e(s.children)}}catch(t){u.e(t)}finally{u.f()}}((null===(i=e().departmentResult)||void 0===i||null===(i=i.data)||void 0===i?void 0:i.content)||[])}},deleteDepartmentCache:function(){return t({},!0)}}})),{name:o.xY_})))}}]);